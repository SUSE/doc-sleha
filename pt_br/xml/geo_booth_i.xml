<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_booth_i.xml" version="5.0" xml:id="sec.ha.geo.booth">
 <title>Configurando os serviços de booth</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>editando</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes (sim)</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  A configuração padrão de booth é <filename>/etc/booth/booth.conf</filename>. Esse arquivo deve ser o mesmo em todos os sites do cluster Geo, incluindo o(s) arbitrador(es). Para manter a configuração de booth síncrona em todos os sites e arbitradores, use o Csync2, conforme descrito na <xref linkend="sec.ha.geo.booth.sync"/>.
 </para>

 <note xml:id="note.ha.geo.booth.ownership">
  <title>Propriedade do <filename class="directory">/etc/booth</filename> e arquivos</title>
  <para>
   O diretório <filename class="directory">/etc/booth</filename> e todos os arquivos contidos nele precisam pertencer ao usuário <systemitem class="username">hacluster</systemitem> e ao grupo <systemitem class="groupname">haclient</systemitem>. Sempre que você copiar um novo arquivo desse diretório, use a opção <option>-p</option> para o comando <command>cp</command> para preservar a propriedade. Se preferir, quando você criar um novo arquivo, defina o usuário e o grupo posteriormente com <command>chown</command> <option>hacluster:haclient <replaceable>ARQUIVO</replaceable></option>.
  </para>
 </note>

 <para>
   Para configurações que incluem vários clusters Geo, é possível <quote>compartilhar</quote> o mesmo arbitrador (a partir da <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12). Ao fornecer vários arquivos de configuração de booth, você pode iniciar diversas instâncias de booth no mesmo arbitrador, com cada instância sendo executada em uma porta diferente. Dessa forma, você pode usar <emphasis>uma</emphasis> máquina como arbitrador para <emphasis>diferentes</emphasis> clusters Geo. Para obter detalhes sobre como configurar o booth para vários clusters Geo, consulte a <xref linkend="sec.ha.geo.booth.multi"/>.
 </para>
 
 
 <para>Para evitar que partes maliciosas interrompam o serviço de booth, você pode configurar a autenticação para comunicar com o booth, com base em uma chave compartilhada. Para obter detalhes, consulte <xref linkend="co.ha.geo.booth.config.auth"/> no <xref linkend="ex.ha.booth.conf.default"/>. Todos os hosts que se comunicam com vários servidores de booth precisam dessa chave. Portanto, inclua o arquivo de chave na configuração do Csync2 ou sincronize-o manualmente em todas as partes.</para>

 <sect2 xml:id="sec.ha.geo.booth.default">
  <title>Configuração de booth padrão</title>
  <para>
   Para configurar todos os parâmetros necessários ao booth, edite os arquivos de configuração de booth manualmente ou por meio do módulo <guimenu>Geo Cluster</guimenu> do YaST. Para acessar o módulo do YaST, inicie-o pela linha de comando com <command>yast2 geo-cluster</command> (ou inicie o YaST e selecione <menuchoice><guimenu>Alta Disponibilidade</guimenu> <guimenu>Geo Cluster</guimenu> </menuchoice>).
  </para>
  <example xml:id="ex.ha.booth.conf.default">
   <title>Um arquivo de configuração de booth</title>

<screen><?dbsuse-fo font-size="0.75em"?>

transport = UDP <co xml:id="co.ha.geo.booth.config.transport"/>
port = 9929 <co xml:id="co.ha.geo.booth.config.port"/>
arbitrator = 147.2.207.14 <co xml:id="co.ha.geo.booth.config.arbitrator"/>
site =  192.168.201.151 <co xml:id="co.ha.geo.booth.config.site"/>
site =  192.168.202.151 <xref linkend="co.ha.geo.booth.config.site" xrefstyle="select:label nopage"/>
authfile = /etc/booth/authkey <co xml:id="co.ha.geo.booth.config.auth"/>
ticket = "ticket-nfs" <co xml:id="co.ha.geo.booth.config.ticket"/>
     expire = 600 <co xml:id="co.ha.geo.booth.config.expiry"/>
     timeout = 10 <co xml:id="co.ha.geo.booth.config.timeout"/>
     retries = 5 <co xml:id="co.ha.geo.booth.config.retries"/>
     renewal-freq = 30 <co xml:id="co.ha.geo.booth.config.renewal"/>
     before-acquire-handler<co xml:id="co.ha.geo.booth.config.handler"/> = /etc/booth/ticket-nfs<co xml:id="co.ha.geo.booth.config.script"/> ms_drbd_nfs<co xml:id="co.ha.geo.booth.config.rsc"/>
     acquire-after = 60 <co xml:id="co.ha.geo.booth.config.acquire-after"/>
ticket = "ticketA" <xref linkend="co.ha.geo.booth.config.ticket" xrefstyle="select:label nopage"/>
     expire = 600 <xref linkend="co.ha.geo.booth.config.expiry" xrefstyle="select:label nopage"/>
     timeout = 10 <xref linkend="co.ha.geo.booth.config.timeout" xrefstyle="select:label nopage"/>
     retries = 5 <xref linkend="co.ha.geo.booth.config.retries" xrefstyle="select:label nopage"/>
     renewal-freq = 30 <xref linkend="co.ha.geo.booth.config.renewal" xrefstyle="select:label nopage"/>
     before-acquire-handler<xref linkend="co.ha.geo.booth.config.handler" xrefstyle="select:label nopage"/> = /etc/booth/ticket-A<xref linkend="co.ha.geo.booth.config.script" xrefstyle="select:label nopage"/> db-1 <xref linkend="co.ha.geo.booth.config.rsc" xrefstyle="select:label nopage"/>
     acquire-after = 60 <xref linkend="co.ha.geo.booth.config.acquire-after" xrefstyle="select:label nopage"/>
ticket = "ticketB" <xref linkend="co.ha.geo.booth.config.ticket" xrefstyle="select:label nopage"/>
     expire = 600 <xref linkend="co.ha.geo.booth.config.expiry" xrefstyle="select:label nopage"/>
     timeout = 10 <xref linkend="co.ha.geo.booth.config.timeout" xrefstyle="select:label nopage"/>
     retries = 5 <xref linkend="co.ha.geo.booth.config.retries" xrefstyle="select:label nopage"/>
     renewal-freq = 30 <xref linkend="co.ha.geo.booth.config.renewal" xrefstyle="select:label nopage"/>
     before-acquire-handler<xref linkend="co.ha.geo.booth.config.handler" xrefstyle="select:label nopage"/> = /etc/booth/ticket-B<xref linkend="co.ha.geo.booth.config.script" xrefstyle="select:label nopage"/> db-8 <xref linkend="co.ha.geo.booth.config.rsc" xrefstyle="select:label nopage"/>
     acquire-after = 60 <xref linkend="co.ha.geo.booth.config.acquire-after" xrefstyle="select:label nopage"/>
    </screen>
   <calloutlist>
    <callout arearefs="co.ha.geo.booth.config.transport">
     <para>
      O protocolo de transporte usado para comunicação entre os sites. Apenas o UDP é suportado, mas outras camadas de transporte estarão disponíveis no futuro. Portanto, esse parâmetro pode ser omitido no momento.
     </para>
    </callout>
    <callout arearefs="co.ha.geo.booth.config.port">
     <para>
      A porta que será usada para comunicação entre as instâncias de booth em cada site. Quando a porta padrão (<literal>9929</literal>) não é usada, escolha uma porta que ainda não seja utilizada em outros serviços. Abra a porta nos firewalls dos nós e dos arbitradores. Os clientes de booth usam o TCP para se comunicar com o <systemitem class="daemon">boothd</systemitem>. O booth sempre estará vinculado e escutará nas portas UDP e TCP.
     </para>
    </callout>
    <callout arearefs="co.ha.geo.booth.config.arbitrator">
     <para>
       O endereço IP da máquina que será usada como arbitrador. Adicione uma entrada a cada arbitrador que você usar na configuração do cluster Geo.
     </para>
    </callout>
    <callout arearefs="co.ha.geo.booth.config.site">
     <para>
      O endereço IP usado para o <systemitem class="daemon">boothd</systemitem> em um site. Adicione uma entrada a cada site que você usar na configuração do cluster Geo. Insira os endereços IP virtuais corretos (<systemitem>IPaddr2</systemitem>) para cada site; do contrário, o mecanismo de booth não funcionará corretamente. Para obter detalhes sobre como configurar o IP virtual para o booth, consulte o <xref linkend="pro.ha.geo.setup.rsc.boothd"/>. O booth funciona com os endereços IPv4 e IPv6.

     </para>
    </callout>
    <callout arearefs="co.ha.geo.booth.config.auth">
     <para>
      Parâmetro opcional. Habilita a autenticação de booth em clientes e servidores com base em uma chave compartilhada. Esse parâmetro especifica o caminho para o arquivo de chave. 
     </para>
     <itemizedlist>
      <title>Requisitos principais</title>
      <listitem>
       <para>A chave pode ser binária ou de texto.</para>
       <para>Se for de texto, os seguintes caracteres serão ignorados: espaço em branco à direita e à esquerda, novas linhas.</para>
      </listitem>
      <listitem>
       <para>A chave deve ter entre oito e 64 caracteres.</para>
      </listitem>
      <listitem>
        <para>A chave deve pertencer ao usuário <systemitem class="username">hacluster</systemitem> e ao grupo <systemitem class="groupname">haclient</systemitem>.
        </para>
      </listitem>
      <listitem>
       <para>A chave deve ser legível apenas pelo proprietário do arquivo.</para>
      </listitem>
     </itemizedlist>
    </callout>
    <callout arearefs="co.ha.geo.booth.config.ticket">
     <para>
      O ticket que será gerenciado pelo booth. Para cada ticket, adicione uma entrada <literal>ticket</literal>. Neste exemplo, o ticket <literal>ticket-nfs</literal> será usado para failover do NFS e do DRBD a seguir. Consulte a <xref linkend="sec.ha.geo.drbd"/> para obter os detalhes. 
     </para>
    </callout>
    <callout arearefs="co.ha.geo.booth.config.expiry">
     <para>
      Parâmetro opcional. Define o horário de vencimento do ticket em segundos. Um site que recebeu um ticket renova o ticket regularmente. Se o booth não receber nenhuma informação sobre a renovação do ticket dentro do horário de vencimento definido, o ticket será revogado e concedido a outro site. Se nenhum horário de vencimento for especificado, por padrão, o ticket vencerá após <literal>600</literal> segundos. O parâmetro não deve ser definido como um valor menor do que 120 segundos.
     </para>
    </callout>
    <callout arearefs="co.ha.geo.booth.config.timeout">
     <para>
      Parâmetro opcional. Define um período de tempo de espera em segundos. Após esse período, o booth reenviará os pacotes se ele não receber nenhuma resposta. O tempo de espera definido deve ser longo o suficiente para permitir que os pacotes cheguem até os outros membros do booth (todos os arbitradores e sites).
     </para>
    </callout>
    <callout arearefs="co.ha.geo.booth.config.retries">
     <para>
      Parâmetro opcional. Define quantas vezes o booth tenta enviar os pacotes antes de desistir de esperar pela confirmação de outros sites. Valores menores do que <literal>3</literal> são inválidos e impedem que o booth seja iniciado.
     </para>
    </callout>
    <callout arearefs="co.ha.geo.booth.config.renewal">
     <para>
      Parâmetro opcional. Define o período de frequência de renovação do ticket. Por padrão, a renovação do ticket ocorre a cada metade do horário de vencimento. Se a confiabilidade da rede é frequentemente reduzida durante períodos prolongados, recomenda-se renovar com mais frequência. Antes de cada renovação, <literal>before-acquire-handler</literal> é executado.
     </para>
    </callout>
    <callout arearefs="co.ha.geo.booth.config.handler">
     <para>
      Parâmetro opcional. Suporta um ou mais scripts. Para usar mais de um script, cada script pode ser responsável por verificações diferentes, como o estado do cluster, a conectividade do data center, os sensores de saúde do ambiente, etc. Armazene todos os scripts no diretório <filename>/etc/booth.d/<replaceable>NOME_DO_TICKET</replaceable></filename> e verifique se eles têm a propriedade correta (usuário <systemitem class="username">hacluster</systemitem> e grupo <systemitem class="groupname">haclient</systemitem>). Atribua o nome do diretório como um valor ao parâmetro <parameter>before-acquire-handler</parameter>.
     </para>
     <para>
      Os scripts nesse diretório são executados em ordem alfabética. Todos os scripts serão chamados antes de o <systemitem class="daemon">boothd</systemitem> tentar adquirir ou renovar um ticket. Para conceder ou renovar o ticket, <emphasis>todos</emphasis> os scripts devem ser bem-sucedidos. A semântica é igual à de um script único: Quando o código de saída é diferente de <literal>0</literal>, o <systemitem class="daemon">boothd</systemitem> abandona o ticket.
     </para>
    </callout>
    <callout arearefs="co.ha.geo.booth.config.script">
     <para>
      O script <filename>/usr/share/booth/service-runnable</filename> está incluído no produto como um exemplo. Para usá-lo, vincule-o ao respectivo diretório do <quote>ticket</quote>:
     </para>
     <screen><prompt role="root">root # </prompt><command>ln</command> -s /usr/share/booth/service-runnable /etc/booth.d/<replaceable>TICKET_NAME</replaceable></screen>
     <para>
      Suponha que o diretório <filename>/etc/booth.d<replaceable>NOME_DO_TICKET</replaceable></filename> contenha o script <command>service-runnable</command>. Esse script simples baseia-se no <command>crm_simulate</command>. Ele pode ser usado para testar se determinado recurso de cluster <emphasis>pode</emphasis> ser executado no site do cluster atual. Sendo assim, ele verifica se o cluster é saudável o suficiente para executar o recurso (todas as dependências do recurso foram atendidas, a partição de cluster tem quorum, não há nós com problemas, etc.). Por exemplo, se um serviço na cadeia de dependências tem uma contagem de falhas <literal>INFINITY</literal> em todos os nós disponíveis, o serviço não poderá ser executado no site. Nesse caso, não é útil requerer o ticket.
     </para>
    </callout>
    <callout arearefs="co.ha.geo.booth.config.rsc">
     <para>
      O recurso que será testado por <literal>before-acquire-handler</literal> (neste caso, pelo script <filename>service-runnable</filename>). Você precisa fazer referência ao recurso que é protegido pelo respectivo ticket. Neste exemplo, o recurso <literal>db-1</literal> é protegido por <literal>ticketA</literal>, enquanto <literal>db-8</literal> é protegido por <literal>ticketB</literal>. O recurso do DRBD (<literal>ms_drbd_nfs</literal>) é protegido pelo ticket <literal>ticket-nfs</literal>.
     </para>
    </callout>
    <callout arearefs="co.ha.geo.booth.config.acquire-after">
     <para>
      Parâmetro opcional. Após a perda de um ticket, o booth aguardará também durante esse período antes de adquirir o ticket. Dessa forma, o site que perdeu o ticket pode abandonar os recursos, interrompendo-os ou limitando um nó. Um atraso típico pode ser de <literal>60</literal> segundos, mas basicamente, ele depende dos recursos protegidos e da configuração de limitação. O valor padrão é <literal>0</literal>.
     </para>
     <para>
      Se você não sabe ao certo quanto tempo pode levar para parar ou retroceder os recursos ou limitar um nó (dependendo da <literal>loss-policy</literal>), use esse parâmetro para impedir que os recursos sejam executados em dois sites ao mesmo tempo.
     </para>
    </callout>
   </calloutlist>
  </example>
  <procedure xml:id="pro.ha.geo.setup.booth.config.edit">
   <title>Editando manualmente o arquivo de configuração de booth</title>
   <step>
    <para>
     Efetue login em um nó do cluster como <systemitem class="username">root</systemitem> ou equivalente.
    </para>
   </step>
   <step>
    <para>
     Copie o arquivo de configuração de booth de exemplo <filename>/etc/booth/booth.conf.example</filename> para <filename>/etc/booth/booth.conf</filename>:
    </para>
    <remark>toms 2016-08-09: "cp -p" is needed, see https://bugzilla.suse.com/show_bug.cgi?id=968865#c14</remark>
    <screen><prompt role="root">root # </prompt><command>cp</command> -p /etc/booth/booth.conf.example /etc/booth/booth.conf</screen>
   </step>
   <step>
    <para>
     Edite <filename>/etc/booth/booth.conf</filename> de acordo com o <xref linkend="ex.ha.booth.conf.default"/>.
    </para>
   </step>
   <step>
    <para>
     Verifique suas mudanças e grave o arquivo.
    </para>
   </step>
   <step>
    <para>
     Em todos os nós e arbitradores do cluster, abra a porta no firewall que você configurou para o booth. Consulte o <xref linkend="ex.ha.booth.conf.default"/>, posição <xref linkend="co.ha.geo.booth.config.port"/>.
    </para>
   </step>
  </procedure>
  <procedure xml:id="pro.ha.geo.setup.booth.yast">
   <title>Configurando o booth com o YaST</title>
   <step>
    <para>
     Efetue login em um nó do cluster como <systemitem class="username">root</systemitem> ou equivalente.
    </para>
   </step>
   <step>
    <para>
     Inicie o módulo <guimenu>Geo Cluster</guimenu> do YaST.
    </para>
   </step>
   <step>
    <para>
     Escolha a opção para <guimenu>Editar</guimenu> um arquivo de configuração de booth existente ou clique em <guimenu>Adicionar</guimenu> para criar um novo arquivo:
    </para>
    <substeps performance="required">
     <step xml:id="step.ha.booth.conf.params">
      <para>
       Na tela exibida, configure os seguintes parâmetros:
      </para>
      <itemizedlist>
       <listitem>
        <formalpara>
         <title>Arquivo de Configuração</title>
         <para>
          Um nome para o arquivo de configuração de booth. Por padrão, o YaST sugere <literal>booth</literal>. Esse procedimento grava a configuração de booth em <filename>/etc/booth/booth.conf</filename>. Mude esse valor apenas se você precisar configurar várias instâncias de booth em clusters Geo diferentes, conforme descrito na <xref linkend="sec.ha.geo.booth.multi"/>.
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara>
         <title>Transporte</title>
         <para>
          O protocolo de transporte usado para comunicação entre os sites. Apenas o UDP é suportado, mas outras camadas de transporte estarão disponíveis no futuro. Consulte também o <xref linkend="ex.ha.booth.conf.default"/>, posição <xref linkend="co.ha.geo.booth.config.transport"/>.
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara>
         <title>Porta</title>
         <para>
          A porta que será usada para comunicação entre as instâncias de booth em cada site. Consulte também o <xref linkend="ex.ha.booth.conf.default"/>, posição <xref linkend="co.ha.geo.booth.config.port"/>.
         </para>
        </formalpara>
       </listitem>
       <listitem>
        <formalpara>
         <title>Arbitrador</title>
         <para>
           O endereço IP da máquina que será usada como arbitrador. Consulte também o <xref linkend="ex.ha.booth.conf.default"/>, posição <xref linkend="co.ha.geo.booth.config.arbitrator"/>.
         </para>
        </formalpara>
        <para>
         Para especificar um <guimenu>Arbitrador</guimenu>, clique em <guimenu>Adicionar</guimenu>. Na caixa de diálogo aberta, digite o endereço IP do arbitrador e clique em <guimenu>OK</guimenu>.
        </para>
       </listitem>
       <listitem>
        <formalpara>
         <title>Site</title>
         <para>
          O endereço IP usado para o <systemitem class="daemon">boothd</systemitem> em um site. Consulte também o <xref linkend="ex.ha.booth.conf.default"/>, posição <xref linkend="co.ha.geo.booth.config.site"/>.
         </para>
        </formalpara>
        <para>
         Para especificar um <guimenu>Site</guimenu> do cluster Geo, clique em <guimenu>Adicionar</guimenu>. Na caixa de diálogo aberta, digite o endereço IP de um site e clique em <guimenu>OK</guimenu>.
        </para>
       </listitem>
       <listitem>
        <formalpara>
         <title>Ticket</title>
         <para>
          O ticket que será gerenciado pelo booth. Consulte também o <xref linkend="ex.ha.booth.conf.default"/>, posição <xref linkend="co.ha.geo.booth.config.ticket"/>.
         </para>
        </formalpara>
        <para>
         Para especificar um <guimenu>Ticket</guimenu>, clique em <guimenu>Adicionar</guimenu>. Na caixa de diálogo aberta, digite um nome de <guimenu>Ticket</guimenu> exclusivo. Se você precisar definir vários tickets com os mesmos parâmetros e valores, reduza o trabalho de configuração criando um <quote>gabarito de ticket</quote>, que especifica os parâmetros e valores padrão para todos os tickets. Para fazer isso, use <literal>__default__</literal> como o nome do <guimenu>Ticket</guimenu>.
        </para>
       </listitem>
       <listitem>
        
        <formalpara>
         <title>Autenticação</title>
         <para>Para habilitar a autenticação para o booth, clique em <guimenu>Autenticação</guimenu> e, na caixa de diálogo aberta, ative <guimenu>Habilitar Autenticação de Segurança</guimenu>. Se você já tem uma chave, especifique o caminho e o nome de arquivo em <guimenu>Arquivo de autenticação</guimenu>. Para gerar um arquivo de chave para um novo cluster Geo, clique em <guimenu>Gerar Arquivo de Chave de Autenticação</guimenu>. A chave será criada e gravada no local especificado em <guimenu>Arquivo de autenticação</guimenu>.</para>
        </formalpara>
        <para>
         Além disso, você pode especificar parâmetros opcionais para o ticket. Para obter uma visão geral, consulte o <xref linkend="ex.ha.booth.conf.default"/>, posições <xref linkend="co.ha.geo.booth.config.expiry"/> a <xref linkend="co.ha.geo.booth.config.acquire-after"/>.
        </para>
        <para>
         Clique em <guimenu>OK</guimenu> para confirmar as mudanças.
        </para>
       </listitem>
      </itemizedlist>
      <figure xml:id="fig.yast2.ha.geo.booth">
       <title>Dependência de Ticket de Exemplo</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="yast2_geo_cluster_booth.png" width="80%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="yast2_geo_cluster_booth.png" width="50%" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </step>
     <step>
      <para>
       Clique em <guimenu>OK</guimenu> para fechar a tela de configuração de booth atual. O YaST mostra o nome do arquivo de configuração de booth que você definiu.
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Antes de fechar o módulo do YaST, alterne para a categoria <guimenu>Configuração do Firewall</guimenu>.
    </para>
   </step>
   <step>
    <para>
     Para abrir a porta que você configurou para o booth, habilite <guimenu>Abrir Porta no Firewall</guimenu>.
    </para>
    <important>
     <title>Configuração do firewall apenas para máquina local</title>
     <para>
      A configuração do firewall é aplicada apenas à máquina atual. Ela abre todas as portas UDP/TCP que foram especificadas em <filename>/etc/booth/booth.conf</filename> ou quaisquer outros arquivos de configuração de booth (consulte a <xref linkend="sec.ha.geo.booth.multi"/>).
     </para>
     <para>
      Abra também as respectivas portas em todos os outros nós e arbitradores do cluster da configuração de cluster Geo. Faça isso manualmente ou sincronizando os seguintes arquivos com o Csync2:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        <filename>/etc/sysconfig/SuSEfirewall2</filename>
       </para>
      </listitem>
      <listitem>
       <para>
        <filename>/etc/sysconfig/SuSEfirewall2.d/services/booth</filename>
       </para>
      </listitem>
     </itemizedlist>
    </important>
   </step>
   <step>
    <para>
     Clique em <guimenu>Concluir</guimenu> para confirmar todas as configurações e fechar o módulo do YaST. Dependendo do <replaceable>NOME</replaceable> do <guimenu>Arquivo de Configuração</guimenu> especificado na <xref linkend="step.ha.booth.conf.params"/>, a configuração é gravada em <filename>/etc/booth/<replaceable>NOME</replaceable>.conf</filename>.
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec.ha.geo.booth.multi">
  <title>Configuração de booth para vários locatários</title>

  <para>
    Para configurações que incluem vários clusters Geo, é possível <quote>compartilhar</quote> o mesmo arbitrador (a partir da <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12). Ao fornecer vários arquivos de configuração de booth, você pode iniciar diversas instâncias de booth no mesmo arbitrador, com cada instância sendo executada em uma porta diferente. Dessa forma, você pode usar <emphasis>uma</emphasis> máquina como arbitrador para <emphasis>diferentes</emphasis> clusters Geo.
  </para>
  <para>
   Vamos supor que você tenha dois clusters Geo, um na EMEA (Europa, Oriente Médio e África) e um na região do Pacífico Asiático (APAC).
  </para>
  <para>
   Para usar o mesmo arbitrador para ambos os clusters Geo, crie dois arquivos de configuração no diretório <filename>/etc/booth</filename>: <filename>/etc/booth/emea.conf</filename> e <filename>/etc/booth/apac.conf</filename>. Deve haver uma diferença mínima entre os dois nos seguintes parâmetros:
  </para>
  <itemizedlist>
   <listitem>
    <para>
     A porta usada para comunicação das instâncias de booth.
    </para>
   </listitem>
   <listitem>
    <para>
     Os sites pertencentes aos diferentes clusters Geo nos quais o arbitrador é usado.
    </para>
   </listitem>
  </itemizedlist>
  <example xml:id="ex.ha.conf.booth.multi-1">
   <title><filename>/etc/booth/apac.conf</filename></title>
<screen><?dbsuse-fo font-size="0.75em"?>

transport = UDP <xref linkend="co.ha.geo.booth.config.transport" xrefstyle="select:label nopage"/>
port = 9133 <xref linkend="co.ha.geo.booth.config.port" xrefstyle="select:label nopage"/>
arbitrator = 147.2.207.14 <xref linkend="co.ha.geo.booth.config.arbitrator" xrefstyle="select:label nopage"/>
site = 192.168.2.254 <xref linkend="co.ha.geo.booth.config.site" xrefstyle="select:label nopage"/>
site = 192.168.1.112 <xref linkend="co.ha.geo.booth.config.site" xrefstyle="select:label nopage"/>
authfile = /etc/booth/authkey-apac <xref linkend="co.ha.geo.booth.config.auth" xrefstyle="select:label nopage"/>
ticket ="tkt-db-apac-intern" <xref linkend="co.ha.geo.booth.config.ticket"/>
     timeout = 10 
     retries = 5 
     renewal-freq = 60 
     before-acquire-handler<xref linkend="co.ha.geo.booth.config.handler" xrefstyle="select:label nopage"/> = /usr/share/booth/service-runnable<xref linkend="co.ha.geo.booth.config.script" xrefstyle="select:label nopage"/> db-apac-intern <xref linkend="co.ha.geo.booth.config.rsc" xrefstyle="select:label nopage"/> 
ticket = "tkt-db-apac-cust" <xref linkend="co.ha.geo.booth.config.ticket" xrefstyle="select:label nopage"/>
     timeout = 10 
     retries = 5 
     renewal-freq = 60 
     before-acquire-handler = /usr/share/booth/service-runnable db-apac-cust</screen>
  </example>
  <example xml:id="ex.ha.conf.booth.multi-2">
   <title><filename>/etc/booth/emea.conf</filename></title>
<screen><?dbsuse-fo font-size="0.75em"?>

transport = UDP <xref linkend="co.ha.geo.booth.config.transport" xrefstyle="select:label nopage"/>
port = 9150 <xref linkend="co.ha.geo.booth.config.port" xrefstyle="select:label nopage"/>
arbitrator = 147.2.207.14 <xref linkend="co.ha.geo.booth.config.arbitrator" xrefstyle="select:label nopage"/>
site = 192.168.201.151 <xref linkend="co.ha.geo.booth.config.site" xrefstyle="select:label nopage"/>
site = 192.168.202.151 <xref linkend="co.ha.geo.booth.config.site" xrefstyle="select:label nopage"/>
authfile = /etc/booth/authkey-emea <xref linkend="co.ha.geo.booth.config.auth" xrefstyle="select:label nopage"/>
ticket = "tkt-sap-crm" <xref linkend="co.ha.geo.booth.config.ticket"/>
     expire = 900 
     renewal-freq = 60 
     before-acquire-handler<xref linkend="co.ha.geo.booth.config.handler" xrefstyle="select:label nopage"/> = /usr/share/booth/service-runnable<xref linkend="co.ha.geo.booth.config.script" xrefstyle="select:label nopage"/> sap-crm <xref linkend="co.ha.geo.booth.config.rsc" xrefstyle="select:label nopage"/>
ticket = "tkt-sap-prod" <xref linkend="co.ha.geo.booth.config.ticket" xrefstyle="select:label nopage"/>
     expire = 600 
     renewal-freq = 60 
     before-acquire-handler = /usr/share/booth/service-runnable sap-prod</screen>
  </example>
  <calloutlist>
   <callout arearefs="co.ha.geo.booth.config.transport">
    <para>
     O protocolo de transporte usado para comunicação entre os sites. Apenas o UDP é suportado, mas outras camadas de transporte estarão disponíveis no futuro. Portanto, esse parâmetro pode ser omitido no momento.
    </para>
   </callout>
   <callout arearefs="co.ha.geo.booth.config.port">
    <para>
     A porta que será usada para comunicação entre as instâncias de booth em cada site. Os arquivos de configuração usam portas diferentes para permitir que várias instâncias de booth sejam iniciadas no mesmo arbitrador.
    </para>
   </callout>
   <callout arearefs="co.ha.geo.booth.config.arbitrator">
    <para>
      O endereço IP da máquina que será usada como arbitrador. Nos exemplos acima, usamos o mesmo arbitrador para clusters Geo diferentes.
    </para>
   </callout>
   <callout arearefs="co.ha.geo.booth.config.site">
    <para>
     O endereço IP usado para o <systemitem class="daemon">boothd</systemitem> em um site. Os sites definidos nos dois arquivos de configuração de booth são distintos, porque eles pertencem a dois clusters Geo diferentes.
    </para>
   </callout>
   <callout arearefs="co.ha.geo.booth.config.auth">
    <para>
     Parâmetro opcional. Habilita a autenticação de booth em clientes e servidores com base em uma chave compartilhada. Esse parâmetro especifica o caminho para o arquivo de chave. Use arquivos de chave diferentes para locatários diferentes.
    </para>
    <itemizedlist>
      <title>Requisitos principais</title>
      <listitem>
       <para>A chave pode ser binária ou de texto.</para>
       <para>Se for de texto, os seguintes caracteres serão ignorados: espaço em branco à direita e à esquerda, novas linhas.</para>
      </listitem>
      <listitem>
       <para>A chave deve ter entre oito e 64 caracteres.</para>
      </listitem>
      <listitem>
        <para>A chave deve pertencer ao usuário <systemitem class="username">hacluster</systemitem> e ao grupo <systemitem class="groupname">haclient</systemitem>.
        </para>
      </listitem>
      <listitem>
       <para>A chave deve ser legível apenas pelo proprietário do arquivo.</para>
      </listitem>
     </itemizedlist>
   </callout>
   <callout arearefs="co.ha.geo.booth.config.ticket">
    <para>
     O ticket que será gerenciado pelo booth. Teoricamente, os mesmos nomes de ticket podem ser definidos em arquivos de configuração de booth diferentes. Os tickets não interferem porque fazem parte de clusters Geo diferentes que são gerenciados por instâncias de booth distintas. No entanto, (para melhor visão geral) é recomendável usar nomes de ticket distintos para cada cluster Geo, conforme mostrado nos exemplos acima.
    </para>
   </callout>
   <callout arearefs="co.ha.geo.booth.config.handler">
    <para>
     Parâmetro opcional. Se definido, o comando especificado será chamado antes de o <systemitem class="daemon">boothd</systemitem> tentar adquirir ou renovar um ticket. Quando o código de saída é diferente de <literal>0</literal>, o <systemitem class="daemon">boothd</systemitem> abandona o ticket.
    </para>
   </callout>
   <callout arearefs="co.ha.geo.booth.config.script">
    <para>
     O script <filename>service-runnable</filename> mencionado neste documento está incluído no produto como um exemplo. Ele é um script simples baseado no <command>crm_simulate</command>. Ele pode ser usado para testar se determinado recurso de cluster <emphasis>pode</emphasis> ser executado no site do cluster atual. Sendo assim, ele verifica se o cluster é saudável o suficiente para executar o recurso (todas as dependências do recurso foram atendidas, a partição de cluster tem quorum, não há nós com problemas, etc.). Por exemplo, se um serviço na cadeia de dependências tem uma contagem de falhas <literal>INFINITY</literal> em todos os nós disponíveis, o serviço não poderá ser executado no site. Nesse caso, não é útil requerer o ticket.
    </para>
   </callout>
   <callout arearefs="co.ha.geo.booth.config.rsc">
    <para>
     O recurso que será testado por <literal>before-acquire-handler</literal> (neste caso, pelo script <filename>service-runnable</filename>). Você precisa fazer referência ao recurso que é protegido pelo respectivo ticket.
    </para>
   </callout>
  </calloutlist>
  <procedure>
   <title>Usando o mesmo arbitrador para clusters Geo diferentes</title>
   <step>
    <para>
     Crie arquivos de configuração de booth diferentes em <filename>/etc/booth</filename>, conforme mostrado no <xref linkend="ex.ha.conf.booth.multi-1"/> e no <xref linkend="ex.ha.conf.booth.multi-2"/>. Faça isso manualmente ou com o YaST, conforme descrito no <xref linkend="pro.ha.geo.setup.booth.yast"/>.
    </para>
   </step>
   <step>
    <para>
     No arbitrador, abra as portas que foram definidas em qualquer um dos arquivos de configuração de booth em <filename>/etc/booth</filename>.
    </para>
   </step>
   <step>
    <para>
     Nos nós pertencentes aos clusters Geo individuais nos quais o arbitrador é usado, abra a porta que é usada para a respectiva instância de booth.
    </para>
   </step>
   <step>
    <para>
     Sincronize os respectivos arquivos de configuração de booth em todos os nós e arbitradores do cluster que usam a mesma configuração de booth. Para obter os detalhes, consulte a <xref linkend="sec.ha.geo.booth.sync"/>.
    </para>
   </step>
   <step>
    <para>
     No arbitrador, inicie as instâncias de booth individuais, conforme descrito em <xref linkend="vle.ha.geo.setup.booth.service.arbitrator"/> para configurações de multilocatário.
    </para>
   </step>
   <step>
    <para>
     Nos clusters Geo individuais, inicie o serviço de booth conforme descrito em <xref linkend="vle.ha.geo.setup.booth.service.sites"/>.
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec.ha.geo.booth.sync">
  <title>Sincronizando a configuração de booth com todos os sites e arbitradores</title>
  <note>
   <title>Use a mesma configuração de booth em todos os sites e arbitradores</title>
   <para>
    Para que o booth funcione corretamente, todos os nós e arbitradores de um cluster Geo devem usar a mesma configuração de booth.
   </para>
   <para>
    Você pode usar o Csync2 para sincronizar a configuração de booth. Para obter os detalhes, consulte a <xref linkend="sec.ha.geo.booth.sync.csync2.setup"/> e a <xref linkend="sec.ha.geo.booth.sync.csync2.start"/>.
   </para>
   <para>
    No caso de quaisquer mudanças na configuração de booth, atualize os arquivos de configuração apropriadamente em todas as partes e reinicie os serviços de booth, conforme descrito na <xref linkend="sec.ha.geo.setup.booth.reconfig"/>.
   </para>
  </note>
 </sect2>

 <sect2 xml:id="sec.ha.geo.setup.booth.service">
  <title>Habilitando e iniciando os serviços de booth</title>
  <variablelist>
   <varlistentry xml:id="vle.ha.geo.setup.booth.service.sites">
    <term>Iniciando os serviços de booth em sites do cluster</term>
    <listitem>
     <para>
      O serviço de booth para cada site do cluster é gerenciado pelo grupo de recursos de booth configurado no <xref linkend="pro.ha.geo.setup.rsc.boothd"/>. Para iniciar uma instância do serviço de booth por site, inicie o respectivo grupo de recursos de booth em cada site do cluster.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle.ha.geo.setup.booth.service.arbitrator">
    <term>Iniciando os serviços de booth nos arbitradores</term>

    <listitem>
     <para>
      A partir do SUSE Linux Enterprise 12, os arbitradores de booth são gerenciados com o systemd. O arquivo unitário é denominado <filename>booth@.service</filename>. A <literal>@</literal> indica a possibilidade de executar o serviço com um parâmetro, que, neste caso, é o nome do arquivo de configuração.
     </para>
     <para>
      Para <emphasis>habilitar</emphasis> o serviço de booth em um arbitrador, use o seguinte comando:
     </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> enable booth@booth</screen>
     <para>
      Após a habilitação do serviço da linha de comando, o Gerenciador de Serviços do YaST poderá ser usado para gerenciar o serviço, desde que ele não seja desabilitado. Nesse caso, ele desaparecerá da lista de serviços no YaST da próxima vez que o systemd for reiniciado.
     </para>
     <para>
      No entanto, o comando para <emphasis>iniciar</emphasis> o serviço de booth depende da configuração de booth:
     </para>
     <itemizedlist>
      <listitem>
       <para>
        Se você usa a configuração padrão, como descrito na <xref linkend="sec.ha.geo.booth.default"/>, apenas <filename>/etc/booth/booth.conf</filename> é configurado. Nesse caso, efetue login em cada arbitrador e use o seguinte comando:
       </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start booth@booth</screen>
      </listitem>
      <listitem>
       <para>
        Se você estiver executando o booth no modo multilocatário, como descrito na <xref linkend="sec.ha.geo.booth.multi"/>, você definiu vários arquivos de configuração de booth em <filename>/etc/booth</filename>. Para iniciar os serviços para as instâncias de booth individuais, use <command>systemctl start booth@</command> <replaceable>NOME</replaceable>, em que <replaceable>NOME</replaceable> representa o nome do respectivo arquivo de configuração <filename>/etc/booth/<replaceable>NOME</replaceable>.conf</filename>.
       </para>
       <para>
        Por exemplo, se você tem os arquivos de configuração de booth <filename>/etc/booth/emea.conf</filename> e <filename>/etc/booth/apac.conf</filename>, efetue login no arbitrador e execute os seguintes comandos:
       </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start booth@emea
<prompt role="root">root # </prompt><command>systemctl</command> start booth@apac</screen>
       <para>

       </para>
      </listitem>
     </itemizedlist>
     <para>
      Esse procedimento inicia o serviço de booth no modo de arbitrador. Ele pode se comunicar com todos os outros daemons de booth, porém, diferentemente dos daemons de booth em execução nos sites do cluster, ele não pode receber um ticket. Os arbitradores de booth participam apenas das escolhas. Do contrário, eles ficam inativos.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect2>

 <sect2 xml:id="sec.ha.geo.setup.booth.reconfig">
  <title>Reconfigurando o booth durante a execução</title>

  <para>
   Se você precisar mudar a configuração de booth quando os serviços de booth já estiverem em execução, faça o seguinte:
  </para>
  <procedure>
   <step>
    <para>
     Ajuste os arquivos de configuração de booth conforme desejado.
    </para>
   </step>
   <step>
    <para>
     Sincronize os arquivos de configuração de booth atualizados com  todos os nós e arbitradores que fazem parte do cluster Geo. Para obter os detalhes, consulte a <xref linkend="sec.ha.geo.sync"/>.
    </para>
   </step>
   <step>

    <para>
     Reinicie os serviços de booth nos arbitradores e sites do cluster, como descrito na <xref linkend="sec.ha.geo.setup.booth.service"/>. Isso não tem nenhum efeito sobre os tickets que já foram concedidos aos sites.
    </para>
   </step>
  </procedure>
 </sect2>
</sect1>
