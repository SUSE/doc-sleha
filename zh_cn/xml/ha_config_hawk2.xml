<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_config_hawk2.xml" xml:id="cha.conf.hawk2" version="5.0">
 <title>使用 Hawk2 配置和管理群集资源</title>
 <info>
  <abstract>
   <para>
    要配置和管理群集资源，请使用 Hawk2 或 crm 外壳 (crmsh) 命令行实用程序。如果您从安装了 Hawk 的较低版 <phrase role="roductnamereg"><phrase os="sles">SUSE® Linux Enterprise High Availability Extension</phrase></phrase> 升级，该包将替换为最新版本 Hawk2。
   </para>

   <para>
    Hawk2 的用户友好 Web 界面可让您从 Linux 或非 Linux 计算机监视和管理高可用性群集。可使用（图形）Web 浏览器从群集内外的任何计算机访问 Hawk2。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer/>
   <dm:status>编辑</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>yes</dm:translation>
   <dm:languages/>
   <dm:release/>
   <dm:repository/>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec.conf.hawk2.req">
  <title>Hawk2 要求</title>

  <para>
   仅当系统满足以下要求后，用户才能登录 Hawk2：
  </para>

  <variablelist>
   <varlistentry>
    <term><package>hawk2</package> 包</term>
    <listitem>
     <para>
      此 <package>hawk2</package>  包必须安装在要使用 Hawk2 连接的所有群集节点上。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term> Web 浏览器</term>
    <listitem>
     <para>
      在要使用 Hawk2 访问群集节点的计算机上，需要安装启用了 JavaScript 和 Cookie 的（图形）Web 浏览器才能建立连接。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Hawk2 服务</term>
    <listitem>
     <para>
      要使用 Hawk2，必须在要通过 Web 界面连接到的节点上启动相应的 Web 服务。请参见<xref linkend="pro.ha.hawk2.service"/>。
     </para>
     <para>
      如果您是使用 <systemitem class="resource">ha-cluster-bootstrap</systemitem> 包中的脚本设置群集的，则此时 Hawk2 服务已启用。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>每个群集节点上的用户名、组和口令</term>
    <listitem>
     <para>
      Hawk2 用户必须是 <systemitem class="groupname">haclient</systemitem> 组的成员。安装程序将创建名为 <systemitem class="username">hacluster</systemitem> 的 Linux 用户，该用户将添加到 <systemitem class="groupname">haclient</systemitem> 组中。
     </para>
     <para>
      使用 <command>ha-cluster-init</command> 脚本进行设置时，将为 <systemitem class="username">hacluster</systemitem> 用户设置默认口令。在启动 Hawk2 之前，请将它更改为安全口令。如果您不使用 <command>ha-cluster-init</command> 脚本，请先为 <systemitem class="username">hacluster</systemitem> 设置口令，或者创建属于 <systemitem class="groupname">haclient</systemitem> 组成员的新用户。请在要使用 Hawk2 连接的所有节点上执行此操作。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <procedure xml:id="pro.ha.hawk2.service">
   <title>启动 Hawk2 服务</title>
   <step>
    <para>
     在要连接到的节点上，打开外壳并以 <systemitem class="username">root</systemitem> 用户身份登录。
    </para>
   </step>
   <step>
    <para>
     通过输入以下命令，检查服务的状态
    </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> status hawk</screen>
   </step>
   <step>
    <para>
     如果服务未在运行，请使用以下命令启动服务
    </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start hawk</screen>
    <para>
     如果希望 Hawk2 在引导时自动启动，请执行以下命令：
    </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> enable hawk</screen>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.conf.hawk2.login">
  <title>登录</title>

  <para>
   Hawk2 Web 界面使用 HTTPS 协议和端口 <literal>7630</literal>。
  </para>

  <para>
   您无需使用 Hawk2 登录个别群集节点，而是可以将一个浮动的虚拟 IP 地址（<literal>IPaddr</literal> 或 <literal>IPaddr2</literal>）配置为群集资源。该地址无需任何特殊配置。如此，无论 Hawk 服务在哪个物理节点上运行，客户端都可以连接到该服务。
  </para>

  <para>
   在使用 <systemitem class="resource">ha-cluster-bootstrap</systemitem> 脚本设置群集时，系统会询问您是否配置虚拟 IP 以用于群集管理。
  </para>

  <procedure xml:id="pro.ha.hawk2.login">
   <title>登录 Hawk2 Web 界面</title>
   <step>
    <para>
     在任一台计算机上，启动 Web 浏览器并输入以下 URL：
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    <para>
     使用运行 Hawk Web 服务的任何群集节点的 IP 地址或主机名替换 <replaceable>HAWKSERVER</replaceable>。如果已配置虚拟 IP 地址以使用 Hawk2 进行群集管理，请使用该虚拟 IP 地址替换 <replaceable>HAWKSERVER</replaceable>。
    </para>
    <note>
     <title>证书警告</title>
     <para>
      当您首次尝试访问 URL 时如果显示证书警告，则表示使用了自我签名证书。默认情况下，自我签名证书不被视为可信证书。
     </para>
     <para>
      要校验证书，请联系群集操作员获取证书细节。
     </para>
     <para>
      要继续，可在浏览器中添加例外，以绕过警告。
     </para>
     <para>
      有关如何将自我签名证书替换为官方证书颁发机构签名的证书的信息，请参见<xref linkend="vle.trouble.hawk2.cert"/>。
     </para>
    </note>
   </step>
   <step>
    <para>
     在 Hawk2 登录屏幕上，输入 <guimenu>hacluster</guimenu> 用户（或属于 <guimenu>haclient</guimenu> 组的任何其他用户）的<systemitem class="username">用户名</systemitem>和<systemitem class="groupname">口令</systemitem>。
    </para>
   </step>
   <step>
    <para>
     单击<guimenu>登录</guimenu>。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.conf.hawk2.overview">
  <title>Hawk2 概述：主要元素</title>

  <para>
   登录 Hawk2 后，左侧会显示一个导航栏，右侧会显示一个顶层行，其中包含若干链接。
  </para>

  <note>
   <title>Hawk2 中的可用功能</title>
   <para>
    默认情况下，以 <systemitem class="username">root</systemitem> 或 <systemitem class="username">hacluster</systemitem> 身份登录的用户对所有群集配置任务具有完全读写访问权。不过，使用<xref linkend="cha.ha.acl" xrefstyle="select:title"/> (ACL) 可以定义细化的访问权限。
   </para>
   <para>
    如果在 CRM 中启用了 ACL，Hawk2 中的可用功能取决于用户角色和指派给这些角色的访问权限。Hawk2 中的<guimenu>历史记录浏览器</guimenu>只能由用户 <systemitem class="username">hacluster</systemitem> 来执行。
   </para>
  </note>

  <sect2 xml:id="sec.conf.hawk2.overview.leftnav">
   <title>左侧导航栏</title>
   <variablelist>
    <varlistentry>
     <term><guimenu>监控</guimenu>
     </term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <guimenu>状态</guimenu>：一目了然地显示当前的群集状态（与 crmsh 上的 <command>crm status</command> 作用类似）。有关详细信息，请参见<xref linkend="sec.conf.hawk2.manage.monitor.status"/>。如果群集包含 <literal>guest 节点</literal>（运行 <literal>pacemaker_remote</literal> 守护程序的节点），则也会显示这些节点。<remark>taroth 2018-10-30: check and probably mention in more detail in
         'sec.conf.hawk2.manage.monitor.status' for next revision</remark>屏幕刷新频率接近实时刷新：任何节点或资源状态的更改都几乎立即可见。
        </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>仪表板</guimenu>：可用于监视多个群集（如果您设置了 Geo 群集，还会位于多个不同站点）。有关详细信息，请参见<xref linkend="sec.conf.hawk2.manage.monitor.dash"/>。如果群集包含 <literal>guest 节点</literal>（运行 <literal>pacemaker_remote</literal> 守护程序的节点），则也会显示这些节点。<remark>taroth 2018-10-30: check and probably mention in more detail in
         'sec.conf.hawk2.manage.monitor.status' for next revision</remark>屏幕刷新频率接近实时刷新：任何节点或资源状态的更改都几乎立即可见。
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>查错</guimenu>
     </term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <guimenu>历史记录</guimenu>：打开<guimenu>历史记录浏览器</guimenu>，您可以从中生成群集报告。有关细节，请参见<xref linkend="sec.conf.hawk2.history"/>。
        </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>命令日志</guimenu>：列出 Hawk2 最近执行的 crmsh 命令。
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
     <varlistentry>
      <term>配置</term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <guimenu>添加资源</guimenu>：打开资源配置屏幕。有关细节，请参见<xref linkend="sec.conf.hawk2.rsc"/>。 </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>添加约束</guimenu>：打开约束配置屏幕。有关细节，请参见<xref linkend="sec.conf.hawk2.cons"/>。 </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>向导</guimenu>：可让您从数个向导中选择一个，以便引导您完成为某个工作负载（例如，某个 DRBD 块设备）创建资源的流程。有关细节，请参见<xref linkend="sec.conf.hawk2.rsc.wizard"/>。 </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>编辑配置</guimenu>：可用于编辑资源、约束、节点名称和属性、标记、<link xlink:href="http://crmsh.github.io/man/#cmdhelp_configure_alert">警报</link>和<link xlink:href="http://crmsh.github.io/man/#cmdhelp_configure_fencing_topology">屏蔽拓扑</link>。
         </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>群集配置</guimenu>：可用于修改全局群集选项以及资源和操作默认值。有关细节，请参见<xref linkend="sec.conf.hawk2.cluster.config"/>。 </para>
       </listitem>
       <listitem>
        <para>
         <menuchoice>
          <guimenu>访问控制</guimenu>
          <guimenu>角色</guimenu>
         </menuchoice>：打开一个屏幕，您可在其中为访问控制列表（即用于描述对 CIB 的访问权限的规则集）创建角色。有关细节，请参见<xref linkend="pro.ha.acl.hawk2.role"/>。 </para>
       </listitem>
       <listitem>
        <para>
         <menuchoice>
          <guimenu>访问控制</guimenu>
          <guimenu>目标</guimenu>
         </menuchoice>：打开一个屏幕，您可在其中为访问控制列表创建目标（系统用户），并为这些目标指派角色。有关细节，请参见<xref linkend="pro.ha.acl.hawk2.target"/>。 </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec.conf.hawk2.overview.toprow">
   <title>顶层行</title>
   <para>
    Hawk2 的顶层行显示以下条目：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <guimenu>批</guimenu>：单击可切换到批模式。可用于模拟和分阶段进行更改并通过单次事务应用这些更改。有关细节，请参见<xref linkend="sec.conf.hawk2.batch"/>。
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu><replaceable>用户名</replaceable></guimenu>：可用于设置 Hawk2 的首选项（例如，Web 界面的语言，或者是否在 STONITH 处于禁用状态时显示警告）。
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>帮助</guimenu>：访问 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 文档、阅读发行说明或报告 Bug。
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>注销</guimenu>：单击可注销。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.conf.hawk2.cluster.config">
  <title>配置全局群集选项</title>

  <para>
   全局群集选项控制群集在遇到特定情况时的行为方式。它们被分成若干组，可通过 Hawk2 和 crmsh 之类的群集管理工具来查看和修改。通常可保留预定义值。但为了确保群集的关键功能正常工作，需要在进行基本群集设置后调整以下参数：
  </para>

  <itemizedlist>
   <listitem>
    <para>
     <xref linkend="sec.ha.config.basics.global.quorum" xrefstyle="select:title"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sec.ha.config.basics.global.stonith" xrefstyle="select:title"/>
    </para>
   </listitem>
  </itemizedlist>

  <procedure xml:id="pro.conf.hawk2.global">
   <title>修改全局群集选项</title>
   <step>
    <para>
     登录 Hawk2：
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     从左侧导航栏中，选择<menuchoice>
     <guimenu>配置</guimenu><guimenu>群集配置</guimenu>
     </menuchoice>。
    </para>
    <para>
     <guimenu>群集配置</guimenu>屏幕即会打开。屏幕中显示全局群集选项及其当前值。
    </para>
    <para>
     要在屏幕右侧显示某个参数的简要描述，请将鼠标悬停在该参数上方。 <remark>taroth 2017-08-10: this does no longer seem to be the case
      @ayoub: are those descriptions gone on purpose?</remark>
    </para>
    <figure pgwide="0">
     <title>Hawk2 - 群集配置</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="hawk2-cluster-config.png" width="100%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="hawk2-cluster-config.png" width="100%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     检查 <guimenu>no-quorum-policy</guimenu> 和 <guimenu>stonith-enabled</guimenu> 的值并根据需要进行调整。
    </para>
    <substeps performance="required">
     <step>
      <para>
       将 <guimenu>no-quorum-policy</guimenu> 设置为合适的值。有关详细信息，请参见<xref linkend="sec.ha.config.basics.global.quorum"/>。
      </para>
     </step>
     <step>
      <para>
       如果出于某些原因需要禁用屏蔽，请将 <guimenu>stonith-enabled</guimenu> 设置为 <literal>no</literal>。默认情况下，该参数设置为 <literal>true</literal>，因为执行常规的群集操作必须要使用 STONITH 设备。根据默认值，如果未配置 STONITH 资源，群集将拒绝启动任何资源。
      </para>
        <important>
      <title>不支持无 STONITH 的配置</title>
      <itemizedlist>
       <listitem>
        <para>您必须为群集配置节点屏蔽机制。</para>
       </listitem>
       <listitem>
        <para>全局群集选项 <systemitem>stonith-enabled</systemitem> 和 <systemitem>startup-fencing</systemitem> 必须设置为 <literal>true</literal>。如果您更改这些选项，将会失去支持。</para>
       </listitem>
      </itemizedlist>
      </important>
      </step>
     <step>
      <para>
       要从群集配置中去除某个参数，请单击该参数旁边的<guimenu>减号</guimenu>图标。如果删除了某个参数，则群集的表现方式就像该参数采用默认值一样。
      </para>
     </step>
     <step>
      <para>
       要向群集配置添加新参数，请从下拉框中选择一个参数。
      </para>
     </step>
    </substeps>
   </step>

   <step>
    <para>
     如果您需要更改<guimenu>资源默认值</guimenu>或<guimenu>操作默认值</guimenu>，请执行以下步骤：
    </para>
    <substeps performance="required">
     <step>
      <para>
       要调整某个值，请从下拉框中选择一个不同的值，或直接编辑该值。
      </para>
     </step>
     <step>
      <para>
       要添加新的资源默认值或操作默认值，请从空下拉框中选择一项，然后输入值。如果有默认值，Hawk2 会自动建议这些值。
      </para>
     </step>
     <step>
      <para>
       要去除某个参数，请单击该参数旁边的<guimenu>减号</guimenu>图标。如果没有为<guimenu>资源默认值</guimenu>和<guimenu>操作默认值</guimenu>指定值，群集会使用<xref linkend="sec.ha.config.basics.meta.attr"/>和<xref linkend="sec.ha.config.basics.operations"/>中所述的默认值。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     确认更改。
    </para>
   </step>
  </procedure>
 </sect1>
 <xi:include href="ha_hawk2_rsc_i.xml"/>
 <xi:include href="ha_hawk2_cons_i.xml"/>
 <xi:include href="ha_hawk2_manage_i.xml"/>

 <xi:include href="ha_hawk2_monitor_i.xml"/>
 <xi:include href="ha_hawk2_batch_i.xml"/>
 <xi:include href="ha_hawk2_history_i.xml"/>
 <xi:include href="ha_hawk2_health_i.xml"/>
</chapter>
