<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_hawk2_manage_i.xml" version="5.0" xml:id="sec.conf.hawk2.manage">
 <title>管理群集资源</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer/>
   <dm:status>编辑</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>yes</dm:translation>
   <dm:languages/>
   <dm:release/>
   <dm:repository/>
  </dm:docmanager>
 </info>

 <para>
  除了配置群集资源以外，Hawk2 还可用于从<guimenu>状态</guimenu>屏幕管理现有资源。有关该屏幕的一般性概述，请参见<xref linkend="sec.conf.hawk2.manage.monitor.status"/>。
 </para>

 <sect2 xml:id="sec.conf.hawk2.manage.edit">
  <title>编辑资源和组</title>
  <para>
   如果您需要编辑现有资源，请转到<guimenu>状态</guimenu>屏幕。在<guimenu>操作</guimenu>列中，单击要修改的资源或组旁边的向下箭头图标，然后选择<guimenu>编辑</guimenu>。
  </para>
  <para>
   编辑屏幕即会显示。如果要编辑原始资源，则以下操作可用：
  </para>
  <itemizedlist>
   <title>针对原始资源的操作</title>
   <listitem>
    <para>
     复制资源。
    </para>
   </listitem>
   <listitem>
    <para>
     重命名资源（更改其 ID）。
    </para>
   </listitem>
   <listitem>
    <para>
     删除资源。
    </para>
   </listitem>
  </itemizedlist>
  <para>
   如果要编辑组，则以下操作可用：
  </para>
  <itemizedlist>
   <title>针对组的操作</title>
   <listitem>
    <para>
     创建要添加到此组的新原始资源。
    </para>
   </listitem>
   <listitem>
    <para>
     重命名组（更改其 ID）。
    </para>
   </listitem>
   <listitem>
    <para>
     通过使用右侧的<quote>手柄</quote>图标将组成员拖放为需要的顺序对其进行排序。
    </para>
   </listitem>
  </itemizedlist>
 </sect2>

 <sect2 xml:id="sec.conf.hawk2.manage.start">
  <title>启动资源</title>
  <para>
   启动群集资源之前，应确保资源设置正确。例如，如果使用 Apache 服务器作为群集资源，请先设置 Apache 服务器。完成 Apache 配置，然后再启动群集中的相应资源。
  </para>
  <note>
   <title>不要处理由群集管理的服务</title>
   <para>
    通过 High Availability Extension 管理资源时，不得以其他方式（例如，在群集外手动或者引导时或重引导时）启动或停止该资源。High Availability Extension 软件负责所有服务的启动或停止操作。
   </para>
   <para>
    但如果要检查服务是否配置正确，可手动启动该服务，不过请确保在 High Availability Extension 接管前再次停止该服务。
   </para>
   <para>
    要对群集当前管理的资源进行干预，请先将资源设置为<literal>维护模式</literal>。有关细节，请参见<xref linkend="pro.ha.maint.mode.rsc.hawk2"/>。
   </para>
  </note>
  <para>
   使用 Hawk2 创建资源时，可通过 <literal>target-role</literal> 元属性设置其初始状态。如果将其值设置为 <literal>stopped</literal>，则该资源在创建后不会自动启动。
  </para>
  <procedure xml:id="pro.hawk2.rsc.start">
   <title>启动新资源</title>
   <step>
    <para>
     登录 Hawk2：
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     从左侧导航栏中，选择<menuchoice><guimenu>监视</guimenu>
     <guimenu>状态</guimenu></menuchoice>。<guimenu>资源</guimenu>列表还会显示<guimenu>状态</guimenu>。
    </para>
   </step>
   <step>
    <para>
     选择要启动的资源。在其<guimenu>操作</guimenu>列中，单击<guimenu>启动</guimenu>图标。要继续，请确认显示的消息。
    </para>
    <para>
     资源启动后，Hawk2 会将资源的<guimenu>状态</guimenu>变为绿色，并显示当前运行该资源的节点。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec.conf.hawk2.manage.cleanup">
  <title>清理资源</title>
  <para>
   如果资源失败，它会自动重启动，但每次失败都会增加资源的失败计数。
  </para>
  <para>
   如果已为资源设置 <literal>migration-threshold</literal>，当失败次数达到迁移阈值时，节点将不再运行该资源。
  </para>
  <para>
   资源的失败计数可以通过系统自动重设置（通过设置资源的 <literal>failure-timeout</literal> 选项），也可如下所述手动重设置。
  </para>
  <procedure xml:id="pro.hawk2.clean">
   <title>清理资源</title>
   <step>
    <para>
     登录 Hawk2：
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     从左侧导航栏中，选择<guimenu>状态</guimenu>。<guimenu>资源</guimenu>列表还会显示<guimenu>状态</guimenu>。
    </para>
   </step>
   <step>
    <para>
     转到要清理的资源。在<guimenu>操作</guimenu>列中，单击向下箭头按钮并选择<guimenu>清理</guimenu>。要继续，请确认显示的消息。
    </para>
    <para>
     如此即会执行 <command>crm resource cleanup</command> 命令并在所有节点上清理该资源。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec.conf.hawk2.manage.remove">
  <title>删除群集资源</title>
  <para>
   如果需要从群集中删除资源，请遵循以下过程以免出现配置错误：
  </para>
  <procedure xml:id="pro.hawk2.rsc.rm">
   <title>删除群集资源</title>
   <step>
    <para>
     登录 Hawk2：
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     按<xref linkend="pro.hawk2.clean"/>中所述清理所有节点上的资源。
    </para>
   </step>
   <step>
    <para>
     停止资源：
    </para>
    <substeps>
     <step>
      <para>
       从左侧导航栏中，选择<menuchoice><guimenu>监视</guimenu>
       <guimenu>状态</guimenu></menuchoice>。<guimenu>资源</guimenu>列表还会显示<guimenu>状态</guimenu>。
      </para>
     </step>
     <step>
      <para>
       在<guimenu>操作</guimenu>列中，单击资源旁边的<guimenu>停止</guimenu>按钮。
      </para>
     </step>
     <step>
      <para>
       要继续，请确认显示的消息。
      </para>
      <para>
       资源停止后，<guimenu>状态</guimenu>列将会反映此变化。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     删除资源：
    </para>
    <substeps>
     <step>
      <para>
       从左侧导航栏中，选择<menuchoice><guimenu>配置</guimenu> <guimenu>编辑配置</guimenu></menuchoice>。
      </para>
     </step>
     <step>
      <para>
       在<guimenu>资源</guimenu>列表中，转到相应资源。在<guimenu>操作</guimenu>列中，单击资源旁边的<guimenu>删除</guimenu>图标。
      </para>
     </step>
     <step>
      <para>
       要继续，请确认显示的消息。
      </para>
     </step>
    </substeps>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec.conf.hawk2.manage.migrate">
  <title>迁移群集资源</title>
  <para>
   如<xref linkend="sec.conf.hawk2.failover"/>中所述，如果软件或硬件发生故障，群集会根据可自定义的特定参数（例如，迁移阈值或资源粘性），自动进行资源故障转移（迁移）。您还可以手动将资源迁移到群集中的其他节点。或者，可以将它移出当前节点，并让群集决定要将它放置到哪个位置。
  </para>
  <procedure xml:id="pro.hawk2.rsc.migrate">
   <title>手动迁移资源</title>
   <step>
    <para>
     登录 Hawk2：
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     从左侧导航栏中，选择<menuchoice><guimenu>监视</guimenu>
     <guimenu>状态</guimenu></menuchoice>。<guimenu>资源</guimenu>列表还会显示<guimenu>状态</guimenu>。
    </para>
   </step>
   <step>
    <para>
     在<guimenu>资源</guimenu>列表中，选择相应资源。
    </para>
   </step>
   <step>
    <para>
     在<guimenu>操作</guimenu>列中，单击向下箭头按钮并选择<guimenu>迁移</guimenu>。
    </para>
   </step>
   <step>
    <para>
     随后打开的窗口中会提供以下选项：
    </para>
    <itemizedlist>
     <listitem>
      <para>
       <guimenu>离开当前节点</guimenu>：此选项会为当前节点创建一个分数为 <literal>-INFINITY</literal> 的位置约束。
      </para>
     </listitem>
     <listitem>
      <para>
       或者，您也可以将资源移到另一节点上。此选项将为目标节点创建分数为 <literal>INFINITY</literal> 的位置约束。
      </para>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     确认您的选择。
    </para>
   </step>
  </procedure>
  <para>
   要使资源重新移回，请按如下操作：
  </para>
  <procedure xml:id="pro.hawk2.rsc.migrate.back">
   <title>取消迁移资源</title>
   <step>
    <para>
     登录 Hawk2：
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     从左侧导航栏中，选择<menuchoice><guimenu>监视</guimenu>
     <guimenu>状态</guimenu></menuchoice>。<guimenu>资源</guimenu>列表还会显示<guimenu>状态</guimenu>。
    </para>
   </step>
   <step>
    <para>
     在<guimenu>资源</guimenu>列表中，转到相应资源。
    </para>
   </step>
   <step>
    <para>
     在<guimenu>操作</guimenu>列中，单击向下箭头按钮并选择<guimenu>清除</guimenu>。要继续，请确认显示的消息。
    </para>
    <para>
     Hawk2 使用 <command>crm_resource </command> <option>--clear</option> 命令。资源可以移回到其原始位置，也可以留在当前位置（取决于资源粘性）。
    </para>
   </step>
  </procedure>
  <para>
   有关详细信息，请参见 <link xlink:href="http://www.clusterlabs.org/pacemaker/doc/"/> 上的《<citetitle>Pacemaker Explained</citetitle>》（Pacemaker 配置说明）。请参见“<citetitle>Resource Migration</citetitle>”（资源迁移）一节。
  </para>
 </sect2>
</sect1>
