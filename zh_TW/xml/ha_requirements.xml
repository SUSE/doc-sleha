<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:dm="urn:x-suse:ns:docmanager" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_requirements.xml" version="5.0" xml:id="cha-ha-requirements">
  <?dbfo-need height="10em"?>


  <title>系統要求與建議</title>
 <info>
      <dm:docmanager>
        <dm:bugtracker>
          <dm:assignee>taroth@suse.com</dm:assignee>
        </dm:bugtracker>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
      <abstract>
        <para>
    下面的小節介紹 <phrase role="roductnamereg"><phrase os="sles">SUSE® Linux Enterprise High Availability Extension</phrase></phrase> 的系統要求和一些先決條件。此外，還提供了關於叢集設定的建議。
   </para>
      </abstract>
    </info>
    <sect1 xml:id="sec-ha-requirements-hw">
  <title>硬體要求</title>

  <para>
   下面的清單指定了基於 <phrase role="roductnamereg"><phrase os="sles">SUSE® Linux Enterprise High Availability Extension</phrase></phrase> 之叢集的硬體要求。這些要求代表最低硬體組態。依您打算如何使用叢集而定，您可能還需要其他硬體。
  </para>

  <variablelist>
   <varlistentry>
    <term>伺服器</term>
    <listitem>
     <para> 1 至 32 部安裝了<xref linkend="sec-ha-requirements-sw"/> 中所指定之軟體的 Linux 伺服器。 </para>
     <para>
      伺服器可以是裸機，也可以是虛擬機器。它們不需要使用相同的硬體 (記憶體、磁碟空間等等)，但必須具有相同的架構。系統不支援跨平台叢集。
     </para>
     <para> 使用 <literal>pacemaker_remote</literal> 可擴充叢集使其突破 32 個節點的限制，以包含更多的 Linux 伺服器。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>通訊通道</term>
    <listitem>
       <para>
       每個叢集節點至少有兩個 TCP/IP 通訊媒體。網路設備必須支援您希望用於叢集通訊的通信方式︰多點傳播或單路廣播。通訊媒體應支援 100 Mbit/s 或更高的資料速率。對於受支援的叢集設定，需要兩個或以上的備援通訊路徑。可以透過以下方式來實現︰</para>
       <itemizedlist>
        <listitem>
         <para>
          網路裝置結合 (優先)。
         </para>
        </listitem>
        <listitem>
         <para>
          Corosync 中的另一個通訊通道。
         </para>
        </listitem>
       </itemizedlist>
     <para>如需詳細資料，請分別參閱<xref linkend="cha-ha-netbonding"/>和<xref linkend="pro-ha-installation-setup-channel2"/>。
      
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>節點圍籬區隔/STONITH</term>
    <listitem>
      <para>
      若要避免<quote>電腦分裂</quote>的情況，叢集需要有節點圍籬區隔機制。在出現電腦分裂的情況下，叢集節點會因硬體或軟體故障或者網路連接斷開而分成兩個或更多互不相識的群組。圍籬區隔機制會隔離存在問題的節點 (通常是透過重設節點或關閉節點的電源)。這也稱為 STONITH (<quote>將其他節點爆頭</quote>)。節點圍籬區隔機制可以是實體裝置 (電源開關)，也可以是 SBD (依磁碟 STONITH) 等機制與監視程式相結合。使用 SBD 需要共享儲存。
     </para>
     <para>除非使用了 SBD，否則高可用性叢集中的每個節點都必須至少有一個 STONITH 裝置。強烈建議每個節點上有多個 STONITH 裝置。</para>
      <important>
      <title>沒有 STONITH 則不提供支援</title>
      <itemizedlist>
       <listitem>
        <para>您必須為叢集設定節點圍籬區隔機制。</para>
       </listitem>
       <listitem>
        <para>全域叢集選項 <systemitem>stonith-enabled</systemitem> 和 <systemitem>startup-fencing</systemitem> 必須設定為 <literal>true</literal>。如果您變更這些選項，將會失去支援。</para>
       </listitem>
      </itemizedlist>
      </important>
    </listitem>
  </varlistentry>
  </variablelist>
 </sect1>
<?dbfo-need height="10em"?>


 <sect1 xml:id="sec-ha-requirements-sw">
  <title>軟體要求</title>

  <para>
   將加入叢集的所有節點上都至少需安裝以下模組和延伸：
  </para>

<itemizedlist>
   <listitem>
    <para>Base System Module <phrase role="productnumber"><phrase os="sles">15</phrase></phrase></para>
   </listitem>
   <listitem>
    <para>Server Applications Module <phrase role="productnumber"><phrase os="sles">15</phrase></phrase></para>
   </listitem>
   <listitem>
    <para><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> <phrase role="productnumber"><phrase os="sles">15</phrase></phrase></para>
   </listitem>
  </itemizedlist>

   <para>
   根據您在安裝期間選取的<systemitem>系統角色</systemitem>，預設會安裝以下軟體模式︰
 </para>
 <table>
  <title>系統角色和所安裝模式</title>
  <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="50*"/>
   <colspec colnum="2" colname="2" colwidth="50*"/>
   <thead>
    <row>
     <entry>
      <para>
       系統角色
      </para>
     </entry>
     <entry>
      <para>
       軟體模式 (YaST/Zypper)
      </para>
     </entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry>
      <para>
       HA 節點
      </para>
     </entry>
     <entry>
       <itemizedlist>
        <listitem>
         <para>
          高可用性 (sles_ha)
         </para>
        </listitem>
        <listitem>
         <para>
         增強型基礎系統 (enhanced_base)
         </para>
        </listitem>
       </itemizedlist>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       HA GEO 節點
      </para>
     </entry>
      <entry>
       <itemizedlist>
        <listitem>
         <para>
          Geo Clustering for High Availability (ha_geo)
         </para>
        </listitem>
        <listitem>
         <para>
          增強型基礎系統 (enhanced_base)
         </para>
        </listitem>
       </itemizedlist>
      </entry>
    </row>
   </tbody>
  </tgroup>
 </table>
  <note>
   <title>最小安裝</title>
   <para>
    透過這些系統角色安裝只能完成最小安裝。必要時，您可能需要手動新增更多套件。</para>
   <para>
    對於原本指定了另一個系統角色的機器，您需要手動安裝 <systemitem>sles_ha</systemitem> 或 <systemitem>ha_geo</systemitem> 模式及所需的任何其他套件。
   </para>
  </note>
 </sect1>
 <sect1 xml:id="sec-ha-requirements-disk">
  <title>儲存需求</title>

  <para>
   有些服務需要使用共用儲存。如果使用外部 NFS 共享，必須能夠從所有叢集節點透過備援通訊路徑可靠地存取該共享。</para>
  <para>為了確保資料的高可用性，我們建議您為叢集使用共享磁碟系統 (儲存區域網路，即 SAN)。如果使用共享磁碟子系統，請注意下列事項︰
  </para>

  <itemizedlist>
   <listitem>
    <para>
     已根據製造商的指示正確設定共用磁碟系統，而且可以正常運作。
    </para>
   </listitem>
   <listitem>
    <para>
     共享磁碟系統中包含的磁碟應設定為使用鏡像複製或 RAID，以增強共享磁碟系統的容錯能力。建議使用硬體型 RAID。系統並不是對所有組態都支援主機型軟體 RAID。
    </para>
   </listitem>
   <listitem>
    <para>
     如果使用 iSCSI 存取共用磁碟系統，必須確定已正確設定 iSCSI 啟動程式和目標。
    </para>
   </listitem>
   <listitem>
    <para>
     使用 DRBD* 實作在兩台機器間配送資料的鏡像 RAID 系統時，請務必只存取 DRBD 提供的裝置，切勿存取備份裝置。請與叢集的其餘部分使用相同 (繫結) 的 NIC，以利用該處所提供的備援。
    </para>
   </listitem>
  </itemizedlist>
  <para>
   如果使用 SBD 做為 STONITH 機制，則共用儲存還需要符合其他要求。如需詳細資料，請參閱<xref linkend="sec-ha-storage-protect-req"/>。
   </para>
 </sect1>
 <sect1 xml:id="sec-ha-requirements-other">
  <title>其他要求與建議</title>

  <para>
   為了實現受支援且有用的高可用性設定，請考慮以下建議︰
  </para>

  <variablelist>
   <varlistentry xml:id="vle-ha-req-nodes">
    <term>叢集節點數</term>
    <listitem>
     <important>
      <title>奇數數量的叢集節點</title>
      <para>
       對於包含三個以上節點的叢集，強烈建議使用奇數數量的叢集節點。
      </para>
      <para>為使服務保持執行狀態，包含兩個以上節點的叢集依賴最低節點數 (多數投票數) 來解決叢集分割區。雙節點或三節點叢集只能容許每次有一個節點失敗，而五節點叢集可以容許兩個節點失敗，依此類推。
      </para>
     </important>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>時間同步</term>
     <listitem>
   <para>
     叢集節點必須與叢集外的 NTP 伺服器同步。自 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 15 起，採用 chrony 做為 NTP 的預設實作。如需詳細資訊，請參閱《<citetitle>SUSE Linux Enterprise Server <phrase role="productnumber"><phrase os="sles">15</phrase></phrase> 管理指南</citetitle>》中的「<citetitle>與 NTP 同步時間</citetitle>」一章。此文件位於 <link xlink:href="http://www.suse.com/documentation/"/>。
    </para>
    <para>
     若節點未同步，叢集可能無法正常運作。此外，記錄檔案和叢集報告在未同步的情況下很難進行分析。使用開機程序檔時，若尚未設定 NTP，系統會向您發出警告。
    </para>
  </listitem>
   </varlistentry>
   <varlistentry>
    <term>網路介面卡 (NIC) 名稱</term>
    <listitem>
     <para>
      在所有節點上都必須相同。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>主機名稱與 IP 位址</term>
    <listitem>
     <itemizedlist>
      <listitem>
       <para>
        使用靜態 IP 位址。
       </para>
      </listitem>
      <listitem>
        <para>
     在 <filename>/etc/hosts</filename> 檔案中列出了所有叢集節點，包括完全合格的主機名稱和簡短主機名稱。叢集的成員必須能夠籍由名稱找到彼此，這是一項基本要求。如果名稱不可用，內部叢集通訊將會失敗。
   </para>
       <para>
        如需 Pacemaker 如何取得節點名稱的詳細資料，請參閱 <link xlink:href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1/html/Pacemaker_Explained/s-node-name.html"/>。
       </para>
      </listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-ha-req-ssh">
    <term>SSH</term>
    <listitem>
      <para>
    所有叢集節點必須能透過 SSH 互相存取。諸如 <command>crm report</command> (用於疑難排解) 等工具以及 Hawk2 的<guimenu>歷程總管</guimenu>，要求節點之間透過無密碼的 SSH 方式來存取，否則它們只能從目前節點收集資料。
  </para>
     <note>
      <title>法規要求</title>
      <para>
       如果無密碼 SSH 存取不符合法規要求，您可以使用<xref linkend="app-crmreport-nonroot"/>中所述的解決方式來執行 <command>crm report</command>。
      </para>
      <para>
       對於<guimenu>歷程總管</guimenu>，目前還沒有其他方式可替代無密碼登入。
      </para>
     </note>
    </listitem>
   </varlistentry>

  </variablelist>
 </sect1>
</chapter>
