<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_error_codes.xml" version="5.0" xml:id="sec.ha.errorcodes">
 <title>OCF 傳回代碼與失敗復原</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>編輯</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  根據 OCF 規格，對於動作必須返回的離開碼有著嚴格的定義。叢集會始終根據預期結果檢查傳回代碼。如果結果不符合預期值，則該操作將被視為失敗，並啟動復原動作。失敗復原有三種類型：
 </para>

 <table>
  <title>失敗復原類型</title>
  <tgroup cols="3">
   <thead>
    <row>
     <entry>
      <para>
       復原類型
      </para>
     </entry>
     <entry>
      <para>
       描述
      </para>
     </entry>
     <entry>
      <para>
       叢集採取的動作
      </para>
     </entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry>
      <para>
       軟式
      </para>
     </entry>
     <entry>
      <para>
       發生暫時錯誤。
      </para>
     </entry>
     <entry>
      <para>
       重新啟動資源或將其移到新的位置。
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       硬式
      </para>
     </entry>
     <entry>
      <para>
       發生非暫時錯誤。該錯誤可能與目前節點有關。
      </para>
     </entry>
     <entry>
      <para>
       將資源移到別處並阻止其在目前節點上被重試。
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       嚴重錯誤
      </para>
     </entry>
     <entry>
      <para>
       發生對於所有叢集節點均相同的非暫時錯誤。這表示指定了錯誤的組態。
      </para>
     </entry>
     <entry>
      <para>
       停止資源並阻止其在任何叢集節點上啟動。
      </para>
     </entry>
    </row>
   </tbody>
  </tgroup>
 </table>

 <para>
  下表列出了假設一個動作被視為已失敗時的不同 OCF 傳回代碼，另外還顯示了叢集在接收到相應錯誤碼時將啟始的復原類型。
 </para>

 <remark>taroth 2010-03-07: DEVs, please check if the information in the table is still valid</remark>



 <table>
  <title>OCF 傳回代碼</title>
  <tgroup cols="4">
   <colspec colnum="1" colname="1" colwidth="12*"/>
   <colspec colnum="2" colname="2" colwidth="23*"/>
   <colspec colnum="3" colname="3" colwidth="50*"/>
   <colspec colnum="4" colname="4" colwidth="15*"/>
   <thead>
    <row>
     <entry>
      <para>
       OCF 傳回代碼
      </para>
     </entry>
     <entry>
      <para>
       OCF 別名
      </para>
     </entry>
     <entry>
      <para>
       描述
      </para>
     </entry>
     <entry>
      <para>
       復原類型
      </para>
     </entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry>
      <para>
       0
      </para>
     </entry>
     <entry>
      <para>
       OCF_SUCCESS
      </para>
     </entry>
     <entry>
      <para>
       成功。指令成功完成。這是所有 start、stop、promote 和 demote 指令的預期結果。
      </para>
     </entry>
     <entry>
      <para>
       軟式
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       1
      </para>
     </entry>
     <entry>
      <para>
       OCF_ERR_­GENERIC
      </para>
     </entry>
     <entry>
      <para>
       一般<quote>發生問題</quote>錯誤碼。
      </para>
     </entry>
     <entry>
      <para>
       軟式
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       2
      </para>
     </entry>
     <entry>
      <para>
       OCF_ERR_ARGS
      </para>
     </entry>
     <entry>
      <para>
       此機器上的資源組態無效 (例如，它參考節點上找不到的位置/工具)。
      </para>
     </entry>
     <entry>
      <para>
       硬式
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       3
      </para>
     </entry>
     <entry>
      <para>
       OCF_­ERR_­UN­IMPLEMENTED
      </para>
     </entry>
     <entry>
      <para>
       未執行所需動作。
      </para>
     </entry>
     <entry>
      <para>
       硬式
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       4
      </para>
     </entry>
     <entry>
      <para>
       OCF_ERR_PERM
      </para>
     </entry>
     <entry>
      <para>
       資源代辦沒有足夠的權限來完成任務。
      </para>
     </entry>
     <entry>
      <para>
       硬式
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       5
      </para>
     </entry>
     <entry>
      <para>
       OCF_ERR_­INSTALLED
      </para>
     </entry>
     <entry>
      <para>
       此機器上未安裝資源所需的工具。
      </para>
     </entry>
     <entry>
      <para>
       硬式
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       6
      </para>
     </entry>
     <entry>
      <para>
       OCF_ERR_­CONFIGURED
      </para>
     </entry>
     <entry>
      <para>
       資源的組態無效 (例如，缺少必需的參數)。
      </para>
     </entry>
     <entry>
      <para>
       嚴重錯誤
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       7
      </para>
     </entry>
     <entry>
      <para>
       OCF_NOT_­RUNNING
      </para>
     </entry>
     <entry>
      <para>
       資源未執行。叢集不會嘗試停止對任何動作返回此代碼的資源。
      </para>
      <para>
       此 OCF 傳回代碼可能需要也可能不需要資源復原，具體取決於預期的資源狀態。如果不是預期情況，則進行<literal>軟式</literal>復原。
      </para>
     </entry>
     <entry>
      <para>
       無
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       8
      </para>
     </entry>
     <entry>
      <para>
       OCF_RUNNING_­MASTER
      </para>
     </entry>
     <entry>
      <para>
       資源正以主要模式執行。
      </para>
     </entry>
     <entry>
      <para>
       軟式
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       9
      </para>
     </entry>
     <entry>
      <para>
       OCF_FAILED_­MASTER
      </para>
     </entry>
     <entry>
      <para>
       資源在主要模式下執行，但已失敗。資源將被降級、停止，然後再次啟動 (還可能升級)。
      </para>
     </entry>
     <entry>
      <para>
       軟式
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       其他
      </para>
     </entry>
     <entry>
      <para>
       無
      </para>
     </entry>
     <entry>
      <para>
       自訂錯誤碼。
      </para>
     </entry>
     <entry>
      <para>
       軟式
      </para>
     </entry>
    </row>
   </tbody>
  </tgroup>
 </table>
</sect1>
