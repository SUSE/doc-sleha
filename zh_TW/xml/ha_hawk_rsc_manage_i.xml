<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_hawk_rsc_manage_i.xml" version="5.0" xml:id="sec.ha.config.hawk.manage">
 <title>管理叢集資源</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>編輯</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  除了設定叢集資源外，Hawk 還可讓您透過<guimenu>叢集狀態</guimenu>螢幕管理現存資源。有關此螢幕的一般綜覽、不同檢視以及用於狀態資訊的色碼，請參閱<xref linkend="sec.ha.config.hawk.intro.main"/>。
 </para>



 <para>
  從任何叢集狀態檢視中都可執行基本的資源操作。從<guimenu>樹狀檢視</guimenu>和<guimenu>表格檢視</guimenu>中，都可以直接存取個別資源。但是，在<guimenu>摘要檢視</guimenu>中，您需要先按一下資源類別中的連結，以顯示資源詳細資料。詳細的檢視窗還會顯示為該資源設定的所有屬性。對於基本資源 (一般的基本資源，群組子項、複製品或多狀態資源)，還會額外顯示下列資訊：
 </para>

 <itemizedlist>
  <listitem>
   <para>
    資源的失敗計數
   </para>
   <para>
    上次失敗時戳 (如果失敗計數 &gt; 0)
   </para>
  </listitem>
  <listitem>
   <para>
    操作歷程及時間 (呼叫 ID、操作、上次執行時戳、執行時間、佇列時間、傳回代碼及上次變更時戳)
   </para>
  </listitem>
 </itemizedlist>

 <figure>
  <title>檢視資源的詳細資料</title>
  <mediaobject>
   <imageobject role="fo">
    <imagedata fileref="hawk-resource-details.png" width="60%" format="PNG"/>
   </imageobject>
   <imageobject role="html">
    <imagedata fileref="hawk-resource-details.png" width="55%"/>
   </imageobject>
  </mediaobject>
 </figure>

 <sect2 xml:id="sec.ha.config.hawk.start">
  <title>啟動資源</title>
  <para>
   啟動叢集資源之前，請先確定該資源已正確設定。例如，如果想要使用 Apache 伺服器做為叢集資源，請先設定 Apache 伺服器。完成 Apache 組態設定後，再在叢集中啟動相應的資源。
  </para>
  <note>
   <title>不要對叢集管理的服務執行任何操作</title>
   <para>
    當您正透過 High Availability Extension 管理某個資源時，就不能再啟動或停止該資源 (例如，不能在叢集之外手動啟動或停止，或者在開機或重新開機時啟動或停止)。High Availability Extension 軟體負責所有服務的啟動或停止動作。
   </para>
   <para>
    不過，如果您要檢查服務是否正確設定，請手動將其啟動，但務必在 High Availability 接管之前將它再次停止。
   </para>
   <para>
    若要對目前由叢集管理的資源進行干預，請先依照<xref linkend="pro.ha.config.hawk.maint.mode.rsc"/>所述將資源設定為<literal>維護模式</literal>。
   </para>
  </note>
  <para>
   透過 Hawk 建立資源時，您可以使用 <literal>target-role</literal> 中繼屬性設定該資源的初始狀態。如果將其值設定為 <literal>stopped</literal>，則資源建立後不會自動啟動。
  </para>
  <procedure xml:id="pro.ha.config.hawk.start">
   <title>啟動新資源</title>
   <step>
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step>
    <para>
     在左側導覽列中選取<guimenu>叢集狀態</guimenu>。
    </para>
   </step>
   <step>
    <para>
     在其中一個資源檢視中，按一下資源旁邊的扳手圖示，然後選取<guimenu>啟動</guimenu>。若要繼續，請確認顯示的訊息。資源啟動後，Hawk 會將該資源的色彩變為綠色，並顯示目前執行該資源的節點。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec.ha.config.hawk.cleanup">
  <title>清理資源</title>
  <para>
   如果資源失敗，系統會自動將其重新啟動，但每次失敗都會增加該資源的 failcount。
  </para>
  <para>
   如果為資源設定了 <literal>migration-threshold</literal>，則當失敗次數達到移轉限定值時，節點將不再執行該資源。
  </para>
  <para>
   資源的 failcount 可自動重設 (若為資源設定 <literal>failure-timeout</literal> 選項)，也可按如下方式手動重設。
  </para>
  <procedure xml:id="pro.ha.config.hawk.clean">
   <title>清理資源</title>
   <step>
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step>
    <para>
     在左側導覽列中選取<guimenu>叢集狀態</guimenu>。
    </para>
   </step>
   <step>
    <para>
     在其中一個資源檢視中，按一下失敗資源旁邊的扳手圖示，然後選取<guimenu>清理</guimenu>。若要繼續，請確認顯示的訊息。
    </para>

    <para>
     如此會對指定節點上的指定資源執行指令 <command>crm_resource </command><option>-C</option> 與 <command>crm_failcount </command><option>-D</option>。
    </para>
   </step>
  </procedure>
  <para>
   如需詳細資訊，請參閱 <command>crm_resource</command> 與 <command>crm_failcount</command> 的 man 頁面。
  </para>
 </sect2>

 <sect2 xml:id="sec.ha.config.hawk.remove">
  <title>移除叢集資源</title>
  <para>
   如果需要從叢集移除資源，請按照下面的程序操作，以免出現組態錯誤：
  </para>


  <procedure xml:id="pro.ha.config.hawk.rm">
   <title>移除叢集資源</title>
   <step>
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step>
    <para>
     在左側導覽列中選取<guimenu>叢集狀態</guimenu>。
    </para>
   </step>
   <step>
    <para>
     依照<xref linkend="pro.ha.config.hawk.clean"/> 中的說明在所有節點上清理該資源。
    </para>
   </step>
   <step>
    <para>
     在其中一個資源檢視中，按一下資源旁邊的扳手圖示，然後選取<guimenu>停止</guimenu>。若要繼續，請確認顯示的訊息。
    </para>
   </step>


   <step>
    <para>
     如果資源已停止，請按一下資源旁邊的扳手圖示，然後選取<guimenu>刪除資源</guimenu>。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec.ha.config.hawk.migrate">
  <title>移轉叢集資源</title>
  <para>
   如<xref linkend="sec.ha.config.hawk.failover"/> 所述，當軟體或硬體發生故障時，叢集會自動對資源進行容錯移轉 (移轉)，具體情況視您可以定義的特定參數 (例如移轉限定值或資源粘性) 而定。除此之外，您也可以手動將資源移轉至叢集中的其他節點。或者，您可以選擇將資源移出目前節點，並讓叢集決定要將它放在哪個位置。
  </para>
  <procedure xml:id="pro.ha.config.hawk.migrate">
   <title>手動移轉資源</title>
   <step>
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step>
    <para>
     在左側導覽列中選取<guimenu>叢集狀態</guimenu>。
    </para>
   </step>
   <step>
    <para>
     在其中一個資源檢視中，按一下資源旁邊的扳手圖示，然後選取<guimenu>移動</guimenu>。
    </para>
   </step>
   <step>
    <para>
     在新視窗中選取要將資源移至其中的節點。
    </para>
    <para>
     如此會建立一個位置條件約束，其目的節點的分數為 <literal>INFINITY</literal>。
    </para>
   </step>
   <step>
    <para>
     或者，選擇將資源<guimenu>從目前節點移開</guimenu>。
    </para>
    <informalfigure>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="hawk-move-rsc.png" width="70%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="hawk-move-rsc.png" width="60%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </informalfigure>
    <para>
     如此會建立一個位置條件約束，其目前節點的分數為 <literal>-INFINITY</literal>。
    </para>

   </step>

   <step>
    <para>
     按一下<guimenu>確定</guimenu>以確認移轉。
    </para>
   </step>
  </procedure>
  <para>
   若要讓資源回到原來的狀態，請執行下列步驟：
  </para>
  <procedure xml:id="pro.ha.config.hawk.migrate.back">
   <title>清除移轉條件約束</title>
   <step>
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step>
    <para>
     在左側導覽列中選取<guimenu>叢集狀態</guimenu>。
    </para>
   </step>
   <step>
    <para>
     在其中一個資源檢視中，按一下資源旁邊的扳手圖示，然後選取<guimenu>放棄重新配置規則</guimenu>。若要繼續，請確認顯示的訊息。
    </para>
    <para>
     此過程會使用 <command>crm_resource </command><option>-U</option> 指令。資源<emphasis>可以</emphasis>移回其原始位置，也可以保留在目前的位置 (具體取決於資源粘性)。
    </para>
   </step>
  </procedure>
  <para>
   如需詳細資訊，請參閱 <command>crm_resource</command> 的 man 頁面或 <link xlink:href="http://www.clusterlabs.org/doc/"/> 上的《<citetitle>Pacemaker Explained</citetitle>》(Pacemaker 說明)。可參閱其中的「Resource Migration」(資源移轉) 一節。<citetitle/>
  </para>
 </sect2>

 <sect2 xml:id="sec.ha.config.hawk.maint.mode">
  <title>使用維護模式</title>
    <para>
   您可能不時地需要對個別叢集元件或整個叢集執行測試或維護任務 — 變更叢集組態、更新個別節點的軟體套件，或者將叢集升級到更高的產品版本。
  </para>
    <para>
   為此，High Availability Extension 提供了針對多個層級的 <literal>maintenance</literal> 選項：
  </para>
  <itemizedlist>
   <listitem>
    <para>
     <xref linkend="pro.ha.config.hawk.maint.mode.rsc" xrefstyle="select:title"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="pro.ha.config.hawk.maint.mode.nodes" xrefstyle="select:title"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="pro.ha.config.hawk.maint.mode.cluster" xrefstyle="select:title"/>
    </para>
   </listitem>
  </itemizedlist>
   
   <warning>
   <title>資料遺失的風險</title>
   <para>當服務在叢集控制下執行時，如果您需要執行任何測試或維護任務，請務必遵循以下指南：</para>
   <orderedlist>
    <listitem>
     <para>在開始之前，請將個別資源、節點或整個叢集設定為維護模式。這有助於避免一些不利的負面影響，例如，資源不按順序啟動、出現叢集節點間 CIB 不同步或資料遺失的風險。 </para>
    </listitem>
    <listitem>
     <para>執行維護任務或測試。</para>
    </listitem>
    <listitem>
     <para>完成後，請解除維護模式以開始正常的叢集操作。</para>
    </listitem>
   </orderedlist>
  </warning>
   
   <para>
   如需處於維護模式的資源和叢集會發生之情況的詳細資料，請參閱<xref linkend="sec.ha.config.basics.maint.mode"/>。
  </para>
  <procedure xml:id="pro.ha.config.hawk.maint.mode.rsc">
   <title>向資源套用維護模式</title>
   <step>
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step>
    <para>
     在左側導覽列中，選取<guimenu>資源</guimenu>。選取要將其置於維護模式或不受管理模式的資源，然後按一下資源旁邊的扳手圖示並選取<guimenu>編輯資源</guimenu>。
    </para>
   </step>
   <step>
    <para>
     開啟<guimenu>中繼屬性</guimenu>類別。
    </para>
   </step>
   <step>
    <para>
     從空白下拉式清單中，選取 <guimenu>maintenance</guimenu> 屬性並按一下加號圖示新增該屬性。
    </para>
   </step>
   <step>
    <para>
     啟用 <literal>maintenance</literal> 旁邊的核取方塊，將 maintenance 屬性設定為 <literal>yes</literal>。
    </para>
   </step>
   <step>
    <para>
     確認您的變更。
    </para>
   </step>
   <step>
    <para>
     完成針對該資源的維護任務後，停用該資源 <literal>maintenance</literal> 屬性旁邊的核取方塊。
    </para>
    <para>
     從此時起，資源將重新由 High Availability Extension 軟體管理。
    </para>
   </step>
  </procedure>

  <procedure xml:id="pro.ha.config.hawk.maint.mode.nodes">
   <title>向節點套用維護模式</title>
   <para>
    有時，需要將個別節點置於維護模式。

   </para>
   <step>
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step>
    <para>
     在左側導覽列中選取<guimenu>叢集狀態</guimenu>。
    </para>
   </step>
   <step>
    <para>
     在其中一個節點檢視窗中，按一下節點旁邊的扳手圖示，然後選取<guimenu>維護</guimenu>。
    </para>
    <para>
     如此會將以下例項屬性新增至該節點：<literal>maintenance="true"</literal>。先前在這個維護模式節點上執行的資源將會變成<literal>未受管理</literal>模式。在該節點脫離維護模式之前，系統將不會為其配置任何新的資源。
    </para>
   </step>
   <step>
    <para>
     若要停用維護模式，請按一下節點旁邊的扳手圖示，然後選取<guimenu>就緒</guimenu>。
    </para>
   </step>
  </procedure>
  <procedure xml:id="pro.ha.config.hawk.maint.mode.cluster">
   <title>向叢集套用維護模式</title>
   <para>
    若要為整個叢集設定或取消設定維護模式，請執行下列步驟：
   </para>
   <step>
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step>
    <para>
     在左側導覽列中選取<guimenu>叢集組態</guimenu>。
    </para>
   </step>
   <step>
    <para>
     在 <guimenu>CRM 組態</guimenu>群組中，從空白下拉式方塊中選取 <guimenu>maintenance-mode</guimenu> 屬性，然後按一下加號圖示新增該屬性。
    </para>
   </step>
   <step>
    <para>
     若要設定 <literal>maintenance-mode=true</literal>，請啟用 <literal>maintenance-mode</literal> 旁邊的核取方塊，並確認您所做的變更。
    </para>
   </step>
   <step>
    <para>
     完成針對整個叢集的維護任務後，停用 <literal>maintenance-mode</literal> 屬性旁邊的核取方塊。
    </para>
    <para>
     從此刻起，High Availability Extension 會再次接管叢集管理工作。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec.ha.config.hawk.history">
  <title>檢視叢集歷程</title>

  <para>
   Hawk 提供了以下用於檢視叢集過往事件 (按不同的層級和不同的詳細程度) 的功能。
  </para>
  <procedure xml:id="pro.ha.config.hawk.recent">
   <title>檢視節點或資源的最近事件</title>
   <step>
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step>
    <para>
     在左側導覽列中選取<guimenu>叢集狀態</guimenu>。
    </para>
   </step>
   <step>
    <para>
     在<guimenu>樹狀檢視</guimenu>或<guimenu>表格檢視</guimenu>中，按一下目標資源或節點旁邊的扳手圖示，然後選取<guimenu>檢視最近的事件</guimenu>。
    </para>
    <para>
     開啟的對話方塊即會顯示前一個小時的事件。
    </para>
   </step>
  </procedure>
  <procedure xml:id="pro.ha.config.hawk.history.explorer">
   <title>使用歷程總管檢視轉換</title>
   <para>
    <guimenu>歷程總管</guimenu>提供某個時間範圍內 (您可以定義此時間範圍) 的轉換資訊。它還會列出其先前執行的歷程，並可讓您<guimenu>刪除</guimenu>不再需要的報告。<guimenu>歷程總管</guimenu>使用 <literal>hb_report</literal> 提供的資訊。您還可以使用<literal>歷程總管</literal>上傳在其他叢集上離線建立的 <guimenu>hb_report</guimenu> 歸檔，並檢視相應的轉換。請參閱<xref linkend="pro.ha.config.hawk.history.explorer.offline"/>。

   </para>
   <step>
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step>
    <para>
     在左側導覽列中選取<guimenu>歷程總管</guimenu>。
    </para>
   </step>
   <step>
    <para>
     瀏覽時段預設設為過去的 24 小時。若要修改此值，請設定其他<guimenu>開始時間</guimenu>和<guimenu>結束時間</guimenu>。
    </para>
   </step>
   <step>
    <para>
     按一下<guimenu>顯示</guimenu>開始收集轉換資料。
    </para>
   </step>
  </procedure>
  <figure>
   <title>Hawk — 歷程報告</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="hawk-history-report.png" width="100%" format="PNG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="hawk-history-report.png" width="90%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>
  <para>
   下列資訊就會顯示：
  </para>
  <variablelist xml:id="vl.hawk.history.results">
   <title>歷程總管結果</title>
   <varlistentry>
    <term><guimenu>時間</guimenu>
    </term>
    <listitem>
     <para>
      叢集中所有過往轉換的時間表。
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term>資訊圖示</term>
    <listitem>
     <para>
      在某些情況下，<guimenu>時間</guimenu>與 <guimenu>PE 輸入</guimenu>欄之間會顯示資訊圖示。將滑鼠指標移至該圖示的上方會顯示下列其中一則訊息：
     </para>
     <itemizedlist>
      <listitem>
       <para>
        <literal>輸入由另一個 Pacemaker 版本建立</literal>。在這種情況下，轉換圖表只會反映大致情況，因為這些圖表是由其他 PE 版本產生的。
       </para>
      </listitem>
      <listitem>
       <para>
        <literal>PE 輸入中不存在 Pacemaker 版本</literal>。此訊息會在叢集啟動期間尚未選取 DC 時顯示。
       </para>
      </listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><guimenu>PE Input</guimenu>/<guimenu>節點</guimenu>
    </term>
    <listitem>
     <para>
      每個轉換的 <filename>pe-input*</filename> 檔案以及產生該檔案的節點。叢集會為每個轉換儲存一個狀態副本，並提供給規則引擎以做為輸入。系統會記錄此歸檔的路徑。這些 <filename>pe-input*</filename> 檔案只會在指定協調者 (DC) 上產生，但由於 DC 可能會變更，因此有些 <filename>pe-input*</filename> 檔案可能來自多個節點。這些檔案顯示了規則引擎 (PE) <emphasis>計畫</emphasis>執行的操作。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><guimenu>詳細資料</guimenu>/<guimenu>完整記錄</guimenu>
    </term>

    <listitem>
     <para>
      開啟一個快顯視窗，其中會顯示屬於該特定轉換之記錄資料的片段。視窗可以顯示不同程度的詳細資料：按一下<guimenu>詳細資料</guimenu>會顯示 <command>crm history transition</command> <replaceable>peinput</replaceable> 的輸出 (包括資源代辦的記錄訊息)。按一下<guimenu>完整記錄</guimenu>還會顯示來自 <systemitem>pengine</systemitem>、<systemitem>crmd</systemitem> 與 <systemitem>lrmd</systemitem> 的詳細資料，該按鈕的作用相當於 <command>crm history transition log</command> <replaceable>peinput</replaceable> 指令。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><guimenu>圖形</guimenu>/<guimenu>XML</guimenu>
    </term>
    <listitem>
     <para>
      每個轉換的圖形與 XML 表示。如果選擇顯示<guimenu>圖形</guimenu>，系統將重新呼叫 PE (使用 <filename>pe-input*</filename> 檔案)，並以圖形方式來顯示轉換。或者，您可以檢視圖形的 XML 表示。
     </para>
     <figure>
      <title>Hawk 歷程報告 — 轉換圖形</title>
      <mediaobject>
       <imageobject role="fo">
        <imagedata fileref="hawk-history-graph.png" width="80%" format="PNG"/>
       </imageobject>
       <imageobject role="html">
        <imagedata fileref="hawk-history-graph.png" width="70%" format="PNG"/>
       </imageobject>
      </mediaobject>
     </figure>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term><guimenu>差異</guimenu>
    </term>

    <listitem>
     <para>
      如果列出的 pe-input 有兩個或兩個以上，每個 pe-input 配對的右側會顯示一個<guimenu>差異</guimenu>連結。按一下該連結將會顯示組態與狀態的差異。
     </para>

    </listitem>
   </varlistentry>
  </variablelist>

  <procedure xml:id="pro.ha.config.hawk.history.explorer.offline">
   <title>離線使用<guimenu>歷程總管</guimenu></title>
   <para>
    只要任何一個機器上在執行 Hawk，您還可以<quote>離線</quote>使用<guimenu>歷程總管</guimenu>，這意味著，您可以檢視和分析目前未連接之叢集的轉換。您只需提供一個 TAR 歸檔，該歸檔包含 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 叢集上產生的 <literal>hb_report</literal>。若要使用<guimenu>歷程總管</guimenu>上傳和分析該歸檔，請執行下列步驟：
   </para>
   <step>
    <para>
     啟動網頁瀏覽器，並依<xref linkend="sec.ha.config.hawk.intro.connect"/>所述登入 Hawk Web 介面。
    </para>
   </step>
   <step>
    <para>
     在左側導覽列中選取<guimenu>歷程總管</guimenu>。
    </para>
    <para>
     此時會顯示<guimenu>上傳 hb_report Tar 聚合檔</guimenu>項目。
    </para>
    <figure>
     <title>Hawk — 離線使用歷程總管</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="hawk-history-offline.png" width="80%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="hawk-history-offline.png" width="70%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     按一下<guimenu>瀏覽</guimenu>，然後選取要從您的檔案系統上傳的 <filename>hb_report</filename> 歸檔。
    </para>
   </step>
   <step>
    <para>
     按一下<guimenu>探索</guimenu>開始分析該歸檔，並顯示<xref linkend="vl.hawk.history.results"/>中所列的資訊。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec.ha.config.hawk.simulator">
  <title>瞭解可能發生的失敗個案</title>

  <para>
   Hawk 提供了一個<guimenu>模擬器</guimenu>，可讓您瞭解會發生的故障情境，以防患於未然。切換至模擬器模式後，可以變更節點狀態，新增或編輯資源與條件約束，變更叢集組態，或執行多個資源操作，以瞭解這些事件發生時叢集的行為。只要啟動模擬器模式，<guimenu>叢集狀態</guimenu>螢幕右下角就會顯示一個控制對話方塊。模擬器會收集所有螢幕中發生的變更並將它們新增至其內部事件佇列中。除非在控制對話方塊中手動觸發，否則使用排入佇列的事件來執行模擬將不會成功。執行模擬後，您可以檢視並分析可能會發生的情況的詳細資料 (記錄片段、轉換圖形和 CIB 狀態)。
  </para>
  <procedure xml:id="pro.ha.config.hawk.simulator">
   <title>切換至模擬器模式</title>
   <step>
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step>
    <para>
     若要啟用模擬器模式，請按一下頂層列中的扳手圖示 (使用者名稱旁邊)，然後選取<guimenu>模擬器</guimenu>。
    </para>
    <para>
     Hawk 的背景色彩即會變更，指出模擬器正在使用中。模擬器控制對話方塊顯示在<guimenu>叢集狀態</guimenu>螢幕右下角。其標題<guimenu>模擬器 (初始狀態)</guimenu>指示尚未執行過模擬器。
    </para>
   </step>
   <step>
    <para>
     填入模擬器的事件佇列：
    </para>
    <substeps performance="required">
     <step>
      <para>
       若要模擬某個節點的狀態變更：在模擬器控制對話方塊中按一下<guimenu>+節點</guimenu>。選取您要操作的<guimenu>節點</guimenu>，並選取其目標<guimenu>狀態</guimenu>。確認變更，以將其新增至控制器對話方塊中列出的事件佇列中。
      </para>
     </step>
     <step>
      <para>
       若要模擬資源操作：在模擬器控制對話方塊中按一下<guimenu>+操作</guimenu>。選取要操作的<guimenu>資源</guimenu>，以及要模擬的<guimenu>操作</guimenu>。如有必要，請定義一個<guimenu>間隔</guimenu>。選取要在其上執行該操作的<guimenu>節點</guimenu>以及預期的<guimenu>結果</guimenu>。確認變更，以將其新增至控制器對話方塊中列出的事件佇列中。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     對要模擬的任何其他節點狀態或資源操作重複上述步驟。
    </para>
    <figure>
     <title>Hawk — 含有插入事件的模擬器</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="hawk-simulator-injected.png" width="90%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="hawk-simulator-injected.png" width="70%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     若要插入其他要模擬的變更：
    </para>
    <substeps performance="required">
     <step>
      <para>
       切換至下列一或多個 Hawk 螢幕：<guimenu>叢集狀態</guimenu>、<guimenu>設定精靈</guimenu>、<guimenu>叢集組態</guimenu>、<guimenu>資源</guimenu>或<guimenu>條件約束</guimenu>。
      </para>
      <note>
       <title>歷程總管與模擬器模式</title>
       <para>
        按一下<guimenu>歷程總管</guimenu>索引標籤將停用模擬器模式。
       </para>
      </note>
     </step>
     <step>
      <para>
       視需要在螢幕上新增或修改參數。
      </para>
      <para>
       模擬器會收集所有螢幕中發生的變更並將它們新增至其內部事件佇列中。 <remark>taroth 2013-03-27: tserong, is there some way to display also the events collected
         on the other screens in the "Injected State" queue? from a user perspective, it's somehow
         strange if the injected events reflect only part of what will happen if you hit the "run"
         button... - tserong 2013-04-15: No, there's not currently, and you're right, that's
         annoying :-/ I've made a note to do something about that (again not sure if that'll make
         this release).</remark>
      </para>
     </step>
     <step>
      <para>
       若要回到模擬器控制對話方塊，請切換至<guimenu>叢集狀態</guimenu>螢幕，或按一下頂層列中的扳手圖示，然後再次按一下<guimenu>模擬器</guimenu>。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     如果要移除<guimenu>已插入狀態</guimenu>中列出的事件，請選取相應的項目，然後按一下清單下方的減號圖示。
    </para>
   </step>
   <step>
    <para>
     在模擬器控制對話方塊中按一下<guimenu>執行</guimenu>，啟動該輪模擬。<guimenu>叢集狀態</guimenu>螢幕即會顯示模擬的事件。例如，如果將某個節點標示為未清理，該節點現在將顯示為離線，並且它的所有資源都將停止。模擬器控制對話方塊將變更為<guimenu>模擬器 (最終狀態)</guimenu>。
    </para>
    <figure>
     <title>Hawk — 處於最終狀態的模擬器</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="hawk-simulator-final.png" width="90%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="hawk-simulator-final.png" width="70%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     若要檢視關於模擬執行的更多詳細資訊：
    </para>
    <substeps performance="required">
     <step>
      <para>
       在模擬器對話方塊中按一下<guimenu>詳細資料</guimenu>連結，以查看所發生之情況的記錄片段。
      </para>
     </step>
     <step>
      <para>
       按一下<guimenu>圖形</guimenu>連結，以顯示轉換圖形。
      </para>
     </step>
     <step>
      <para>
       按一下<guimenu>CIB (入)</guimenu>，以顯示初始 CIB 狀態。若要查看轉換後 CIB 的內容，請按一下<guimenu>CIB (出)</guimenu>。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     若要從頭開始進行一次新模擬，請使用<guimenu>重設</guimenu>按鈕。
    </para>
   </step>
   <step>
    <para>
     若要離開模擬模式，請關閉模擬器控制對話方塊。<guimenu>叢集狀態</guimenu>螢幕將切換回其正常色彩，並顯示目前叢集狀態。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec.ha.config.hawk.crmreport">
  <title>產生叢集報告</title>

  <para>
   為了分析和診斷叢集發生的問題，Hawk 可以產生叢集報告，用於從叢集中的所有節點收集資訊。
  </para>
  <procedure xml:id="pro.ha.config.hawk.crmreport">
   <title>產生 <literal>hb_report</literal></title>
   <step>
    <para>
     啟動網頁瀏覽器並依<xref linkend="sec.ha.config.hawk.intro.connect"/> 所述登入叢集。
    </para>
   </step>
   <step>
    <para>
     按一下頂層列中使用者名稱旁邊的扳手圖示，然後選取<guimenu>產生 hb_report</guimenu>。
    </para>
   </step>
   <step>
    <para>
     檢查時段預設為過去 1 小時。若要修改此值，請設定其他<guimenu>開始時間</guimenu>和<guimenu>結束時間</guimenu>。
    </para>
   </step>
   <step>
    <para>
     按一下<guimenu>產生</guimenu>。
    </para>
   </step>
   <step>
    <para>
     建立報告後，按一下相應的連結以下載 <filename>*.tar.bz2</filename> 檔案。
    </para>
   </step>
  </procedure>
  <para>
   如需報告涵蓋的記錄檔案的詳細資訊，請參閱<xref linkend="vle.ha.crmreport"/>。
  </para>
 </sect2>
</sect1>
