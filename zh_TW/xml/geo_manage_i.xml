<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_manage_i.xml" version="5.0" xml:id="sec.ha.geo.manage">
 <title>管理地理叢集</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>編輯</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  在 booth 可以管理地理叢集中的特定票證之前，首先需要手動將該票證授予給網站。
 </para>

 <sect2 xml:id="sec.ha.geo.manage.cli">
  <title>透過指令行</title>
  <para>
   請使用 <command>booth client</command> 指令行工具授予、列出或撤銷票證，如 <xref linkend="vl.ha.booth.client.cmds"/> 所述。可以在叢集中的任何機器上執行 <systemitem class="daemon">boothd</systemitem> 指令，而不僅是能夠在執行 <command>booth client</command> 的機器上執行。<command>booth client</command> 指令嘗試透過查看 booth 組態檔案和本地定義的 IP 位址來尋找<quote>本地</quote>叢集。如果未指定 booth 用戶端應連接到的網站 (使用 <option>-s</option> 選項)，則一律連接到本地網站。
  </para>
  <note>
   <title>語法變更</title>
   <para>
    從 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 11 開始，booth 用戶端指令的語法已得到簡化。例如，可以在 <option>list</option>、<option>grant</option> 或 <option>revoke</option> 操作中省略 <literal>client</literal> 關鍵字：<command>booth list</command>。此外，指定票證時可以省略 <option>-t</option> 選項。
   </para>
   <para>
    以前的語法仍受支援。如需詳細資訊，請參閱 booth man 頁面中的「<literal>概要</literal>」一節。不過，本手冊中的範例使用簡化的語法。
   </para>
  </note>

  <variablelist xml:id="vl.ha.booth.client.cmds">
   <title><command>booth client</command> 指令綜覽</title>
   <varlistentry>
    <term>列出所有票證</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> list
ticket: ticketA, leader: none
ticket: ticketB, leader: 10.2.12.101, expires: 2014-08-13 10:28:57</screen>
     <para>
      如果您未使用 <option>-s</option> 指定特定網站，將從本地 booth 例項要求票證的相關資訊。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>將票證授予給站台</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> grant -s 192.168.201.151 ticketA
booth[27891]: 2014/08/13_10:21:23 info: grant request sent, waiting for the result ...
booth[27891]: 2014/08/13_10:21:23 info: grant succeeded!</screen>
     <para>
      在這種情況下，<literal>ticketA</literal> 將授予給站台 <literal>192.168.201.151</literal>。如果省略 <option>-s</option> 選項，booth 將自動連接到目前網站 (執行 booth 用戶端的網站)並要求 <command>grant</command> 操作。
     </para>
     <para>
      在授予票證之前，該指令將會執行狀態檢查。如果已將同一張票證授予給另一個站台，系統將會發出警告，並提示您先從目前的站台中撤銷該票證。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>從站台中撤銷票證</term>
    <listitem>
<screen><prompt role="root">root # </prompt><command>booth</command> revoke ticketA
booth[27900]: 2014/08/13_10:21:23 info: revoke succeeded!</screen>
     <para>
      Booth 將會檢查目前向哪個網站授予了票證，並針對 <literal>ticketA</literal> 要求 <command>revoke</command> 操作。撤銷作業將立即執行。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <para>
   <command>grant</command> 和 (在某些情況下) <command>revoke</command> 操作可能需要在一段時間後才傳回確切操作的結果。用戶端將一直等待傳回結果，直到超過了票證的  <varname>timeout </varname> 值。此時間過後，用戶端將放棄等待 — 除非使用了 <option>-w</option> 選項，在這種情況下，用戶端會無限期等待。在記錄檔案中或者使用 <command>crm_ticket -L</command> 指令尋找確切的狀態。
  </para>
  <warning>
   <title><command>crm_ticket</command> 及 <command>crm site ticket</command></title>
   <para>
    如果 booth 服務出於任何原因未在執行中，您還可以使用 <command>crm_ticket</command> 或 <command>crm site ticket</command> 手動管理票證。這兩個指令只適用於叢集節點。進行干預時，請小心使用這些指令，因為它們<emphasis>無法</emphasis>驗證同一票證是否已授予給其他網站。如需詳細資訊，請閱讀 man 頁面。
   </para>
   <para>
    只要 booth 處於正常執行狀態，使用 <command>booth client</command> 指令便可進行手動干預。
   </para>
  </warning>
  <para>
   當您最初將票證授予給站台後，booth 機制將會接管該工作並自動管理票證。如果持有票證的站台停止服務，該票證將會在達到過期時間後自動撤銷並被授予給其他站台。依賴於該票證的資源將會容錯移轉至持有該票證的新站台。之前執行這些資源的節點將根據您在條件約束中設定的 <literal>loss-policy</literal> 加以處理。
  </para>

  <procedure xml:id="pro.ha.geo.manage.tickets">
   <title>手動管理票證</title>
   <para>
    假設您要將 <literal>ticket-nfs</literal> 從網站 <literal>amsterdam</literal> (使用虛擬 IP <literal>192.168.201.151</literal>) 手動移至網站 <literal>berlin</literal> (使用虛擬 IP <literal>192.168.202.151</literal>)，請執行以下步驟：
   </para>
   <step>
    <para>
     使用以下指令將 <literal>ticket-nfs</literal> 設定為待命狀態：
    </para>
<screen><prompt role="root">root # </prompt><command>crm_ticket</command> -t ticket-nfs -s</screen>
   </step>
   <step>
    <para>
     等待相依於 <literal>ticket-nfs</literal> 的所有資源完全停止或降級。
    </para>
   </step>
   <step>
    <para>
     使用以下指令從網站 <literal>amsterdam</literal> 中撤銷 <literal>ticket-nfs</literal>：
    </para>
<screen><prompt role="root">root # </prompt><command>booth</command> revoke -s 192.168.201.151 ticket-nfs</screen>
   </step>
   <step>
    <para>
     從原始網站中撤銷票證後，使用以下指令將它授予給網站 <literal>berlin</literal>：
    </para>
<screen><prompt role="root">root # </prompt><command>booth</command> grant -s 192.168.202.151 ticket-nfs</screen>
   </step>
  </procedure>
  <remark>phil 2013-12: Will/Should get a cleaner, more integrated workflow - "booth client move -t ticket -s new-site"
     or something similar. - dmuhamedagic 2014-08-13: N/A</remark>
 </sect2>

 
 <xi:include href="geo_manage_hawk2_i.xml"/>
</sect1>
