<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_migration.xml" version="5.0" xml:id="cha.ha.migration">

 <title>クラスタアップグレードとソフトウェアパッケージの更新</title>
 <info>
      <abstract>
        <para>
    この章では、次の2つの異なるシナリオ(<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase>の別バージョン(メジャーリリースまたはサービスパック)へのクラスタアップグレード、およびクラスタノード上の各パッケージの更新)について説明します。<xref linkend="sec.ha.migration.upgrade"/>および<xref linkend="sec.ha.migration.update"/>を参照してください。
   </para>
        <para>
    クラスタをアップグレードする場合、アップグレードを開始する前に、<xref linkend="sec.ha.migration.upgrade.oview"/>および<xref linkend="sec.ha.migration.upgrade.require"/>を確認してください。
   </para>
      </abstract>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>編集</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <sect1 xml:id="sec.ha.migration.terminology">
  <title>用語集</title>

  <para>
   次に、この章で使用される最も重要な用語の定義を示します。
  </para>



  <variablelist>
   <varlistentry>
    <term>メジャーリリース</term>
    <term>一般出荷(GA)バージョン</term>
    <listitem>
     <para>
      メジャーリリースとは、新しい機能やツールを導入し、非推奨になっていたコンポーネントを削除した、新しい製品バージョンです。これには、後方互換性のない変更が存在します。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle.upgrade.offline">
    <term>オフラインマイグレーション</term>
    <listitem>
     <para>
      新しい製品バージョンに後方互換性のない大幅な変更が含まれる場合、クラスタをオフラインマイグレーションでアップグレードする必要があります。つまり、すべてのノードをオフラインにしてクラスタ全体をアップグレードしてから、すべてのノードをオンラインに戻す必要があります。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle.upgrade.rolling">
    <term>ローリングアップグレード</term>
    <listitem>
     <para>
      ローリングアップグレードでは、一度に1つずつクラスタノードをアップグレードし、残りのクラスタは実行中のままにします。つまり、最初のノードをオフラインにしてアップグレードし、オンラインに戻してクラスタに参加させます。その後、すべてのクラスタノードがメジャーバージョンにアップグレードされるまで、1つずつアップグレードを続けます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>サービスパック(SP)</term>
    <listitem>
     <para>
      複数のパッチを組み合わせて、インストールまたは展開しやすい形式にします。サービスパックには番号が付けられ、通常、プログラムのセキュリティ修正、更新、アップグレード、または拡張機能が含まれます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>アップデート</term>
    <listitem>
     <para>
      新しい<emphasis>マイナー</emphasis>バージョンのパッケージのインストールです。通常、セキュリティの修正やその他の重要な修正が含まれています。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>アップグレード</term>
    <listitem>
     <para>
      パッケージまたは配布の新しい<emphasis>主要</emphasis>バージョンのインストール。これにより<emphasis>新機能</emphasis>がもたらされます。<xref linkend="vle.upgrade.offline"/>および<xref linkend="vle.upgrade.rolling"/>も参照してください。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 xml:id="sec.ha.migration.upgrade">
  <title>最新の製品バージョンへのクラスタアップグレード</title>

  <para>
   サポートされるアップグレードパスおよびアップグレードの実行方法は、現在の製品バージョンおよび移行したいターゲットバージョンによって異なります。
  </para>

  <itemizedlist>
   <listitem>
    <para>
     ローリングアップグレードは、同じメジャーリリース内(製品バージョンのGAから次のサービスパックまで、および1つのサービスパックから次のサービスパックまでの間)でのみサポートされます。
    </para>
   </listitem>
   <listitem>
    <para>
     あるメジャーリリースから次のメジャーリリース(たとえば、SLE HA 12からSLE HA 15など)、または特定のメジャーリリース内のサービスパックから次のメジャーリリース(たとえば、SLE HA 12SP3からSLE HA 15)へアップグレードするには、オフラインマイグレーションが必要です。
    </para>
   </listitem>
  </itemizedlist>

  <para>
   <xref linkend="sec.ha.migration.upgrade.oview" xrefstyle="select:label"/>には、SLE HA (Geo)のサポートされているアップグレードパスの概要が示されています。列<citetitle>詳細情報の参照先</citetitle>には、参照する必要がある特定のアップグレードドキュメント(基本システムとGeo Clustering for SUSE Linux Enterprise High Availability Extensionも含まれます)が一覧表示されています。このマニュアルは以下から入手できます。</para>
   <itemizedlist>
    <listitem>
     <para>
      <link xlink:href="http://www.suse.com/documentation/sles"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <link xlink:href="http://www.suse.com/documentation/sle-ha"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <link xlink:href="http://www.suse.com/documentation/sle-ha-geo"/>
     </para>
    </listitem>
   </itemizedlist>

  <important>
   <title>混合クラスタおよびアップグレード後に元に戻す操作はサポートされない</title>
   <itemizedlist>
    <listitem>
     <para>
      <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12/<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 15で実行する混合クラスタはサポートされていません。<emphasis/>
     </para>
    </listitem>
    <listitem>
     <para>
      製品バージョン15へのアップグレードプロセス後に、製品バージョン12に戻す処理は、<emphasis/>サポートされていません。
     </para>
    </listitem>
   </itemizedlist>
  </important>

  <sect2 xml:id="sec.ha.migration.upgrade.oview">
   <title>SLE HAおよびSLE HA Geoでサポートされるアップグレードパス</title>
   <informaltable>
    <tgroup cols="3">
     <colspec colnum="1" colname="1" colwidth="28*"/>
     <colspec colnum="2" colname="2" colwidth="22*"/>
     <colspec colnum="3" colname="3" colwidth="50*"/>
     <thead>
      <row>
       <entry>
        <para>
         アップグレード元とアップグレード先
        </para>
       </entry>
       <entry>
        <para>
         アップグレードパス
        </para>
       </entry>
       <entry>
        <para>
         詳細情報の参照先
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         SLE HA 11 SP3から
        </para>
       <para>SLE HA (Geo) 12</para>
       </entry>
       <entry>
        <para>
         オフラインマイグレーション
        </para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基本システム:  SLES 12用の『<citetitle>導入ガイド</citetitle>』の「<citetitle>Updating and Upgrading SUSE Linux Enterprise</citetitle>」のパート
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA: <xref linkend="pro.ha.migration.offline" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo:  SLE HA 12用の『<citetitle>Geo Clustering クイックスタート</citetitle>』の「<citetitle>Upgrading from SLE HA (Geo) 11 SP 3 to SLE HA Geo 12</citetitle>」の項
          </para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         SLE HA (Geo) 11 SP4からSLE HA (Geo) 12 SP1
        </para>
       </entry>
       <entry>
        <para>
         オフラインマイグレーション
        </para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基本システム:  SLES 12 SP1用の『<citetitle>導入ガイド</citetitle>』の「<citetitle>Updating and Upgrading SUSE Linux Enterprise</citetitle>」のパート
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA: <xref linkend="pro.ha.migration.offline" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo: SLE HA 12 SP1用の『<citetitle>Geo Clustering クイックスタート</citetitle>』の「<citetitle>Upgrading to the Latest Product Version</citetitle>」の項
          </para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         SLE HA (Geo) 12からSLE HA (Geo) 12 SP1
        </para>
       </entry>
       <entry>
        <para>
         ローリングアップグレード
        </para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基本システム:  SLES 12 SP1用の『<citetitle>導入ガイド</citetitle>』の「<citetitle>Updating and Upgrading SUSE Linux Enterprise</citetitle>」のパート
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA: <xref linkend="pro.ha.migration.rolling.upgrade" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo: SLE HA 12 SP1用の『<citetitle>Geo Clustering クイックスタート</citetitle>』の「<citetitle>Upgrading to the Latest Product Version</citetitle>」の項
          </para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>SLE HA (Geo) 12 SP1からSLE HA (Geo) 12 SP2</para>
       </entry>
       <entry>
        <para>ローリングアップグレード</para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基本システム:  SLES 12 SP2用の『<citetitle>導入ガイド</citetitle>』の「<citetitle>Updating and Upgrading SUSE Linux Enterprise</citetitle>」のパート
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA: <xref linkend="pro.ha.migration.rolling.upgrade" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo: SLE HA 12 SP2用の『<citetitle>Geo Clustering クイックスタート</citetitle>』の「<citetitle>Upgrading to the Latest Product Version</citetitle>」の項
          </para>
         </listitem>
         <listitem>
          <para>DRBD 8から DRBD 9への移行<xref linkend="sec.ha.drbd.migrate" xrefstyle="select:title nopage"/></para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>SLE HA (Geo) 12 SP2からSLE HA (Geo) 12 SP3</para>
       </entry>
       <entry>
        <para>ローリングアップグレード</para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基本システム:  SLES 12 SP3用の『<citetitle>導入ガイド</citetitle>』の「<citetitle>Updating and Upgrading SUSE Linux Enterprise</citetitle>」のパート
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA: <xref linkend="pro.ha.migration.rolling.upgrade" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo: SLE HA 12 SP3用の『<citetitle>Geo Clusteringガイド</citetitle>』の「<citetitle>Upgrading to the Latest Product Version</citetitle>」の項
          </para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>SLE HA (Geo) 12 SP3からSLE HA (Geo) 15</para>
       </entry>
       <entry>
        <para>オフラインマイグレーション</para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基本システム: SLES 15用の『<citetitle>アップグレードガイド</citetitle>』
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA: <xref linkend="pro.ha.migration.offline.12-15" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo: <xref linkend="cha.ha.geo.upgrade"/>
          </para>
         </listitem>
         <listitem>
          <para>Cluster LVM: <xref linkend="sec.ha.clvm.migrate" xrefstyle="select:title nopage"/></para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
  </sect2>

  <sect2 xml:id="sec.ha.migration.upgrade.require">
   <title>アップグレード前に必要な準備</title>
   <variablelist>
    <varlistentry>
     <term>バックアップ</term>
     <listitem>
      <para>
       システムバックアップが最新で、復元可能かどうかを確認します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>テスト</term>
     <listitem>
      <para>
       運用環境で実行する前に、まず、クラスタセットアップのステージングインスタンスでアップグレード手順をテストします。これにより、メンテナンス期間に要するタイムフレームを予測できます。発生する可能性のある予期しない問題を検出し、解決するのにも役立ちます。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec.ha.migration.upgrade.offline">
   <title>オフラインマイグレーション</title>
   <para>
    この項は次のシナリオに適用されます。
   </para>
   <itemizedlist>
    <listitem>
     <para>
      SLE HA 11 SP3からSLE HA 12へのアップグレード
     </para>
    </listitem>
    <listitem>
     <para>
      SLE HA 12 SP4からSLE HA 11 SP1へのアップグレード
     </para>
    </listitem>
    <listitem>
     <para>
      SLE HA 12 SP3からSLE HA 15へのアップグレード
     </para>
    </listitem>
   </itemizedlist>
   <para>
    クラスタがまだこれらより古い製品バージョンに基づいている場合は、まず、必要なターゲットバージョンにアップグレードするためのソースとして使用できるバージョンのSLESおよびSLE HAにクラスタをアップグレードします。
   </para>
   <para>
    High Availability Extension 12クラスタスタックでは、さまざまなコンポーネントに大幅な変更が導入されています(たとえば、<filename>/etc/corosync/corosync.conf</filename>、OCFS2のディスクフォーマットなど)。したがって、<literal>SUSE Linux Enterprise High Availability Extension</literal> 11バージョンからの<phrase role="productname"><phrase os="sles">ローリングアップグレード</phrase></phrase>はサポートされません。代わりに、<xref linkend="pro.ha.migration.offline"/>で説明されているように、すべてのクラスタノードをオフラインにしてから、クラスタ全体を移行する必要があります。
   </para>
   <procedure xml:id="pro.ha.migration.offline">
    <title>製品バージョン11から12へのアップグレード: クラスタ全体のオフラインマイグレーション</title>
    <step>
     <para>
      各クラスタノードにログインし、次のコマンドを使用してクラスタスタックを停止します。
     </para>
<screen><prompt role="root">root # </prompt><command>rcopenais</command> stop</screen>
    </step>
    <step>
     <para>
      クラスタノードごとに、目的のターゲットバージョンのSUSE Linux Enterprise Serverおよび<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase>へのアップグレードを実行します。<xref linkend="sec.ha.migration.upgrade.oview"/>を参照してください。
     </para>
    </step>
    <step>
     <para>
      アップグレードプロセスが完了した後で、SUSE Linux Enterprise Serverおよび<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase>のアップグレード済みバージョンがインストールされた各ノードを再起動します。
     </para>
    </step>
    <step>
     <para>
      クラスタセットアップでOCFS2を使用する場合は、次のコマンドを実行して、オンデバイス構造をアップデートします。
     </para>
<screen><prompt role="root">root # </prompt><command>o2cluster</command> --update <replaceable>PATH_TO_DEVICE</replaceable></screen>
     <para>
      追加のパラメータがディスクに追加されます。これらのパラメータは、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12および12 SPxに付属しているアップデートされたOCFS2バージョンで必要になります。
     </para>
    </step>
    <step>
     <para>
      Corosyncバージョン2の<filename>/etc/corosync/corosync.conf</filename>をアップデートするには:
     </para>
     <substeps>
      <step>
       <para>
        1つのノードにログインして、YaSTクラスタモジュールを起動します。
       </para>
      </step>
      <step>
       <para>
        <guimenu>通信チャネル</guimenu>カテゴリに切り替えて、新しいパラメータ(<guimenu>クラスタ名</guimenu>および<guimenu>期待する得票数</guimenu>)の値を入力します。詳細については、<xref linkend="pro.ha.installation.setup.channel1.udp"/>または<xref linkend="pro.ha.installation.setup.channel1.udpu"/>をそれぞれ参照してください。
       </para>
       <para>
        Corosyncバージョン2で無効になっていたり、見つからない他のオプションをYaSTが検出する場合、変更を求めるプロンプトが表示されます。
       </para>

      </step>
      <step>
       <para>
        YaSTで変更内容を確認します。YaSTが変更を<filename>/etc/corosync/corosync.conf</filename>に書き込みます。
       </para>
      </step>
      <step>
       <para>
        クラスタに対してCsync2が設定されている場合は、次のコマンドを使用して、アップデートされたCorosync設定を他のクラスタノードにプッシュします。
       </para>
<screen><prompt role="root">root # </prompt><command>csync2</command> <option>-xv</option></screen>
       <para>
        Csync2の詳細については、<xref linkend="sec.ha.installation.setup.csync2"/>を参照してください。
       </para>
       <para>
        または、<filename>/etc/corosync/corosync.conf</filename>をすべてのクラスタノードに手動でコピーして、更新されたCorosync設定の同期を取ります。
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      各ノードにログインして、次のコマンドを使用してクラスタスタックを起動します。
     </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster start</screen>
    </step>
    <step>
     <para>
      <command>crm status</command>またはHawk2を使用してクラスタの状態を確認します。
     </para>
    </step>
    <step>
     <para>ブート時に起動するように以下のサービスを設定します。 </para>
     <screen><prompt role="root">root # </prompt>systemctl enable pacemaker
<prompt role="root">root # </prompt>systemctl enable hawk
<prompt role="root">root # </prompt>systemctl enable sbd</screen>
    </step>
   </procedure>

 <note xml:id="note.ha.cib.upgrade">
    <title>CIB構文バージョンのアップグレード</title>
    <para>
     新しい機能は、最新のCIB構文バージョンでのみ使用可能な場合もあります。新しい製品バージョンにアップグレードした場合でも、デフォルトではCIB構文バージョンはアップグレードされません。<emphasis/>
     </para>
    <procedure>
     <step>
      <para>バージョンをチェックします。</para>
<screen>cibadmin -Q | grep validate-with</screen>
     </step>
     <step>
      <para>最新のCIB構文バージョンにアップグレードします。
      </para>
<screen><prompt role="root">root # </prompt><command>cibadmin</command> --upgrade --force</screen>
     </step>
    </procedure>
   </note>

<procedure xml:id="pro.ha.migration.offline.12-15">
    <title>製品バージョン12から15へのアップグレード: クラスタ全体のオフラインマイグレーション</title>
   <important>
     <title>最初からのインストール</title>
     <para>クラスタノードを(アップグレードするのではなく)最初からインストールすることにした場合、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> <phrase role="productnumber"><phrase os="sles">15 SP1</phrase></phrase>に必要なモジュールのリストについて、<xref linkend="sec.ha.requirements.sw"/>を参照してください。モジュール、拡張機能、および関連製品の詳細については、SUSE Linux Enterprise Server 15のリリースノートを確認してください。これらは、<link xlink:href="https://www.suse.com/releasenotes/"/>から入手できます。
     </para>
    </important>
    <step>
     <para>
      <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension </phrase></phrase> 15へのオフラインマイグレーションを開始する前に、<xref linkend="note.ha.cib.upgrade"/>の説明に従って現在のクラスタでCIB構文を手動でアップグレードしてください。
     </para>
    </step>
    <step>
     <para>
      各クラスタノードにログインし、次のコマンドを使用してクラスタスタックを停止します。
     </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster stop</screen>
    </step>
    <step>
     <para>
      クラスタノードごとに、目的のターゲットバージョンのSUSE Linux Enterprise Serverおよび<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase>へのアップグレードを実行します。<xref linkend="sec.ha.migration.upgrade.oview"/>を参照してください。
     </para>
    </step>
    <step>
     <para>
      アップグレードプロセスが完了した後で、SUSE Linux Enterprise Serverおよび<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase>のアップグレード済みバージョンがインストールされた各ノードにログインして起動します。
     </para>
    </step>
    <step>
     <para>Cluster LVMを使用する場合は、clvmdからlvmlockdに移行する必要があります。<command>lvmlockd</command>のマニュアルページの「<citetitle>changing a clvm VG to a lockd VG</citetitle>」および<xref linkend="sec.ha.clvm.migrate"/>を参照してください。
     </para>
    </step>
    <step>
     <para>
      次のコマンドを実行してこのクラスタスタックを開始します。
     </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster start</screen>
    </step>
    <step>
     <para>
      <command>crm status</command>またはHawk2を使用してクラスタの状態を確認します。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec.ha.migration.upgrade.rolling">
   <title>ローリングアップグレード</title>
   <para>
    この項は次のシナリオに適用されます。
   </para>
   <itemizedlist>
    <listitem>
     <para>
      SLE HA 12からSLE HA 12 SP1へのアップグレード
     </para>
    </listitem>
    <listitem>
     <para>
      SLE HA 12 SP1からSLE HA 12 SP2へのアップグレード
     </para>
    </listitem>
    <listitem>
     <para>
      SLE HA (Geo) 12 SP2からSLE HA (Geo) 12 SP3へのアップグレード
     </para>
    </listitem>

   </itemizedlist>
   <warning>
    <title>アクティブなクラスタスタック</title>
    <para>
     ノードのアップグレードを開始する前に、「そのノード上の」クラスタスタックを「停止」します。<emphasis/><emphasis/>
    </para>
    <para>
     ソフトウェアの更新中にノード上のクラスタリソースマネージャがアクティブな場合、アクティブノードのフェンシングのような予期しない結果を招く場合があります。
    </para>
   </warning>
   <procedure xml:id="pro.ha.migration.rolling.upgrade">
    <title>クラスタ全体のローリングアップグレードの実行</title>

    <step>
     <para>
      アップグレードするノードで<systemitem class="username">root</systemitem>としてログインし、クラスタスタックを停止します。
     </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster stop</screen>
    </step>
    <step xml:id="step.ha.migration.upgrade.tolatest">
     <para>
      目的のターゲットバージョンのSUSE Linux Enterprise Serverおよび<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase>へのアップグレードを実行します。個々のアップグレードプロセスの詳細を確認するには、<xref linkend="sec.ha.migration.upgrade.oview"/>を参照してください。
     </para>
    </step>
    <step xml:id="step.ha.migration.upgrade.ais">
     <para>
      アップグレードしたノードでクラスタスタックを起動して、ノードをクラスタに再加入させます。
     </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster start</screen>
    </step>
    <step>
     <para>
      次のノードをオフラインにし、そのノードに関して手順を繰り返します。
     </para>
    </step>
    <step>
     <para>
      <command>crm status</command>またはHawk2を使用してクラスタの状態を確認します。
     </para>
    </step>
   </procedure>
   <important>
    <title>ローリングアップグレードの時間制限</title>
    <para>
     最新の製品バージョンに装備されている新機能は、「すべての」クラスタノードが最新の製品バージョンにアップグレードされた後でないと使用できません。<emphasis/>混合バージョンのクラスタは、ローリングアップグレード中の短いタイムフレームでのみサポートされます。ローリングアップグレードは1週間以内に完了してください。
    </para>
   </important>
   <para>クラスタノードに異なるCRMバージョンが検出される場合、Hawk2の<guimenu>状態</guimenu>画面に警告も表示されます。</para>
  </sect2>
 </sect1>
 <sect1 xml:id="sec.ha.migration.update">
  <title>クラスタノード上のソフトウェアパッケージの更新</title>

  <warning>
   <title>アクティブなクラスタスタック</title>
   <para>
    <emphasis/>ノードの更新を開始する前に、クラスタスタックが影響を受けるか否かによって、「そのノード上の」クラスタスタックを「停止」するか、「ノードを保守モード」にします。<emphasis/><emphasis/>詳細については、<xref linkend="step.update.check"/>を参照してください。
   </para>
   <para>
    ソフトウェアの更新中にノード上のクラスタリソースマネージャがアクティブな場合、アクティブノードのフェンシングのような予期しない結果を招く場合があります。
   </para>
  </warning>

  <procedure>
   <step xml:id="step.update.check">
    <para>
     ノード上にパッケージ更新をインストールする前に、次の内容を確認してください。
    </para>
    <itemizedlist>
     <listitem>
      <para>
       その更新は、<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase>またはGeo Clustering for SUSE Linux Enterprise High Availability Extensionに属するパッケージに影響しますか。<literal>影響する</literal>場合は、ソフトウェアの更新を開始する前に、ノード上でクラスタスタックを停止します。
      </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster stop</screen>
     </listitem>
     <listitem>
      <para>
       パッケージ更新には再起動が必要ですか。<literal/>必要な場合は、ソフトウェアの更新を開始する前に、ノード上でクラスタスタックを停止します。
      </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster stop</screen>
     </listitem>
     <listitem>
      <para>
       これらの状況のいずれにも該当しない場合は、クラスタスタックを停止する必要はありません。その場合は、ソフトウェアの更新を開始する前に、ノードを保守モードにします。
      </para>
<screen><prompt role="root">root # </prompt><command>crm</command> node maintenance <replaceable>NODE_NAME</replaceable></screen>
      <para>
       保守モードの詳細については、<xref linkend="sec.ha.maint.overview"/>を参照してください。
      </para>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     YaSTまたはZypperを使用してパッケージ更新をインストールします。
    </para>
   </step>
   <step>
    <para>
     更新が正常にインストールされたら、次のいずれかを行います。
    </para>
    <itemizedlist>
     <listitem>
      <para>
       それぞれのノードでクラスタスタックを起動します(<xref linkend="step.update.check"/>で停止した場合)。
      </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster start</screen>
     </listitem>
     <listitem>
      <para>
       または、ノードの保守フラグを削除して、ノードを通常モードに戻します。
      </para>
<screen><prompt role="root">root # </prompt><command>crm</command> node ready <replaceable>NODE_NAME</replaceable></screen>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     <command>crm status</command>またはHawk2を使用してクラスタの状態を確認します。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec.ha.migration.more">
  <title>その他の情報</title>

  <para>
   アップグレード先の製品の変更点と新機能の詳細については、それぞれのリリースノートを参照してください。リリースノートは、<link xlink:href="https://www.suse.com/releasenotes/"/>で入手できます。
  </para>
 </sect1>
</chapter>
