<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter
[
  <!ENTITY % entities SYSTEM "entity-decl.ent">
    %entities;
]>
<chapter xmlns="http://docbook.org/ns/docbook"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
 xml:id="cha.ha.maintenance">

 <title>Executing Maintenance Tasks</title>
 <info>
   <abstract>
    &maint-mode-basics;
   </abstract>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>editing</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>

<sect1 xml:id="sec.ha.config.basics.maint.mode">
  <title>Maintenance Options</title>
  <para>
   With regard to that, the &hasi; provides <literal>maintenance</literal>
   options on several levels:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     for resources
    </para>
   </listitem>
   <listitem>
    <para>
     for nodes
    </para>
   </listitem>
   <listitem>
    <para>
     for the whole cluster
    </para>
   </listitem>
  </itemizedlist>

  &warning-maint-mode;

  <para>
   Use the maintenance mode if you need to perform maintenance tasks and do
   not want to receive any notification by the cluster during that time.
   In maintenance mode, you can stop or restart cluster resources at
   will&mdash;the &hasi; will not attempt to restart them. All
   resources automatically become unmanaged: The &hasi; will cease
   monitoring them and thus be oblivious to their status. You can even stop
   all &pace; services on a node, and all daemons and processes
   originally started as &pace;-managed cluster resources will continue
   to run.
  </para>
  <para>
   However, as &corosync; is also stopped when you stop the &pace; service,
   this might lead to unexpected results for some resources. For example, DLM
   depends on the membership and messaging services provided by &corosync;. If
   &corosync; stops, the DLM resource will assume a split-brain scenario and
   trigger a fencing operation. To avoid this, manually stop resources like DLM
   or bring them back from maintenance mode before stopping the &pace; service.
  </para>
  <para>
   If you attempt to start &pace; services on a node while the
   cluster is in maintenance mode, &pace; will initiate a single one-shot
   monitor operation (a <quote>probe</quote>) for every resource to evaluate
   which resources are currently running on that node. However, it will take
   no further action other than determining the resources' status.
  </para>

  <para>
   If you want to suspend management of an individual resource but still want the
   cluster to monitor the resource and to report any failures, set the
   <option>is-managed</option> meta attribute for this resource to
   <literal>false</literal>. Do so either by using &hawk2; or by executing the
   following command with the &crmshell;:
  </para>
<screen>&prompt.root;crm resource unmanage <replaceable>RESOURCE_ID</replaceable></screen>
  <para>
   For the difference between maintenance mode and <option>is-managed</option>,
   see also <xref linkend="tab.ha.basics.meta"/>.
  </para>
  <para>
   For details on setting or unsetting maintenance mode with your preferred
   cluster management tool:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     &hawk2;: <xref linkend="sec.conf.hawk2.maintenance"/>
    </para>
   </listitem>
   <listitem>
    <para>
     &crmsh;: <xref linkend="sec.ha.manual_config.cli.maint.mode"/>
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
</chapter>