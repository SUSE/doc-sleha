<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook50-profile.xsl"
  type="text/xml" 
  title="Profiling step"?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:dm="urn:x-suse:ns:docmanager" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="article_geo_clustering.xml" version="5.0" xml:lang="fr" xml:id="article-geo-clustering">
 <title>Démarrage rapide de Geo Clustering</title>
 <info>
  <productnumber><phrase role="productnumber"><phrase os="sles">15 SP4</phrase></phrase></productnumber><productname><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase></productname>
  <date><?dbtimestamp ?>
</date>
  <xi:include href="ha_authors.xml"/>
  <abstract>
   <para>
     Geo Clustering protège les charges de travail au sein des centres de données distribués au niveau international. Le présent document explique la configuration de base d&apos;une grappe géographique, à l&apos;aide des scripts d&apos;amorçage Geo fournis par le shell crm.
   </para>
  </abstract>
  <dm:docmanager>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <sect1 xml:id="sec-ha-geo-quick-concept">
  <title>Présentation conceptuelle</title>

  <para>
   Les grappes géographiques basées sur <phrase role="roductnamereg"><phrase os="sles">SUSE® Linux Enterprise High Availability Extension</phrase></phrase> peuvent être considérées comme des grappes de <quote>superposition</quote>, dans lesquelles chaque site de grappe correspond à un noeud d&apos;une grappe traditionnelle. La grappe de superposition est gérée par le gestionnaire de ticket de grappe booth (appelé ci-après booth). Chacune des parties impliquées dans une grappe géographique exécute un service, le <systemitem class="daemon">boothd</systemitem>. Celui-ci se connecte aux daemons booth en cours d&apos;exécution sur les autres sites et échange des informations de connectivité. Pour rendre les ressources de grappe hautement disponibles entre les sites, le booth s&apos;appuie sur les objets de grappe appelés tickets. Un ticket donne le droit d&apos;exécuter certaines ressources sur un site de grappe spécifique. Le booth garantit que chaque ticket est accordé à un seul site à la fois.
  </para>
  <para>
   En cas d&apos;interruption de la communication entre deux instances de booth, cela peut provenir d&apos;une défaillance du réseau entre les sites de grappe <emphasis>ou</emphasis> d&apos;une indisponibilité d&apos;un site de grappe. Dans ce cas, vous avez besoin d&apos;une instance supplémentaire (un troisième site de grappe ou un <literal>arbitre</literal>) pour parvenir à un consensus sur les décisions (par exemple, le basculement des ressources entre les sites). Les arbitres sont des machines uniques (hors des grappes) qui exécutent une instance de booth dans un mode particulier. Chaque grappe géographique peut avoir un ou plusieurs arbitres.
  </para>

  <para>
   <remark>toms 2017-07-04: for the future: maybe also add example IP addresses
    to graphic (node IPs, VIPs for cluster sites)
    </remark>
   <remark>taroth 2017-12-29: FATE#322100 - adjust graphic in case two sites
   *without* arbitrator becomes the default setup? (c#6)
   </remark>
  </para>

  <figure xml:id="fig-ha-geo-quick-example-geosetup">
   <title>Grappe à deux sites—2x2 noeuds + arbitre (facultatif)</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ha_geocluster.svg" width="100%" format="SVG"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ha_geocluster.png" width="85%" format="PNG"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   Il est également possible d&apos;exécuter une grappe géographique à deux sites <emphasis>sans</emphasis> arbitre. Dans ce cas, un administrateur de grappe géographique doit gérer manuellement les tickets. Si un ticket doit être accordé à plusieurs sites en même temps, le booth affiche un avertissement.
  </para>

  <para>
   Pour plus de détails sur le concept, les composants et la gestion des tickets pour les grappes géographiques, reportez-vous au <xref linkend="book-administration"/>.
  </para>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-scenario">
  <title>Scénario d&apos;utilisation</title>

  <para>
   Dans l&apos;exemple suivant, nous allons configurer une grappe géographique de base avec deux sites de grappe et un arbitre :
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Supposons que les sites de grappe soient nommés <literal>amsterdam</literal> et <literal>berlin</literal>.
    </para>
   </listitem>
   <listitem>
    <para>
     Supposons que chaque site se compose de deux noeuds. Les noeuds <literal>alice</literal> et <literal>bob</literal> appartiennent à la grappe <literal>amsterdam</literal>. Les noeuds <literal>charlie</literal> et <literal>doro</literal> appartiennent à la grappe <literal>berlin</literal>.
    </para>
   </listitem>
   <listitem>
    <para>
     Le site <literal>amsterdam</literal> recevra l&apos;adresse IP virtuelle suivante : <literal>192.168.201.100</literal>.
    </para>
   </listitem>
   <listitem>
    <para>
     Le site <literal>berlin</literal> recevra l&apos;adresse IP virtuelle suivante : <literal>192.168.202.100</literal>.
    </para>
   </listitem>
   <listitem>
    <para>
     <remark>taroth 2017-12-29: FATE#322100 - move to Geo Guide? (c#6)</remark>
     Supposons que l&apos;arbitre a l&apos;adresse IP suivante : <literal>192.168.203.100</literal>.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Avant de poursuivre, assurez-vous que les conditions suivantes sont remplies :
  </para>

  <variablelist>
   <title>Configuration requise</title>
   <varlistentry>
    <term>Deux grappes existantes</term>
    <listitem>
     <para>
      Vous avez au moins deux grappes existantes que vous souhaitez combiner dans une grappe géographique. (Si vous devez configurer deux grappes d&apos;abord, suivez les instructions du manuel <xref linkend="article-installation"/>.)
      </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Noms de grappe pertinents</term>
    <listitem>
     <para>
      Chaque grappe possède un nom de grappe pertinent défini dans le fichier <filename>/etc/corosync/corosync.conf</filename> qui reflète son emplacement.
     </para>
   </listitem>
   </varlistentry>
   <varlistentry>
    <term>Arbitre</term>
    <listitem>
     <para><remark>taroth 2017-12-29: FATE#322100 - move to Geo Guide? (see
     c#6)</remark>
      Vous avez installé une troisième machine qui ne fait partie d&apos;aucune grappe existante et doit être utilisée en tant qu&apos;arbitre.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Pour plus de détails sur chaque élément, reportez-vous également à la <xref linkend="sec-ha-geo-quick-req"/>.
  </para>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-req">
  <title>Configuration requise</title>
   <para>
    Toutes les machines (noeuds de grappe et arbitres) destinées à faire partie de la grappe doivent disposer au minimum des modules et extensions suivants :
   </para>

<itemizedlist>
   <listitem>
    <para>Basesystem Module <phrase role="productnumber"><phrase os="sles">15 SP4</phrase></phrase></para>
   </listitem>
   <listitem>
    <para>Server Applications Module <phrase role="productnumber"><phrase os="sles">15 SP4</phrase></phrase></para>
   </listitem>
   <listitem>
    <para><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> <phrase role="productnumber"><phrase os="sles">15 SP4</phrase></phrase></para>
   </listitem>
  </itemizedlist>
  <para>
   Lorsque vous installez les machines, sélectionnez <literal>Noeud GEO haute disponibilité</literal> comme <systemitem>system role</systemitem>. Cela entraîne l&apos;installation d&apos;un système minimal où les paquetages du modèle de <literal>mise en grappe géographique haute disponibilité (ha_geo)</literal> sont installés par défaut.
  </para>
  <itemizedlist>
   <title>Configuration réseau</title>
   <listitem>
   <para>
    Les adresses IP virtuelles à utiliser pour chaque site de grappe doivent être accessibles dans la grappe géographique.
   </para>
  </listitem>
   <listitem>
   <para>
     Les sites doivent être accessibles sur un port UDP et un port TCP par instance de booth. En d&apos;autres termes, les éventuels pare-feux ou tunnels IPsec intermédiaires doivent être configurés en conséquence.
    </para>
   </listitem>
   <listitem>
    <para>
     D&apos;autres décisions de configuration peuvent nécessiter l&apos;ouverture de ports supplémentaires (par exemple, pour la réplication de base de données ou DRBD).
    </para>
   </listitem>
  </itemizedlist>

  <itemizedlist>
  <title>Autres conditions requises et recommandations</title>
  <listitem>
   <para>
    Tous les noeuds de grappe sur tous les sites doivent être synchronisés avec un serveur NTP en dehors de la grappe. Pour plus d&apos;informations, reportez-vous au manuel <link xlink:href="https://documentation.suse.com/sles-15/html/SLES-all/cha-ntp.html"><citetitle>Administration Guide</citetitle> for SUSE Linux Enterprise Server <phrase role="productnumber"><phrase os="sles">15 SP4</phrase></phrase></link> (Guide d&apos;administration de SUSE Linux Enterprise Server 15 SP4).
   </para>
   <para>
    Si les noeuds ne sont pas synchronisés, les fichiers journaux et les rapports de grappe sont très difficiles à analyser.
   </para>
  </listitem>
  <listitem>
   <para>
    Utilisez un nombre <emphasis>impair</emphasis> de sites dans votre grappe géographique. En cas d&apos;interruption de la connexion réseau, cela permet de garantir qu&apos;il y a toujours une majorité de sites (afin d&apos;éviter les scénarios de vues de grappe divergentes). Si vous avez un nombre pair de sites de grappe, utilisez un arbitre pour la gestion du basculement automatique des tickets. Si vous n&apos;utilisez pas d&apos;arbitre, vous devez gérer le basculement des tickets manuellement.
   </para>
  </listitem>
  <listitem>
   <para>
    La grappe sur chaque site a un nom pertinent, par exemple : <literal>amsterdam</literal> et <literal>berlin</literal>.
   </para>
   <para>
    Les noms de grappe pour chaque site sont définis dans leur fichier <filename>/etc/corosync/corosync.conf</filename> respectif :
   </para>
<screen>totem {
    [...]
    cluster_name: amsterdam
    }
</screen>
   <para>
    Modifiez le nom à l&apos;aide de la commande crmsh suivante :
   </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster rename <replaceable>NEW_NAME</replaceable></screen>
   <para>
    Arrêtez et démarrez le service <systemitem class="service">pacemaker</systemitem> pour appliquer les modifications :
   </para> <screen><prompt role="root">root # </prompt><command>crm</command> cluster restart</screen>
  </listitem>
 <listitem>
   <para>
     Les architectures mixtes au sein d&apos;une grappe ne sont pas prises en charge. En revanche, pour les grappes géographiques, chaque membre de la grappe géographique peut avoir une architecture différente, qu&apos;il s&apos;agisse d&apos;un site de grappe ou d&apos;un arbitre. Par exemple, vous pouvez exécuter une grappe géographique avec trois membres (deux sites de grappe et un arbitre), dans laquelle un seul site de grappe est exécuté sur IBM Z, l&apos;autre fonctionnant sur x86 et l&apos;arbitre sur POWER.
   </para>
 </listitem>
</itemizedlist>

 </sect1>
 <sect1 xml:id="sec-ha-geo-scripts">
  <title>Présentation des scripts d&apos;amorçage Geo</title>
  <itemizedlist>
   <listitem>
    <para>
     Le script <command>crm cluster geo_init</command> permet de configurer une grappe en tant que premier site d&apos;une grappe géographique. Le script utilise certains paramètres tels que les noms des grappes, l&apos;arbitre et un ou plusieurs tickets pour créer le fichier <filename>/etc/booth/booth.conf</filename>. Il copie la configuration booth sur tous les noeuds du site de grappe actuel. Il configure également les ressources de grappe nécessaires pour le booth sur le site de grappe actuel.
    </para>
    <para>
     Pour plus de détails, reportez-vous au <xref linkend="sec-ha-geo-quick-crm-cluster-geo-init"/>.
    </para>
   </listitem>
   <listitem>
    <para>
     Le script <command>crm cluster geo_join</command> permet d&apos;ajouter la grappe actuelle à une grappe géographique existante. Le script copie la configuration booth d&apos;un site de grappe existant et l&apos;écrit dans le fichier <filename>/etc/booth/booth.conf</filename> sur tous les noeuds du site de grappe actuel. Il configure également les ressources de grappe nécessaires pour le booth sur le site de grappe actuel.
    </para>
    <para>
     Pour plus de détails, reportez-vous au <xref linkend="sec-ha-geo-quick-crm-cluster-geo-join"/>.
    </para>
   </listitem>
   <listitem>
    <para>
     Le script <command>crm cluster geo_init_arbitrator</command> permet de transformer la machine actuelle en arbitre pour la grappe géographique. Le script copie de la configuration booth d&apos;un site de grappe existant et l&apos;écrit dans le fichier <filename>/etc/booth/booth.conf</filename>.
    </para>
    <para>
     Pour plus de détails, reportez-vous au <xref linkend="sec-ha-geo-quick-crm-cluster-geo-init-arbitrator"/>.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Tous les scripts d&apos;amorçage consignent des données dans le fichier <filename>/var/log/crmsh/crmsh.log</filename>. Pour toute information à propos du processus d&apos;amorçage, consultez le fichier journal. Toutes les options définies lors du processus d&apos;amorçage peuvent être modifiées ultérieurement (en changeant les paramètres booth, les ressources, etc). Pour plus de détails, consultez le <xref linkend="book-administration"/>.
  </para>


 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-inst">
  <title>Installation</title>

  <para>
   La prise en charge de l&apos;utilisation de grappes à haute disponibilité sur des distances illimitées est disponible par le biais de <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase>.
  </para>
  <para>
   Pour configurer une grappe géographique, vous avez besoin des paquetages inclus dans les modèles d&apos;installation suivants :
  </para>

  <itemizedlist>
   <listitem>
    <para>
     <literal>Haute disponibilité</literal> (appelé <literal>sles_ha</literal> dans la ligne de commande)
    </para>
   </listitem>
   <listitem>
    <para>
     <literal>Mise en grappe géographique pour haute disponibilité</literal> (appelé <literal>ha_geo</literal> dans la ligne de commande)
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Ces deux modèles sont disponibles uniquement si vous avez enregistré votre système auprès du SUSE Customer Center (ou d&apos;un serveur d&apos;enregistrement local) et ajouté les modules ou supports d&apos;installation en tant qu&apos;extension. Pour plus d&apos;informations sur l&apos;installation des extensions, reportez-vous au manuel <link xlink:href="https://documentation.suse.com/sles/html/SLES-all/cha-add-ons.html"><citetitle>Deployment Guide</citetitle> for SUSE Linux Enterprise <phrase role="productnumber"><phrase os="sles">15 SP4</phrase></phrase></link> (Guide de déploiement de SUSE Linux Enterprise 15 SP4).
  </para>
  <para>
     Pour installer les paquetages des deux modèles via la ligne de commande, utilisez Zypper :
    </para>
<screen><prompt role="root">root # </prompt><command>zypper</command> install -t pattern ha_sles ha_geo</screen>

  <important>
   <title>installation des paquetages logiciels sur toutes les parties</title>
   <para>
    Les paquetages logiciels nécessaires pour la haute disponibilité et les grappes géographiques ne sont <emphasis>pas</emphasis> copiés automatiquement sur les noeuds de grappe.
   </para>
   <itemizedlist>
    <listitem>
     <para>
      Installez SUSE Linux Enterprise Server <phrase role="productnumber"><phrase os="sles">15 SP4</phrase></phrase> ainsi que les modèles <literal>ha_sles</literal> et <literal>ha_geo</literal> sur <emphasis>toutes</emphasis> les machines qui feront partie de votre grappe géographique.
     </para>
    </listitem>
    <listitem>
     <para>
      Au lieu d&apos;installer manuellement les paquetages sur toutes les machines qui feront partie de votre grappe, utilisez AutoYaST pour cloner des noeuds existants. Pour plus d&apos;informations, reportez-vous au <xref linkend="sec-ha-installation-autoyast"/>. 
     </para>
    </listitem>
   </itemizedlist>
  </important>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-crm-cluster-geo-init">
  <title>Configuration du premier site d&apos;une grappe géographique</title>

  <para>
   Utilisez la commande <command>crm cluster geo_init</command> pour configurer une grappe existante en tant que premier site d&apos;une grappe géographique.
  </para>

  <procedure xml:id="pro-ha-geo-quick-crm-cluster-geo-init">
   <title>Configuration du premier site (<systemitem>amsterdam</systemitem>) avec la commande <command>crm cluster geo_init</command></title>
   <step>
    <para>
     Définissez une adresse IP virtuelle par site de grappe qui peut être utilisée pour accéder au site. Supposons que nous utilisons <literal>192.168.201.100</literal> et <literal>192.168.202.100</literal> à cet effet. Vous ne devez pas encore configurer les adresses IP virtuelles en tant que ressources de grappe. Les scripts d&apos;amorçage s&apos;en chargeront.
    </para>
   </step>
   <step>
    <para>
     Définissez le nom d&apos;au moins un ticket qui accordera les droits pour l&apos;exécution de certaines ressources sur un site de grappe. Utilisez un nom pertinent qui reflète les ressources qui dépendront du ticket (par exemple, <literal>ticket-nfs</literal>). Les scripts d&apos;amorçage ont uniquement besoin du nom de ticket, vous pouvez définir les détails restants (dépendances de ticket des ressources) plus tard, comme décrit à la <xref linkend="sec-ha-geo-quick-next"/>.
    </para>
   </step>
   <step>
    <para>
     Connectez-vous à un noeud d&apos;une grappe existante (par exemple, au noeud <literal>alice</literal> de la grappe <literal>amsterdam</literal>).
    </para>
   </step>
   <step xml:id="st-crm-cluster-geo-init">
    <para>
     Exécutez le script <command>crm cluster geo_init</command>. Par exemple, utilisez les options suivantes :
     <remark>taroth 2017-12-29: FATE#322100 - remove the --arbitrator option?
     (see c#6)</remark>
    </para>
<screen><prompt role="root">root # </prompt><command>crm cluster geo_init</command> \
  --clusters<co xml:id="co-geo-init-clusters"/> "amsterdam=192.168.201.100 berlin=192.168.202.100" \
  --tickets<co xml:id="co-geo-init-ticket"/> ticket-nfs \
  --arbitrator<co xml:id="co-geo-init-arbitrator"/> 192.168.203.100</screen>
    <calloutlist>
     <callout arearefs="co-geo-init-clusters">
       <para>
    Les noms des sites de grappe (comme définis dans le fichier <filename>/etc/corosync/corosync.conf</filename>) et les adresses IP virtuelles que vous souhaitez utiliser pour chaque site de grappe. Dans ce cas, nous avons deux sites de grappe (<literal>amsterdam</literal> et <literal>berlin</literal>) avec une adresse IP virtuelle pour chacun.
   </para>
     </callout>
     <callout arearefs="co-geo-init-ticket">
      <para>
       Le nom d&apos;un ou de plusieurs tickets.
      </para>
     </callout>
     <callout arearefs="co-geo-init-arbitrator">
      <para>
       Le nom d&apos;hôte ou l&apos;adresse IP d&apos;une machine en dehors des grappes.
      </para>
     </callout>
    </calloutlist>
   </step>
  </procedure>

  <para>
   Le script d&apos;amorçage crée le fichier de configuration booth et le synchronise pour les différents sites de grappe. Il crée également les ressources de grappe de base nécessaires pour le booth. L&apos;<xref linkend="st-crm-cluster-geo-init" xrefstyle="seletc:label"/> de la <xref linkend="pro-ha-geo-quick-crm-cluster-geo-init" xrefstyle="select:label"/> conduirait à la configuration booth et aux ressources de grappe suivantes :
   <remark>taroth 2017-12-29: FATE#322100 - remove the arbitrator entry? (c#6)</remark>
  </para>

  <example xml:id="ex-geo-init-booth-conf">
   <title>Configuration booth créée par le script <command>crm cluster geo_init</command></title>
<screen># The booth configuration file is "/etc/booth/booth.conf". You need to
# prepare the same booth configuration file on each arbitrator and
# each node in the cluster sites where the booth daemon can be launched.

# "transport" means which transport layer booth daemon will use.
# Currently only "UDP" is supported.
transport="UDP"
port="9929"

arbitrator="192.168.203.100"
site="192.168.201.100"
site="192.168.202.100"
authfile="/etc/booth/authkey"
ticket="ticket-nfs"
expire="600"</screen>
  </example>

  <example xml:id="ex-geo-init-rsc-conf">
   <title>Ressources de grappe créées par le script <command>crm cluster geo_init</command></title>
<screen>primitive<co xml:id="co-geo-quick-rsc-booth-ip"/> booth-ip IPaddr2 \
  params rule #cluster-name eq amsterdam ip=192.168.201.100 \
  params rule #cluster-name eq berlin ip=192.168.202.100 \
primitive<co xml:id="co-geo-quick-rsc-booth-site"/> booth-site ocf:pacemaker:booth-site \
  meta resource-stickiness=INFINITY \
  params config=booth \
  op monitor interval=10s
group<co xml:id="co-geo-quick-rsc-g-booth"/> g-booth booth-ip booth-site \
meta target-role=Stopped<co xml:id="co-geo-quick-rsc-stopped"/></screen>
   <calloutlist>
    <callout arearefs="co-geo-quick-rsc-booth-ip">
     <para>
      Une adresse IP virtuelle pour chaque site de grappe. Elle est requise par les daemons booth qui ont besoin d&apos;une adresse IP persistante sur chaque site de grappe.
     </para>
    </callout>
    <callout arearefs="co-geo-quick-rsc-booth-site">
     <para>
      Une ressource primitive pour le daemon booth. Elle communique avec les daemons booth sur les autres sites de grappe. Le daemon peut être démarré sur n&apos;importe quel noeud du site. Pour que la ressource reste sur le même noeud, si possible, l&apos;adhérence de ressource est définie sur <literal>INFINITY</literal>.
     </para>
    </callout>
    <callout arearefs="co-geo-quick-rsc-g-booth">
     <para>
      Un groupe de ressources de grappe pour les deux primitives. Avec cette configuration, chaque daemon de booth sera disponible sur son adresse IP individuelle, indépendamment du noeud sur lequel le daemon est exécuté.
     </para>
    </callout>
    <callout arearefs="co-geo-quick-rsc-stopped">
     <para>
      Le groupe de ressources de grappe n&apos;est pas démarré par défaut. Après vérification de la configuration de vos ressources de grappe (et l&apos;ajout des ressources nécessaires pour terminer votre configuration), vous devez démarrer le groupe de ressources. Reportez-vous à la section <xref linkend="vl-ha-geo-quick-next-req"/> pour plus d&apos;informations. 
     </para>
    </callout>
   </calloutlist>
  </example>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-crm-cluster-geo-join">
  <title>Ajout d&apos;un autre site à une grappe géographique</title>

  <para>
   Après avoir initialisé le premier site de votre grappe géographique, ajoutez la deuxième grappe avec le script <literal>crm cluster geo_join</literal>, comme décrit dans la <xref linkend="pro-ha-geo-quick-crm-cluster-geo-join" xrefstyle="select:label"/>. Le script doit avoir un accès SSH à un site de grappe déjà configuré et ajoutera la grappe actuelle à la grappe géographique.
  </para>

  <procedure xml:id="pro-ha-geo-quick-crm-cluster-geo-join">
   <title>Ajout du deuxième site (<literal>berlin</literal>) à l&apos;aide du script <command>crm cluster geo_join</command></title>
   <step>
    <para>
     Connectez-vous à un noeud du site de grappe que vous souhaitez ajouter (par exemple, au noeud <literal>charlie</literal> de la grappe <literal>berlin</literal>).
    </para>
   </step>
   <step xml:id="st-crm-cluster-geo-join">
    <para>
     Exécutez la commande <command>crm cluster geo_join</command>. Par exemple :
    </para>
<screen><prompt role="root">root # </prompt><command>crm cluster geo_join</command> \
  --cluster-node<co xml:id="co-geo-join-cluster-node"/> 192.168.201.100\
  --clusters<co xml:id="co-geo-join-clusters"/> "amsterdam=192.168.201.100 berlin=192.168.202.100"
     </screen>
    <calloutlist>
     <callout arearefs="co-geo-join-cluster-node">
      <para>
       Indique à partir de quel emplacement le système doit copier la configuration booth. Utilisez l&apos;adresse IP ou le nom d&apos;hôte d&apos;un noeud d&apos;un site de grappe géographique déjà configuré. Vous pouvez également utiliser l&apos;adresse IP virtuelle d&apos;un site de grappe déjà existant (comme dans cet exemple). Vous pouvez aussi utiliser l&apos;adresse IP ou le nom d&apos;hôte d&apos;un arbitre déjà configuré pour votre grappe géographique.
      </para>
     </callout>
     <callout arearefs="co-geo-join-clusters">
       <para>
    Les noms des sites de grappe (comme définis dans le fichier <filename>/etc/corosync/corosync.conf</filename>) et les adresses IP virtuelles que vous souhaitez utiliser pour chaque site de grappe. Dans ce cas, nous avons deux sites de grappe (<literal>amsterdam</literal> et <literal>berlin</literal>) avec une adresse IP virtuelle pour chacun.
   </para>
     </callout>
    </calloutlist>
   </step>
  </procedure>

  <para>
   La commande <command>crm cluster geo_join</command> copie la configuration booth à partir de l&apos;emplacement <xref linkend="co-geo-join-cluster-node" xrefstyle="select:label"/> (voir <xref linkend="ex-geo-init-booth-conf" xrefstyle="select:label"/>). En outre, il crée les ressources de grappe nécessaires pour le booth (voir <xref linkend="ex-geo-init-rsc-conf" xrefstyle="select:label"/>).
  </para>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-crm-cluster-geo-init-arbitrator">
  <title>Ajout de l&apos;arbitre</title>

  <para>
   <remark>taroth 2017-12-29: FATE#322100 - move this section to Geo Guide? (c#6)</remark>
   Après avoir configuré tous les sites de votre grappe géographique avec les scripts <command>crm cluster geo_init</command> et <command>crm cluster geo_join</command>, configurez l&apos;arbitre avec le script <command>crm geo_init_arbitrator</command>.
  </para>

  <procedure xml:id="pro-ha-geo-quick-crm-cluster-geo-init-arbitrator">
   <title>Configuration de l&apos;arbitre à l&apos;aide du script <command>crm cluster geo_init_arbitrator</command></title>
   <step>
    <para>
     Connectez-vous à la machine que vous souhaitez utiliser en tant qu&apos;arbitre.
    </para>
   </step>
   <step>
    <para>
     Exécutez la commande suivante. Par exemple :
    </para>
<screen><prompt role="root">root # </prompt><command>crm cluster geo_init_arbitrator</command> --cluster-node<co xml:id="co-geo-init-arbitrator-cluster-node"/> 192.168.201.100</screen>
    <calloutlist>
     <callout arearefs="co-geo-init-arbitrator-cluster-node">
      <para>
       Indique à partir de quel emplacement le système doit copier la configuration booth. Utilisez l&apos;adresse IP ou le nom d&apos;hôte d&apos;un noeud d&apos;un site de grappe géographique déjà configuré. Vous pouvez également utiliser l&apos;adresse IP virtuelle d&apos;un site de grappe déjà existant (comme dans cet exemple).
      </para>
     </callout>
    </calloutlist>
   </step>
  </procedure>

  <para>
   Le script <command>crm cluster geo_init_arbitrator</command> copie la configuration booth à partir de l&apos;emplacement <xref linkend="co-geo-init-arbitrator-cluster-node"/> (voir <xref linkend="ex-geo-init-booth-conf" xrefstyle="select:label"/>). Il active et démarre également le service de booth sur l&apos;arbitre. Ainsi, l&apos;arbitre est prêt à communiquer avec les instances de booth sur les sites de grappe lorsque les services de booth y sont aussi en cours d&apos;exécution.
  </para>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-monitor">
  <title>Surveillance des sites de grappe</title>

  <para>
   Pour afficher les deux sites de grappe avec les ressources et le ticket que vous avez créés au cours du processus d&apos;amorçage, utilisez Hawk2. L&apos;interface Web Hawk2 vous permet de surveiller et de gérer plusieurs grappes (indépendantes) et grappes géographiques.
  </para>

  <itemizedlist>
   <title>Conditions préalables</title>
   <listitem>
    <para>
     Toutes les grappes à surveiller à partir du <guimenu>tableau de bord</guimenu> de Hawk4 doivent exécuter <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> <phrase role="productnumber"><phrase os="sles"> 15 SP4</phrase></phrase>.
    </para>
   </listitem>
   <listitem>
    <para>
     Si vous n&apos;avez pas encore remplacé le certificat auto-signé pour Hawk2 par votre propre certificat (ou un certificat signé par une autorité de certification officielle) sur chaque noeud de grappe, effectuez l&apos;opération suivante : connectez-vous à Hawk2 sur <emphasis>chaque</emphasis> noeud dans <emphasis>chaque</emphasis> grappe au moins une fois. Vérifiez le certificat (ou ajoutez une exception dans le navigateur afin d&apos;ignorer l&apos;avertissement). Sans cela, Hawk2 ne peut pas se connecter à la grappe.
    </para>
   </listitem>
  </itemizedlist>

  <procedure xml:id="pro-ha-geo-quick-hawk2-dashboard">
   <title>utilisation du tableau de bord Hawk2</title>
   <step>
    <para>
     Démarrez un navigateur Web et entrez l&apos;adresse IP virtuelle de votre premier site de grappe, <literal>amsterdam</literal> :
    </para>
<screen>https://192.168.201.100:7630/</screen>
    <para>
     Vous pouvez également utiliser l&apos;adresse IP ou le nom d&apos;hôte du noeud <literal>alice</literal> ou <literal>bob</literal>. Si vous avez configuré les deux noeuds avec les scripts d&apos;amorçage, le service <literal>hawk</literal> doit s&apos;exécuter sur les deux noeuds.
    </para>
   </step>
   <step>
    <para>
     Connectez-vous à l&apos;interface Web de Hawk2.
    </para>
   </step>
   <step>
    <para>
     Dans la barre de navigation de gauche, sélectionnez <guimenu>Tableau de bord</guimenu>.
    </para>
    <para>
     Hawk2 affiche une vue d&apos;ensemble des noeuds et ressources sur le site de grappe actuel. En outre, il indique les <guimenu>tickets</guimenu> qui ont été configurés pour la grappe géographique. Si vous avez besoin d&apos;informations sur les icônes utilisées dans cette vue, cliquez sur <guimenu>Legend</guimenu> (Légende).
    </para>
    <figure>
     <title>tableau de bord Hawk2 avec un site de grappe (<literal>amsterdam</literal>)</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="hawk2-dashboard-site1.png" width="100%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="hawk2-dashboard-site1.png" width="95%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     Pour ajouter un tableau de bord pour le deuxième site de grappe, cliquez sur <guimenu>Ajouter une grappe</guimenu>.
    </para>
    <substeps>
     <step>
      <para>
       Entrez le <guimenu>nom de grappe</guimenu> permettant d&apos;identifier la grappe dans le <guimenu>Tableau de bord</guimenu>. Dans ce cas, il s&apos;agit de <literal>berlin</literal>.
      </para>
     </step>
     <step>
      <para>
       Entrez le nom d&apos;hôte complet de l&apos;un des noeuds de la grappe (dans ce cas, <literal>charlie</literal> ou <literal>doro</literal>).
      </para>
     </step>
     <step>
      <para>
       Cliquez sur <guimenu>Ajouter</guimenu>. Hawk2 affiche un deuxième onglet pour le site de grappe nouvellement ajouté avec une vue d&apos;ensemble de ses noeuds et ressources.
      </para>
      <figure>
       <title>tableau de bord Hawk2 avec deux sites de grappe</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="hawk2-dashboard-two-sites.png" width="100%" format="PNG"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="hawk2-dashboard-two-sites.png" width="95%" format="PNG"/>
        </imageobject>
       </mediaobject>
      </figure>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Pour afficher plus de détails sur un site de grappe ou sur sa gestion, basculez vers l&apos;onglet du site et cliquez sur l&apos;icône de la chaîne.
    </para>
    <para>
     Hawk2 ouvre la vue <guimenu>État</guimenu> de ce site dans une nouvelle fenêtre de navigateur ou un nouvel onglet. Cette vue vous permet d&apos;administrer cette partie de la grappe géographique.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-next">
  <title>Étapes suivantes</title>

  <para>
   Les scripts d&apos;amorçage de mise en grappe géographique constituent un moyen rapide pour configurer une grappe géographique de base qui peut être utilisée à des fins de test. Toutefois, pour convertir la grappe géographique résultante en une grappe géographique opérationnelle pouvant être utilisée dans des environnements de production, d&apos;autres étapes sont requises (voir <xref linkend="vl-ha-geo-quick-next-req"/>).
  </para>

  <variablelist xml:id="vl-ha-geo-quick-next-req">
   <title>Étapes requises pour terminer la configuration d&apos;une grappe géographique</title>
   <varlistentry xml:id="vle-ha-geo-quick-booth-service-sites">
    <term>Démarrage des services de booth sur des sites de grappe</term>
    <listitem>
     <para>
      Après le processus d&apos;amorçage, le service de booth de l&apos;arbitre ne peut pas encore communiquer avec les services de booth des sites de grappe, car ils ne sont pas démarrés par défaut.
     </para>
     <para>
      Le service de booth pour chaque site de grappe est géré par le groupe de ressources de booth <literal>g-booth</literal> (voir <xref linkend="ex-geo-init-rsc-conf"/>). Pour démarrer une instance du service de booth par site, démarrez le groupe de ressources de booth respectif sur chaque site de grappe. Cela permet à toutes les instances de booth de communiquer entre elles.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Configuration des dépendances de tickets et ordre des contraintes</term>
    <listitem>
     <para>
      Pour faire dépendre des ressources du ticket que vous avez créé au cours du processus d&apos;amorçage de grappe géographique, configurez des contraintes. Pour chaque contrainte, définissez une <literal>stratégie relative aux pertes</literal> qui définit ce qu&apos;il arriverait aux ressources respectives si le ticket était révoqué d&apos;un site de grappe.
     </para>
     <para>
      Pour plus de détails, reportez-vous au <xref linkend="cha-ha-geo-rsc"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Octroi initial d&apos;un ticket à un site</term>
    <listitem>
     <para>
      Avant que le booth puisse gérer un certain ticket au sein de la grappe géographique, vous devez d&apos;abord <emphasis>l&apos;attribuer</emphasis> à un site manuellement. Pour accorder un ticket, vous pouvez utiliser l&apos;outil de ligne de commande du client de booth ou Hawk2.
     </para>
     <para>
       Pour plus de détails, reportez-vous au <xref linkend="cha-ha-geo-manage"/>.</para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Les scripts d&apos;amorçage créent les mêmes ressources de booth sur les deux sites de grappe et les mêmes fichiers de configuration booth sur tous les sites, y compris l&apos;arbitre. Si vous étendez la configuration de grappe géographique (pour passer à un environnement de production), vous devrez probablement affiner la configuration booth et modifier la configuration des ressources de grappe liées au booth. Ensuite, vous devez synchroniser les modifications sur les autres sites de votre grappe géographique pour qu&apos;elles soient prises en compte.
  </para>

  <note>
   <title>synchronisation des modifications entre les différents sites de grappe</title>
   <itemizedlist>
    <listitem>
     <para>
      Pour synchroniser les modifications de la configuration booth sur tous les sites de grappe (y compris l&apos;arbitre), utilisez Csync2. Pour plus d&apos;informations, reportez-vous au <xref linkend="cha-ha-geo-sync"/>. 
     </para>
    </listitem>
    <listitem>
     <para>
      Le CIB (base d&apos;informations de la grappe) n&apos;est pas synchronisé automatiquement entre les différents sites d&apos;une grappe géographique. Cela signifie que toutes les modifications de la configuration des ressources requises sur tous les sites de grappe doivent être transférées vers les autres sites manuellement. Pour ce faire, ajoutez des balises aux ressources respectives, exportez-les à partir du CIB actuel, puis importez-les dans le CIB sur les autres sites de grappe. Pour plus de détails, reportez-vous au <xref linkend="sec-ha-geo-rsc-sync-cib"/>.
      </para>
    </listitem>
   </itemizedlist>
  </note>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-more">
  <title>Pour en savoir plus</title>
  <itemizedlist>
   <listitem>
    <para>
     Pour plus de documentation sur ce produit, reportez-vous à l&apos;adresse <link xlink:href="https://documentation.suse.com/sle-ha/"/>. Pour des informations concernant d&apos;autres tâches de configuration et d&apos;administration, reportez-vous au manuel <link xlink:href="https://documentation.suse.com/sle-ha/html/SLE-HA-all/book-administration.html"><citetitle>Geo Clustering Guide</citetitle></link> (Guide de Geo Clustering).
    </para>
   </listitem>
   <listitem>
    <para>
     Vous trouverez des informations concernant la réplication des données sur les grappes géographiques via DRBD dans le document suivant : <link xlink:href="https://documentation.suse.com/sbp/all/html/SBP-DRBD/index.html"><citetitle>SUSE Best Practices</citetitle></link> (Meilleures pratiques SUSE).
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <xi:include href="common_copyright_quick.xml"/>
 <xi:include href="common_legal.xml"/>
</article>
