<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:dm="urn:x-suse:ns:docmanager" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_requirements.xml" version="5.0" xml:id="cha-ha-requirements">
  <?dbfo-need height="10em"?>

  <title>系统要求和建议</title>
 <info>
      <abstract>
        <para>
    下面的小节介绍 SUSE® Linux Enterprise High Availability 的系统要求和先决条件。此外，还提供了有关群集设置的建议。
   </para>
      </abstract>
  <dm:docmanager>
   <dm:maintainer/>
   <dm:status>editing</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>yes</dm:translation>
   <dm:languages/>
   <dm:release/>
   <dm:repository/>
  </dm:docmanager>
    </info>
    <sect1 xml:id="sec-ha-requirements-hw">
  <title>硬件要求</title>

  <para>
   以下列表指出了基于 SUSE® Linux Enterprise High Availability 的群集的硬件要求。这些要求表示最低硬件配置。根据群集的用途，可能会需要其他硬件。
  </para>

  <variablelist>
   <varlistentry>
    <term>服务器</term>
    <listitem>
     <para> 安装了<xref linkend="sec-ha-requirements-sw"/>中指定的软件的 1 到 32 台 Linux 服务器。</para>
     <para>
      服务器可以是裸机，也可以是虚拟机。两者不要求有相同的硬件（内存、磁盘空间等），但们必须具有相同的体系结构。不支持跨平台群集。
     </para>
     <para> 使用 <literal>pacemaker_remote</literal> 可扩展群集使之突破 32 个节点的限制，包含更多的 Linux 服务器。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>通讯通道</term>
    <listitem>
       <para>
       每个群集节点至少有两个 TCP/IP 通讯媒体。网络设备必须支持您要用于群集通讯的通讯方式：多播或单播。通讯媒体应支持 100 Mbit/s 或更高的数据传送速度。对于支持的群集设置，要求有两个或更多冗余通讯路径。这可通过以下方式实现：</para>
       <itemizedlist>
        <listitem>
         <para>
          网络设备绑定（首选）
         </para>
        </listitem>
        <listitem>
         <para>
          Corosync 中的另一个通讯通道
         </para>
        </listitem>
       </itemizedlist>
     <para>有关细节，请分别参见<xref linkend="cha-ha-netbonding"/>和<xref linkend="pro-ha-installation-setup-channel2"/>。
      
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>节点屏蔽/STONITH</term>
    <listitem>
      <para>
      为了避免发生<quote>节点分裂</quote>情况，群集需要有节点屏蔽机制。在节点分裂情况下，群集节点会因硬件或软件故障或者网络连接中断而分割成两个或更多互不相识的组。而屏蔽机制会隔离存在问题的节点（通常的做法是重置该节点或关闭其电源）。这也称为 STONITH（<quote>Shoot the other node in the head</quote>，关闭其他节点）。节点屏蔽机制可以是物理设备（电源开关），也可以是 SBD（按磁盘 STONITH）等机制再结合看门狗。SBD 可以与共享存储设备搭配使用，也可以在无磁盘模式下使用。
     </para>
     <para>除非使用了 SBD，否则 High Availability 群集中的每个节点都必须至少有一个 STONITH 设备。强烈建议每个节点上有多个 STONITH 设备。</para>
      <important>
      <title>不支持无 STONITH 的配置</title>
      <itemizedlist>
       <listitem>
        <para>您必须为群集配置节点屏蔽机制。</para>
       </listitem>
       <listitem>
        <para>全局群集选项 <systemitem>stonith-enabled</systemitem> 和 <systemitem>startup-fencing</systemitem> 必须设置为 <literal>true</literal>。如果您更改这些选项，将会失去支持。</para>
       </listitem>
      </itemizedlist>
      </important>
    </listitem>
  </varlistentry>
  </variablelist>
 </sect1>
<?dbfo-need height="10em"?>

 <sect1 xml:id="sec-ha-requirements-sw">
  <title>软件要求</title>

  <para>
   所有节点上至少需要安装以下模块和扩展：
  </para>

<itemizedlist>
   <listitem>
    <para>Basesystem Module 15 SP7</para>
   </listitem>
   <listitem>
    <para>Server Applications Module 15 SP7</para>
   </listitem>
   <listitem>
    <para>SUSE Linux Enterprise High Availability 15 SP7</para>
   </listitem>
  </itemizedlist>

  <para>
   根据您在安装期间选择的系统角色，默认会安装以下软件集：
  </para>
  <variablelist>
   <varlistentry>
    <term>HA 节点系统角色</term>
    <listitem>
     <para>
      High Availability (<literal>ha_sles</literal>)
     </para>
     <para>
      增强型基础系统 (<literal>enhanced_base</literal>)
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>HA GEO 节点系统角色</term>
    <listitem>
     <para>
      Geo Clustering for High Availability (<literal>ha_geo</literal>)
     </para>
     <para>
      增强型基础系统 (<literal>enhanced_base</literal>)
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <note>
   <title>极简安装</title>
   <para>
    通过这些系统角色安装只能完成极简安装。如有必要，您可能需要手动添加更多软件包。</para>
   <para>
    对于原先指派了另一个系统角色的计算机，您需要手动安装 <systemitem>ha_sles</systemitem> 或 <systemitem>ha_geo</systemitem> 软件集及所需的任何其他软件包。
   </para>
  </note>
 </sect1>
 <sect1 xml:id="sec-ha-requirements-disk">
  <title>存储要求</title>

  <para>
   有些服务需要使用共享存储。如果使用外部 NFS 共享，必须能够从所有群集节点通过冗余通讯路径可靠地访问该共享。</para>
  <para>为确保数据的高可用性，我们建议您为群集设置共享磁盘系统（存储区域网络，简称 SAN）。如果使用共享磁盘子系统，请确保符合以下要求：
  </para>

  <itemizedlist>
   <listitem>
    <para>
     根据制造商的说明正确设置共享磁盘系统并且共享磁盘系统可正确运行。
    </para>
   </listitem>
   <listitem>
    <para>
     共享磁盘系统中包含的磁盘应配置为使用镜像或 RAID，来为共享磁盘系统增加容错性。
    </para>
   </listitem>
   <listitem>
    <para>
     如果准备对共享磁盘系统访问使用 iSCSI，则请确保正确配置了 iSCSI 启动器和目标。
    </para>
   </listitem>
   <listitem>
    <para>
     使用 DRBD* 实施在两台计算机间分发数据的镜像 RAID 系统时，请确保只访问 DRBD 提供的设备，切勿访问备份设备。要利用冗余，可以使用群集剩余组件中所用的相同 NIC。
    </para>
   </listitem>
  </itemizedlist>
  <para>
   如果使用基于磁盘的 SBD 作为 STONITH 机制，则共享存储设备还需要满足其他要求。有关详细信息，请参见 <xref linkend="sec-ha-storage-protect-req"/>。
   </para>
 </sect1>
 <sect1 xml:id="sec-ha-requirements-other">
  <title>其他要求和建议</title>

  <para>
   为了实现受支持且有用的高可用性设置，请考虑以下建议：
  </para>

  <variablelist>
   <varlistentry xml:id="vle-ha-req-nodes">
    <term>群集节点数</term>
    <listitem>
     <para>对于包含两个以上节点的群集，强烈建议使用奇数数目的群集节点，以便具有仲裁。有关仲裁的详细信息，请参见<xref linkend="sec-ha-config-basics-global"/>。一个常规群集最多只能包含 32 个节点。借助 <systemitem class="daemon">pacemaker_remote</systemitem> 服务，可以将 High Availability 群集进行扩展，使其包含超出此限制的额外节点。请参见《Pacemaker 远程快速入门》获取更多细节。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>时间同步</term>
     <listitem>
   <para>
     群集节点必须同步到群集外的 NTP 服务器。自 SUSE Linux Enterprise High Availability 15 起，采用 chrony 作为 NTP 的默认实现方式。有关详细信息，请参见<link xlink:href="https://documentation.suse.com/sles-15/html/SLES-all/cha-ntp.html">《SUSE Linux Enterprise Server 15 SP7 管理指南》</link>。
    </para>
    <para>
     如果节点未同步，或者即使节点已同步但配置了不同的时区，群集也可能无法正常工作。此外，日志文件和群集报告在不进行同步的情况下也很难进行分析。如果使用引导脚本，而 NTP 尚未配置，则系统会提出警告。
    </para>
  </listitem>
   </varlistentry>
   <varlistentry>
    <term>网络接口卡 (NIC) 名称</term>
    <listitem>
     <para>
      必须在所有节点上都相同。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>主机名和 IP 地址</term>
    <listitem>
     <itemizedlist>
      <listitem>
       <para>
        使用静态 IP 地址。
       </para>
      </listitem>
      <listitem>
       <para>
        只支持主 IP 地址。
       </para>
      </listitem>
      <listitem>
        <para>
     在 <filename>/etc/hosts</filename> 文件中列出所有群集节点，包括各自的完全限定主机名和简短主机名。群集成员必须能够按名称找到彼此。如果名称不可用，则将无法进行群集内部通讯。
   </para>
       <para>
        有关 Pacemaker 如何获取节点名称的详细信息，请参见 <link xlink:href="https://clusterlabs.org/doc/en-US/Pacemaker/1.1/html/Pacemaker_Explained/s-node-name.html"></link>。
       </para>
      </listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-ha-req-ssh">
    <term>SSH</term>
    <listitem>
      <para>
    所有群集节点都必须能通过 SSH 相互访问。<command>crm report</command>（用于查错）等工具和 Hawk2 的<guimenu>历史记录浏览器</guimenu>要求节点之间通过无口令 SSH 方式来访问，否则它们只能从当前节点收集数据。
  </para>
     <para>
      如果使用引导脚本设置群集，系统会自动创建并复制 SSH 密钥。如果使用 YaST 群集模块设置群集，您必须自行配置 SSH 密钥。
     </para>
     <note>
      <title>合规要求</title>
      <para>
       默认情况下，群集以 <systemitem class="username">root</systemitem> 用户身份执行操作。如果无口令 <systemitem class="username">root</systemitem> SSH 访问方式不符合法规要求，您可以将群集设置为具有 <command>sudo</command> 特权的用户。此用户可以运行群集操作，包括 <command>crm report</command>。
      </para>
      <para>
       此外，如果无法将 SSH 密钥直接存储在节点上，可以改为通过 SSH 代理转发使用本地 SSH 密钥（如<xref linkend="sec-ha-manual-config-crm-user-privileges"/>中所述）。
      </para>
      <para>
       如果安全策略更为严格，您可以按<xref linkend="sec-crmreport-nonroot-sudo"/>中所述，设置一个只拥有受限 <command>sudo</command> 权限的非 root 用户来专门执行 <command>crm report</command>。
      </para>
      <para>
       对于<guimenu>历史记录浏览器</guimenu>，目前还没有其他方式可替代无口令登录。
      </para>
     </note>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
</chapter>
