<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_install.xml" version="5.0" xml:id="cha-ha-install">
<?dbfo-need height="20em"?>

 <title>安装 High Availability Extension</title>
 <info>
  <abstract>
   <para>如果您是首次使用 <phrase role="roductnamereg"><phrase os="sles">SUSE® Linux Enterprise High Availability Extension</phrase></phrase> 设置高可用性群集，最简单的方法就是从基本的双节点群集开始设置。您也可以使用双节点群集来运行一些测试。之后，您便可使用 AutoYaST 克隆现有的群集节点来添加更多节点。克隆的节点上会安装相同的软件包，并具有与原始节点相同的系统配置。
   </para>
   <para>
    如果要升级运行较低版 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 的现有群集，请参见<xref linkend="cha-ha-migration"/>。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer/>
   <dm:status>editing</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>yes</dm:translation>
   <dm:languages/>
   <dm:release/>
   <dm:repository/>
  </dm:docmanager>
 </info>
 
 <sect1 xml:id="sec-ha-install-manual">
  <title>手动安装</title>
  <para>
   要手动安装 High Availability Extension 的软件包，请参见<xref linkend="article-installation"/>。该指南会引导您完成基本双节点群集的设置。
  </para>
 </sect1>
  <sect1 xml:id="sec-ha-installation-autoyast">
  <title>使用 AutoYaST 进行批量安装和部署</title>

  <para>
   安装并设置双节点群集后，您可以使用 AutoYaST 克隆现有节点并将克隆节点添加到群集，以便扩展群集。
  </para>
   
   <para>AutoYaST 使用包含安装和配置数据的配置文件。配置文件会告知 AutoYaST 要安装的内容以及如何配置已安装系统，以最终获得一个现成可用的系统。然后可使用此配置文件以各种方式（例如，克隆现有群集节点）进行大批量部署。</para>

   <para>
    有关在各种情况下如何使用 AutoYaST 的详细说明，请参见<link xlink:href="https://documentation.suse.com/sles-15/html/SLES-all/book-autoyast.html">
     <citetitle>《AutoYaST Guide for SUSE Linux Enterprise Server 15 SP4》（SUSE Linux Enterprise Server 15 SP2 的 AutoYaST 指南）</citetitle><phrase role="productnumber"><phrase os="sles"></phrase></phrase></link>。
   </para>

   <important>
    <title>相同硬件</title>
    <para>
     <xref linkend="pro-ha-installation-clone-node"/>假设您要将 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> <phrase role="productnumber"><phrase os="sles"> 15 SP4</phrase></phrase> 部署到硬件配置完全相同的一组计算机上。
    </para>
    <para>
     如果您需要在配置不同的硬件上部署群集节点，请参见《<citetitle>SUSE Linux Enterprise <phrase role="productnumber"><phrase os="sles">15 SP4</phrase></phrase> 部署指南</citetitle>》“<citetitle>自动安装</citetitle>”一章中的“<citetitle>基于规则的自动安装</citetitle>”一节。
    </para>
   </important>



  <procedure xml:id="pro-ha-installation-clone-node">
   <title>使用 AutoYaST 克隆群集节点</title>
   <step>
    <para>
     确保已正确安装和配置要克隆的节点。有关细节，请参见《<citetitle><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 安装和设置快速入门》</citetitle>或<xref linkend="cha-ha-ycluster"/>。
    </para>
   </step>
   <step>
    <para>
     按照《<citetitle>SUSE Linux Enterprise <phrase role="productnumber"><phrase os="sles">15 SP4</phrase></phrase> 部署指南</citetitle>》中的概要说明进行简单的大批量安装。其中包括以下基本步骤：
    </para>
    <substeps performance="required">
     <step>
      <para>
       创建 AutoYaST 配置文件。使用 AutoYaST GUI 基于现有系统配置创建和修改配置文件。在 AutoYaST 中选择 <guimenu>High Availability</guimenu> 模块并单击<guimenu>克隆</guimenu>按钮。如果需要，调整其他模块中的配置，并将生成的控制文件另存为 XML 格式的文件。
      </para>

      <para>
       如果您已配置 DRBD，也可以在 AutoYaST GUI 中选择并克隆此模块。
      </para>
     </step>
     <step>
      <para>
       确定 AutoYaST 配置文件的来源以及要传递到其他节点的安装例程的参数。
      </para>
     </step>
     <step>
      <para>
       确定 SUSE Linux Enterprise Server 和 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 安装数据的来源。
      </para>
     </step>
     <step>
      <para>
       确定并设置自动安装的引导方案。
      </para>
     </step>
     <step>
      <para>
       通过手动添加参数或创建 <filename>info</filename> 文件，将命令行传递到安装例程。
      </para>
     </step>
     <step>
      <para>
       启动并监视自动安装进程。
      </para>
     </step>
    </substeps>
   </step>
  </procedure>

  <para>
   成功安装克隆节点后，执行以下步骤将克隆节点加入群集中：
  </para>

  <procedure xml:id="pro-ha-installation-clone-start">
   <title>将克隆节点置于联机状态</title>
   <step>
    <para>
     按<xref linkend="sec-ha-installation-setup-csync2"/>中所述使用 Csync2 将密钥配置文件从已配置的节点传送到克隆节点。
    </para>
   </step>
   <step>
    <para>
     要使节点联机，请按<xref linkend="sec-ha-installation-start"/>中所述在克隆的节点上启动 Pacemaker 服务。
    </para>
   </step>
  </procedure>

  <para>
   现在克隆节点将加入群集，因为 <filename>/etc/corosync/corosync.conf</filename> 文件已通过 Csync2 应用到克隆节点。CIB 将在群集节点间自动同步。
  </para>
 </sect1>
</chapter>
