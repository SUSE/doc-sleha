<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
 type="text/xml"
 title="Profiling step"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_log_in.xml" xml:id="cha-ha-log-in" xml:lang="zh-cn" version="5.1">
  <title>登录群集节点</title>
  <info>
    <abstract>
      <para>
        Crm 外壳 (crmsh) 使用无口令 SSH 访问方式在节点之间进行通讯。如果使用 <command>crm cluster init</command> 设置群集，脚本会检查是否存在 SSH 密钥，如果不存在，则会生成这些密钥。如果使用 YaST 群集模块设置群集，您必须自行配置 SSH 密钥。
      </para>
      <para>
        默认情况下，crmsh 会以 <systemitem class="username">root</systemitem> 用户身份执行某些操作。但是，如果您不能允许进行无口令 root SSH 访问，则可以将群集设置为以具有 <command>sudo</command> 权限的用户执行操作。
      </para>
    </abstract>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
      <dm:bugtracker/>
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
  </info>

  <para>
    以下用户可以在第一个节点上设置群集以及向群集添加更多节点：
  </para>
  <variablelist>
    <varlistentry>
      <term><systemitem class="username">root</systemitem> 用户</term>
      <listitem>
        <para>
          以 <systemitem class="username">root</systemitem> 身份运行 crmsh 是默认设置，不需要额外配置。<systemitem class="username">root</systemitem> 用户的 SSH 密钥必须在节点本地存储（或生成），而不应存放在远程系统上。
        </para>
        <para>
          要以 <systemitem class="username">root</systemitem> 用户身份登录节点，请运行以下命令：
        </para>
<screen><prompt>user@local&gt; </prompt><command>ssh root@<replaceable>NODE</replaceable></command></screen>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>具有 <command>sudo</command> 权限的用户（无 SSH 代理转发权限）</term>
      <listitem>
        <para>
          使用 <command>crm cluster join -c <replaceable>USER@NODE</replaceable></command> 向群集添加更多节点时，必须指定此用户。该用户的 SSH 密钥必须在节点本地存储（或生成），而不应存放在远程系统上。
        </para>
        <para>
          要以 <command>sudo</command> 用户身份登录节点，请运行以下命令：
        </para>
<screen><prompt>user@local&gt; </prompt><command>ssh <replaceable>USER@NODE</replaceable></command></screen>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>具有 <command>sudo</command> 权限的用户（有 SSH 代理转发权限）</term>
      <listitem>
        <para>
          您可以使用 SSH 代理转发功能将本地 SSH 密钥传递给群集节点。如果您需要避免在节点上存储 SSH 密钥，此方法将会很有用，不过这需要在本地计算机和群集节点上进行额外的配置。
        </para>
        <para>
          要登录启用了 SSH 代理转发功能的节点，请执行以下步骤：
        </para>
        <orderedlist>
        <listitem>
          <para>
            在本地计算机上，启动 SSH 代理并为其添加密钥。有关详细信息，请参见 SUSE Linux Enterprise Server 的《<citetitle>Security and Hardening Guide</citetitle>》中的 <link xlink:href="https://documentation.suse.com/sles/html/SLES-all/cha-ssh.html#sec-ssh-authentic-agent"><citetitle>Automated public key logins with ssh-agent</citetitle></link>。
          </para>
        </listitem>
        <listitem>
          <para>
            使用 <option>-A</option> 选项登录节点，以启用 SSH 代理转发功能：
          </para>
<screen><prompt>user@local&gt; </prompt><command>ssh -A <replaceable>USER@NODE</replaceable></command></screen>
        </listitem>
      </orderedlist>
      </listitem>
    </varlistentry>
  </variablelist>
  <para>
    向群集添加节点时，必须以设置第一个节点的用户身份登录每个节点。
  </para>
  <important role="compact">
    <para>
      为简单起见，本指南中的命令假设您以 <systemitem class="username">root</systemitem> 用户身份登录。如果您是以 <command>sudo</command> 用户身份登录的，请相应地调整命令。
    </para>
  </important>
</chapter>
