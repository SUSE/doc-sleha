<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_hawk2_health_i.xml" version="5.0" xml:id="sec-conf-health">
 <title>校验群集状态</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer/>
   <dm:status>editing</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>yes</dm:translation>
   <dm:languages/>
   <dm:release/>
   <dm:repository/>
  </dm:docmanager>
 </info>

 <para>
  您可以使用 Hawk2 或 crmsh 来检查群集的运行状态。
 </para>

 <sect2 xml:id="sec-conf-hawk2-health">
 <title>使用 Hawk2 校验群集运行状态</title>
 <para>
  Hawk2 提供了一个向导用来检查和检测群集存在的问题。分析完成后，Hawk2 会创建包含更多细节的群集报告。要校验群集状态并生成报告，Hawk2 需要具有在节点之间进行无口令 SSH 访问的权限。否则，它只能从当前节点收集数据。如果您已使用 crm 外壳提供的引导脚本设置群集，那么此时已配置好无口令 SSH 访问权限。如果您需要手动配置，请参见<xref linkend="sec-crmreport-nonroot-ssh"/>。
 </para>

 <procedure>
  <step>
   <para>
    登录 Hawk2：
   </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
  </step>
  <step>
   <para>
    从左侧导航栏中，选择<menuchoice><guimenu>配置</guimenu>
     <guimenu>向导</guimenu></menuchoice>。
   </para>
  </step>
  <step>
   <para>
    展开<guimenu>基本</guimenu>类别。
   </para>
  </step>
  <step>
   <para>
    选择<guimenu>校验状态和配置</guimenu>向导。
   </para>
  </step>
  <step>
   <para>
    单击<guimenu>校验</guimenu>进行确认。
   </para>
  </step>
  <step>
   <para>
    输入群集的 root 口令，然后单击<guimenu>应用</guimenu>。Hawk2 会生成报告。
   </para>
  </step>
 </procedure>
 </sect2>

 <sect2 xml:id="sec-ha-manual-config-cli-health">
  <title>使用 crmsh 检查运行状态</title>
  <para>
   可以使用所谓的<emphasis>脚本</emphasis>来显示群集或节点的<quote>运行</quote>状态。脚本可以执行不同的任务，并不局限于显示运行状态。不过，本节重点介绍如何获取运行状态。
  </para>
  <para>
   要获取有关 <command>health</command> 命令的所有细节，请使用 <command>describe</command>：
  </para>
<screen><prompt role="root"># </prompt><command>crm script describe health</command></screen>
  <para>
   该命令将显示所有参数及其默认值的说明和列表。要执行脚本，请使用 <command>run</command>：
  </para>
<screen><prompt role="root"># </prompt><command>crm script run health</command></screen>
  <para>
   如果您希望只运行整套命令中的一个步骤，可以使用 <command>describe</command> 命令列出 <citetitle>Steps</citetitle> 类别中的所有可用步骤。
  </para>
  <para>
   例如，以下命令将执行 <command>health</command> 命令的第一个步骤。将在 <filename>health.json</filename> 文件中储存输出以供做进一步调查：
  </para>
<screen><prompt role="root"># </prompt><command>crm script run health statefile='health.json'</command></screen>
  <para>您也可以使用 <command>crm cluster health</command> 运行以上命令。</para>
  <para>
   有关脚本的更多信息，请参见 <link xlink:href="http://crmsh.github.io/scripts/"/>。
  </para>
 </sect2>
</sect1>
