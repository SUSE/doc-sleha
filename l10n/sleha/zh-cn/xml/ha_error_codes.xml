<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_error_codes.xml" version="5.0" xml:id="sec-ha-errorcodes">
 <title>OCF 返回代码和故障恢复</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>editing</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  根据 OCF 规范，有一些关于操作必须返回的退出代码的严格定义。群集会始终检查返回代码与预期结果是否相符。如果结果与预期值不匹配，则将操作视为失败，并将启动恢复操作。有三种类型的故障恢复：
 </para>

 <table>
  <title>故障恢复类型</title>
  <tgroup cols="3">
   <thead>
    <row>
     <entry>
      <para>
       恢复类型
      </para>
     </entry>
     <entry>
      <para>
       说明
      </para>
     </entry>
     <entry>
      <para>
       群集执行的操作
      </para>
     </entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry>
      <para>
       软
      </para>
     </entry>
     <entry>
      <para>
       发生临时错误。
      </para>
     </entry>
     <entry>
      <para>
       重启动资源或将它移到新位置。
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       硬
      </para>
     </entry>
     <entry>
      <para>
       发生非临时错误。错误可能特定于当前节点。
      </para>
     </entry>
     <entry>
      <para>
       将资源移到别处，避免在当前节点上重试该资源。
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       致命
      </para>
     </entry>
     <entry>
      <para>
       发生所有群集节点共有的非临时错误。这表示指定了错误配置。
      </para>
     </entry>
     <entry>
      <para>
       停止资源，避免在任何群集节点上启动该资源。
      </para>
     </entry>
    </row>
   </tbody>
  </tgroup>
 </table>

 <para>
  假定某个操作被视为已失败，下表概括了不同的 OCF 返回代码。此外，该表还显示了收到相应的错误代码时群集将启动的恢复类型。
 </para>

 <remark>taroth 2010-03-07: DEVs, please check if the information in the table is still valid</remark>



 <table>
  <title>OCF 返回代码</title>
  <tgroup cols="4">
   <colspec colnum="1" colname="1" colwidth="12*"/>
   <colspec colnum="2" colname="2" colwidth="23*"/>
   <colspec colnum="3" colname="3" colwidth="50*"/>
   <colspec colnum="4" colname="4" colwidth="15*"/>
   <thead>
    <row>
     <entry>
      <para>
       OCF 返回代码
      </para>
     </entry>
     <entry>
      <para>
       OCF 别名
      </para>
     </entry>
     <entry>
      <para>
       说明
      </para>
     </entry>
     <entry>
      <para>
       恢复类型
      </para>
     </entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry>
      <para>
       0
      </para>
     </entry>
     <entry>
      <para>
       OCF_SUCCESS
      </para>
     </entry>
     <entry>
      <para>
       成功。命令成功完成。这是所有启动、停止、升级和降级命令的所需结果。
      </para>
     </entry>
     <entry>
      <para>
       软
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       1
      </para>
     </entry>
     <entry>
      <para>
       OCF_ERR_­GENERIC
      </para>
     </entry>
     <entry>
      <para>
       通用<quote>出现问题</quote>错误代码。
      </para>
     </entry>
     <entry>
      <para>
       软
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       2
      </para>
     </entry>
     <entry>
      <para>
       OCF_ERR_ARGS
      </para>
     </entry>
     <entry>
      <para>
       资源配置在此计算机上无效（例如，它引用了在节点上找不到的位置/工具）。
      </para>
     </entry>
     <entry>
      <para>
       硬
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       3
      </para>
     </entry>
     <entry>
      <para>
       OCF_­ERR_­UN­IMPLEMENTED
      </para>
     </entry>
     <entry>
      <para>
       请求的操作未实现。
      </para>
     </entry>
     <entry>
      <para>
       硬
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       4
      </para>
     </entry>
     <entry>
      <para>
       OCF_ERR_PERM
      </para>
     </entry>
     <entry>
      <para>
       资源代理没有足够的特权，不能完成此任务。
      </para>
     </entry>
     <entry>
      <para>
       硬
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       5
      </para>
     </entry>
     <entry>
      <para>
       OCF_ERR_­INSTALLED
      </para>
     </entry>
     <entry>
      <para>
       资源所需的工具未安装在此计算机上。
      </para>
     </entry>
     <entry>
      <para>
       硬
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       6
      </para>
     </entry>
     <entry>
      <para>
       OCF_ERR_­CONFIGURED
      </para>
     </entry>
     <entry>
      <para>
       资源配置无效（例如，缺少必需的参数）。
      </para>
     </entry>
     <entry>
      <para>
       致命
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       7
      </para>
     </entry>
     <entry>
      <para>
       OCF_NOT_­RUNNING
      </para>
     </entry>
     <entry>
      <para>
       资源未运行。群集将不会尝试停止为任何操作返回此代码的资源。
      </para>
      <para>
       此 OCF 返回代码可能需要或不需要资源恢复，这取决于所需的资源状态。如果出现意外，则执行<literal>软</literal>恢复。
      </para>
     </entry>
     <entry>
      <para>
       无
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       8
      </para>
     </entry>
     <entry>
      <para>
       OCF_RUNNING_­PROMOTED
      </para>
     </entry>
     <entry>
      <para>
       资源正以已升级模式运行。
      </para>
     </entry>
     <entry>
      <para>
       软
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       9
      </para>
     </entry>
     <entry>
      <para>
       OCF_FAILED_­PROMOTED
      </para>
     </entry>
     <entry>
      <para>
       资源处于已升级模式，但已失败。资源将再次被降级、停止再重启动（然后也可能升级）。
      </para>
     </entry>
     <entry>
      <para>
       软
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       其他
      </para>
     </entry>
     <entry>
      <para>
       无
      </para>
     </entry>
     <entry>
      <para>
       自定义错误代码。
      </para>
     </entry>
     <entry>
      <para>
       软
      </para>
     </entry>
    </row>
   </tbody>
  </tgroup>
 </table>
</sect1>
