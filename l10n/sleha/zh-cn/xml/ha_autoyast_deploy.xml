<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
 type="text/xml"
 title="Profiling step"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_autoyast_deploy.xml" xml:id="sec-ha-installation-autoyast" xml:lang="zh-cn" version="5.1">
  <title>使用 AutoYaST 部署节点</title>
  <info>
    <abstract>
      <para>
        安装并设置初始群集后，您便可以扩展群集，只需使用 AutoYaST 克隆现有节点并将克隆节点添加到群集即可。
      </para>
      <para>AutoYaST 使用包含安装和配置数据的配置文件。配置文件会告知 AutoYaST 要安装的内容以及如何配置已安装系统，以最终获得一个现成可用的系统。然后可使用此配置文件以各种方式（例如，克隆现有群集节点）进行大批量部署。
      </para>
      <para>
        有关在各种情况下如何使用 AutoYaST 的详细说明，请参见<link xlink:href="https://documentation.suse.com/sles-15/html/SLES-all/book-autoyast.html">《AutoYaST Guide for SUSE Linux Enterprise Server 15 SP7》（适用于 SUSE Linux Enterprise Server 15 SP7 的 AutoYaST 指南）</link>。
      </para>
    </abstract>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
      <dm:bugtracker/>
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
  </info>



  <important>
    <title>相同硬件</title>
    <para>
     <xref linkend="pro-ha-installation-clone-node"/>假设您要将 SUSE Linux Enterprise High Availability 15 SP7 部署到硬件配置完全相同的一组计算机上。
    </para>
    <para>
     如果您需要在不相同的硬件上部署群集节点，请参见 SUSE Linux Enterprise 15 SP7 的《Deployment Guide》中“<citetitle>Automated Installation</citetitle>”一章的“<citetitle>Rule-Based Autoinstallation</citetitle>”一节。
    </para>
  </important>

  <procedure xml:id="pro-ha-installation-clone-node">
   <title>使用 AutoYaST 克隆群集节点</title>
   <step>
    <para>
     确保已正确安装和配置要克隆的节点。有关详细信息，请参见<xref linkend="cha-ha-bootstrap-install"/>或<xref linkend="cha-ha-ycluster"/>。
    </para>
   </step>
   <step>
    <para>
     按照 SUSE Linux Enterprise 15 SP7 的《Deployment Guide》中的说明执行简单的批量安装。其中包括以下基本步骤：
    </para>
    <substeps performance="required">
     <step>
      <para>
       创建 AutoYaST 配置文件。使用 AutoYaST GUI 基于现有系统配置创建和修改配置文件。在 AutoYaST 中选择 <guimenu>High Availability</guimenu> 模块并单击<guimenu>克隆</guimenu>按钮。如果需要，调整其他模块中的配置，并将生成的控制文件另存为 XML 格式的文件。
      </para>
      <para>
       如果您已配置 DRBD，也可以在 AutoYaST GUI 中选择并克隆此模块。
      </para>
     </step>
     <step>
      <para>
       确定 AutoYaST 配置文件的来源以及要传递到其他节点的安装例程的参数。
      </para>
     </step>
     <step>
      <para>
       确定 SUSE Linux Enterprise Server 和 SUSE Linux Enterprise High Availability 安装数据的来源。
      </para>
     </step>
     <step>
      <para>
       确定并设置自动安装的引导方案。
      </para>
     </step>
     <step>
      <para>
       通过手动添加参数或创建 <filename>info</filename> 文件，将命令行传递到安装例程。
      </para>
     </step>
     <step>
      <para>
       启动并监控自动安装进程。
      </para>
     </step>
    </substeps>
   </step>
  </procedure>

  <para>
   成功安装克隆节点后，执行以下步骤将克隆节点加入群集：
  </para>

  <procedure xml:id="pro-ha-installation-clone-start">
   <title>使克隆节点上线</title>
   <step>
    <para>
     在现有节点上，按照<xref linkend="sec-ha-installation-setup-csync2"/>中的说明将新节点添加到 Csync2 <guimenu>同步主机</guimenu>列表中。
    </para>
   </step>
   <step>
     <para>
       按<xref linkend="sec-ha-setup-yast-csync2-sync"/>中所述使用 Csync2 将密钥配置文件从已配置的节点传送到克隆节点。
     </para>
   </step>
   <step>
    <para>
     要使节点上线，请按<xref linkend="sec-ha-installation-start"/>中所述在克隆的节点上启动群集服务。
    </para>
   </step>
  </procedure>

  <para>
   现在克隆的节点会加入群集，因为已通过 Csync2 将 <filename>/etc/corosync/corosync.conf</filename> 文件应用到克隆的节点。CIB 将在群集节点间自动同步。
  </para>

</chapter>
