<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_hawk2_batch_i.xml" version="5.0" xml:id="sec-conf-hawk2-batch">
 <title>使用批模式</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer/>
   <dm:status>editing</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>yes</dm:translation>
   <dm:languages/>
   <dm:release/>
   <dm:repository/>
  </dm:docmanager>
 </info>

 <para>
  Hawk2 提供<guimenu>批模式</guimenu>，包括<emphasis>群集模拟器</emphasis>。该模式可用于以下操作：
 </para>

 <itemizedlist>
  <listitem>
   <para>
    对群集进行分阶段更改并通过单次事务应用这些更改，而不是让每项更改立即生效。
   </para>
  </listitem>
  <listitem>
   <para>
    模拟更改和群集事件，例如，了解可能失败的情况。
   </para>
  </listitem>
 </itemizedlist>

 <para>
  例如，在创建相互依赖的资源组时，可以使用批模式。通过使用批模式，您可以避免将中间或不完整的配置应用到群集。
 </para>

 <para>
  启用批模式后，您可以添加或编辑资源和约束，或更改群集配置。此外，还可以模拟群集中的事件，包括变为联机或脱机的节点、资源操作，以及要授予或撤消的票据。有关详细信息，请参见 <xref linkend="pro-hawk2-batch-inject"/>。
 </para>

 <para>
  <emphasis>群集模拟器</emphasis>会在每次更改后自动运行，并在用户界面上显示预期效果。举例而言，这还意味着当您在批模式下停止某资源时，用户界面上会将该资源显示为已停止，但实际上，该资源仍在运行中。
 </para>

 <important>
  <title>在线系统的向导和更改</title>
  <para>
   某些向导包含除纯群集配置以外的其他操作。在批模式下使用这些向导时，群集配置以外的任何其他更改都将立即应用到在线系统。
  </para>
  <para>
   因此，需要 <systemitem class="username">root</systemitem> 权限的向导无法在批模式下执行。
  </para>
 </important>

 <procedure xml:id="pro-conf-hawk2-manage-monitor-batch">
  <title>使用批模式</title>
  <step>
   <para>
    登录 Hawk2：
   </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
  </step>
  <step>
   <para>
    要激活批模式，请从顶层行选择<guimenu>批</guimenu>。
   </para>
   <para>
    顶层行下方即会另外显示一栏，指出批模式处于活动状态，且包含指向您可在批模式下执行的操作的链接。
   </para>
   <figure xml:id="fig-hawk2-batch">
    <title>Hawk2 批模式已激活</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="hawk2-batchmode-active.png" width="100%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="hawk2-batchmode-active.png" width="100%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </step>
  <step>
   <para>
    当批模式处于活动状态时，对群集执行任意更改，例如添加或编辑资源和约束，或编辑群集配置。
   </para>
   <para>
    系统将会模拟更改，并将其显示在所有屏幕上。
   </para>
  </step>
  <step>
   <para>
    要查看所做更改的细节，请从批模式栏中选择<guimenu>显示</guimenu>。<guimenu>批模式</guimenu>窗口即会打开。
   </para>
   <para>
    对于任何配置更改，该模式会以 crmsh 语法显示在线状态与模拟更改之间的差异：以 <literal>-</literal> 字符开头的行表示当前状态，而以 <literal>+</literal> 开头的行则显示目标状态。
   </para>
  </step>
  <step>
   <para>
    要插入事件或查看更多细节，请参见<xref linkend="pro-hawk2-batch-inject" xrefstyle="select:label"/>。否则请<guimenu>关闭</guimenu>窗口。
   </para>
  </step>
  <step>
   <para>
    选择<guimenu>丢弃</guimenu>或<guimenu>应用</guimenu>模拟的更改，并确认您的选择。此操作还会停用批模式，使您回到正常模式。
   </para>
  </step>
 </procedure>

 <para>
  在批模式下运行时，Hawk2 还允许您插入<guimenu>节点事件</guimenu>和<guimenu>资源事件</guimenu>。
 </para>

 <variablelist>
  <varlistentry>
   <term><guimenu>节点事件</guimenu>
   </term>
   <listitem>
    <para>
     可让您更改节点的状态。可用的状态有<guimenu>联机</guimenu>、<guimenu>脱机</guimenu>和<guimenu>不干净</guimenu>。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><guimenu>资源事件</guimenu>
   </term>
   <listitem>
    <para>
     可让您更改资源的一些属性。例如，您可以设置操作（如 <literal>start</literal>、<literal>stop</literal>、<literal>monitor</literal>）、其要应用到的节点，以及要模拟的预期结果。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><guimenu>票据事件</guimenu>
   </term>
   <listitem>
    <para>
     可让您测试授予和撤消票据（用于 Geo 群集）的影响。
    </para>
   </listitem>
  </varlistentry>
 </variablelist>

 <procedure xml:id="pro-hawk2-batch-inject">
  <title>插入节点、资源或票据事件</title>
  <step>
   <para>
    登录 Hawk2：
   </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
  </step>
  <step>
   <para>
    如果批模式未启动，请单击顶层行上的<guimenu>批</guimenu>切换到批模式。
   </para>
  </step>
  <step>
   <para>
    在批模式栏中，单击<guimenu>显示</guimenu>打开<guimenu>批模式</guimenu>窗口。
   </para>
  </step>
  <step>
   <para>
    要模拟节点的状态更改：
   </para>
   <substeps>
    <step>
     <para>
      单击<menuchoice> <guimenu>插入</guimenu> <guimenu>节点事件</guimenu> </menuchoice>。
     </para>
    </step>
    <step>
     <para>
      选择要操作的<guimenu>节点</guimenu>，然后选择其目标<guimenu>状态</guimenu>。
     </para>
    </step>
    <step>
     <para>
      确认更改。您的事件便会添加到<guimenu>批模式</guimenu>对话框中所列的事件队列中。
     </para>
    </step>
   </substeps>
  </step>
  <step>
   <para>
    模拟资源操作：
   </para>
   <substeps>
    <step>
     <para>
      单击<menuchoice> <guimenu>插入</guimenu> <guimenu>资源事件</guimenu> </menuchoice>。
     </para>
    </step>
    <step>
     <para>
      选择要操作的<guimenu>资源</guimenu>和要模拟的<guimenu>操作</guimenu>。
     </para>
    </step>
    <step>
     <para>
      如果必要，请定义<guimenu>间隔</guimenu>。
     </para>
    </step>
    <step>
     <para>
      选择要运行操作的<guimenu>节点</guimenu>及目标<guimenu>结果</guimenu>。您的事件便会添加到<guimenu>批模式</guimenu>对话框中所列的事件队列中。
     </para>
    </step>
    <step>
     <para>
      确认更改。
     </para>
    </step>
   </substeps>
  </step>
  <step>
   <para>
    要模拟票据操作，请执行以下操作：
   </para>
   <substeps>
    <step>
     <para>
      单击<menuchoice> <guimenu>插入</guimenu> <guimenu>票据事件</guimenu> </menuchoice>。
     </para>
    </step>
    <step>
     <para>
      依次选择要操作的<guimenu>票据</guimenu>和要模拟的<guimenu>操作</guimenu>。
     </para>
    </step>
    <step>
     <para>
      确认更改。您的事件便会添加到<guimenu>批模式</guimenu>对话框中所列的事件队列中。
     </para>
    </step>
   </substeps>
  </step>
  <step>
   <para>
    <guimenu>批模式</guimenu>对话框（<xref linkend="fig-hawk2-batch-show" xrefstyle="select:label"/>）会为每个插入的事件显示新的一行。此处列出的所有事件都会立即被模拟并反映到<guimenu>状态</guimenu>屏幕上。
   </para>
   <para>
    如果您还执行了任何配置更改，在线状态和模拟更改之间的差异会显示在所插入事件的下方。
   </para>
   <figure xml:id="fig-hawk2-batch-show">
    <title>Hawk2 批模式 - 插入的事件和配置更改</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="hawk2-batchmode-show.png" width="100%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="hawk2-batchmode-show.png" width="100%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </step>
  <step>
   <para>
    要去除插入的事件，请单击该事件旁边的<guimenu>去除</guimenu>图标。Hawk2 会相应地更新<guimenu>状态</guimenu>屏幕。
   </para>
  </step>
  <step>
   <para>
    要查看模拟运行的更多细节，请单击<guimenu>模拟器</guimenu>并选择以下选项之一：
   </para>
   <variablelist>
    <varlistentry>
     <term><guimenu>摘要</guimenu>
     </term>
     <listitem>
      <para>
       显示详细的摘要。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>CIB（输入）</guimenu>/<guimenu>CIB（输出）</guimenu>
     </term>
     <listitem>
      <para>
       <guimenu>CIB（输入）</guimenu>会显示初始的 CIB 状态。<guimenu>CIB（输出）</guimenu>会显示转换后 CIB 的情况。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>转换图</guimenu>
     </term>
     <listitem>
      <para>
       显示转换的图形表示形式。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>交付</guimenu>
     </term>
     <listitem>
      <para>
       显示转换的 XML 表示形式。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </step>
  <step>
   <para>
    如果您已审阅模拟的更改，请关闭<guimenu>批模式</guimenu>窗口。
   </para>
  </step>
  <step>
   <para>
    要退出批模式，请<guimenu>应用</guimenu>或<guimenu>丢弃</guimenu>模拟的更改。
   </para>
  </step>
 </procedure>
</sect1>
