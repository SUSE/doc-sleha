<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
 type="text/xml"
 title="Profiling step"?>
<appendix xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_iscsi_for_sbd.xml" xml:id="ha-iscsi-for-sbd" xml:lang="it" version="5.1">
 <title>Storage iSCSI di base per SBD</title>
 <info>
  <abstract>
   <para>
    Seguire le procedure seguenti per configurare lo storage iSCSI di base da utilizzare con SBD. Queste procedure sono consigliate solo ai fini dei test. Prima di utilizzare iSCSI in un ambiente di produzione, vedere <link xlink:href="https://documentation.suse.com/sles/html/SLES-all/cha-iscsi.html">
    Storage Administration Guide for SUSE Linux Enterprise Server</link> (Guida all&apos;amministrazione dello storage di SUSE Linux Enterprise Server).
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <itemizedlist>
  <title>Requisiti</title>
  <listitem>
   <para>
    Una macchina virtuale SUSE Linux Enterprise Server che funga da destinazione iSCSI. Tale macchina virtuale non fa parte del cluster.
   </para>
  </listitem>
  <listitem>
   <para>
    Due dispositivi di archiviazione virtuale sulla VM: un dispositivo da 20 GB per il sistema e un dispositivo da 1 GB per SBD.
   </para>
  </listitem>
  <listitem>
   <para>
    Due nodi SUSE Linux Enterprise Server che non siano stati ancora aggiunti a un cluster High Availability.
   </para>
  </listitem>
 </itemizedlist>

 <para>
  In primo luogo, configurare una destinazione iSCSI sulla macchina virtuale:
 </para>

 <procedure xml:id="pro-iscsi-for-sbd-target">
  <title>Configurazione di una destinazione iSCSI</title>
  <step>
   <para>
    Installare il pacchetto <package>yast2-iscsi-lio-server</package>:
   </para>
<screen><prompt role="root"># </prompt><command>zypper install yast2-iscsi-lio-server</command></screen>
  </step>
  <step>
   <para>
    Avviare il modulo <literal>iscsi-lio-server</literal> in YaST:
   </para>
<screen><prompt role="root"># </prompt><command>yast2 iscsi-lio-server</command></screen>
  </step>
  <step>
   <para>
    Nella scheda <guimenu>Servizio</guimenu>, in <guimenu>Dopo il riavvio</guimenu>, selezionare <guimenu>Avvia all&apos;avvio del sistema</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Attivare <guimenu>Apri porta nel firewall</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Nella scheda <guimenu>Rilevazione</guimenu>, attivare <guimenu>Autenticazione per il rilevamento</guimenu>.
    </para>
   </step>
  <step>
   <para>
    In <guimenu>Autenticazione tramite destinazioni</guimenu>, immettere un <guimenu>Nome utente</guimenu> e una <guimenu>Password</guimenu>.
   </para>
  </step>
  <step>
   <para>
    In <guimenu>Autenticazione tramite iniziatori</guimenu>, immettere un <guimenu>Nome utente comune</guimenu> e una <guimenu>Password comune</guimenu>. Questa password deve essere diversa da quella di <guimenu>Autenticazione da parte delle destinazioni</guimenu> password.
   </para>
  </step>
  <step>
   <para>
    Nella scheda <guimenu>Destinazione</guimenu>, selezionare <guimenu>Aggiungi</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Modificare il nome della <guimenu>Destinazione</guimenu> sostituendo <literal>.com.example</literal>.
   </para>
  </step>
  <step>
   <para>
    Aggiungere l&apos;<guimenu>Indirizzo IP</guimenu> del server.
   </para>
  </step>
  <step>
   <para>
    Selezionare <guimenu>Aggiungi</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Nella finestra <guimenu>Dettagli LUN</guimenu>, immettere il <guimenu>Percorso LUN</guimenu> del dispositivo di storage da 1 GB (ad esempio, <filename>/dev/vbd</filename>).
   </para>
  </step>
  <step>
   <para>
    Selezionare <guimenu>OK</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Selezionare <guimenu>Avanti</guimenu>. 
   </para>
  </step>
  <step>
   <para>
    Selezionare <guimenu>Fine</guimenu> per chiudere YaST.
   </para>
  </step>
  <step>
   <para>
    Per verificare la configurazione della destinazione, passare all&apos;interfaccia a riga di comando di destinazione:
   </para>
<screen><prompt role="root"># </prompt><command>targetcli</command></screen>
   <para>
    Mostrare la configurazione:
   </para>
<screen><prompt>/&gt; </prompt><command>ls</command></screen>
  </step>
 </procedure>

 <para>
  Quindi, configurare gli iniziatori iSCSI sui nodi. Ripetere la procedura su entrambi i nodi:
 </para>

 <procedure xml:id="pro-iscsi-for-sbd-clients">
  <title>Configurazione di un iniziatore iSCSI</title>
  <step>
   <para>
    Installare il pacchetto <package>yast2-iscsi-client</package>:
   </para>
<screen><prompt role="root"># </prompt><command>zypper install yast2-iscsi-client</command></screen>
  </step>
  <step>
   <para>
    Avviare il servizio <literal>iscsid</literal>:
   </para>
<screen><prompt role="root"># </prompt><command>systemctl start iscsid</command></screen>
  </step>
  <step>
   <para>
    Aprire il modulo <literal>iscsi-client</literal> in YaST:
   </para>
<screen><prompt role="root"># </prompt><command>yast2 iscsi-client</command></screen>
  </step>
  <step>
   <para>
    Nella scheda <guimenu>Destinazioni rilevate</guimenu>, selezionare <guimenu>Rilevazione</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Immettere l&apos;indirizzo IP della destinazione iSCSI.
   </para>
  </step>
  <step>
   <para>
    Cancellare <guimenu>Nessuna autenticazione per la rilevazione</guimenu>.
   </para>
  </step>
  <step>
   <para>
    In <guimenu>Autenticazione da parte dell&apos;iniziatore</guimenu>, immettere il <guimenu>Nome utente</guimenu> e la <guimenu>Password</guimenu> dell&apos;iniziatore.
   </para>
  </step>
  <step>
   <para>
    In <guimenu>Autenticazione tramite destinazioni</guimenu>, immettere il <guimenu>Nome utente</guimenu> e la <guimenu>Password</guimenu> della destinazione.
   </para>
  </step>
  <step>
   <para>
    Selezionare <guimenu>Avanti</guimenu>. 
   </para>
  </step>
  <step>
   <para>
    Dopo il rilevamento da parte di YaST della destinazione iSCSI, selezionare <guimenu>Connetti</guimenu>.
   </para>
  </step>
  <step>
   <para>
    In <guimenu>Avvio</guimenu>, selezionare <guimenu>all&apos;avvio</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Selezionare <guimenu>Avanti</guimenu>. 
   </para>
  </step>
  <step>
   <para>
    Selezionare <guimenu>OK</guimenu> per chiudere YaST.
   </para>
  </step>
  <step>
   <para>
    Verificare l&apos;iniziatore iSCSI:
   </para>
<screen><prompt role="root"># </prompt><command>lsscsi</command>
[0:0:1:0] cd/dvd QEMU QEMU DVD-ROM 2.5+ /dev/sr0
[2:0:0:0] disk LIO-ORG IBLOCK 4.0 /dev/sda</screen>
   <para>
    Cercare una riga con <literal>IBLOCK</literal>. In questo esempio, il dispositivo iSCSI è <literal>/dev/sda</literal>.
   </para>
  </step>
  <step>
   <para>
    Verificare lo stato del servizio <literal>iscsid</literal>:
   </para>
<screen><prompt role="root"># </prompt><command>systemctl status iscsid</command></screen>
  </step>
 </procedure>

 <para>
  È possibile trovare il nome del dispositivo stabile in <filename>/dev/disk/by-id/</filename>. Di norma, un dispositivo iSCSI inizia con <literal>scsi-SLIO-ORG_IBLOCK</literal>.
 </para>
 <para>
  Se si dispone di più dischi, è possibile eseguire il comando <command>lsblk -o name,serial</command> per confermare quale nome di dispositivo stabile corrisponde a quale nome breve (ad esempio, <filename>/dev/sda</filename>).
 </para>
 <para>
  Quando si configura il cluster, specificare il nome del dispositivo stabile con uno di questi metodi:
 </para>
 <itemizedlist>
  <listitem>
   <para>
    Quando si esegue <command>crm cluster init</command>, immettere il nome del dispositivo stabile quando viene richiesto.
   </para>
  </listitem>
  <listitem>
   <para>
    Prima di eseguire <command>crm cluster init</command>, aggiungere il nome del dispositivo stabile a <filename>/etc/sysconfig/sbd</filename>:
   </para>
<screen>SBD_DEVICE=/dev/disk/by-id/scsi-SLIO-ORG_IBLOCK_<replaceable>DEVICE_ID_STRING</replaceable></screen>
   <para>
    Quando si esegue <command>crm cluster init</command>, rispondere <literal>n</literal> a questa domanda:
   </para>
<screen>SBD is already configured to use /dev/disk/by-id/scsi-SLIO-ORG_IBLOCK_... - overwrite (y/n)?</screen>
  </listitem>
 </itemizedlist>
</appendix>
