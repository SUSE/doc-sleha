<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
 type="text/xml"
 title="Profiling step"?>
<appendix xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_iscsi_for_sbd.xml" xml:id="ha-iscsi-for-sbd" xml:lang="de" version="5.1">
 <title>Grundlegender iSCSI-Speicher für SBD</title>
 <info>
  <abstract>
   <para>
    Mit den folgenden Verfahren konfigurieren Sie einen grundlegenden iSCSI-Speicher zur Verwendung mit SBD. Es wird empfohlen, diese Verfahren nur für Testzwecke zu verwenden. Bevor Sie iSCSI in einer Produktionsumgebung einsetzen, lesen Sie <link xlink:href="https://documentation.suse.com/sles/html/SLES-all/cha-iscsi.html">
    Storage Administration Guide for SUSE Linux Enterprise Server</link>.
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
 </info>

 <itemizedlist>
  <title>Anforderungen</title>
  <listitem>
   <para>
    Ein virtueller SUSE Linux Enterprise Server-Rechner, der als iSCSI-Ziel fungiert. Dieser virtuelle Rechner ist nicht Teil des Clusters.
   </para>
  </listitem>
  <listitem>
   <para>
    Zwei virtuelle Speichergeräte auf der VM: ein 20-GB-Gerät für das System und ein 1-GB-Gerät für SBD.
   </para>
  </listitem>
  <listitem>
   <para>
    Zwei SUSE Linux Enterprise Server-Knoten, die noch nicht zu einem Hochverfügbarkeits-Cluster hinzugefügt wurden.
   </para>
  </listitem>
 </itemizedlist>

 <para>
  Richten Sie zunächst ein iSCSI-Ziel auf dem virtuellen Rechner ein:
 </para>

 <procedure xml:id="pro-iscsi-for-sbd-target">
  <title>Konfigurieren eines iSCSI-Ziels</title>
  <step>
   <para>
    Installieren Sie das Paket <package>yast2-iscsi-lio-server</package>:
   </para>
<screen><prompt role="root"># </prompt><command>zypper install yast2-iscsi-lio-server</command></screen>
  </step>
  <step>
   <para>
    Starten Sie das Modul <literal>iscsi-lio-server</literal> in YaST:
   </para>
<screen><prompt role="root"># </prompt><command>yast2 iscsi-lio-server</command></screen>
  </step>
  <step>
   <para>
    Wählen Sie auf der Registerkarte <guimenu>Dienst</guimenu> unter <guimenu>Nach dem Neustart</guimenu> die Option <guimenu>Beim Booten starten</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Aktivieren Sie <guimenu>Firewall-Port öffnen</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Aktivieren Sie auf der Registerkarte <guimenu>Ermittlung</guimenu> die Option <guimenu>Discovery-Authentifizierung</guimenu>.
    </para>
   </step>
  <step>
   <para>
    Geben Sie unter <guimenu>Authentifizierung von Zielen</guimenu> einen <guimenu>Benutzernamen</guimenu> und ein <guimenu>Passwort</guimenu> ein
   </para>
  </step>
  <step>
   <para>
    Geben Sie unter <guimenu>Authentifizierung durch Initiatoren</guimenu> einen <guimenu>gemeinsamen Benutzernamen</guimenu> und ein <guimenu>gemeinsames Passwort</guimenu> ein. Dieses Passwort muss sich von dem für <guimenu>Authentifizierung von Zielen</guimenu> angegebenen Passwort unterscheiden.
   </para>
  </step>
  <step>
   <para>
    Wählen Sie auf der Registerkarte <guimenu>Ziel</guimenu> die Option <guimenu>Hinzufügen</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Ändern Sie den Namen für das <guimenu>Ziel</guimenu>, indem Sie <literal>.com.example</literal> ersetzen.
   </para>
  </step>
  <step>
   <para>
    Fügen Sie die <guimenu>IP-Adresse</guimenu> des Servers hinzu.
   </para>
  </step>
  <step>
   <para>
    Wählen Sie <guimenu>Hinzufügen</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Geben Sie im Fenster <guimenu>LUN-Details</guimenu> den <guimenu>LUN-Pfad</guimenu> zum Speichermedium mit 1 GB Speicherplatz ein (beispielsweise <filename>/dev/vbd</filename>).
   </para>
  </step>
  <step>
   <para>
    Klicken Sie auf <guimenu>OK</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Wählen Sie <guimenu>Weiter</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Wählen Sie <guimenu>Beenden</guimenu>, um YaST zu schließen.
   </para>
  </step>
  <step>
   <para>
    Wechseln Sie zur Kommandozeilenschnittstelle des Ziels, um die Einrichtung des Ziels zu überprüfen:
   </para>
<screen><prompt role="root"># </prompt><command>targetcli</command></screen>
   <para>
    Zeigen Sie die Konfiguration an:
   </para>
<screen><prompt>/&gt; </prompt><command>ls</command></screen>
  </step>
 </procedure>

 <para>
  Richten Sie als Nächstes die iSCSI-Initiatoren auf den Knoten ein. Wiederholen Sie dieses Verfahren auf beiden Knoten:
 </para>

 <procedure xml:id="pro-iscsi-for-sbd-clients">
  <title>Konfigurieren eines iSCSI-Initiators</title>
  <step>
   <para>
    Installieren Sie das Paket <package>yast2-iscsi-client</package>:
   </para>
<screen><prompt role="root"># </prompt><command>zypper install yast2-iscsi-client</command></screen>
  </step>
  <step>
   <para>
    Starten Sie den Dienst <literal>iscsid</literal>:
   </para>
<screen><prompt role="root"># </prompt><command>systemctl start iscsid</command></screen>
  </step>
  <step>
   <para>
    Öffnen Sie das Modul <literal>iscsi-client</literal> in YaST:
   </para>
<screen><prompt role="root"># </prompt><command>yast2 iscsi-client</command></screen>
  </step>
  <step>
   <para>
    Wählen Sie auf der Registerkarte <guimenu>Ermittelte Ziele</guimenu> die Option <guimenu>Ermittlung</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Geben Sie die IP-Adresse des iSCSI-Ziels ein.
   </para>
  </step>
  <step>
   <para>
    Löschen Sie <guimenu>Keine Discovery-Authentifizierung</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Geben Sie unter <guimenu>Authentifizierung durch Initiatoren</guimenu> den Initiator-<guimenu>Benutzernamen</guimenu> und das <guimenu>Passwort</guimenu> ein.
   </para>
  </step>
  <step>
   <para>
    Geben Sie unter <guimenu>Authentifizierung von Zielen</guimenu> den Ziel-<guimenu>Benutzernamen</guimenu> und das <guimenu>Passwort</guimenu> ein.
   </para>
  </step>
  <step>
   <para>
    Wählen Sie <guimenu>Weiter</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Nachdem YaST das iSCSI-Ziel ermittelt hat, wählen Sie <guimenu>Verbinden</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Wählen Sie unter <guimenu>Start</guimenu> die Option <guimenu>Beim Booten</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Wählen Sie <guimenu>Weiter</guimenu>.
   </para>
  </step>
  <step>
   <para>
    Wählen Sie <guimenu>OK</guimenu>, um YaST zu schließen.
   </para>
  </step>
  <step>
   <para>
    Prüfen Sie den iSCSI-Initiator:
   </para>
<screen><prompt role="root"># </prompt><command>lsscsi</command>
[0:0:1:0] cd/dvd QEMU QEMU DVD-ROM 2.5+ /dev/sr0
[2:0:0:0] disk LIO-ORG IBLOCK 4.0 /dev/sda</screen>
   <para>
    Suchen Sie nach einer Zeile mit <literal>IBLOCK</literal>. In diesem Beispiel handelt es sich um das iSCSI-Gerät <literal>/dev/sda</literal>.
   </para>
  </step>
  <step>
   <para>
    Prüfen Sie den Status des Diensts <literal>iscsid</literal>:
   </para>
<screen><prompt role="root"># </prompt><command>systemctl status iscsid</command></screen>
  </step>
 </procedure>

 <para>
  Sie finden den festen Gerätenamen in <filename>/dev/disk/by-id/</filename>. Normalerweise beginnt der Name eines iSCSI-Geräts mit <literal>scsi-SLIO-ORG_IBLOCK</literal>.
 </para>
 <para>
  Wenn Sie über mehrere Datenträger verfügen, können Sie den Befehl <command>lsblk -o name,serial</command> ausführen, um zu überprüfen, welcher stabile Gerätename welchem Kurznamen entspricht (z. B. <filename>/dev/sda</filename>).
 </para>
 <para>
  Wenn Sie den Cluster konfigurieren, geben Sie den festen Gerätenamen mit einer der folgenden Methoden an:
 </para>
 <itemizedlist>
  <listitem>
   <para>
    Wenn Sie <command>crm cluster init</command> ausführen, geben Sie den festen Gerätenamen ein, sobald Sie dazu aufgefordert werden.
   </para>
  </listitem>
  <listitem>
   <para>
    Bevor Sie <command>crm cluster init</command> ausführen, fügen Sie den festen Gerätenamen in <filename>/etc/sysconfig/sbd</filename> hinzu:
   </para>
<screen>SBD_DEVICE=/dev/disk/by-id/scsi-SLIO-ORG_IBLOCK_<replaceable>DEVICE_ID_STRING</replaceable></screen>
   <para>
    Wenn Sie <command>crm cluster init</command> ausführen, beantworten Sie folgende Frage mit <literal>n</literal>:
   </para>
<screen>SBD is already configured to use /dev/disk/by-id/scsi-SLIO-ORG_IBLOCK_... - overwrite (y/n)?</screen>
  </listitem>
 </itemizedlist>
</appendix>
