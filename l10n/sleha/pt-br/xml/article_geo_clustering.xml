<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook50-profile.xsl"
  type="text/xml"
  title="Profiling step"?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:its="http://www.w3.org/2005/11/its" xmlns:dm="urn:x-suse:ns:docmanager" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="article_geo_clustering.xml" version="5.2" xml:lang="pt-br" xml:id="article-geo-clustering">
 <title>Inicialização Rápida de Clustering Geo</title>
 <info>
  <productnumber>15 SP7</productnumber>
  <productname>SUSE Linux Enterprise High Availability</productname>
  <date><?dbtimestamp format="d de B de Y"?>
</date>
  <xi:include href="common_copyright_gfdl.xml"/>
  <abstract>
   <para>
     O Geo Clustering protege as cargas de trabalho nos data centers distribuídos globalmente. Este documento orienta você na configuração básica de um cluster Geográfico usando os scripts de boot Geo incluídos no crm shell.
   </para>
  </abstract>
  <dm:docmanager>
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <meta name="title" its:translate="yes">Inicialização Rápida de Clustering Geo</meta>
  <meta name="series" its:translate="no">Products &amp; Solutions</meta>
  <meta name="description" its:translate="yes">Como executar a configuração básica de um cluster Geo usando os scripts de boot Geo incluídos no shell crm</meta>
  <meta name="social-descr" its:translate="yes">Configurar um cluster Geo</meta>
  <meta name="task" its:translate="no">
    <phrase>Installation</phrase>
    <phrase>Administration</phrase>
    <phrase>Clustering</phrase>
  </meta> <revhistory xml:id="rh-article-geo-clustering">
    <revision>
      <date>2025-06-17</date>
      <revdescription>
        <para>
          Updated for the initial release of SUSE Linux Enterprise High Availability 15 SP7.
        </para>
      </revdescription>
    </revision>
   </revhistory>
  </info>

 <sect1 xml:id="sec-ha-geo-quick-concept">
  <title>Visão geral conceitual</title>

  <para>
   Os clusters geográficos baseados no SUSE® Linux Enterprise High Availability podem ser considerados clusters <quote>sobrepostos</quote>, em que cada site do cluster corresponde a um nó em um cluster tradicional. O cluster sobreposto é administrado pelo gerenciador de tickets de cluster de booth (mencionado a seguir como booth). Cada uma das partes envolvidas em um cluster Geográfico executa um serviço, o <systemitem class="daemon">boothd</systemitem>. Ele se conecta aos daemons de booth executados em outros sites e troca detalhes de conectividade. Para tornar os recursos de cluster altamente disponíveis em todos os sites, o booth usa como base objetos do cluster denominados tickets. Um ticket concede o direito de executar determinados recursos em um site de cluster específico. O booth garante que cada ticket seja concedido a, no máximo, um site por vez.
  </para>
  <para>
   Se a comunicação entre duas instâncias de booth for interrompida, talvez seja por uma falha na rede entre os sites do cluster <emphasis>ou</emphasis> uma interrupção de um site do cluster. Neste caso, é necessária uma instância adicional (um terceiro site do cluster ou um <literal>arbitrator</literal>) para chegar a um consenso sobre as decisões (por exemplo, failover de recursos em todos os sites). Arbitradores são máquinas únicas (fora dos clusters) que executam uma instância de booth em um modo especial. Cada cluster Geográfico pode ter um ou vários arbitradores.
  </para>

  <para>
   <remark>toms 2017-07-04: for the future: maybe also add example IP addresses
    to graphic (node IPs, VIPs for cluster sites)
    </remark> <remark>taroth 2017-12-29: FATE#322100 - adjust graphic in case two sites
   *without* arbitrator becomes the default setup? (c#6)
   </remark>
  </para>

  <figure xml:id="fig-ha-geo-quick-example-geosetup">
   <title>Cluster de dois sites — 2x2 nós + arbitrador (opcional)</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ha_geocluster.svg" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ha_geocluster.png" width="85%"/>
    </imageobject>
    <textobject role="description">
      <phrase> Este diagrama mostra o Site A e o Site B conectados por UDP. Cada site também está conectado ao Site C (o arbitrador). </phrase>
    </textobject>
   </mediaobject>
  </figure>

  <para>
   É possível também executar um cluster geográfico de dois sites <emphasis>sem</emphasis> um arbitrador. Nesse caso, um administrador de cluster Geográfico precisa gerenciar manualmente os tickets. Se for necessário conceder um ticket a mais de um site ao mesmo tempo, o booth exibirá um aviso.
  </para>

  <para>
   Para obter mais detalhes sobre o conceito, os componentes e o gerenciamento de tickets usados para clusters Geográficos, consulte o <xref linkend="book-administration"/>.
  </para>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-scenario">
  <title>Cenário de uso</title>

  <para>
   Os procedimentos neste documento orientam em relação a um cluster Geográfico básico com dois sites e um arbitrador:
  </para>

  <itemizedlist>
   <listitem>
    <para>
     Vamos supor que os nomes dos sites do cluster são <literal>amsterdam</literal> e <literal>berlin</literal>.
    </para>
   </listitem>
   <listitem>
    <para>
     Imagine que cada site tenha dois nós. Os nós <literal>alice</literal> e <literal>bob</literal> pertencem ao cluster <literal>amsterdam</literal>. Os nós <literal>charlie</literal> e <literal>doro</literal> pertencem ao cluster <literal>berlin</literal>.
    </para>
   </listitem>
   <listitem>
    <para>
     O site <literal>amsterdam</literal> tem o seguinte endereço IP virtual: <literal>192.168.201.100</literal>.
    </para>
   </listitem>
   <listitem>
    <para>
     O site <literal>berlin</literal> tem o seguinte endereço IP virtual: <literal>192.168.202.100</literal>.
    </para>
   </listitem>
   <listitem>
    <para>
     <remark>taroth 2017-12-29: FATE#322100 - move to Geo Guide? (c#6)</remark> Suponha que o arbitrador tenha o seguinte endereço IP: <literal>192.168.203.100</literal>.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Antes de prosseguir, verifique se os seguintes requisitos foram atendidos:
  </para>

  <variablelist>
   <title>Requisitos</title>
   <varlistentry>
    <term>Dois clusters existentes</term>
    <listitem>
     <para>
      Você tem pelo menos dois clusters existentes que deseja combinar em um cluster Geográfico (se você precisar configurar dois clusters primeiro, siga as instruções no <xref linkend="article-installation"/>).
      </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Nomes de cluster significativos</term>
    <listitem>
     <para>
      Cada cluster tem um nome significativo que reflete sua localização, por exemplo: <literal>amsterdam</literal> e <literal>berlin</literal>. Os nomes de cluster são definidos em <filename>/etc/corosync/corosync.conf</filename>.
     </para>
   </listitem>
   </varlistentry>
   <varlistentry>
    <term>Arbitrador</term>
    <listitem>
     <para><remark>taroth 2017-12-29: FATE#322100 - move to Geo Guide? (see
     c#6)</remark> Você instalou uma terceira máquina que não faz parte de nenhum cluster existente e deve ser usada como arbitrador.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Para obter os requisitos detalhados de cada item, consulte também a <xref linkend="sec-ha-geo-quick-req"/>.
  </para>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-req">
  <title>Requisitos</title>
   <para>
    Todas as máquinas (nós do cluster e arbitradores) precisam, no mínimo, dos seguintes módulos e extensões:
   </para>

<itemizedlist>
   <listitem>
    <para>Módulo Basesystem 15 SP7</para>
   </listitem>
   <listitem>
    <para>Módulo Server Applications 15 SP7</para>
   </listitem>
   <listitem>
    <para>SUSE Linux Enterprise High Availability 15 SP7</para>
   </listitem>
  </itemizedlist>
  <para>
   Ao instalar as máquinas, selecione <literal>HA GEO Node</literal> como a <systemitem>system role</systemitem>. Esse procedimento leva à instalação de um sistema mínimo em que os pacotes do padrão <literal>Geo Clustering
   for High Availability (ha_geo)</literal> são instalados por padrão.
  </para>
  <itemizedlist>
   <title>Requisitos de rede</title>
   <listitem>
   <para>
    Os IPs virtuais a serem usados para cada site do cluster devem estar acessíveis no cluster Geográfico.
   </para>
  </listitem>
   <listitem>
   <para>
     Os sites devem ser acessíveis em uma porta UDP e TCP por instância de booth. Isso significa que qualquer firewall ou túnel IPsec intermediário deve ser configurado adequadamente.
    </para>
   </listitem>
   <listitem>
    <para>
     Outras decisões de configuração podem exigir a abertura de mais portas (por exemplo, para replicação de banco de dados ou do DRBD).
    </para>
   </listitem>
  </itemizedlist>

  <itemizedlist>
  <title>Outros requisitos e recomendações</title>
  <listitem>
   <para>
    Todos os nós do cluster em todos os sites devem ser sincronizados com um servidor NTP fora do cluster. Para obter mais informações, consulte o <link xlink:href="https://documentation.suse.com/sles-15/html/SLES-all/cha-ntp.html"> Guia de Administração do SUSE Linux Enterprise Server 15 SP7</link>.
   </para>
   <para>
    Se os nós não estiverem sincronizados, será muito difícil de analisar os arquivos de registro e os relatórios do cluster.
   </para>
  </listitem>
  <listitem>
   <para>
    Use um número <emphasis>ímpar</emphasis> de sites no cluster geográfico. Em caso de falha na conexão de rede, esse procedimento garante que ainda exista a maioria dos sites (para evitar um cenário split-brain). Se você tem um número par de sites de cluster, use um arbitrador para processar o failover automático dos tickets. Se você não usar um arbitrador, precisará gerenciar o failover dos tickets manualmente.
   </para>
  </listitem>
  <listitem>
   <para>
    O cluster em cada site tem um nome significativo, por exemplo: <literal>amsterdam</literal> e <literal>berlin</literal>.
   </para>
   <para>
    Os nomes dos clusters para cada site são definidos nos respectivos arquivos <filename>/etc/corosync/corosync.conf</filename>:
   </para>
<screen>totem {
    [...]
    cluster_name: amsterdam
    }
</screen>
   <para>
    Mude o nome com o seguinte comando crmsh:
   </para>
<screen><prompt role="root"># </prompt><command>crm cluster rename <replaceable>NEW_NAME</replaceable></command></screen>
   <para>
    Pare e inicie os serviços do cluster para as mudanças entrarem em vigor:
   </para> <screen><prompt role="root"># </prompt><command>crm cluster restart</command></screen>
  </listitem>
 <listitem>
   <para>
     Não há suporte para arquiteturas mistas em um cluster. No entanto, cada membro do cluster Geográfico pode ter uma arquitetura diferente, seja um site de cluster ou um arbitrador. Por exemplo, você pode executar um cluster Geo com três membros (dois sites de cluster e um arbitrador), em que um site de cluster é executado no IBM Z, o outro site de cluster é executado em x86 e o arbitrador é executado no POWER.
   </para>
 </listitem>
</itemizedlist>

 </sect1>
 <sect1 xml:id="sec-ha-geo-scripts">
  <title>Visão geral dos scripts de boot Geo</title>
  <itemizedlist>
   <listitem>
    <para>
     Com o <command>crm cluster geo_init</command>, transforme um cluster no primeiro site de um cluster Geográfico. O script usa parâmetros, como os nomes dos clusters, o arbitrador e um ou vários tickets, e cria o arquivo <filename>/etc/booth/booth.conf</filename> com base neles. Ele copia a configuração de booth para todos os nós no site do cluster atual. Ele também configura os recursos de cluster necessários para o booth no site do cluster atual.
    </para>
    <para>
     Para obter os detalhes, consulte a <xref linkend="sec-ha-geo-quick-crm-cluster-geo-init"/>.
    </para>
   </listitem>
   <listitem>
    <para>
     Com o <command>crm cluster geo_join</command>, adicione o cluster atual a um cluster Geográfico existente. O script copia a configuração de booth de um site do cluster existente e grava-a no <filename>/etc/booth/booth.conf</filename> em todos os nós no site do cluster atual. Ele também configura os recursos de cluster necessários para o booth no site do cluster atual.
    </para>
    <para>
     Para obter os detalhes, consulte a <xref linkend="sec-ha-geo-quick-crm-cluster-geo-join"/>.
    </para>
   </listitem>
   <listitem>
    <para>
     Com o <command>crm cluster geo_init_arbitrator</command>, transforme a máquina atual em um arbitrador para o cluster Geográfico. O script copia a configuração de booth de um site do cluster existente e grava-a no <filename>/etc/booth/booth.conf</filename>.
    </para>
    <para>
     Para obter os detalhes, consulte a <xref linkend="sec-ha-geo-quick-crm-cluster-geo-init-arbitrator"/>.
    </para>
   </listitem>
  </itemizedlist>

  <para>
   Todos os scripts de boot são registrados em <filename>/var/log/crmsh/crmsh.log</filename>. Consulte o arquivo de registro para obter todos os detalhes do processo de boot. Quaisquer opções definidas durante o processo de boot podem ser modificadas posteriormente (modificando configurações de booth, recursos, etc.). Para obter os detalhes, consulte a <xref linkend="book-administration"/>.
  </para>
 </sect1>

 <sect1 xml:id="sec-ha-geo-quick-inst">
  <title>Instalando os pacotes de High Availability e Geo Clustering</title>
  <para>
   Os pacotes para configurar e gerenciar um cluster Geográfico estão incluídos nos padrões de instalação <literal>High Availability</literal> e <literal>Geo Clustering for High Availability</literal>. Esses padrões estarão disponíveis somente após a instalação do SUSE Linux Enterprise High Availability.
  </para>
  <para>
   Você pode se registrar no SUSE Customer Center e instalar o SUSE Linux Enterprise High Availability durante ou após a instalação do SUSE Linux Enterprise Server. Para obter mais informações, consulte o <link xlink:href="https://documentation.suse.com/sles/html/SLES-all/cha-register-sle.html"> Guia de Implantação</link> do SUSE Linux Enterprise Server.
  </para>
  <procedure xml:id="pro-ha-geo-quick-inst-pattern">
   <title>Instalando os padrões High Availability e Geo Clustering</title>
   <step>
    <para>
     Instale os padrões High Availability e Geo Clustering pela linha de comando:</para>
<screen><prompt role="root"># </prompt><command>zypper install -t pattern ha_sles ha_geo</command></screen>
   </step>
   <step>
    <para>
       Instale os padrões Alta Disponibilidade e Geo Clustering em <emphasis>todas</emphasis> as máquinas que farão parte do cluster.
    </para>
    <note>
     <title>Instalando pacotes de software em todos os nós</title>
     <para>
      Para instalação automatizada do SUSE Linux Enterprise Server 15 SP7 e do SUSE Linux Enterprise High Availability 15 SP7, use o AutoYaST para clonar os nós existentes. Para obter mais informações, consulte <xref linkend="sec-ha-installation-autoyast"/>. 
     </para>
    </note>
   </step>
 </procedure>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-crm-cluster-geo-init">
  <title>Configurando o primeiro site de um cluster Geográfico</title>

  <para>
   Use o comando <command>crm cluster geo_init</command> para transformar um cluster existente no primeiro site de um cluster Geográfico.
  </para>

  <procedure xml:id="pro-ha-geo-quick-crm-cluster-geo-init">
   <title>Configurando o primeiro site (<systemitem>amsterdam</systemitem>) com <command>crm cluster geo_init</command></title>
   <step>
    <para>
     Defina um IP virtual por site do cluster que pode ser usado para acessar o site. Consideramos que <literal>192.168.201.100</literal> e <literal>192.168.202.100</literal> são usados para esta finalidade. Você ainda não precisa configurar os IPs virtuais como recursos de cluster. Isso é feito pelos scripts de boot.
    </para>
   </step>
   <step>
    <para>
     Defina o nome de pelo menos um ticket que concede o direito de executar determinados recursos em um site do cluster. Use um nome significativo que corresponda aos recursos que dependem do ticket (por exemplo, <literal>ticket-nfs</literal>). Os scripts de boot precisam apenas do nome do ticket. Você pode definir os detalhes restantes (dependências de ticket dos recursos) posteriormente, conforme descrito na <xref linkend="sec-ha-geo-quick-next"/>.
    </para>
   </step>
   <step>
    <para>
     Efetue login no nó de um cluster existente (por exemplo, no nó <literal>alice</literal> do cluster <literal>amsterdam</literal>).
    </para>
   </step>
   <step xml:id="st-crm-cluster-geo-init">
    <para>
     Executar <command>crm cluster geo_init</command>. Por exemplo, use as seguintes opções: <remark>taroth 2017-12-29: FATE#322100 - remove the --arbitrator option?
     (see c#6)</remark>
    </para>
<screen><prompt role="root"># </prompt><command>crm cluster geo_init \
  --clusters "amsterdam=192.168.201.100 berlin=192.168.202.100" \</command><co xml:id="co-geo-init-clusters"/>
  <command>--tickets ticket-nfs \</command><co xml:id="co-geo-init-ticket"/>
  <command>--arbitrator 192.168.203.100</command><co xml:id="co-geo-init-arbitrator"/></screen>
    <calloutlist>
     <callout arearefs="co-geo-init-clusters">
       <para>
    Os nomes dos sites do cluster (conforme definido em <filename>/etc/corosync/corosync.conf</filename>) e os endereços IP virtuais que você deseja usar para cada site do cluster. Neste caso, temos dois sites do cluster (<literal>amsterdam</literal> e <literal>berlin</literal>), cada um com um endereço IP virtual.
   </para>
     </callout>
     <callout arearefs="co-geo-init-ticket">
      <para>
       O nome de um ou vários tickets.
      </para>
     </callout>
     <callout arearefs="co-geo-init-arbitrator">
      <para>
       O nome de host ou endereço IP de uma máquina fora dos clusters.
      </para>
     </callout>
    </calloutlist>
   </step>
  </procedure>

  <para>
   O script de boot cria o arquivo de configuração de booth e o sincroniza com os sites do cluster. Ele também cria os recursos básicos de cluster necessários para o booth. <xref linkend="st-crm-cluster-geo-init" xrefstyle="seletc:label"/> de <xref linkend="pro-ha-geo-quick-crm-cluster-geo-init" xrefstyle="select:label"/> resulta na seguinte configuração de booth e nos recursos de cluster: <remark>taroth 2017-12-29: FATE#322100 - remove the arbitrator entry? (c#6)</remark>
  </para>

  <example xml:id="ex-geo-init-booth-conf">
   <title>Configuração de booth criada por <command>crm cluster geo_init</command></title>
<screen># The booth configuration file is "/etc/booth/booth.conf". You need to
# prepare the same booth configuration file on each arbitrator and
# each node in the cluster sites where the booth daemon can be launched.

# "transport" means which transport layer booth daemon will use.
# Currently only "UDP" is supported.
transport="UDP"
port="9929"

arbitrator="192.168.203.100"
site="192.168.201.100"
site="192.168.202.100"
authfile="/etc/booth/authkey"
ticket="ticket-nfs"
expire="600"</screen>
  </example>

  <example xml:id="ex-geo-init-rsc-conf">
   <title>Recursos de cluster criados por <command>crm cluster geo_init</command></title>
<screen>primitive<co xml:id="co-geo-quick-rsc-booth-ip"/> booth-ip IPaddr2 \
  params rule #cluster-name eq amsterdam ip=192.168.201.100 \
  params rule #cluster-name eq berlin ip=192.168.202.100 \
primitive<co xml:id="co-geo-quick-rsc-booth-site"/> booth-site ocf:pacemaker:booth-site \
  meta resource-stickiness=INFINITY \
  params config=booth \
  op monitor interval=10s
group<co xml:id="co-geo-quick-rsc-g-booth"/> g-booth booth-ip booth-site \
meta target-role=Stopped<co xml:id="co-geo-quick-rsc-stopped"/></screen>
   <calloutlist>
    <callout arearefs="co-geo-quick-rsc-booth-ip">
     <para>
      Um endereço IP virtual para cada site do cluster. Os daemons de booth exigem essa informação, pois precisam de um endereço IP persistente em cada site do cluster.
     </para>
    </callout>
    <callout arearefs="co-geo-quick-rsc-booth-site">
     <para>
      Um recurso primitivo para o daemon de booth. Ele se comunica com os daemons de booth nos outros sites do cluster. O daemon pode ser iniciado em qualquer nó do site. Para fazer com que o recurso permaneça no mesmo nó, se possível, resource-stickiness foi definido como <literal>INFINITY</literal>.
     </para>
    </callout>
    <callout arearefs="co-geo-quick-rsc-g-booth">
     <para>
      Um grupo de recursos de cluster para ambos os primitivos. Com essa configuração, cada daemon de booth está disponível em seu endereço IP individual, independentemente do nó em que o daemon é executado.
     </para>
    </callout>
    <callout arearefs="co-geo-quick-rsc-stopped">
     <para>
      O grupo de recursos de cluster não é iniciado por padrão. Depois de verificar a configuração de recursos de cluster (e adicionar os recursos necessários para concluir a configuração), você precisará iniciar o grupo de recursos. Consulte <xref linkend="vl-ha-geo-quick-next-req"/> para obter os detalhes.
     </para>
    </callout>
   </calloutlist>
  </example>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-crm-cluster-geo-join">
  <title>Adicionando outro site a um cluster Geográfico</title>

  <para>
   Depois de inicializar o primeiro site do cluster Geográfico, adicione o segundo cluster com <literal>crm cluster geo_join</literal>, conforme descrito no <xref linkend="pro-ha-geo-quick-crm-cluster-geo-join" xrefstyle="select:label"/>. O script precisa de acesso SSH a um site do cluster já configurado e adiciona o cluster atual ao cluster Geográfico.
  </para>

  <procedure xml:id="pro-ha-geo-quick-crm-cluster-geo-join">
   <title>Adicionando o segundo site (<literal>berlin</literal>) com <command>crm cluster geo_join</command></title>
   <step>
    <para>
     Efetue login no nó do site do cluster que você deseja adicionar (por exemplo, no nó <literal>charlie</literal> do cluster <literal>berlin</literal>).
    </para>
   </step>
   <step xml:id="st-crm-cluster-geo-join">
    <para>
     Execute o comando <command>crm cluster geo_join</command>. Por exemplo:
    </para>
<screen><prompt role="root"># </prompt><command>crm cluster geo_join \
  --cluster-node 192.168.201.100\</command><co xml:id="co-geo-join-cluster-node"/>
  <command>--clusters "amsterdam=192.168.201.100 berlin=192.168.202.100"</command><co xml:id="co-geo-join-clusters"/>
     </screen>
    <calloutlist>
     <callout arearefs="co-geo-join-cluster-node">
      <para>
       Especifica de onde copiar a configuração de booth. Use o nome de host ou endereço IP de um nó em um site do cluster Geográfico já configurado. Você também pode usar o endereço IP virtual de um site do cluster existente (como neste exemplo). Como alternativa, use o nome de host ou endereço IP de um arbitrador já configurado para o cluster Geográfico.
      </para>
     </callout>
     <callout arearefs="co-geo-join-clusters">
       <para>
    Os nomes dos sites do cluster (conforme definido em <filename>/etc/corosync/corosync.conf</filename>) e os endereços IP virtuais que você deseja usar para cada site do cluster. Neste caso, temos dois sites do cluster (<literal>amsterdam</literal> e <literal>berlin</literal>), cada um com um endereço IP virtual.
   </para>
     </callout>
    </calloutlist>
   </step>
  </procedure>

  <para>
   O comando <command>crm cluster geo_join</command> copia a configuração de booth de <xref linkend="co-geo-join-cluster-node" xrefstyle="select:label"/>. Consulte o <xref linkend="ex-geo-init-booth-conf" xrefstyle="select:label"/>. Além disso, ele cria os recursos de cluster necessários para o booth (consulte o <xref linkend="ex-geo-init-rsc-conf" xrefstyle="select:label"/>).
  </para>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-crm-cluster-geo-init-arbitrator">
  <title>Adicionando o arbitrador</title>

  <para>
   <remark>taroth 2017-12-29: FATE#322100 - move this section to Geo Guide? (c#6)</remark> Após configurar todos os sites do cluster geográfico com <command>crm cluster geo_init</command> e <command>crm cluster geo_join</command>, configure o arbitrador com <command>crm cluster geo_init_arbitrator</command>.
  </para>

  <procedure xml:id="pro-ha-geo-quick-crm-cluster-geo-init-arbitrator">
   <title>Configurando o arbitrador com <command>crm cluster geo_init_arbitrator</command></title>
   <step>
    <para>
     Efetue login na máquina que você deseja usar como arbitrador.
    </para>
   </step>
   <step>
    <para>
     Execute o seguinte comando. Por exemplo:
    </para>
<screen><prompt role="root"># </prompt><command>crm cluster geo_init_arbitrator --cluster-node 192.168.201.100</command><co xml:id="co-geo-init-arbitrator-cluster-node"/></screen>
    <calloutlist>
     <callout arearefs="co-geo-init-arbitrator-cluster-node">
      <para>
       Especifica de onde copiar a configuração de booth. Use o nome de host ou endereço IP de um nó em um site do cluster Geográfico já configurado. Se preferir, use o endereço IP virtual de um site do cluster existente (como neste exemplo).
      </para>
     </callout>
    </calloutlist>
   </step>
  </procedure>

  <para>
   O script <command>crm cluster geo_init_arbitrator</command> copia a configuração de booth de <xref linkend="co-geo-init-arbitrator-cluster-node"/>. Consulte o <xref linkend="ex-geo-init-booth-conf" xrefstyle="select:label"/>. Ele também habilita e inicia o serviço de booth no arbitrador. Dessa forma, o arbitrador está pronto para se comunicar com as instâncias de booth nos sites do cluster quando os serviços de booth também são executados neles.
  </para>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-monitor">
  <title>Monitorando os sites do cluster</title>

  <para>
   Para ver os dois sites do cluster com os recursos e o ticket que você criou durante o processo de boot, use o Hawk2. A interface da Web do Hawk2 permite monitorar e gerenciar vários clusters (não relacionados) e clusters Geo.
  </para>

  <itemizedlist>
   <title>Pré-requisitos</title>
   <listitem>
    <para>
     Todos os clusters que serão monitorados pelo <guimenu>Painel</guimenu> do Hawk2 devem executar o SUSE Linux Enterprise High Availability 15 SP7.
    </para>
   </listitem>
   <listitem>
    <para>
     Se você ainda não substituiu o certificado autoassinado do Hawk2 em cada nó do cluster pelo seu próprio certificado (ou um certificado assinado por uma Autoridade de Certificação oficial), faça o seguinte: efetue login no Hawk2 em <emphasis>cada</emphasis> nó em <emphasis>cada</emphasis> cluster pelo menos uma vez. Verifique o certificado (ou adicione uma exceção ao browser para ignorar o aviso). Do contrário, o Hawk2 não poderá se conectar ao cluster.
    </para>
   </listitem>
  </itemizedlist>

  <procedure xml:id="pro-ha-geo-quick-hawk2-dashboard">
   <title>Usando o painel de controle do Hawk2</title>
   <step>
    <para>
     Inicie um browser da Web e insira o IP virtual do seu primeiro site do cluster, <literal>amsterdam</literal>:
    </para>
<screen>https://192.168.201.100:7630/</screen>
    <para>
     Se preferir, use o nome de host ou endereço IP de <literal>alice</literal> ou <literal>bob</literal>. Se você configurou ambos os nós com os scripts de boot, o serviço <literal>hawk</literal> deve ser executado em ambos os nós.
    </para>
   </step>
   <step>
    <para>
     Efetue login na interface da Web do Hawk2.
    </para>
   </step>
   <step>
    <para>
     Na barra de navegação esquerda, selecione <guimenu>Painel</guimenu>.
    </para>
    <para>
     O Hawk2 mostra uma visão geral dos recursos e nós no site do cluster atual. Ele também mostra os <guimenu>Tíquetes</guimenu> que foram configurados para o cluster geográfico. Se você precisar de informações sobre os ícones usados nesta tela, clique em <guimenu>Legenda</guimenu>.
    </para>
    <figure>
     <title>Painel de controle do Hawk2 com um site do cluster (<literal>amsterdam</literal>)</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="hawk2-dashboard-site1.png" width="100%"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="hawk2-dashboard-site1.png" width="95%"/>
      </imageobject>
      <textobject role="description">
        <phrase> Este painel de exemplo mostra um site do cluster (<literal>amsterdam</literal>) com dois nós: <literal>alice</literal> e <literal>bob</literal>. </phrase>
      </textobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     Para adicionar um painel ao segundo site do cluster, clique em <guimenu>Adicionar Cluster</guimenu>.
    </para>
    <substeps>
     <step>
      <para>
       Insira o <guimenu>Nome do cluster</guimenu> para identificá-lo no <guimenu>Painel</guimenu>. Neste caso, <literal>berlin</literal>.
      </para>
     </step>
     <step>
      <para>
       Insira o nome completo do host de um dos nós do cluster (neste caso, <literal>charlie</literal> ou <literal>doro</literal>).
      </para>
     </step>
     <step>
      <para>
       Clique em <guimenu>Adicionar</guimenu>. O Hawk2 exibe uma segunda guia para o site do cluster recém-adicionado com uma visão geral de seus nós e recursos.
      </para>
      <figure>
       <title>Painel de controle do Hawk2 com os dois sites do cluster</title>
       <mediaobject>
        <imageobject role="fo">
         <imagedata fileref="hawk2-dashboard-two-sites.png" width="100%"/>
        </imageobject>
        <imageobject role="html">
         <imagedata fileref="hawk2-dashboard-two-sites.png" width="95%"/>
        </imageobject>
        <textobject role="description">
          <phrase> Este painel de exemplo mostra dois sites do cluster. A guia do segundo site (<literal>berlin</literal>) está selecionada, mostrando dois nós: <literal>charlie</literal> e <literal>doro</literal>. </phrase>
        </textobject>
       </mediaobject>
      </figure>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     Para ver mais detalhes para um site do cluster ou para gerenciá-lo, alterne para a guia do site e clique no ícone de corrente.
    </para>
    <para>
     O Hawk2 abre a tela <guimenu>Status</guimenu> referente a esse site em uma nova janela ou guia do navegador. Neste local, você pode administrar esta parte do cluster Geográfico.
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-next">
  <title>Próximas etapas</title>

  <para>
   Os scripts de boot de cluster Geográfico são um meio rápido para configurar um cluster Geográfico básico que pode ser usado para fins de teste. No entanto, para mover o cluster Geográfico resultante para um cluster Geográfico funcional que possa ser usado em ambientes de produção, mais etapas são necessárias.
  </para>

  <variablelist xml:id="vl-ha-geo-quick-next-req">
   <title>Etapas necessárias para concluir a configuração do cluster Geográfico</title>
   <varlistentry xml:id="vle-ha-geo-quick-booth-service-sites">
    <term>Iniciando os serviços de booth nos sites do cluster</term>
    <listitem>
     <para>
      Após o processo de boot, o serviço de booth do arbitrador ainda não poderá se comunicar com os serviços de booth nos sites do cluster, porque eles não são iniciados por padrão.
     </para>
     <para>
      O serviço de booth para cada site do cluster é gerenciado pelo grupo de recursos de booth <literal>g-booth</literal> (consulte o <xref linkend="ex-geo-init-rsc-conf"/>). Para iniciar uma instância do serviço de booth por site, inicie o respectivo grupo de recursos de booth em cada site do cluster. Isso permite que todas as instâncias de booth se comuniquem umas com as outras.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Configurando dependências de ticket e restrições de pedidos</term>
    <listitem>
     <para>
      Para tornar os recursos dependentes do ticket que você criou durante o processo de boot do cluster Geográfico, configure restrições. Para cada restrição, defina uma <literal>loss-policy</literal>, que define o que deverá acontecer com os respectivos recursos se o ticket for revogado de um site do cluster.
     </para>
     <para>
      Para obter os detalhes, consulte a <xref linkend="cha-ha-geo-rsc"/>.
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Concedendo inicialmente um ticket a um site</term>
    <listitem>
     <para>
      Para que o booth possa gerenciar determinado tíquete no cluster geográfico, antes você precisa <emphasis>concedê-lo</emphasis> a um site manualmente. Você pode usar a ferramenta de linha de comando do cliente de booth ou o Hawk2 para conceder um ticket.
     </para>
     <para>
      Para obter os detalhes, consulte a <xref linkend="cha-ha-geo-manage"/>.</para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Os scripts de boot criam os mesmos recursos de booth em ambos os sites do cluster, e os mesmos arquivos de configuração de booth em todos os sites, incluindo o arbitrador. Se você estender a configuração do cluster Geo (para mover para um ambiente de produção), provavelmente ajustará a configuração de booth e também mudará a configuração dos recursos de cluster relacionados ao booth. Depois disso, será necessário sincronizar as mudanças com os outros sites do cluster Geográfico para entrarem em vigor.
  </para>

  <note>
   <title>Sincronizando mudanças com todos os sites do cluster</title>
   <itemizedlist>
    <listitem>
     <para>
      Para sincronizar as alterações na configuração de booth com todos os sites do cluster (incluindo o arbitrador), use o Csync2. Encontre mais informações no <xref linkend="cha-ha-geo-sync"/>.
     </para>
    </listitem>
    <listitem>
     <para>
      O CIB (Cluster Information Database) não é sincronizado automaticamente com todos os sites de um cluster Geográfico. Isso significa que quaisquer mudanças na configuração de recursos necessárias em todos os sites do cluster precisam ser transferidas para os outros sites manualmente. Para isso, marque os respectivos recursos, exporte-os do CIB atual e importe-os para o CIB nos outros sites do cluster. Para obter os detalhes, consulte a <xref linkend="sec-ha-geo-rsc-sync-cib"/>.
      </para>
    </listitem>
   </itemizedlist>
  </note>
 </sect1>
 <sect1 xml:id="sec-ha-geo-quick-more">
  <title>Para obter mais informações</title>
  <itemizedlist>
   <listitem>
    <para>
     Há mais documentação para este produto disponível em <link xlink:href="https://documentation.suse.com/sle-ha/"></link>.

    </para>
   </listitem>
   <listitem>
    <para>
     Para ver outras tarefas de configuração e de administração, consulte o <link xlink:href="https://documentation.suse.com/sle-ha/html/SLE-HA-all/book-administration.html"> Guia do GEO Clustering</link> completo.
    </para>
   </listitem>
  </itemizedlist>
 </sect1>
 <xi:include href="common_legal.xml"/>
</article>
