<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_migration.xml" version="5.0" xml:id="cha-ha-migration">

 <title>升級叢集和更新軟體套件</title>
 <info>
      <abstract>
        <para>
    本章介紹兩種不同的方案：將叢集升級到另一個版本的 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> (主要版本或 Service Pack)，以及更新叢集節點上的個別套件。請參閱<xref linkend="sec-ha-migration-upgrade"/>與<xref linkend="sec-ha-migration-update"/>。
   </para>
        <para>
    如果您要升級叢集，請在開始升級之前查閱<xref linkend="sec-ha-migration-upgrade-oview"/>和<xref linkend="sec-ha-migration-upgrade-require"/>。
   </para>
      </abstract>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>editing</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <sect1 xml:id="sec-ha-migration-terminology">
  <title>術語</title>

  <para>
   下面將介紹本章中使用的最重要的術語定義：
  </para>



  <variablelist>
   <varlistentry>
    <term>主要版本</term>
    <term>正式發行 (GA) 版本</term>
    <listitem>
     <para>
      主要版本是一個新的產品版本，增加了新功能和工具並停用了先前已取代的元件。其含有不可反向相容的變更。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-upgrade-offline">
    <term>叢集離線升級</term>
    <listitem>
     <para>
      如果新產品版本包含不可回溯相容的重大變更，則需要透過叢集離線升級來升級叢集。需要先將所有節點離線並將叢集做為一個整體進行升級，然後才能將所有節點恢復線上狀態。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-upgrade-rolling">
    <term>叢集滾存升級</term>
    <listitem>
     <para>
      執行叢集滾存升級時，每次會升級一個叢集節點，此時，叢集的其他節點仍在執行中。您可以將第一個節點離線，進行升級，然後再將其恢復線上狀態以加入叢集。然後，需要對每個節點重複上述程序，直到所有叢集節點都升級為主要版本。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Service Pack (SP)</term>
    <listitem>
     <para>
      將多個修補程式合併為一種易於安裝或部署的形式。Service Pack 都指定了編號，通常包含程式的安全性修正、更新、升級或增強。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>更新</term>
    <listitem>
     <para>
      安裝某個套件的較新<emphasis>次要</emphasis>版本，其中通常包含安全修復和其他重要修復。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>升級</term>
    <listitem>
     <para>
      安裝套件或套裝作業系統的較新<emphasis>主要</emphasis>版本，會引入<emphasis>新功能</emphasis>。另請參閱<xref linkend="vle-upgrade-offline"/>與<xref linkend="vle-upgrade-rolling"/>。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
 <sect1 xml:id="sec-ha-migration-upgrade">
  <title>將叢集升級至產品的最新版本</title>

  <para>
   支援哪種升級路徑以及如何執行升級，取決於目前的產品版本以及您要移轉至的目標版本。
  </para>

  <para>
   High Availability Extension 支援的升級路徑與基礎系統支援的升級路徑相同。如需完整綜覽，請參閱<link xlink:href="https://documentation.suse.com/sles-15/html/SLES-all/cha-upgrade-paths.html#sec-upgrade-paths-supported"><citetitle>《SUSE Linux Enterprise Server 升級指南》<phrase role="productnumber"><phrase os="sles">中的 </phrase></phrase></citetitle></link>SUSE Linux Enterprise Server <citetitle>15 SP4 支援的升級路徑</citetitle> 一節。
  </para>

  <para>
   此外，由於高可用性叢集堆疊提供了兩種升級叢集的方法，以下規則也適用：</para>
  <itemizedlist>
   <listitem>
    <formalpara>
     <title><xref linkend="vle-upgrade-rolling"/></title>
     <para>僅在同一主要版本內支援叢集滾存升級 (從一個 Service Pack 升級至下一個 Service Pack，或從產品的 GA 版本升級至 SP1)。</para>
    </formalpara>
   </listitem>
   <listitem>
    <formalpara>
     <title><xref linkend="vle-upgrade-offline" xrefstyle="select:label"/></title>
      <para>若要從一個主要版本升級至下一個主要版本 (例如，從 SLE HA 12 升級至 SLE HA 15)，或者從一個主要版本中的 Service Pack 升級至下一個主要版本 (例如，從 SLE HA 12 SP3 升級至 SLE HA 15)，需要執行叢集離線升級。
     </para>
    </formalpara>
   </listitem>
  </itemizedlist>

  <para>
   <xref linkend="sec-ha-migration-upgrade-oview" xrefstyle="select:label"/> 列出了 SLE HA (Geo) 支援的從一個版本升級至下一個版本的升級路徑和方法。<citetitle>相關詳細資料</citetitle>欄列出了您應參閱的特定升級文件 (還包括基礎系統和 Geo Clustering for SUSE Linux Enterprise High Availability Extension)。此文件可從以下位置取得：</para>
   <itemizedlist>
    <listitem>
     <para>
      <link xlink:href="https://documentation.suse.com/sles-15"/>
     </para>
    </listitem>
    <listitem>
     <para>
      <link xlink:href="https://documentation.suse.com/sle-ha-15"/>
     </para>
    </listitem>
   </itemizedlist>

  <important>
   <title>升級後不支援混合叢集和回復</title>
   <itemizedlist>
    <listitem>
     <para>
      不支援在 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12/<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 15 上執行混合叢集。<emphasis></emphasis>
     </para>
    </listitem>
    <listitem>
     <para>
      執行了升級到產品版本 15 的程序之後，將<emphasis>不</emphasis>支援還原到產品版本 12。
     </para>
    </listitem>
   </itemizedlist>
  </important>

  <sect2 xml:id="sec-ha-migration-upgrade-oview">
   <title>SLE HA 和 SLE HA Geo 支援的升級路徑</title>
   <informaltable>
    <tgroup cols="3">
     <colspec colnum="1" colname="1" colwidth="28*"/>
     <colspec colnum="2" colname="2" colwidth="22*"/>
     <colspec colnum="3" colname="3" colwidth="50*"/>
     <thead>
      <row>
       <entry>
        <para>
         升級來源與目標
        </para>
       </entry>
       <entry>
        <para>
         升級路徑
        </para>
       </entry>
       <entry>
        <para>
         相關詳細資料
        </para>
       </entry>
      </row>
     </thead>
     <tbody>
      <row>
       <entry>
        <para>
         從 SLE HA 11 SP3 到
        </para>
       <para>SLE HA (Geo) 12</para>
       </entry>
       <entry>
        <para>
         叢集離線升級
        </para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基礎系統：SLES 12 的《<citetitle>部署指南</citetitle>》中的「<citetitle>更新和升級 SUSE Linux Enterprise</citetitle>」部分
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA：<xref linkend="pro-ha-migration-offline" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo：SLE HA 12 的《<citetitle>Geo 叢集快速入門</citetitle>》中的「<citetitle>從 SLE HA (Geo) 11 SP3 升級至 SLE HA Geo 12</citetitle>」一節
          </para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         從 SLE HA (Geo) 11 SP4 到 SLE HA (Geo) 12 SP1
        </para>
       </entry>
       <entry>
        <para>
         叢集離線升級
        </para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基礎系統：SLES 12 SP1 的《<citetitle>部署指南</citetitle>》中的「<citetitle>更新和升級 SUSE Linux Enterprise</citetitle>」部分
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA：<xref linkend="pro-ha-migration-offline" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo：SLE HA 12 SP1 的《<citetitle>Geo 叢集快速入門</citetitle>》中的「<citetitle>升級至最新產品版本</citetitle>」一節
          </para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>
         從 SLE HA (Geo) 12 到 SLE HA (Geo) 12 SP1
        </para>
       </entry>
       <entry>
        <para>
         叢集滾存升級
        </para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基礎系統：SLES 12 SP1 的《<citetitle>部署指南</citetitle>》中的「<citetitle>更新和升級 SUSE Linux Enterprise</citetitle>」部分
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA：<xref linkend="pro-ha-migration-rolling-upgrade" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo：SLE HA 12 SP1 的《<citetitle>Geo 叢集快速入門</citetitle>》中的「<citetitle>升級至最新產品版本</citetitle>」一節
          </para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>從 SLE HA (Geo) 12 SP1 到 SLE HA (Geo) 12 SP2</para>
       </entry>
       <entry>
        <para>叢集滾存升級</para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基礎系統：SLES 12 SP2 的《<citetitle>部署指南</citetitle>》中的「<citetitle>更新和升級 SUSE Linux Enterprise</citetitle>」部分
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA：<xref linkend="pro-ha-migration-rolling-upgrade" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo：SLE HA 12 SP2 的《<citetitle>Geo 叢集快速入門</citetitle>》中的「<citetitle>升級至最新產品版本</citetitle>」一節
          </para>
         </listitem>
         <listitem>
          <para>DRBD 8 到 DRBD 9：<xref linkend="sec-ha-drbd-migrate" xrefstyle="select:title nopage"/></para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>從 SLE HA (Geo) 12 SP2 到 SLE HA (Geo) 12 SP3</para>
       </entry>
       <entry>
        <para>叢集滾存升級</para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基礎系統：SLES 12 SP3 的《<citetitle>部署指南</citetitle>》中的「<citetitle>更新和升級 SUSE Linux Enterprise</citetitle>」部分
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA：<xref linkend="pro-ha-migration-rolling-upgrade" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo：SLE HA 12 SP3 的《<citetitle>Geo 叢集指南</citetitle>》中的「<citetitle>升級至最新產品版本</citetitle>」一節
          </para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>從 SLE HA (Geo) 12 SP3 到 SLE HA (Geo) 12 SP4</para>
       </entry>
       <entry>
        <para>叢集滾存升級</para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基礎系統：SLES 12 SP4 的《<citetitle>部署指南</citetitle>》中的「<citetitle>更新和升級 SUSE Linux Enterprise</citetitle>」部分
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA：<xref linkend="pro-ha-migration-rolling-upgrade" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo：SLE HA 12 SP4 的《<citetitle>Geo 叢集指南</citetitle>》中的「<citetitle>升級至最新產品版本</citetitle>」一節
          </para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>從 SLE HA (Geo) 12 SP3 升級至 SLE HA 15</para>
       </entry>
       <entry>
        <para>叢集離線升級</para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基礎系統：SLES 15 的《<citetitle>升級指南</citetitle>》
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA：<xref linkend="pro-ha-migration-offline-12-15" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo：<xref linkend="cha-ha-geo-upgrade"/>
          </para>
         </listitem>
         <listitem>
          <para>叢集式 LVM：<xref linkend="sec-ha-clvm-migrate" xrefstyle="select:title nopage"/></para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>從 SLE HA (Geo) 12 SP4 到 SLE HA (Geo) 12 SP5</para>
       </entry>
       <entry>
        <para>叢集滾存升級</para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基礎系統：SLES 12 SP5 的《<citetitle>部署指南</citetitle>》中的「<citetitle>更新和升級 SUSE Linux Enterprise</citetitle>」部分
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA：<xref linkend="pro-ha-migration-rolling-upgrade" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo：<xref linkend="cha-ha-geo-upgrade"/>
          </para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>從 HA (Geo) 12 SP4 升級至 SLE HA 15 SP1</para>
       </entry>
       <entry>
        <para>叢集離線升級</para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基礎系統：SLES 15 SP1 的《<citetitle>升級指南</citetitle>》
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA：<xref linkend="pro-ha-migration-offline-12-15" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo：<xref linkend="cha-ha-geo-upgrade"/>
          </para>
         </listitem>
         <listitem>
          <para>叢集式 LVM：<xref linkend="sec-ha-clvm-migrate" xrefstyle="select:title nopage"/></para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>從 HA (Geo) 12 SP5 升級至 SLE HA 15 SP2</para>
       </entry>
       <entry>
        <para>叢集離線升級</para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基礎系統：SLES 15 SP2 的《<citetitle>升級指南</citetitle>》
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA：<xref linkend="pro-ha-migration-offline-12-15" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo：<xref linkend="cha-ha-geo-upgrade"/>
          </para>
         </listitem>
         <listitem>
          <para>叢集式 LVM：<xref linkend="sec-ha-clvm-migrate" xrefstyle="select:title nopage"/></para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>從 SLE HA 15 升級至 SLE HA 15 SP1</para>
       </entry>
       <entry>
        <para>叢集滾存升級</para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基礎系統：SLES 15 SP1 的《<citetitle>升級指南</citetitle>》
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA：<xref linkend="pro-ha-migration-rolling-upgrade" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo：<xref linkend="cha-ha-geo-upgrade"/>
          </para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>從 SLE HA 15 SP1 升級至 SLE HA 15 SP2</para>
       </entry>
       <entry>
        <para>叢集滾存升級</para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基礎系統：SLES 15 SP2 的《<citetitle>升級指南</citetitle>》
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA：<xref linkend="pro-ha-migration-rolling-upgrade" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo：<xref linkend="cha-ha-geo-upgrade"/>
          </para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>從 SLE HA 15 SP2 升級至 SLE HA 15 SP3</para>
       </entry>
       <entry>
        <para>叢集滾存升級</para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基礎系統：SLES 15 SP3 的《<citetitle>升級指南</citetitle>》
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA：<xref linkend="pro-ha-migration-rolling-upgrade" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo：<xref linkend="cha-ha-geo-upgrade"/>
          </para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
      <row>
       <entry>
        <para>從 SLE HA 15 SP3 升級至 SLE HA 15 SP4</para>
       </entry>
       <entry>
        <para>叢集滾存升級</para>
       </entry>
       <entry>
        <itemizedlist>
         <listitem>
          <para>
           基礎系統：SLES 15 SP4 的《<citetitle>升級指南</citetitle>》
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA：<xref linkend="pro-ha-migration-rolling-upgrade" xrefstyle="select:title nopage"/>
          </para>
         </listitem>
         <listitem>
          <para>
           SLE HA Geo：<xref linkend="cha-ha-geo-upgrade"/>
          </para>
         </listitem>
        </itemizedlist>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>

   
   <note>
    <title>跳過 Service Pack</title>
    <para>
     最簡單的升級路徑是循序安裝所有 Service Pack。對於 SUSE Linux Enterprise 15 產品系列 (GA 和後續 Service Pack)，還支援在升級時跳過某個 Service Pack。例如，支援從 SLE 15 GA 升級至 15 SP2，或從 SLE 15 SP1 升級至 15 SP3。
    </para>
   </note>
  </sect2>

  <sect2 xml:id="sec-ha-migration-upgrade-require">
   <title>升級前的必要準備</title>
   <variablelist>
    <varlistentry>
     <term>備份</term>
     <listitem>
      <para>
       確保您的系統備份是最新版本且可還原。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>測試</term>
     <listitem>
      <para>
       在線上環境中執行升級程序前，請先在叢集設定的臨時例項上測試該程序。這樣，您便可以預估維護期所需的時間範圍。這也有助於偵測和解決可能會出現的任何非預期問題。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-ha-migration-upgrade-offline">
   <title>叢集離線升級</title>
   <para>
    本節適用於以下案例：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      從 SLE HA 11 SP3 升級至 SLE HA 12 — 如需詳細資料，請參閱<xref linkend="pro-ha-migration-offline"/>。</para>
    </listitem>
    <listitem>
     <para>
      從 SLE HA 11 SP4 升級至 SLE HA 12 SP1 - 如需詳細資料，請參閱<xref linkend="pro-ha-migration-offline"/>。
     </para>
    </listitem>
    <listitem>
     <para>
      從 SLE HA 12 SP3 升級至 SLE HA 15 - 如需詳細資料，請參閱<xref linkend="pro-ha-migration-offline-12-15"/>。
     </para>
    </listitem>
    <listitem>
     <para>
      從 SLE HA 12 SP4 升級至 SLE HA 15 SP1 - 如需詳細資料，請參閱<xref linkend="pro-ha-migration-offline-12-15"/>。
     </para>
    </listitem>
    <listitem>
     <para>
      從 SLE HA 12 SP5 升級至 SLE HA 15 SP2 - 如需詳細資料，請參閱<xref linkend="pro-ha-migration-offline-12-15"/>。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    如果您的叢集仍然以早期的產品版本而不是上面所列版本為基礎，請先將它升級至 SLES 和 SLE HA 的某個版本，而該版本可用做升級至所需目標版本的來源。
   </para>

   <procedure xml:id="pro-ha-migration-offline">
    <title>從產品版本 11 升級至 12：叢集離線升級</title>
    <para>
     The High Availability Extension 12 叢集堆疊的各個元件包含重大變更 (例如 <filename>/etc/corosync/corosync.conf</filename>、OCFS2 的磁碟格式)。因此，不支援從任何 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 11 版本進行<literal>叢集滾存升級</literal>。所有叢集節點都必須處於離線狀態，並且需要依照所述升級整個叢集。
    </para>
    <step>
     <para>
      登入每個叢集節點，並使用以下指令停止叢集堆疊：
     </para>
<screen><prompt role="root">root # </prompt><command>rcopenais</command> stop</screen>
    </step>
    <step>
     <para>
      將每個叢集節點都升級至 SUSE Linux Enterprise Server 和 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 的所需目標版本 — 請參閱<xref linkend="sec-ha-migration-upgrade-oview"/>。
     </para>
    </step>
    <step>
     <para>
      完成升級程序後，將裝有 SUSE Linux Enterprise Server 和 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 升級版本的每個節點重新開機。
     </para>
    </step>
    <step>
     <para>
      如果在叢集設定中使用了 OCFS2，請執行以下指令更新裝置上的結構：
     </para>
<screen><prompt role="root">root # </prompt><command>o2cluster</command> --update <replaceable>PATH_TO_DEVICE</replaceable></screen>
     <para>
      它會為磁碟新增額外參數。<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 12 和 12 SPx 隨附的已更新 OCFS2 版本需要這些參數。
     </para>
    </step>
    <step>
     <para>
      若要更新 Corosync 版本 2 的 <filename>/etc/corosync/corosync.conf</filename>：
     </para>
     <substeps>
      <step>
       <para>
        登入某個節點，然後啟動 YaST 叢集模組。
       </para>
      </step>
      <step>
       <para>
        切換到<guimenu>通訊通道</guimenu>類別，並輸入以下新參數的值：<guimenu>叢集名稱</guimenu>和<guimenu>預期投票數</guimenu>。如需詳細資料，請分別參閱<xref linkend="pro-ha-installation-setup-channel1-udp"/>或<xref linkend="pro-ha-installation-setup-channel1-udpu"/>。
       </para>
       <para>
        如果 YaST 偵測到對 Corosync 版本 2 無效或缺失的任何其他選項，它會提示您變更這些選項。
       </para>

      </step>
      <step>
       <para>
        確認您在 YaST 中所做的變更。YaST 會將組態寫入 <filename>/etc/corosync/corosync.conf</filename>。
       </para>
      </step>
      <step>
       <para>
        如果為叢集設定了 Csync2，請使用以下指令將更新的 Corosync 組態推入至其於叢集節點：
       </para>
<screen><prompt role="root">root # </prompt><command>csync2</command> <option>-xv</option></screen>
       <para>
        如需 Csync2 的詳細資料，請參閱<xref linkend="sec-ha-installation-setup-csync2"/>。
       </para>
       <para>
        或者，也可以透過將 <filename>/etc/corosync/corosync.conf</filename> 手動複製到所有叢集節點的方式來同步化更新的 Corosync 組態。
       </para>
      </step>
     </substeps>
    </step>
    <step>
     <para>
      登入每個節點，並使用以下指令啟動叢集堆疊：
     </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster start</screen>
    </step>
    <step>
     <para>
      使用 <command>crm status</command> 或 Hawk2 檢查叢集狀態。
     </para>
    </step>
    <step>
     <para>將以下服務設定為在開機時啟動：</para>
     <screen><prompt role="root">root # </prompt>systemctl enable pacemaker
<prompt role="root">root # </prompt>systemctl enable hawk
<prompt role="root">root # </prompt>systemctl enable sbd</screen>
    </step>
   </procedure>

 <note xml:id="note-ha-cib-upgrade">
    <title>升級 CIB 語法版本</title>
    <para>
     有時，新功能只能在最新的 CIB 語法版本中使用。升級至新的產品版本時，預設<emphasis>不會</emphasis>升級 CIB 語法版本。
     </para>
    <procedure>
     <step>
      <para>使用以下指令檢查版本：</para>
<screen>cibadmin -Q | grep validate-with</screen>
     </step>
     <step>
      <para>使用以下指令升級至最新的 CIB 語法版本：
      </para>
<screen><prompt role="root">root # </prompt><command>cibadmin</command> --upgrade --force</screen>
     </step>
    </procedure>
   </note>

<procedure xml:id="pro-ha-migration-offline-12-15">
    <title>從產品版本 12 升級至 15：叢集離線升級</title>
   <important>
     <title>從頭開始安裝</title>
     <para>如果您決定從頭開始安裝叢集節點 (而不是升級它們)，請參閱<xref linkend="sec-ha-requirements-sw"/>以取得 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> <phrase role="productnumber"><phrase os="sles">15 SP4</phrase></phrase> 所需的模組清單。如需模組、延伸及相關產品的詳細資訊，請參閱 SUSE Linux Enterprise Server 15 的版本說明。您可以從 <link xlink:href="https://www.suse.com/releasenotes/"/> 上取得這些文件。
     </para>
    </important>
    <step>
     <para>
      在開始離線升級至 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 15 之前，請如<xref linkend="note-ha-cib-upgrade"/>所述手動升級目前叢集中的 CIB 語法。
     </para>
    </step>
    <step>
     <para>
      登入每個叢集節點，並使用以下指令停止叢集堆疊：
     </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster stop</screen>
    </step>
    <step>
     <para>
      將每個叢集節點都升級至 SUSE Linux Enterprise Server 和 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 的所需目標版本 — 請參閱<xref linkend="sec-ha-migration-upgrade-oview"/>。
     </para>
    </step>
    <step>
     <para>
      完成升級程序後，請登入每個節點，並將安裝了 SUSE Linux Enterprise Server 和 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 升級版的每個節點開機。
     </para>
    </step>
    <step>
     <para>如果您使用叢集 LVM，則需要從 clvmd 移轉至 lvmlockd。請參閱 <command>lvmlockd</command> 的 man 頁面中的「<citetitle>changing clvm VG to lockd VG</citetitle>」(將 clvm VG 變更為 lockd VG) 部分，另請參閱<xref linkend="sec-ha-clvm-migrate"/>。
     </para>
    </step>
    <step>
     <para>
      登入某個叢集節點，並啟動所有節點上的叢集堆疊：
     </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster start --all</screen>
     <note>
      <title><option>--all</option> 選項僅在 15 SP4 版本中可用</title>
      <para>
       <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 15 SP4 中新增了 <option>--all</option> 選項。在早期版本中，您必須逐一在每個節點上執行 <command>crm cluster start</command> 指令。
      </para>
     </note>
    </step>
    <step>
     <para>
      使用 <command>crm status</command> 或 Hawk2 檢查叢集狀態。
     </para>
    </step>
   </procedure>
  </sect2>

  <sect2 xml:id="sec-ha-migration-upgrade-rolling">
   <title>叢集滾存升級</title>
   <para>
    本節適用於以下案例：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      從 SLE HA 12 升級到 SLE HA 12 SP1
     </para>
    </listitem>
    <listitem>
     <para>
      從 SLE HA 12 SP1 升級至 SLE HA 12 SP2
     </para>
    </listitem>
    <listitem>
     <para>
      從 SLE HA 12 SP2 升級至 SLE HA 12 SP3
     </para>
    </listitem>
    <listitem>
     <para>
      從 SLE HA 12 SP3 升級至 SLE HA 12 SP4
     </para>
    </listitem>
    <listitem>
     <para>
      從 SLE HA 12 SP4 升級至 SLE HA 12 SP5
     </para>
    </listitem>
    <listitem>
     <para>
      從 SLE HA 15 升級到 SLE HA 15 SP1
     </para>
    </listitem>
    <listitem>
     <para>
      從 SLE HA 15 SP1 升級至 SLE HA 15 SP2
     </para>
    </listitem>
    <listitem>
     <para>
      從 SLE HA 15 SP2 升級至 SLE HA 15 SP3
     </para>
    </listitem>
    <listitem>
     <para>
      從 SLE HA 15 SP3 升級至 SLE HA 15 SP4
     </para>
    </listitem>

   </itemizedlist>

   <para>依據情況使用以下其中一個程序：</para>
   <itemizedlist>
    <listitem>
     <para>
      如果要進行較為一般的滾存升級，請參閱<xref linkend="pro-ha-migration-rolling-upgrade" xrefstyle="select:label"/>。
     </para>
    </listitem>
    <listitem>
     <para>
      如果要進行特定的滾存升級，請參閱<xref linkend="pro-ha-migration-rolling-upgrade-newsp-freshinstall" xrefstyle="select:label"/>。
     </para>
    </listitem>
   </itemizedlist>

   <warning>
    <title>使用中的叢集堆疊</title>
    <para>
     在開始升級某個節點之前，請<emphasis>停止</emphasis><emphasis>該節點上的</emphasis>叢集堆疊。
    </para>
    <para>
     如果節點上的叢集資源管理員在軟體更新期間處於使用中狀態，可能會導致圍籬區隔使用中節點等結果。
    </para>
   </warning>
   <important>
    <title>叢集滾存升級的時間限制</title>
    <para>
     只有將<emphasis>所有</emphasis>叢集節點升級至最新產品版本之後，才可使用最新產品版本隨附的新功能。在叢集滾存升級期間，只有一段較短的時間支援混合版本叢集升級。請在一週內完成叢集滾存升級。
    </para>
    <para>
     當所有線上節點執行的都是升級的版本後，其他使用舊版本的節點不升級就無法 (重新) 加入叢集。
    </para>
   </important>
   <procedure xml:id="pro-ha-migration-rolling-upgrade">
    <title>執行叢集滾存升級</title>

    <step>
     <para>
      以 <systemitem class="username">root</systemitem> 使用者身分登入要升級的節點，並停止叢集堆疊：
     </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster stop</screen>
    </step>
    <step xml:id="step-ha-migration-upgrade-tolatest">
     <para>
      升級至 SUSE Linux Enterprise Server 和 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 的所需目標版本。若要瞭解個別升級程序的詳細資料，請參閱<xref linkend="sec-ha-migration-upgrade-oview"/>。
     </para>
    </step>
    <step xml:id="step-ha-migration-upgrade-ais">
     <para>
      在已升級的節點上啟動叢集堆疊，讓該節點重新加入叢集：
     </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster start</screen>
    </step>
    <step>
     <para>
      讓下一個節點離線，並對其重複執行此程序。
     </para>
    </step>
    <step>
     <para>
      使用 <command>crm status</command> 或 Hawk2 檢查叢集狀態。
     </para>
     <para>
      如果偵測到您的叢集節點有不同的 CRM 版本，Hawk2 <guimenu>狀態</guimenu>螢幕還會顯示一則警告。
     </para>
    </step>
   </procedure>
   <important>
    <title>滾存升級的時間限制</title>
    <para>
     只有將<emphasis>所有</emphasis>叢集節點升級至最新產品版本之後，才可使用最新產品版本隨附的新功能。在滾存升級期間，只有一段較短的時間支援混合版本叢集。請在一週內完成滾存升級。
    </para>
   </important>
   <para>如果偵測到您的叢集節點有不同的 CRM 版本，Hawk2 <guimenu>狀態</guimenu>螢幕還會顯示一則警告。</para>
   <para>除了本機升級之外，許多客戶更喜歡進行全新安裝，即使是要升級至下一個 Service Pack 時也是如此。下面的程序顯示雙節點叢集 (包含節點 alice 和 bob) 升級至下一個 Service Pack (SP) 的情況：
   </para>
   <procedure xml:id="pro-ha-migration-rolling-upgrade-newsp-freshinstall">
    <title>執行新 Service Pack 的叢集範圍全新安裝</title>
    <step xml:id="st-ha-migration-rolling-up-sp-backup">
     <para>備份叢集組態。下面的清單中顯示了至少應備份的檔案：
     </para>
     
     <screen>/etc/corosync/corosync.conf
/etc/corosync/authkey
/etc/sysconfig/sbd
/etc/modules-load.d/watchdog.conf
/etc/hosts
/etc/ntp.conf</screen>
     
     <para>依據您的資源，您可能還需要備份以下檔案：</para>
     
     <screen>/etc/services
/etc/passwd
/etc/shadow
/etc/groups
/etc/drbd/*
/etc/lvm/lvm.conf
/etc/mdadm.conf
/etc/mdadm.SID.conf</screen>
     
    </step>
    <step xml:id="st-ha-migration-rolling-alice">
     <para>先從節點 alice 開始。
     </para>
     <substeps>
      <step>
       <para>
        將節點置於待命模式。這樣便能將資源移出節點：
       </para>
       <screen><prompt role="root">root # </prompt><command>crm</command> --wait node standby alice reboot</screen>
       <para>
        使用 <option>--wait</option> 選項，該指令僅會在叢集完成轉換並變為閒置狀態時傳回。<option>reboot</option> 選項可使節點一旦重新上線就已脫離待命模式。儘管 <option>reboot</option> 選項的名稱是重新開機，但只要節點離線後又上線，該選項就會發揮作用。
       </para>
      </step>
      <step>
       <para>停止節點 alice 上的叢集服務：</para>
       <screen><prompt role="root">root # </prompt><command>crm</command> cluster stop</screen>
      </step>
      <step>
       <para>
        此時，alice 不再有任何執行中資源。升級節點 alice，完成後將其重新開機。假定叢集服務不會在系統開機時啟動。
       </para>
      </step>
      <step>
       <para>
        將<xref linkend="st-ha-migration-rolling-up-sp-backup"/> 中的備份檔案複製到原始位置。
       </para>
      </step>
      <step>
       <para>將節點 alice 重新加入叢集：</para>
       <screen><prompt role="root">root # </prompt><command>crm</command> cluster start</screen>
      </step>
      <step>
       <para>檢查資源是否正常。</para>
      </step>
     </substeps>
    </step>
    <step>
     <para>對節點 bob 重複<xref linkend="st-ha-migration-rolling-alice"/>。
     </para>
    </step>
   </procedure>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-ha-migration-update">
  <title>更新叢集節點上的軟體套件</title>

  <warning>
   <title>使用中的叢集堆疊</title>
   <para>
    啟動某節點的套件更新之前，請<emphasis>停止</emphasis><emphasis>該節點上</emphasis>的叢集堆疊，或將<emphasis>該節點置於維護模式</emphasis>，具體視叢集堆疊是否受影響而定。如需詳細資料，請參閱<xref linkend="step-update-check"/>。
   </para>
   <para>
    如果節點上的叢集資源管理員在軟體更新期間處於使用中狀態，可能會導致圍籬區隔使用中節點等結果。
   </para>
  </warning>

  <procedure>
   <step xml:id="step-update-check">
    <para>
     在節點上安裝任何套件更新之前，請檢查以下幾點：
    </para>
    <itemizedlist>
     <listitem>
      <para>
       該更新是否會影響屬於 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 的任何套件？如果<literal>是</literal>，請在開始軟體更新前先在節點上停止叢集堆疊：
      </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster stop</screen>
     </listitem>
     <listitem>
      <para>
       更新套件是否需要重新開機？如果<literal>是</literal>，請在開始軟體更新前先在節點上停止叢集堆疊：
      </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster stop</screen>
     </listitem>
     <listitem>
      <para>
       如果不屬於以上任一種情況，則不需要停止叢集堆疊。在此情況下，請在開始軟體更新前將節點置於維護模式：
      </para>
<screen><prompt role="root">root # </prompt><command>crm</command> node maintenance <replaceable>NODE_NAME</replaceable></screen>
      <para>
       如需維護模式的詳細資料，請參閱<xref linkend="sec-ha-maint-overview"/>。
      </para>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     使用 YaST 或 Zypper 來安裝套件更新。
    </para>
   </step>
   <step>
    <para>
     在成功安裝更新後：
    </para>
    <itemizedlist>
     <listitem>
      <para>
       啟動相應節點上的叢集堆疊 (如果在執行<xref linkend="step-update-check"/> 時已將它停止)：
      </para>
<screen><prompt role="root">root # </prompt><command>crm</command> cluster start</screen>
     </listitem>
     <listitem>
      <para>
       或者移除維護旗標，使節點恢復正常模式：
      </para>
<screen><prompt role="root">root # </prompt><command>crm</command> node ready <replaceable>NODE_NAME</replaceable></screen>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     使用 <command>crm status</command> 或 Hawk2 檢查叢集狀態。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-ha-migration-more">
  <title>更多資訊</title>

  <para>
   如需所升級產品目標版本的任何變更及新功能的詳細資訊，請參閱其版本說明，這些文件可從 <link xlink:href="https://www.suse.com/releasenotes/"/> 取得。
  </para>
 </sect1>
</chapter>
