<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_config_hawk2.xml" xml:id="cha-conf-hawk2" version="5.0">
 <title>使用 Hawk2 設定和管理叢集資源</title>
 <info>
  <abstract>
   <para>
    若要設定和管理叢集資源，請使用 Hawk2 或 crm 外圍程序 (crmsh) 指令行公用程式。如果您從安裝了 Hawk 的較低版 <phrase role="roductnamereg"><phrase os="sles">SUSE® Linux Enterprise High Availability Extension</phrase></phrase> 升級，該套件將由最新版本 Hawk2 取代。
   </para>

   <para>
    Hawk2 的使用者友好 Web 介面可讓您從 Linux 或非 Linux 機器監控和管理您的高可用性叢集。您可使用 (圖形) 網頁瀏覽器從叢集內外的任何機器存取 Hawk2。
   </para>
  </abstract>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer/>
   <dm:status>editing</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>yes</dm:translation>
   <dm:languages/>
   <dm:release/>
   <dm:repository/>
  </dm:docmanager>
 </info>
 <sect1 xml:id="sec-conf-hawk2-req">
  <title>Hawk2 要求</title>

  <para>
   僅當系統符合以下要求後，使用者才能登入 Hawk2：
  </para>

  <variablelist>
   <varlistentry>
    <term><package>hawk2</package> 套件</term>
    <listitem>
     <para>
      要透過 Hawk2 連接的所有叢集節點都必須已安裝 <package>hawk2</package> 套件。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>網頁瀏覽器</term>
    <listitem>
     <para>
      在要使用 Hawk2 存取叢集節點的機器上，需要安裝啟用了 JavaScript 和 Cookie 的 (圖形) 網頁瀏覽器才能建立連接。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Hawk2 服務</term>
    <listitem>
     <para>
      若要使用 Hawk2，您要透過 Web 介面連接的節點上必須啟動相應的 Web 服務。請參閱<xref linkend="pro-ha-hawk2-service"/>。
     </para>
     <para>
      如果您已使用 crm 外圍程序提供的開機程序檔設定叢集，那麼此時 Hawk2 服務已啟用。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>每個叢集節點上的使用者名稱、群組和密碼</term>
    <listitem>
     <para>
      Hawk2 使用者必須是 <systemitem class="groupname">haclient</systemitem> 群組的成員。安裝程序會建立名為 <systemitem class="username">hacluster</systemitem> 的 Linux 使用者，該使用者已新增至 <systemitem class="groupname">haclient</systemitem> 群組中。
     </para>
     <para>
      使用 <command>crm cluster init</command> 程序檔進行設定時，將為 <systemitem class="username">hacluster</systemitem> 使用者設定預設密碼。在啟動 Hawk2 之前，請將它變更為安全密碼。如果您未使用 <command>crm cluster init</command> 程序檔，請先為 <systemitem class="username">hacluster</systemitem> 設定密碼，或者建立屬於 <systemitem class="groupname">haclient</systemitem> 群組的新使用者。請在您要使用 Hawk2 與之連接的所有節點上執行此操作。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>萬用字元證書處理</term>
    <listitem>
     <para>
      萬用字元證書是指對多個子網域有效的公用金鑰證書。例如，<systemitem class="domainname">*.example.com</systemitem> 的萬用字元證書可以保障 <systemitem class="domainname">login.example.com</systemitem>、<systemitem class="domainname">www.example.com</systemitem> (可能還有更多) 網域的安全。
     </para>
     <para>
      Hawk2 支援萬用字元證書及可轉換證書。<filename>/srv/www/hawk/bin/generate-ssl-cert</filename> 可產生自行簽署的預設公用金鑰和證書。
     </para>
     <para>
      若要使用您自己的證書 (可轉換或萬用字元證書)，請以您自己的證書取代產生的證書 (位於 <filename>/etc/ssl/certs/hawk.pem</filename> 處)。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <procedure xml:id="pro-ha-hawk2-service">
   <title>啟動 Hawk2 服務</title>
   <step>
    <para>
     在您要與之連接的節點上，開啟外圍程序並以 <systemitem class="username">root</systemitem> 身分登入。
    </para>
   </step>
   <step>
    <para>
     輸入以下指令檢查服務的狀態
    </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> status hawk</screen>
   </step>
   <step>
    <para>
     如果服務沒有執行，則使用以下指令將其啟動
    </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> start hawk</screen>
    <para>
     如果希望 Hawk2 在開機時自動啟動，請執行以下指令：
    </para>
<screen><prompt role="root">root # </prompt><command>systemctl</command> enable hawk</screen>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-conf-hawk2-login">
  <title>登入</title>

  <para>
   Hawk2 Web 介面使用 HTTPS 通訊協定和連接埠 <literal>7630</literal>。
  </para>

  <para>
   您無需使用 Hawk2 登入個別叢集節點，而是可以將一個浮動的虛擬 IP 位址 (<literal>IPaddr</literal> 或 <literal>IPaddr2</literal>) 設定為叢集資源。該位址無需任何特殊組態設定。如此，無論 Hawk 服務在哪個實體節點上執行，用戶端都可以連接到該服務。
  </para>

  <para>
   在使用 crm 外圍程序提供的開機程序檔設定叢集時，系統會詢問您是否設定虛擬 IP 以用於叢集管理。
  </para>

  <procedure xml:id="pro-ha-hawk2-login">
   <title>登入 Hawk2 Web 介面</title>
   <step>
    <para>
     在任一部機器上，啟動網頁瀏覽器並輸入以下 URL：
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
    <para>
     使用執行 Hawk Web 服務的任何叢集節點的 IP 位址或主機名稱取代 <replaceable>HAWKSERVER</replaceable>。如果已設定虛擬 IP 位址以供您使用 Hawk2 進行叢集管理，請使用該虛擬 IP 位址取代 <replaceable>HAWKSERVER</replaceable>。
    </para>
    <note>
     <title>證書警告</title>
     <para>
      當您首次嘗試存取該 URL 時，如果系統顯示證書警告，則表示使用了自行簽署的證書。依預設，自行簽署的證書不被視為可信證書。
     </para>
     <para>
      若要驗證證書，請聯絡叢集操作人員獲取證書詳細資料。
     </para>
     <para>
      若仍要繼續，您可以在瀏覽器中新增一個例外以略過此警告。
     </para>
     <para>
      如需關於如何將自行簽署的證書取代為官方證書管理中心所簽署證書的資訊，請參閱<xref linkend="vle-trouble-hawk2-cert"/>。
     </para>
    </note>
   </step>
   <step>
    <para>
     在 Hawk2 登入螢幕中，輸入 <systemitem class="username">hacluster</systemitem>使用者 (或任何屬於群組 <systemitem class="groupname">haclient</systemitem>的其他使用者) 的<guimenu>使用者名稱</guimenu>和<guimenu>密碼</guimenu>。
    </para>
   </step>
   <step>
    <para>
     按一下<guimenu>登入</guimenu>。
    </para>
   </step>
  </procedure>
 </sect1>
 <sect1 xml:id="sec-conf-hawk2-overview">
  <title>Hawk2 綜覽：主要元素</title>

  <para>
   登入 Hawk2 後，左側會顯示一個導覽列，右側會顯示一個頂層列，其中包含若干連結。
  </para>

  <note>
   <title>Hawk2 中的可用功能</title>
   <para>
    依預設，以 <systemitem class="username">root</systemitem> 或 <systemitem class="username">hacluster</systemitem> 身分登入的使用者對於所有叢集組態任務都擁有完整的讀-寫存取權限。不過，您可以使用<xref linkend="cha-ha-acl" xrefstyle="select:title"/> (ACL) 來定義精細的存取權限。
   </para>
   <para>
    如果 CRM 中啟用了 ACL，則 Hawk2 的可用功能取決於指定給您的使用者角色及其所指定的存取權限。Hawk2 中的<guimenu>歷程總管</guimenu>只能由使用者 <systemitem class="username">hacluster</systemitem> 來執行。
   </para>
  </note>

  <sect2 xml:id="sec-conf-hawk2-overview-leftnav">
   <title>左側導覽列</title>
   <variablelist>
    <varlistentry>
     <term><guimenu>監測</guimenu>
     </term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <guimenu>狀態</guimenu>：扼要顯示當前的叢集狀態 (與 crmsh 上的 <command>crm status</command> 類似)。如需詳細資料，請參閱<xref linkend="sec-conf-hawk2-manage-monitor-status"/>。如果叢集包含<literal>訪客節點</literal> (執行 <literal>pacemaker_remote</literal> 精靈的節點)，則也會顯示這些節點。
         <remark>taroth 2018-10-30: check and probably mention in more detail in
         'sec.conf.hawk2.manage.monitor.status' for next revision</remark>
         螢幕重新整理頻率接近即時重新整理：任何節點或資源狀態的變更都幾乎立即可見。
        </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>儀表板</guimenu>：可讓您監控多個叢集 (如果您設定了 Geo 叢集，則這些叢集還可以位於不同站點)。如需詳細資料，請參閱<xref linkend="sec-conf-hawk2-manage-monitor-dash"/>。如果叢集包含<literal>訪客節點</literal> (執行 <literal>pacemaker_remote</literal> 精靈的節點)，則也會顯示這些節點。
         <remark>taroth 2018-10-30: check and probably mention in more detail in
         'sec.conf.hawk2.manage.monitor.status' for next revision</remark>螢幕重新整理頻率接近即時重新整理：任何節點或資源狀態的變更都幾乎立即可見。
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>疑難排解</guimenu>
     </term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <guimenu>歷程</guimenu>：開啟可以用來產生叢集報告的<guimenu>歷程總管</guimenu>。如需詳細資料，請參閱<xref linkend="sec-conf-hawk2-history"/>。
        </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>指令記錄</guimenu>：可列出近期由 Hawk2 執行的 crmsh 指令。
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
     <varlistentry>
      <term>組態</term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para>
         <guimenu>新增資源</guimenu>：開啟資源組態螢幕。如需詳細資料，請參閱<xref linkend="sec-conf-hawk2-rsc"/>。 </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>新增約束條件</guimenu>：開啟約束條件組態螢幕。如需詳細資料，請參閱<xref linkend="sec-conf-hawk2-cons"/>。 </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>精靈</guimenu>：可讓您從數個精靈中選取一個，以便引導您完成為某個工作負載 (例如，某個 DRBD 區塊裝置) 建立資源的程序。如需詳細資料，請參閱<xref linkend="sec-conf-hawk2-rsc-wizard"/>。 </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>編輯組態</guimenu>：可用於編輯資源、條件約束、節點名稱和屬性、標記、<link xlink:href="http://crmsh.github.io/man/#cmdhelp_configure_alert">警報</link>和<link xlink:href="http://crmsh.github.io/man/#cmdhelp_configure_fencing_topology">圍籬區隔拓撲</link>。
         </para>
       </listitem>
       <listitem>
        <para>
         <guimenu>叢集組態</guimenu>：可用於修改全域叢集選項以及資源和操作預設值。如需詳細資料，請參閱<xref linkend="sec-conf-hawk2-cluster-config"/>。 </para>
       </listitem>
       <listitem>
        <para>
         <menuchoice>
          <guimenu>存取控制</guimenu>
          <guimenu>角色</guimenu>
         </menuchoice>：開啟您可在其中為存取控制清單 (即用於描述對 CIB 的存取權限的規則集) 建立角色的螢幕。如需詳細資料，請參閱<xref linkend="pro-ha-acl-hawk2-role"/>。 </para>
       </listitem>
       <listitem>
        <para>
         <menuchoice>
          <guimenu>存取控制</guimenu>
          <guimenu>目標</guimenu>
         </menuchoice>：開啟您可在其中為存取控制清單建立目標 (系統使用者) 並為這些目標指定角色的螢幕。如需詳細資料，請參閱<xref linkend="pro-ha-acl-hawk2-target"/>。 </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>

  <sect2 xml:id="sec-conf-hawk2-overview-toprow">
   <title>頂層列</title>
   <para>
    Hawk2 的頂層列顯示以下項目：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <guimenu>批次</guimenu>：按一下可切換到批次模式。可用於模擬和分階段進行變更並透過單次交易套用這些變更。如需詳細資料，請參閱<xref linkend="sec-conf-hawk2-batch"/>。
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu><replaceable>使用者名稱</replaceable></guimenu>：可用於設定 Hawk2 的優先設定 (例如，Web 介面的語言，或者是否在 STONITH 處於停用狀態時顯示警告)。
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>說明</guimenu>：存取 <phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 文件、閱讀版本說明或報告錯誤。
     </para>
    </listitem>
    <listitem>
     <para>
      <guimenu>登出</guimenu>：按一下可登出。
     </para>
    </listitem>
   </itemizedlist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-conf-hawk2-cluster-config">
  <title>設定全域叢集選項</title>

  <para>
   全域叢集選項控制叢集在遇到特定情況時的運作方式。它們分為不同的組，可透過 Hawk2 和 crmsh 等叢集管理工具來檢視和修改。一般情況下，可以保留預先定義的值。但是，為了讓叢集的關鍵功能正常運作，還需要在執行基本叢集設定後調整以下參數：
  </para>

  <itemizedlist>
   <listitem>
    <para>
     <xref linkend="sec-ha-config-basics-global-quorum" xrefstyle="select:title"/>
    </para>
   </listitem>
   <listitem>
    <para>
     <xref linkend="sec-ha-config-basics-global-stonith" xrefstyle="select:title"/>
    </para>
   </listitem>
  </itemizedlist>

  <procedure xml:id="pro-conf-hawk2-global">
   <title>修改全域叢集選項</title>
   <step>
    <para>
     登入 Hawk2：
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     從左側導覽列中，選取<menuchoice>
     <guimenu>組態</guimenu><guimenu>叢集組態</guimenu>
     </menuchoice>。
    </para>
    <para>
     <guimenu>叢集組態</guimenu>螢幕隨即開啟。它會顯示全域叢集選項及其當前的值。
    </para>
    <para>
     若要在螢幕右側顯示參數的簡要描述，請將游標懸停在該參數上。
     <remark>taroth 2017-08-10: this does no longer seem to be the case
      @ayoub: are those descriptions gone on purpose?</remark>
    </para>
    <figure pgwide="0">
     <title>Hawk2 - 叢集組態</title>
     <mediaobject>
      <imageobject role="fo">
       <imagedata fileref="hawk2-cluster-config.png" width="100%" format="PNG"/>
      </imageobject>
      <imageobject role="html">
       <imagedata fileref="hawk2-cluster-config.png" width="100%" format="PNG"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
   <step>
    <para>
     檢查 <guimenu>no-quorum-policy</guimenu> 和 <guimenu>stonith-enabled</guimenu> 的值，必要時予以調整：
    </para>
    <substeps performance="required">
     <step>
      <para>
       將 <guimenu>no-quorum-policy</guimenu> 設為適當的值。請參閱 <xref linkend="sec-ha-config-basics-global-quorum"/>，以取得詳細資料。
      </para>
     </step>
     <step>
      <para>
       如果出於某種原因需要停用圍籬區隔，請將 <guimenu>stonith-enabled</guimenu> 設定為 <literal>no</literal>。依預設，該參數設定為 <literal>true</literal>，因為執行常規的叢集操作必須要使用 STONITH 裝置。依據預設值，如果未設定 STONITH 資源，叢集將拒絕啟動任何資源。
      </para>
        <important>
      <title>不支援沒有 STONITH 的組態</title>
      <itemizedlist>
       <listitem>
        <para>您必須為叢集設定節點圍籬區隔機制。</para>
       </listitem>
       <listitem>
        <para>全域叢集選項 <systemitem>stonith-enabled</systemitem> 和 <systemitem>startup-fencing</systemitem> 必須設定為 <literal>true</literal>。如果您變更這些選項，將會失去支援。</para>
       </listitem>
      </itemizedlist>
      </important>
      </step>
     <step>
      <para>
       若要從叢集組態中移除某個參數，請按一下該參數旁邊的<guimenu>減號</guimenu>圖示。如果某個參數被刪除，叢集會將該參數視為具有預設值。
      </para>
     </step>
     <step>
      <para>
       若要將新參數新增至叢集組態，請從下拉式方塊中選擇一個參數。
      </para>
     </step>
    </substeps>
   </step>

   <step>
    <para>
     如果您需要變更<guimenu>資源預設值</guimenu>或<guimenu>操作預設值</guimenu>，請執行下列步驟：
    </para>
    <substeps performance="required">
     <step>
      <para>
       若要調整值，請在下拉式方塊中選取其他值，或直接編輯該值。
      </para>
     </step>
     <step>
      <para>
       若要新增新的資源預設值或操作預設值，請從空下拉式方塊中選擇一項，然後輸入值。如果已定義預設值，Hawk2 會自動提供這些預設值。
      </para>
     </step>
     <step>
      <para>
       若要移除某個參數，請按一下該參數旁邊的<guimenu>減號</guimenu>圖示。如果沒有為<guimenu>資源預設值</guimenu>和<guimenu>操作預設值</guimenu>指定值，叢集會使用<xref linkend="sec-ha-config-basics-meta-attr"/> 及<xref linkend="sec-ha-config-basics-operations"/> 中所述的預設值。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     確認您的變更。
    </para>
   </step>
  </procedure>
 </sect1>
 <xi:include href="ha_hawk2_rsc_i.xml"/>
 <xi:include href="ha_hawk2_cons_i.xml"/>
 <xi:include href="ha_hawk2_manage_i.xml"/>

 <xi:include href="ha_hawk2_monitor_i.xml"/>
 <xi:include href="ha_hawk2_batch_i.xml"/>
 <xi:include href="ha_hawk2_history_i.xml"/>
 <xi:include href="ha_hawk2_health_i.xml"/>
</chapter>
