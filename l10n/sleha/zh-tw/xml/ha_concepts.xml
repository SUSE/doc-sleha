<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_concepts.xml" version="5.0" xml:id="cha-ha-concepts">
 <title>產品綜覽</title>
 <info>
  <abstract>
   <para>
    SUSE® Linux Enterprise High Availability 是開放原始碼叢集技術的整合套件。它可讓您實作高度可用的實體和虛擬 Linux 叢集，避免單一故障點。該套裝軟體可確保資料、應用程式和服務等重要網路資源的高可用性及可管理性。因此，可協助您保持業務持續運作，保護資料完整性，並可降低關鍵任務 Linux 工作負載的意外停機時間。
   </para>
   <para>
    它提供了基本的監控、訊息傳送和叢集資源管理功能，支援個別受管理叢集資源的容錯移轉、容錯回復和移轉 (負載平衡)。
   </para>
   <para>
    本章介紹 SUSE Linux Enterprise High Availability 的主要產品功能和優勢。您會看到幾個範例叢集，並瞭解組成叢集的各個元件。最後一節所敘述的是該架構的綜覽，介紹了叢集內的個別架構層和程序。
   </para>
   <para>
    High Availability Extension 叢集內容中使用的一些常見詞彙，可以在<xref linkend="gl-heartb"/>中找到相關說明。
   </para>
      </abstract>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>editing</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <sect1 xml:id="sec-ha-availability">
  <title>做為模組或延伸的可用性</title>

  <para>
   High Availability 可做為多個產品的模組或延伸使用。如需詳細資料，請參閱<link xlink:href="https://documentation.suse.com/sles/html/SLES-all/article-modules.html#art-modules-high-availability"/>。
  </para>
 </sect1>
 <sect1 xml:id="sec-ha-features">
  <title>主要功能</title>

  <para>
   SUSE® Linux Enterprise High Availability 可協助您保障和管理網路資源的可用性。以下各節重點描述一些關鍵功能：
  </para>

  <sect2 xml:id="sec-ha-features-scenarios">
   <title>各種叢集情境</title>
   <para>
    SUSE Linux Enterprise High Availability 支援以下情境：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      主動/主動組態
     </para>
    </listitem>
    <listitem>
     <para>
      <remark>toms 2018-09-20: Explain the meaning of these abbreviations
      (from Lars):</remark>
      主動/被動組態：N+1、N+M、N 到 1、N 到 M
     </para>
    </listitem>
    <listitem>
     <para>
      混合式實體和虛擬叢集，允許虛擬伺服器與實體伺服器叢集在一起。這能提高服務的可用性和資源的使用率。
     </para>
    </listitem>
    <listitem>
     <para>
      本地叢集
     </para>
    </listitem>
    <listitem>
     <para>
      城際叢集 (<quote>延伸的</quote>本地叢集)
     </para>
    </listitem>
    <listitem>
     <para>
      Geo 叢集 (地理位置分散的叢集)
     </para>
    </listitem>
   </itemizedlist>
   <important>
    <title>不支援混合架構</title>
    <para>
     屬於一個叢集的所有節點都應使用相同的處理器平台：x86、IBM Z 或 POWER。<emphasis>不</emphasis>支援採用混合架構的叢集。
    </para>
   </important>
   <para>
    叢集最多可以包含 32 個 Linux 伺服器。使用 pacemaker_remote 可擴充叢集使其突破此限制，以包含更多 Linux 伺服器。可以使用叢集內的任一伺服器重新啟動同一叢集中之失敗伺服器中的資源 (應用程式、服務、IP 位址和檔案系統)。
   </para>
  </sect2>

  <sect2 xml:id="sec-ha-features-flexibility">
   <title>靈活性</title>
   <para>
    SUSE Linux Enterprise High Availability 隨附了 Corosync 訊息傳送和成員資格層，以及 Pacemaker 叢集資源管理員。使用 Pacemaker，管理員可持續監控其資源的健康狀況和狀態，並管理相依性。他們可根據高度可設定的規則，自動停止和啟動服務。使用 SUSE Linux Enterprise High Availability，您可以對叢集量身打造，採用適合組織的特定應用程式和硬體基礎架構。時間相關組態可讓服務在指定時間自動移轉回已修復節點。
   </para>
  </sect2>

  <sect2 xml:id="sec-ha-features-storage">
   <title>儲存與資料複製</title>
   <para>
    憑藉 SUSE Linux Enterprise High Availability，您可以視需要動態指定和重新指定伺服器儲存。它支援光纖通道或 iSCSI 儲存區域網路 (SAN)。還支援共用磁碟系統，但這些系統並非必要系統。SUSE Linux Enterprise High Availability 還隨附叢集感知檔案系統 (OCFS2) 和叢集邏輯磁碟區管理員 (叢集 LVM2)。若要複製您的資料，請使用 DRBD* 將高可用性服務的資料自叢集主動節點鏡像複製到待命節點。此外，SUSE Linux Enterprise High Availability 還支援 CTDB (Cluster Trivial Database，叢集簡單資料庫)，這是一種 Samba 叢集技術。
   </para>
  </sect2>

  <sect2 xml:id="sec-ha-features-virtualized">
   <title>虛擬化環境支援</title>
   <para>
    SUSE Linux Enterprise High Availability 支援由實體和虛擬 Linux 伺服器組成的混合叢集。SUSE Linux Enterprise Server 15 SP6 隨附了 Xen (一種開放原始碼虛擬化監管程式) 和 KVM (基於核心的虛擬機器)。KVM 是一款適用於 Linux 的虛擬化軟體，基於硬體虛擬化延伸。SUSE Linux Enterprise High Availability 中的叢集資源管理員能夠辨識、監控和管理虛擬伺服器以及實體伺服器中執行的服務。叢集可以將訪客系統做為服務進行管理。
   </para>
   <important>
    <title>High Availability 叢集中的即時移轉</title>
    <para>
     在使用中叢集內執行節點的即時移轉時要小心。叢集堆疊可能無法容忍即時移轉程序導致的作業系統凍結，這可能使節點遭到圍籬區隔。
    </para>
    <para>
     建議執行以下任一動作，以避免在即時移轉期間圍籬區隔節點：
    </para>
    <itemizedlist>
     <listitem>
      <para>
       新增 Corosync 記號逾時和 SBD 監視程式逾時，以及任何其他相關設定。適當的值取決於您的特定設定。如需詳細資訊，請參閱<xref linkend="sec-ha-storage-protect-watchdog-timings"/>。
      </para>
     </listitem>
     <listitem>
      <para>
       在執行即時移轉之前，請停止節點或整個叢集上的叢集服務。如需詳細資訊，請參閱<xref linkend="sec-ha-maint-overview"/>。
      </para>
     </listitem>
    </itemizedlist>
    <para>
     在生產環境中嘗試執行即時移轉之前，<emphasis role="bold">必須</emphasis>徹底測試此設定。
    </para>
   </important>
  </sect2>

  <sect2 xml:id="sec-ha-features-geo">
   <title>本地、城際和 Geo 叢集支援</title>
   <para>
    SUSE Linux Enterprise High 支援不同的地理情境，包括地理位置分散的叢集 (即 Geo 叢集)。
   </para>
   <variablelist>
    <varlistentry>
     <term>本地叢集</term>
     <listitem>
      <para>
       一個位置中的單一叢集 (例如，所有節點位於一個資料中心)。此叢集在各節點之間使用多點傳送或單點傳播進行通訊，並在內部管理容錯移轉。網路延遲可以忽略。一般而言，所有節點對儲存的存取都是同步的。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>城際叢集</term>
     <listitem>
      <para>
       覆蓋面延伸到多棟大樓或資料中心，並透過光纖通道將所有站台連接起來的單一叢集。此叢集在各節點之間使用多點傳送或單點傳播進行通訊，並在內部管理容錯移轉。網路延遲通常比較短 (距離約為 20 英里時，小於 5 毫秒)。對儲存的複製很頻繁 (鏡像複製或同步複製)。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Geo 叢集 (多站點叢集)</term>
     <listitem>
      <para>
       多個地理位置分散的站台，每個站台都有一個本地叢集。這些站台透過 IP 進行通訊。站台間的容錯移轉由一個更高階的實體來調節控制。Geo 叢集需要克服有限網路頻寬與高延遲的問題。儲存是以非同步模式複製。
      </para>
      <note>
       <title>Geo 叢集和 SAP 工作負載</title>
       
       <para>
        目前，Geo 叢集既不支援 SAP HANA 系統複製，也不支援 SAP S/4HANA 和 SAP NetWeaver 排入佇列複製設定。
       </para>
      </note>
     </listitem>
    </varlistentry>
   </variablelist>
   <para>
    各叢集節點之間的地理位置相隔越遠，可能干擾叢集所提供服務的高可用性的因素就越多。網路延遲、有限的頻寬和對儲存的存取是遠距離叢集面臨的主要挑戰。
   </para>

  </sect2>

  <sect2 xml:id="sec-ha-features-ra">
   <title>資源代理程式</title>
   <para>
    SUSE Linux Enterprise High Availability 包含許多資源代理程式，用於管理 Apache、IPv4 和 IPv6 等資源。它還內建有適用於 IBM WebSphere Application Server 等廣受歡迎的協力廠商應用程式的資源代理程式。如需產品隨附的 Open Cluster Framework (OCF) 資源代理程式綜覽，請依照<command>crm
    ra</command>所述使用 <xref linkend="sec-ha-manual-config-ocf"/> 指令。
   </para>
  </sect2>

  <sect2 xml:id="sec-ha-features-tools">
   <title>簡單易用的管理工具</title>
   <para>
    SUSE Linux Enterprise High Availability 隨附了一套強大的工具。您可使用這些工具進行基本的叢集安裝和設定，並能實現高效的組態設定和管理：
   </para>
   <variablelist>
    <varlistentry>
     <term>YaST </term>
     <listitem>
      <para>
       用於一般系統安裝和管理的圖形使用者介面。使用此使用者介面，可依《安裝與設定快速入門》所述，在 SUSE Linux Enterprise Server 的基礎上安裝 SUSE Linux Enterprise High Availability。YaST 在 High Availability Extension 類別中還提供了以下模組，可以幫助您設定叢集或個別元件：
      </para>
      <itemizedlist>
       <listitem>
        <para>
         叢集：基本叢集設定。如需詳細資訊，請參閱<xref linkend="cha-ha-ycluster"/>。
        </para>
       </listitem>
       <listitem>
        <para>
         DRBD：分散式複製區塊裝置的組態。
        </para>
       </listitem>
       <listitem>
        <para>
         IP 負載平衡：使用 Linux 虛擬伺服器或 HAProxy 實作負載平衡的組態。如需詳細資訊，請參閱<xref linkend="cha-ha-lb"/>。
        </para>
       </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>Hawk2</term>
     <listitem>
      <para>
       您可以在 Linux 或非 Linux 機器上使用方便使用的 Web 介面來監控和管理高可用性叢集。您可使用 (圖形) 網頁瀏覽器從叢集內外的任何機器存取 Hawk2。因此，即便您使用的只是提供精簡圖形使用者介面的系統，也能完美滿足您的需求。如需詳細資料，請參閱<xref linkend="cha-conf-hawk2"/>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><command>crm</command> 外圍程序
     </term>
     <listitem>
      <para>
       一款功能強大的整合式指令列介面，用於設定資源以及執行所有監控或管理任務。如需詳細資訊，請參閱<xref linkend="cha-ha-manual-config"/>。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
 </sect1>
 <sect1 xml:id="sec-ha-benefits">
  <title>優點</title>

  <para>
   使用 SUSE Linux Enterprise High Availability，您可以將多達 32 個 Linux 伺服器設定成一個高可用性叢集 (HA 叢集)。資源可在叢集中的任何節點之間動態切換或移動。資源可以設定為在發生節點故障時自動進行移轉，您也可以手動移動資源以對硬體進行疑難排解或平衡工作負載。
  </para>

  <para>
   SUSE Linux Enterprise High Availability 能夠提供商用元件的高可用性。透過將應用程式和操作整合到一個叢集可降低成本。SUSE Linux Enterprise High Availability 還允許您集中管理整個叢集。您可以調整資源以符合不斷變化的工作負載要求 (即對叢集進行手動<quote>負載平衡</quote>)。允許具有兩個以上節點的叢集還可透過允許幾個節點共用一個<quote>熱備用</quote>來節省成本。
  </para>

  <para>
   它還具有另一個同等重要的優點，就是可以潛在地減少計畫外的服務中斷運作時間，以及為了執行軟體和硬體的維護與升級而進行的計畫內中斷運作時間。
  </para>

  <para>
   您希望實作叢集的理由包括：
  </para>

  <itemizedlist>
   <listitem>
    <para>
     增加可用性
    </para>
   </listitem>
   <listitem>
    <para>
     改善效能
    </para>
   </listitem>
   <listitem>
    <para>
     降低運作成本
    </para>
   </listitem>
   <listitem>
    <para>
     可延展性
    </para>
   </listitem>
   <listitem>
    <para>
     災害復原
    </para>
   </listitem>
   <listitem>
    <para>
     資料保護
    </para>
   </listitem>
   <listitem>
    <para>
     伺服器整合
    </para>
   </listitem>
   <listitem>
    <para>
     儲存整合
    </para>
   </listitem>
  </itemizedlist>

  <para>
   藉由在共用磁碟子系統上建置 RAID ，可以達到磁碟容錯共用。
  </para>

  <para>
   以下情境說明了 SUSE Linux Enterprise High Availability 可以提供的一些優勢。
  </para>

  <bridgehead>範例叢集情境</bridgehead>

  <para>
   假設您已設定一個含有三個節點的叢集，並在該叢集內的每個節點上都安裝了 Web 伺服器。叢集中的每個節點都代管兩個網站。每個網站上的所有資料、圖形以及網頁內容都儲存在與叢集中的每個節點相連接的共享磁碟子系統上。以下的圖解可以描繪這個設定的可能外觀。
  </para>

  <figure>
   <title>由三部伺服器構成的叢集</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ha_cluster_example1.png" width="80%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ha_cluster_example1.png" width="85%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   正常的叢集操作期間，每個節點都會與叢集中的其他節點保持通訊，並會定期輪詢所有已註冊的資源以偵測是否有故障發生。
  </para>

  <para>
   假設 Web 伺服器 1 發生硬體或軟體問題，且利用 Web 伺服器 1 進行網際網路存取、收發電子郵件和資訊的使用者失去連接。下圖說明當 Web 伺服器 1 發生故障時，資源移動的情形。
  </para>

  <figure>
   <title>由三部伺服器構成的叢集 (一部伺服器出現故障後)</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ha_cluster_example2.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ha_cluster_example2.png" width="75%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   網站 A 將移至 Web 伺服器 2，而網站 B 將移至 Web 伺服器 3。IP 位址和證書也會移至 Web 伺服器 2 和 Web 伺服器 3。
  </para>

  <para>
   當您進行叢集設定時，可以決定發生故障時每一台 Web 伺服器上代管之網站的移動目的地。在前面的範例中，將網站 A 設定為移至 Web 伺服器 2，而將網站 B 設定為移至 Web 伺服器 3。這樣一來，之前由 Web 伺服器 1 處理的工作負載仍可用，並將在所有正常運行的叢集成員之間平均分散。
  </para>

  <para>
   Web 伺服器 1 發生故障時，High Availability 軟體執行了以下操作：
  </para>

  <itemizedlist>
   <listitem>
    <para>
     偵測到故障並向 STONITH 確認 Web 伺服器 1 確實已停止運行。STONITH 是<quote>Shoot The Other Node In The Head</quote>(關閉另一個節點) 的首字母縮略字。它是一種關閉行為異常節點的方式，可防止這些節點在叢集中引發問題。
    </para>
   </listitem>
   <listitem>
    <para>
     將先前掛接於 Web 伺服器 1 上的共享資料目錄重新掛接於 Web 伺服器 2 和 Web 伺服器 3。
    </para>
   </listitem>
   <listitem>
    <para>
     在 Web 伺服器 2 和 Web 伺服器 3 上重新啟動先前於 Web 伺服器 1 上執行的應用程式。
    </para>
   </listitem>
   <listitem>
    <para>
     將 IP 位址傳送至 Web 伺服器 2 和 Web 伺服器 3。
    </para>
   </listitem>
  </itemizedlist>

  <para>
   在此範例中，容錯移轉程序會快速完成，而使用者也將在數秒內重新獲得存取網站資訊的能力，並且通常無需再次登入。
  </para>

  <para>
   現在假設 Web 伺服器 1 所發生的問題已經解決，並且它已恢復到正常的操作狀態。此時，網站 A 和網站 B 可以自動容錯回復 (移回) 到 Web 伺服器 1，也可以保留在現有伺服器上。這取決於您是如何為他們設定資源的。將服務移轉回 Web 伺服器 1 會造成一段時間停機。因此，SUSE Linux Enterprise High Availability 也允許您選擇延遲移轉，等到只會產生短暫或不會產生服務中斷時再進行移轉。兩種備選方法各有優缺點。
  </para>

  <para>
   SUSE Linux Enterprise High Availability 還提供資源移轉功能。您可以根據系統管理的需要將應用程式、網站等移至叢集中的其他伺服器。
  </para>

  <para>
   例如，您可以手動將網站 A 或網站 B 從 Web 伺服器 1 移至叢集中的任一其他伺服器。此操作的使用案例包括，對 Web 伺服器 1 進行升級或執行排程維護，或者提高網站的效能或存取性。
  </para>
 </sect1>
 <sect1 xml:id="sec-ha-clusterconfig">
  <title>叢集組態：儲存</title>

  <para>
   使用 SUSE Linux Enterprise High Availability 的叢集組態可能包括共用磁碟子系統，也可能不包括。共享磁碟子系統可以透過高速光纖通道卡、纜線和交換器進行連接，也可設定為使用 iSCSI。如果有一個節點發生故障，叢集中的另一個指定節點就會自動掛接先前掛接於故障節點上的共用磁碟目錄。這使得網路使用者得以繼續存取共用磁碟子系統上的目錄。
  </para>

  <important>
   <title>具有 LVM 的共用磁碟子系統</title>
   <para>
    使用具有 LVM 的共用磁碟子系統時，必須將該子系統連接至叢集中需要存取它的所有伺服器。
   </para>
  </important>

  <para>
   一般資源包括資料、應用程式和服務。下圖顯示典型光纖通道叢集組態的可能構成。綠色線表示與乙太網網路電源開關的連接。如此裝置便可透過網路控制，並可在 ping 申請失敗時將節點重新開機。
  </para>

  <figure>
   <title>一般的光纖通道叢集組態</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ha_cluster_example3.png" width="80%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ha_cluster_example3.png" width="85%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   雖然光纖通道提供的效能最佳，但您仍可以將叢集設定為使用 iSCSI。iSCSI 是光纖通道的替代方案，可用於建立低成本的儲存區域網路 (SAN)。下圖顯示一般 iSCSI 叢集組態的可能外觀。
  </para>

  <figure>
   <title>一般的 iSCSI 叢集組態</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ha_cluster_example4.png" width="100%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ha_cluster_example4.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>

  <para>
   雖然大多數叢集都包含共用磁碟子系統，但您也可以建立不含共用磁碟子系統的叢集。下圖顯示不含共用磁碟子系統之叢集的可能外觀。
  </para>

  <figure>
   <title>不含共用儲存的一般叢集組態</title>
   <mediaobject>
    <imageobject role="fo">
     <imagedata fileref="ha_cluster_example5.png" width="80%"/>
    </imageobject>
    <imageobject role="html">
     <imagedata fileref="ha_cluster_example5.png" width="100%"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>
 <sect1 xml:id="sec-ha-architecture">
  <title>結構</title>

  <para>
   本節提供了 SUSE Linux Enterprise High Availability 架構的簡要綜覽。它識別並提供有關結構元件的資訊，並說明這些元件如何相互操作。
  </para>

  <sect2 xml:id="sec-ha-architecture-layers">
   <title>架構層</title>
   <para>
    SUSE Linux Enterprise High Availability 具有分層架構。<xref linkend="fig-ha-architecture" xrefstyle="FigureXRef"/> 說明不同的層及其相關的元件。
   </para>
   <figure xml:id="fig-ha-architecture">
    <title>結構</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="cluster_stack_arch.png" width="100%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="cluster_stack_arch.png" width="100%"/>
     </imageobject>
    </mediaobject>
   </figure>
 
   <sect3 xml:id="sec-ha-architecture-layers-coro">
    <title>成員資格和訊息傳送層 (Corosync)</title>
    <para>
     此元件提供可靠的訊息傳送、成員資格，以及關於叢集的仲裁資訊。相應的程序由 Corosync 叢集引擎 (一個群組通訊系統) 進行處理。
    </para>
   </sect3>
   <sect3 xml:id="sec-ha-architecture-layers-crm">
    <title>叢集資源管理員 (Pacemaker)</title>
     <para>
      用作叢集資源管理員的 Pacemaker 是對叢集中所發生事件做出回應的<quote>大腦</quote>。它是做為 <systemitem class="daemon">pacemaker-controld</systemitem> 執行的，即，協調所有動作的叢集控制器。例如，節點加入或退出叢集、資源故障，或者維護等排程的活動均為事件。
     </para>
    <variablelist>
     <varlistentry xml:id="vle-lrm">
      <term>本地資源管理員</term>
      
      <listitem>
      <para>
        本地資源管理員位於每個節點上的 Pacemaker 層與資源層之間。它實作為 <systemitem class="daemon">pacemaker-execd</systemitem> 精靈。透過此精靈，Pacemaker 可以啟動、停止和監控資源。
      </para>
      </listitem>
     </varlistentry>
      <varlistentry xml:id="vle-cib">
       <term>叢集資訊資料庫 (CIB)</term>
       <listitem>
        <para>
         Pacemaker 在每個節點上維護叢集資訊資料庫 (CIB)。CIB 是叢集組態的 XML 表示 (包括叢集選項、節點、資源、條件約束及其相互之間的關係)。CIB 也反映目前叢集狀態。每個叢集節點包含一個在整個叢集中同步的 CIB 複本。<systemitem class="daemon">pacemaker-based</systemitem> 精靈會處理叢集組態和狀態的讀取及寫入。</para>
       </listitem>
      </varlistentry>
     <varlistentry xml:id="vle-dc">
      <term>指定協調者 (DC)</term>
      <listitem>
       <para>
        DC 是從叢集中的所有節點選出的。如果目前沒有 DC，或者目前的 DC 出於任何原因退出叢集，則就會依此方式選出 DC。DC 是叢集中可以決定是否需要執行全叢集變更 (例如圍籬區隔節點或移動資源) 的唯一實體。所有其他節點均從目前 DC 取得其組態和資源配置資訊。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry xml:id="vle-pe">
      <term>規則引擎</term>
      
      <listitem>
       <para>
        規則引擎在每個節點上執行，但 DC 上的引擎是使用中的引擎。該引擎實作為 <systemitem class="daemon">pacemaker-schedulerd</systemitem> 精靈。需要叢集轉換時，<systemitem class="daemon">pacemaker-schedulerd</systemitem> 會根據目前的狀態和組態，計算叢集的下一預期狀態。它會確定需要排程哪些動作來達到下一種狀態。
       </para>
      </listitem>
     </varlistentry>
   </variablelist>
   </sect3>
   <sect3 xml:id="sec-ha-architecture-layers-rsc">
    <title>資源和資源代理程式</title>
    <para>
     在高可用性叢集中，資源是指需要保持高度可用的服務。資源代辦 (RA) 是用於啟動、停止和監控叢集資源的指令碼。
    </para>
   </sect3>
  </sect2>

  <sect2 xml:id="sec-ha-architecture-processflow">
   <title>處理流程</title>
   <para>
    <systemitem class="daemon">pacemakerd</systemitem> 精靈可啟動並監控其他所有相關精靈。用於協調所有動作的精靈 <systemitem class="daemon">pacemaker-controld</systemitem> 在每個叢集節點上都有一個例項。Pacemaker 會選出其中一個例項做為主要例項，以集中做出所有叢集決策。如果選出的 <systemitem class="daemon">pacemaker-controld</systemitem> 精靈出現故障，則會建立一個新的主要精靈。
   </para>
   <para>
    在叢集中執行的許多動作都會導致全叢集發生變更。這些動作包括新增或移除叢集資源，或變更資源條件約束等。執行此類動作時，必須瞭解叢集中會發生什麼狀況。
   </para>
   <para>
    例如，假設您要新增叢集 IP 位址資源。為此，您可以使用 crm 外圍程序或 Web 介面來修改 CIB。不需要在 DC 上執行動作。您可以在叢集中的任何節點上使用以上任一工具，變更將會轉送至 DC。然後，DC 會將 CIB 變更複製到所有叢集節點。
   </para>
   <para>
    隨後 <systemitem class="daemon">pacemaker-schedulerd</systemitem> 將根據 CIB 中的資訊，計算叢集的理想狀態以及應如何達到該狀態。它會將指令清單饋送給 DC。DC 透過訊息傳送/基礎架構層送出指令，而這些指令將由其他節點上的 <systemitem class="daemon">pacemaker-controld</systemitem> 對等體接收。每個對等體使用自身的本地資源代理程式執行程式 (實作為 <systemitem class="daemon">pacemaker-execd</systemitem>) 來執行資源修改。<systemitem class="daemon">pacemaker-execd</systemitem> 不具有叢集感知能力，它直接與資源代理程式互動。
   </para>
   <para>
    所有對等節點都會將其操作結果報告給 DC。DC 確定已在叢集中成功執行了所有必要的操作後，叢集就會轉回閒置狀態，等待以後的事件。如果有任何操作未按計畫執行，則會用 CIB 中記錄的新資訊再次呼叫 <systemitem class="daemon">pacemaker-schedulerd</systemitem>。
   </para>
   <para>
    在某些情況下，可能需要關閉節點以保護共用資料或完成資源復原。在 Pacemaker 叢集中，節點層級圍籬區隔的實作為 STONITH。為此，Pacemaker 隨附了一個圍籬區隔子系統 <systemitem class="daemon">pacemaker-fenced</systemitem>。必須將 STONITH 裝置設定為叢集資源 (使用特定的圍籬區隔代理程式的資源)，如此便可以監控圍籬區隔裝置。當用戶端偵測到故障時，會將一個要求傳送至 <systemitem class="daemon">pacemaker-fenced</systemitem>，後者再執行圍籬區隔代理程式來關閉節點。
   </para>
  </sect2>
 </sect1>
</chapter>
