<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:dm="urn:x-suse:ns:docmanager" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_requirements.xml" version="5.0" xml:id="cha-ha-requirements">
  <?dbfo-need height="10em"?>

  <title>系統要求和建議</title>
 <info>
      <abstract>
        <para>
    下面的小節介紹 SUSE® Linux Enterprise High Availability 的系統要求和先決條件。此外，還提供了關於叢集設定的建議。
   </para>
      </abstract>
  <dm:docmanager>
   <dm:maintainer/>
   <dm:status>editing</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>yes</dm:translation>
   <dm:languages/>
   <dm:release/>
   <dm:repository/>
  </dm:docmanager>
    </info>
    <sect1 xml:id="sec-ha-requirements-hw">
  <title>硬體需求</title>

  <para>
   下面的清單指出了基於 SUSE® Linux Enterprise High Availability 的叢集的硬體要求。這些要求代表最低硬體組態。依您打算如何使用叢集而定，您可能還需要其他硬體。
  </para>

  <variablelist>
   <varlistentry>
    <term>伺服器</term>
    <listitem>
     <para> 1 至 32 部安裝了<xref linkend="sec-ha-requirements-sw"/> 中所指定之軟體的 Linux 伺服器。 </para>
     <para>
      伺服器可以是裸機，也可以是虛擬機器。兩部伺服器不需要使用相同的硬體 (記憶體、磁碟空間等)，但它們的架構必須相同。系統不支援跨平台叢集。
     </para>
     <para> 使用 <literal>pacemaker_remote</literal> 可擴充叢集使其突破 32 個節點的限制，以包含更多的 Linux 伺服器。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>通訊通道</term>
    <listitem>
       <para>
       每個叢集節點至少有兩個 TCP/IP 通訊媒體。網路設備必須支援您希望用於叢集通訊的通信方式：多點傳播或單路廣播。通訊媒體應支援 100 Mbit/s 或更高的資料速率。對於受支援的叢集設定，需要兩個或更多備援通訊路徑。可以透過以下方式來實現：</para>
       <itemizedlist>
        <listitem>
         <para>
          網路裝置結合 (建議選項)
         </para>
        </listitem>
        <listitem>
         <para>
          Corosync 中的另一個通訊通道
         </para>
        </listitem>
       </itemizedlist>
     <para>如需詳細資料，請分別參閱<xref linkend="cha-ha-netbonding"/>和<xref linkend="pro-ha-installation-setup-channel2"/>。
      
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>節點圍籬區隔/STONITH</term>
    <listitem>
      <para>
      為了避免發生<quote>電腦分裂</quote>情況，叢集需要有節點圍籬區隔機制。在電腦分裂情況下，叢集節點會因硬體或軟體故障或者網路連接中斷而分割成兩個或更多互不相識的群組。圍籬區隔機制會隔離存在問題的節點 (通常是透過重設節點或關閉節點的電源)。這也稱為 STONITH (<quote>將其他節點爆頭</quote>)。節點圍籬區隔機制可以是實體裝置 (電源開關)，也可以是 SBD (依磁碟 STONITH) 等機制與監視程式相結合。使用 SBD 需要共用儲存。
     </para>
     <para>除非使用了 SBD，否則高可用性叢集中的每個節點都必須至少有一個 STONITH 裝置。強烈建議每個節點上有多個 STONITH 裝置。</para>
      <important>
      <title>不支援沒有 STONITH 的組態</title>
      <itemizedlist>
       <listitem>
        <para>您必須為叢集設定節點圍籬區隔機制。</para>
       </listitem>
       <listitem>
        <para>全域叢集選項 <systemitem>stonith-enabled</systemitem> 和 <systemitem>startup-fencing</systemitem> 必須設定為 <literal>true</literal>。如果您變更這些選項，將會失去支援。</para>
       </listitem>
      </itemizedlist>
      </important>
    </listitem>
  </varlistentry>
  </variablelist>
 </sect1>
<?dbfo-need height="10em"?>

 <sect1 xml:id="sec-ha-requirements-sw">
  <title>軟體要求</title>

  <para>
   所有節點上至少需要安裝以下模組和延伸：
  </para>

<itemizedlist>
   <listitem>
    <para>Basesystem Module 15 SP6</para>
   </listitem>
   <listitem>
    <para>Server Applications Module 15 SP6</para>
   </listitem>
   <listitem>
    <para>SUSE Linux Enterprise High Availability 15 SP6</para>
   </listitem>
  </itemizedlist>

  <para>
   根據您在安裝期間選取的系統角色，預設會安裝以下軟體模式：
  </para>
  <variablelist>
   <varlistentry>
    <term>HA 節點系統角色</term>
    <listitem>
     <para>
      高可用性 (<literal>sles_ha</literal>)
     </para>
     <para>
      增強型基礎系統 (<literal>enhanced_base</literal>)
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>HA GEO 節點系統角色</term>
    <listitem>
     <para>
      Geo Clustering for High Availability (<literal>ha_geo</literal>)
     </para>
     <para>
      增強型基礎系統 (<literal>enhanced_base</literal>)
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <note>
   <title>精簡安裝</title>
   <para>
    透過這些系統角色安裝只能完成最小安裝。必要時，您可能需要手動新增更多套件。</para>
   <para>
    對於原先指定了另一個系統角色的機器，您需要手動安裝 <systemitem>sles_ha</systemitem> 或 <systemitem>ha_geo</systemitem> 模式，以及所需的任何其他套件。
   </para>
  </note>
 </sect1>
 <sect1 xml:id="sec-ha-requirements-disk">
  <title>儲存要求</title>

  <para>
   有些服務需要使用共用儲存。如果使用外部 NFS 共用，必須能夠從所有叢集節點透過備援通訊路徑可靠地存取該共用。</para>
  <para>為了確保資料的高可用性，我們建議您為叢集使用共用磁碟系統 (儲存區域網路，即 SAN)。如果使用共用磁碟子系統，請注意下列事項：
  </para>

  <itemizedlist>
   <listitem>
    <para>
     已根據製造商的指示正確設定共用磁碟系統，而且可以正常運作。
    </para>
   </listitem>
   <listitem>
    <para>
     共用磁碟系統中包含的磁碟應設定為使用鏡像複製或 RAID，以增強共用磁碟系統的容錯能力。
    </para>
   </listitem>
   <listitem>
    <para>
     如果使用 iSCSI 存取共用磁碟系統，必須確定已正確設定 iSCSI 啟動程式和目標。
    </para>
   </listitem>
   <listitem>
    <para>
     使用 DRBD* 實作在兩台機器間配送資料的鏡像 RAID 系統時，請務必只存取 DRBD 提供的裝置，切勿存取備份裝置。若要利用備援，可以使用叢集剩餘元件中所用的相同 NIC。
    </para>
   </listitem>
  </itemizedlist>
  <para>
   如果使用 SBD 做為 STONITH 機制，則共用儲存還需要符合其他要求。如需詳細資料，請參閱<xref linkend="sec-ha-storage-protect-req"/>。
   </para>
 </sect1>
 <sect1 xml:id="sec-ha-requirements-other">
  <title>其他要求與建議</title>

  <para>
   為了實現受支援且有用的高可用性設定，請考慮以下建議：
  </para>

  <variablelist>
   <varlistentry xml:id="vle-ha-req-nodes">
    <term>叢集節點數</term>
    <listitem>
     <para>對於包含兩個以上節點的叢集，強烈建議使用奇數數量的叢集節點，以便具有仲裁能力。如需仲裁的詳細資訊，請參閱<xref linkend="sec-ha-config-basics-global"/>。一個一般叢集最多只能包含 32 個節點。憑藉 <systemitem class="daemon">pacemaker_remote</systemitem> 服務，可以將高可用性叢集進行延伸，使其包含超出此限制的額外節點。請參閱《Pacemaker 遠端快速入門》以獲取更多詳細資料。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>時間同步</term>
     <listitem>
   <para>
     叢集節點必須與叢集外的 NTP 伺服器同步。自 SUSE Linux Enterprise High Availability 15 起，採用 chrony 做為 NTP 的預設實作。如需詳細資訊，請參閱<link xlink:href="https://documentation.suse.com/sles-15/html/SLES-all/cha-ntp.html">
     Administration Guide for SUSE Linux Enterprise Server 15 SP6</link>。
    </para>
    <para>
     如果未同步節點，或者即使已同步節點但設定了不同的時區，叢集也可能無法正常運作。此外，記錄檔案和叢集報告在未同步的情況下很難進行分析。使用開機程序檔時，若尚未設定 NTP，系統會向您發出警告。
    </para>
  </listitem>
   </varlistentry>
   <varlistentry>
    <term>網路介面卡 (NIC) 名稱</term>
    <listitem>
     <para>
      在所有節點上都必須相同。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>主機名稱與 IP 位址</term>
    <listitem>
     <itemizedlist>
      <listitem>
       <para>
        使用靜態 IP 位址。
       </para>
      </listitem>
      <listitem>
       <para>
        只支援主要 IP 位址。
       </para>
      </listitem>
      <listitem>
        <para>
     在 <filename>/etc/hosts</filename> 檔案中列出所有叢集節點，包括各自的完整網域主機名稱和簡短主機名稱。叢集的成員必須能夠籍由名稱找到彼此，這是一項基本要求。如果名稱不可用，內部叢集通訊將會失敗。
   </para>
       <para>
        如需 Pacemaker 如何取得節點名稱的詳細資料，請參閱 <link xlink:href="https://clusterlabs.org/doc/en-US/Pacemaker/1.1/html/Pacemaker_Explained/s-node-name.html"/>。
       </para>
      </listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-ha-req-ssh">
    <term>SSH</term>
    <listitem>
      <para>
    所有叢集節點必須能透過 SSH 互相存取。<command>crm report</command> (用於疑難排解) 等工具和 Hawk2 的<guimenu>歷程總管</guimenu>要求節點之間透過無密碼 SSH 方式來存取，否則它們只能從目前節點收集資料。
  </para>
     <para>
      如果使用開機指令碼設定叢集，系統會自動建立並複製 SSH 金鑰。如果使用 YaST 叢集模組設定叢集，您必須自行設定 SSH 金鑰。
     </para>
     <note>
      <title>法規要求</title>
      <para>
       依預設，叢集以 <systemitem class="username">root</systemitem> 使用者身分執行操作。如果無密碼 <systemitem class="username">root</systemitem> SSH 存取不符合法規要求，您可以將叢集設定為具有 <command>sudo</command> 權限的使用者。此使用者可以執行叢集操作，包括 <command>crm report</command>。
      </para>
      <para>
       此外，如果無法將 SSH 金鑰直接儲存在節點上，可以改為透過 SSH 代理程式轉遞來使用本地 SSH 金鑰 (如<xref linkend="sec-ha-manual-config-crm-user-privileges"/>所述)。
      </para>
      <para>
       如果安全性規則更為嚴格，您可以依照<xref linkend="sec-crmreport-nonroot-sudo"/>所述，設定一個僅擁有受限 <command>sudo</command> 權限的非 root 使用者來專門執行 <command>crm report</command>。
      </para>
      <para>
       對於<guimenu>歷程總管</guimenu>，目前還沒有其他方式可替代無密碼登入。
      </para>
     </note>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
</chapter>
