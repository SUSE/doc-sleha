<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_hawk2_batch_i.xml" version="5.0" xml:id="sec-conf-hawk2-batch">
 <title>使用批次模式</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer/>
   <dm:status>editing</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>yes</dm:translation>
   <dm:languages/>
   <dm:release/>
   <dm:repository/>
  </dm:docmanager>
 </info>

 <para>
  Hawk2 提供<guimenu>批次模式</guimenu>，包括<emphasis>叢集模擬器</emphasis>。該模式可用於以下操作：
 </para>

 <itemizedlist>
  <listitem>
   <para>
    對叢集進行分階段變更並透過單次交易套用這些變更，而不是讓每項變更立即生效。
   </para>
  </listitem>
  <listitem>
   <para>
    模擬變更和叢集事件，例如，瞭解可能失敗的情況。
   </para>
  </listitem>
 </itemizedlist>

 <para>
  例如，在建立相互依賴的資源群組時，可以使用批次模式。透過使用批次模式，您可以避免將中繼或不完整的組態套用到叢集。
 </para>

 <para>
  啟用批次模式後，您可以新增或編輯資源和條件約束，或變更叢集組態。此外，還可以模擬叢集中的事件，包括變為線上或離線的節點、資源操作，以及要授予或撤銷的票證。如需詳細資料，請參閱<xref linkend="pro-hawk2-batch-inject"/>。
 </para>

 <para>
  <emphasis>叢集模擬器</emphasis>會在每次變更後自動執行，並在使用者介面上顯示預期效果。舉例而言，這還意味著當您在批次模式下停止某資源時，使用者介面上會將該資源顯示為已停止，但實際上，該資源仍在執行中。
 </para>

 <important>
  <title>線上系統的精靈和變更</title>
  <para>
   某些精靈包含除純叢集組態以外的其他動作。在批次模式下使用這些精靈時，叢集組態以外的任何其他變更都將立即套用到線上系統。
  </para>
  <para>
   因此，需要 <systemitem class="username">root</systemitem> 許可權的精靈無法在批次模式下執行。
  </para>
 </important>

 <procedure xml:id="pro-conf-hawk2-manage-monitor-batch">
  <title>使用批次模式</title>
  <step>
   <para>
    登入 Hawk2：
   </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
  </step>
  <step>
   <para>
    若要啟用批次模式，請從頂層列選取<guimenu>批次</guimenu>。
   </para>
   <para>
    頂層列下方即會另外顯示一列，指出批次模式處於使用中狀態，並會包含指向您可在批次模式下執行的動作的連結。
   </para>
   <figure xml:id="fig-hawk2-batch">
    <title>Hawk2 批次模式已啟用</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="hawk2-batchmode-active.png" width="100%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="hawk2-batchmode-active.png" width="100%"/>
     </imageobject>
    </mediaobject>
   </figure>
  </step>
  <step>
   <para>
    當批次模式處於使用中狀態時，對叢集執行任意變更，例如新增或編輯資源和條件約束，或編輯叢集組態。
   </para>
   <para>
    系統將會模擬變更，並將其顯示在所有螢幕上。
   </para>
  </step>
  <step>
   <para>
    若要檢視所做變更的詳細資料，請從批次模式列中選取<guimenu>顯示</guimenu>。<guimenu>批次模式</guimenu>視窗即會開啟。
   </para>
   <para>
    對於任何組態變更，該模式會以 crmsh 語法顯示線上狀態與模擬變更之間的差異：以 <literal>-</literal> 字元開頭的行表示目前狀態，而以 <literal>+</literal> 開頭的行則顯示預期狀態。
   </para>
  </step>
  <step>
   <para>
    若要插入事件或檢視更多詳細資料，請參閱<xref linkend="pro-hawk2-batch-inject" xrefstyle="select:label"/>。否則請<guimenu>關閉</guimenu>視窗。
   </para>
  </step>
  <step>
   <para>
    選擇是<guimenu>丟棄</guimenu>還是<guimenu>套用</guimenu>模擬的變更，然後確認您的選擇。此操作還會停用批次模式，使您回到正常模式。
   </para>
  </step>
 </procedure>

 <para>
  在批次模式下執行時，Hawk2 還允許您插入<guimenu>節點事件</guimenu>和<guimenu>資源事件</guimenu>。
 </para>

 <variablelist>
  <varlistentry>
   <term><guimenu>節點事件</guimenu>
   </term>
   <listitem>
    <para>
     可讓您變更節點的狀態。可用的狀態有<guimenu>線上</guimenu>、<guimenu>離線</guimenu>和<guimenu>不正常</guimenu>。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><guimenu>資源事件</guimenu>
   </term>
   <listitem>
    <para>
     可讓您變更資源的一些內容。例如，您可以設定操作 (如 <literal>start</literal>、<literal>stop</literal>、<literal>monitor</literal>)、其要套用到的節點，以及要模擬的預期結果。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><guimenu>票證事件</guimenu>
   </term>
   <listitem>
    <para>
     可讓您測試授予和撤銷票證 (用於 Geo 叢集) 的影響。
    </para>
   </listitem>
  </varlistentry>
 </variablelist>

 <procedure xml:id="pro-hawk2-batch-inject">
  <title>插入節點、資源或票證事件</title>
  <step>
   <para>
    登入 Hawk2：
   </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
  </step>
  <step>
   <para>
    如果批次模式尚未啟動，請按一下頂層列上的<guimenu>批次</guimenu>以切換到批次模式。
   </para>
  </step>
  <step>
   <para>
    在批次模式列中，按一下<guimenu>顯示</guimenu>以開啟<guimenu>批次模式</guimenu>視窗。
   </para>
  </step>
  <step>
   <para>
    若要模擬節點的狀態變更：
   </para>
   <substeps>
    <step>
     <para>
      按一下<menuchoice> <guimenu>插入</guimenu> <guimenu>節點事件</guimenu> </menuchoice>。
     </para>
    </step>
    <step>
     <para>
      選取您要操作的<guimenu>節點</guimenu>，並選取其目標<guimenu>狀態</guimenu>。
     </para>
    </step>
    <step>
     <para>
      確認您的變更。您的事件便會新增至<guimenu>批次模式</guimenu>對話方塊中所列的事件佇列中。
     </para>
    </step>
   </substeps>
  </step>
  <step>
   <para>
    若要模擬某個資源作業：
   </para>
   <substeps>
    <step>
     <para>
      按一下<menuchoice> <guimenu>插入</guimenu> <guimenu>資源事件</guimenu> </menuchoice>。
     </para>
    </step>
    <step>
     <para>
      選取要操作的<guimenu>資源</guimenu>和要模擬的<guimenu>操作</guimenu>。
     </para>
    </step>
    <step>
     <para>
      如有必要，請定義一個<guimenu>間隔</guimenu>。
     </para>
    </step>
    <step>
     <para>
      選取要在其上執行該操作的<guimenu>節點</guimenu>以及預期的<guimenu>結果</guimenu>。您的事件便會新增至<guimenu>批次模式</guimenu>對話方塊中所列的事件佇列中。
     </para>
    </step>
    <step>
     <para>
      確認您的變更。
     </para>
    </step>
   </substeps>
  </step>
  <step>
   <para>
    若要模擬票證動作：
   </para>
   <substeps>
    <step>
     <para>
      按一下<menuchoice> <guimenu>插入</guimenu> <guimenu>票證事件</guimenu> </menuchoice>。
     </para>
    </step>
    <step>
     <para>
      依次選取要操作的<guimenu>票證</guimenu>和要模擬的<guimenu>動作</guimenu>。
     </para>
    </step>
    <step>
     <para>
      確認您的變更。您的事件便會新增至<guimenu>批次模式</guimenu>對話方塊中所列的事件佇列中。
     </para>
    </step>
   </substeps>
  </step>
  <step>
   <para>
    <guimenu>批次模式</guimenu>對話方塊 (<xref linkend="fig-hawk2-batch-show" xrefstyle="select:label"/>) 會為每個插入的事件顯示新的一行。此處列出的所有事件都會立即被模擬並反映到<guimenu>狀態</guimenu>螢幕上。
   </para>
   <para>
    如果您還進行了任何組態變更，線上狀態和模擬變更之間的差異會顯示在所插入事件的下方。
   </para>
   <figure xml:id="fig-hawk2-batch-show">
    <title>Hawk2 批次模式 - 插入的事件和組態變更</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="hawk2-batchmode-show.png" width="100%"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="hawk2-batchmode-show.png" width="100%"/>
     </imageobject>
    </mediaobject>
   </figure>
  </step>
  <step>
   <para>
    若要移除插入的事件，請按一下該事件旁邊的<guimenu>移除</guimenu>圖示。Hawk2 會相應地更新<guimenu>狀態</guimenu>螢幕。
   </para>
  </step>
  <step>
   <para>
    若要檢視模擬執行的更多詳細資料，請按一下<guimenu>模擬器</guimenu>並選擇以下選項之一：
   </para>
   <variablelist>
    <varlistentry>
     <term><guimenu>摘要</guimenu>
     </term>
     <listitem>
      <para>
       顯示詳細的摘要。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>CIB (入)</guimenu>/<guimenu>CIB (出)</guimenu>
     </term>
     <listitem>
      <para>
       <guimenu>CIB (入)</guimenu> 會顯示初始的 CIB 狀態。<guimenu>CIB (出)</guimenu> 會顯示轉換後 CIB 的情況。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>轉換圖表</guimenu>
     </term>
     <listitem>
      <para>
       顯示轉換的圖形表示。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>移交</guimenu>
     </term>
     <listitem>
      <para>
       顯示轉換的 XML 表示。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </step>
  <step>
   <para>
    如果您已複查模擬的變更，請關閉<guimenu>批次模式</guimenu>視窗。
   </para>
  </step>
  <step>
   <para>
    若要離開批次模式，請<guimenu>套用</guimenu>或<guimenu>丟棄</guimenu>模擬的變更。
   </para>
  </step>
 </procedure>
</sect1>
