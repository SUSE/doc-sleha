<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
  type="text/xml"
  title="Profiling step"?>
<article xmlns="http://docbook.org/ns/docbook" xmlns:its="http://www.w3.org/2005/11/its" xmlns:dm="urn:x-suse:ns:docmanager" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="article_installation.xml" version="5.2" xml:lang="zh-tw" xml:id="article-installation">
 <title>安裝與設定快速入門</title>
 <info>
  <productnumber>15 SP6</productnumber>
  <productname>SUSE Linux Enterprise High Availability</productname>
  <date><?dbtimestamp format="Y"?> 年 <?dbtimestamp format="B" padding="0"?> 月 <?dbtimestamp format="d" padding="0"?> 日
</date>
  <xi:include href="common_copyright_gfdl.xml"/>
  <abstract>
   <para>
     本文件會協助您使用 crm 外圍程序提供的開機指令碼完成最基本的雙節點叢集的設定。其中包括將虛擬 IP 位址設定為叢集資源，以及在共享儲存上使用 SBD 做為節點圍籬區隔機制。
   </para>
  </abstract>
  <dm:docmanager>
   <dm:bugtracker/>
   <dm:translation>yes</dm:translation>
  </dm:docmanager>
  <meta name="task" its:translate="no">
    <phrase>安裝</phrase>
    <phrase>管理</phrase>
    <phrase>叢集</phrase>
  </meta>
  <meta name="series" its:translate="no">產品文件</meta>
  <revhistory xml:id="rh-article-installation">
    <revision>
      <date>2024-06-26</date>
      <revdescription>
        <para>
          針對 SUSE Linux Enterprise High Availability15 SP6 的初始版本進行了更新。
        </para>
      </revdescription>
    </revision>
   </revhistory>
 </info>

  <sect1 xml:id="sec-ha-inst-quick-usage-scenario">
   <title>使用情境</title>
   <para>
    透過本文件中介紹的程序，可完成內容如下的雙節點叢集的極簡設定：
   </para>
   <itemizedlist>
    <listitem>
     <para>
      兩個節點：<systemitem class="server">alice</systemitem> (IP：<systemitem class="ipaddress">192.168.1.1</systemitem>) 和 <systemitem class="server">bob</systemitem> (IP：<systemitem class="ipaddress">192.168.1.2</systemitem>)，兩者之間透過網路彼此連接。
     </para>
    </listitem>
    <listitem>
     <para>
      一個浮動虛擬 IP 位址 (<systemitem class="ipaddress">192.168.1.10</systemitem>)，無論服務在哪個節點上執行，用戶端都可透過該位址連接至服務。此 IP 位址用於連接至圖形管理工具 Hawk2。
     </para>
    </listitem>
    <listitem>
     <para>一個共用儲存裝置，用做 SBD 圍籬區隔機制。這樣可避免出現電腦分裂情況。
     </para>
    </listitem>
    <listitem>
     <para>
      若主動主機發生故障 (<emphasis>主動/被動</emphasis>設定)，資源會從一個節點容錯移轉到另一個節點。
     </para>
    </listitem>
   </itemizedlist>
   <para>
    該雙節點叢集可用於測試的目的，也可以用做基本叢集組態，稍後再進行擴充。將該叢集用於生產環境之前，請參閱<xref linkend="book-administration"/>以根據自己的要求修改叢集。
   </para>
  </sect1>

  <sect1 xml:id="sec-ha-inst-quick-req">
   <title>系統要求</title>
   <para>
    本章介紹<xref linkend="sec-ha-inst-quick-usage-scenario" xrefstyle="select:label"/>中所述案例的關鍵系統要求。若要將叢集調整為可用於生產環境，請參閱<xref linkend="cha-ha-requirements"/>中的完整清單。
   </para>

  <sect2 xml:id="vl-ha-inst-quick-req-hw">
   <title>硬體需求</title>
   <variablelist>
    <varlistentry>
     <term>伺服器</term>
     <listitem>
      <para>
       兩部已安裝<xref linkend="il-ha-inst-quick-req-sw"/>中指定的軟體的伺服器。
      </para>
      <para>
      伺服器可以是裸機，也可以是虛擬機器。兩部伺服器不需要使用相同的硬體 (記憶體、磁碟空間等)，但它們的架構必須相同。系統不支援跨平台叢集。
     </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>通訊通道</term>
     <listitem>  <para>
       每個叢集節點至少有兩個 TCP/IP 通訊媒體。網路設備必須支援您希望用於叢集通訊的通信方式：多點傳送或單路廣播。通訊媒體應支援 100 Mbit/s 或更高的資料速率。對於受支援的叢集設定，需要兩個或更多備援通訊路徑。可以透過以下方式來實現：</para>
       <itemizedlist>
        <listitem>
         <para>
          網路裝置結合 (建議選項)
         </para>
        </listitem>
        <listitem>
         <para>
          Corosync 中的另一個通訊通道
         </para>
        </listitem>
       </itemizedlist> </listitem>
    </varlistentry>
    <varlistentry>
     <term>節點圍籬區隔/STONITH</term>
     <listitem>
      <para>
       用於防止出現電腦分裂情況的節點圍籬區隔 (STONITH) 裝置。可以是實體裝置 (電源開關)，也可以是 SBD (依磁碟 STONITH) 這樣的機制與監視程式的組合。SBD 可以與共用儲存裝置配合使用，也可以在無磁碟模式下使用。本文件介紹如何將 SBD 與共用儲存裝置配合使用。必須符合以下要求：
      </para>
      <itemizedlist>
       <listitem>
        <para>
         一部共用儲存裝置。如需設定共用儲存裝置的資訊，請參閱 <link xlink:href="https://documentation.suse.com/sles/html/SLES-all/book-storage.html">
         Storage Administration Guide for SUSE Linux Enterprise Server</link>。如果您只需要基本的共用儲存裝置來進行測試，請參閱<xref linkend="ha-iscsi-for-sbd"/>。
        </para>
       </listitem>
       <listitem>
        <para>針對叢集中的所有節點，共享儲存裝置的路徑必須永久且一致。使用穩定的裝置名稱，如 <filename>/dev/disk/by-id/dm-uuid-part1-mpath-abcedf12345</filename>。
        </para>
       </listitem>
       <listitem>
        <para> SBD 裝置<emphasis>不得</emphasis>使用基於主機的 RAID、LVM 或 DRBD*。
        </para>
       </listitem>
      </itemizedlist>
      <para>
       如需 STONITH 的詳細資訊，請參閱<xref linkend="cha-ha-fencing"/>。如需 SBD 的詳細資訊，請參閱<xref linkend="cha-ha-storage-protect"/>。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
 </sect2>
  <sect2 xml:id="il-ha-inst-quick-req-sw">
   <title>軟體要求</title>
   <para>
   所有節點上至少需要安裝以下模組和延伸：
  </para>

<itemizedlist>
   <listitem>
    <para>Basesystem Module 15 SP6</para>
   </listitem>
   <listitem>
    <para>Server Applications Module 15 SP6</para>
   </listitem>
   <listitem>
    <para>SUSE Linux Enterprise High Availability 15 SP6</para>
   </listitem>
  </itemizedlist>

  </sect2>
  <sect2 xml:id="vl-ha-inst-quick-req-other">
   <title>其他要求與建議</title>
   <variablelist>
    <varlistentry>
     <term>時間同步</term>  <listitem>
   <para>
     叢集節點必須與叢集外的 NTP 伺服器同步。自 SUSE Linux Enterprise High Availability 15 起，採用 chrony 做為 NTP 的預設實作。如需詳細資訊，請參閱<link xlink:href="https://documentation.suse.com/sles-15/html/SLES-all/cha-ntp.html">
     Administration Guide for SUSE Linux Enterprise Server 15 SP6</link>。
    </para>
    <para>
     如果未同步節點，或者即使已同步節點但設定了不同的時區，叢集也可能無法正常運作。此外，記錄檔案和叢集報告在未同步的情況下很難進行分析。使用開機指令碼時，若尚未設定 NTP，系統會向您發出警告。
    </para>
  </listitem> </varlistentry>
    <varlistentry>
     <term>主機名稱與 IP 位址</term>
     <listitem>
      <itemizedlist>
       <listitem>
        <para> 使用靜態 IP 位址。 </para>
       </listitem>
       <listitem>
        <para>
         只支援主要 IP 位址。
        </para>
       </listitem>
       <listitem>  <para>
     在 <filename>/etc/hosts</filename> 檔案中列出所有叢集節點，包括各自的完整網域主機名稱和簡短主機名稱。叢集的成員必須能夠籍由名稱找到彼此，這是一項基本要求。如果名稱不可用，內部叢集通訊將會失敗。
   </para> </listitem>
      </itemizedlist>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>SSH</term>
     <listitem>  <para>
    所有叢集節點必須能透過 SSH 互相存取。<command>crm report</command> (用於疑難排解) 等工具和 Hawk2 的<guimenu>歷程總管</guimenu>要求節點之間透過無密碼 SSH 方式來存取，否則它們只能從目前節點收集資料。
  </para> <para> 如果使用開機指令碼設定叢集，系統會自動建立並複製 SSH 金鑰。 </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect2>
  </sect1>

 <sect1 xml:id="sec-ha-inst-quick-bootstrap">
  <title>開機指令碼綜覽</title>
  <para>
   以下指令可執行只需要極少時間和手動操作的開機指令碼。
  </para>
  <itemizedlist>
   <listitem>
    <para>
     使用 <command>crm cluster init</command> 可定義叢集通訊所需的基本參數。如此可讓您擁有一個正常運作的單節點叢集。
    </para>
   </listitem>
   <listitem>
    <para>
     使用 <command>crm cluster join</command> 可將更多節點新增到叢集中。
    </para>
   </listitem>
   <listitem>
    <para>
     使用 <command>crm cluster remove</command> 可從叢集中移除節點。
    </para>
   </listitem>
  </itemizedlist>
  <para>
   開機指令碼設定的選項可能與 Pacemaker 預設設定不同。您可以在 <filename>/var/log/crmsh/crmsh.log</filename> 中查看開機指令碼變更了哪些設定。開機過程中設定的任何選項都可在之後使用 YaST 叢集模組加以修改。如需詳細資料，請參閱<xref linkend="cha-ha-ycluster"/>。
  </para>
  <para>
   開機指令碼 <command>crm cluster init</command> 會檢查並設定以下元件：
  </para>

  <variablelist>
   <varlistentry>
    <term>NTP</term>
    <listitem>
     <para>
      檢查 NTP 是否設定為在系統開機時啟動。如果未設定成這樣，一則訊息會顯示。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>SSH</term>
    <listitem>
     <para>建立 SSH 金鑰，以用於在叢集節點之間進行無密碼登入。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Csync2</term>
    <listitem>
     <para>
      設定 Csync2，讓其在叢集中的所有節點上複製組態檔案。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>Corosync</term>
    <listitem>
     <para>設定叢集通訊系統。</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>SBD/監視程式</term>
    <listitem>
     <para>檢查是否存在監視程式，並詢問您是否要將 SBD 設定為節點圍籬區隔機制。</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>虛擬浮動 IP</term>
    <listitem>
     <para>詢問您是否要設定虛擬 IP 位址，以便使用 Hawk2 進行叢集管理。</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>防火牆</term>
    <listitem>
     <para>在防火牆中開啟叢集通訊所需的連接埠。</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>叢集名稱</term>
    <listitem>
     <para>為叢集定義名稱，預設為 <systemitem>hacluster</systemitem>。叢集名稱是選擇性元件，對 Geo 叢集最有用。叢集名稱通常會反映地理位置，這樣您便可更輕鬆地識別 Geo 叢集內的站點。</para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>QDevice/QNetd</term>
    <listitem>
     <para>
      詢問您是否要設定 QDevice/QNetd，以參與仲裁決定。我們建議對節點數為偶數的叢集 (特別是雙節點叢集) 使用 QDevice 和 QNetd。
     </para>
     <para>
      本文不會介紹此組態，但您可以稍後依照<xref linkend="cha-ha-qdevice"/>所述進行此設定。
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
  <note>
    <title>不同平台的叢集組態</title>
    <para>
      <command>crm cluster init</command> 指令碼會偵測系統環境 (例如 Microsoft Azure)，並根據該環境的設定檔調整特定的叢集設定。如需詳細資訊，請參閱 <filename>/etc/crm/profiles.yml</filename> 檔案。
    </para>
  </note>
 </sect1>

  <sect1 xml:id="sec-ha-inst-quick-installation">
    <title>安裝 High Availability 套件</title>
    <para>
      <literal>High Availability</literal> 安裝模式中包含用於設定和管理叢集的套件。只有在安裝 SUSE Linux Enterprise High Availability 後，才能使用此模式。
    </para>
    <para>
      在安裝 SUSE Linux Enterprise Server 期間或之後，您可以註冊到 SUSE Customer Center 中，並安裝 SUSE Linux Enterprise High Availability。如需詳細資訊，請參閱 SUSE Linux Enterprise Server 的 <link xlink:href="https://documentation.suse.com/sles/html/SLES-all/cha-register-sle.html">
     Deployment Guide</link>。
    </para>
    <procedure xml:id="pro-ha-inst-quick-pattern">
      <title>安裝 High Availability 模式</title>
      <step>
       <para>
        從指令列安裝 High Availability 模式：</para>
<screen><prompt role="root"># </prompt><command>zypper install -t pattern ha_sles</command></screen>
      </step>
      <step>
       <para>
          在<emphasis>所有</emphasis>將成為叢集成員的機器上安裝 High Availability 模式。
       </para>
       <note>
        <title>在所有節點上安裝軟體套件</title>
        <para>
          如果要自動安裝 SUSE Linux Enterprise Server 15 SP6 和 SUSE Linux Enterprise High Availability 15 SP6，請使用 AutoYaST 複製現有節點。如需詳細資訊，請參閱<xref linkend="sec-ha-installation-autoyast"/>。
        </para>
       </note>
      </step>
    </procedure>
  </sect1>

 <sect1 xml:id="sec-ha-inst-quick-sbd">
  <title>使用 SBD 進行節點圍籬區隔</title>
   <para>
    必須在每個節點上都啟用監視程式，才能使用開機指令碼設定 SBD。SUSE Linux Enterprise Server 隨附了數個核心模組，用於提供針對特定硬體的監視程式驅動程式。SUSE Linux Enterprise High Availability 使用 SBD 精靈做為<quote>饋送</quote>監視程式的軟體元件。
   </para>
   <para>
    以下程序使用 <systemitem>softdog</systemitem> 監視程式。
   </para>

   
   <important>
    <title>Softdog 限制</title>
    <para>
     Softdog 驅動程式假設至少有一個 CPU 仍然在執行。如果所有 CPU 均已堵塞，則 softdog 驅動程式中應該將系統重新開機的代碼永遠都不會執行。相反地，即使所有 CPU 均已堵塞，硬體監視程式也仍然會繼續運作。
    </para>
    <para>強烈建議您先以最適合硬體的硬體模組取代 <systemitem>softdog</systemitem> 模組，再在生產環境中使用叢集。
    </para>
    <para>不過，如果沒有與您的硬體相符的監視程式，則可以將 <systemitem class="resource">softdog</systemitem> 當成核心監視程式模組使用。</para>
   </important>

   <procedure xml:id="pro-ha-inst-quick-sbd-setup">
    <title>對 SBD 啟用 Softdog 監視程式</title>
    <step>
     <para>
      在每個節點上啟用 softdog 監視程式：
     </para>
     
     <screen><prompt role="root"># </prompt><command>echo softdog &gt; /etc/modules-load.d/watchdog.conf</command>
<prompt role="root"># </prompt><command>systemctl restart systemd-modules-load</command></screen>
    </step>
    <step>
     <para>測試 softdog 模組是否已正確載入：
     </para>
     <screen><prompt role="root"># </prompt><command>lsmod | grep dog</command>
softdog           16384  1</screen>
    </step>
  </procedure>
 </sect1>

 <sect1 xml:id="sec-ha-inst-quick-setup-1st-node">
  <title>設定第一個節點</title>
   <para>
   使用 <command>crm cluster init</command> 指令碼設定第一個節點。此操作所需的時間和手動介入都極少。
  </para>

  <procedure xml:id="pro-ha-inst-quick-setup-crm-cluster-init">
   <title>使用 <command>crm cluster init</command> 設定第一個節點 (<systemitem class="server">alice</systemitem>)</title>
   <step>
    <para>
     以 <systemitem class="username">root</systemitem> 身分或擁有 <command>sudo</command> 權限的使用者身分登入第一個叢集節點。
    </para>
    <important>
     <title>SSH 金鑰存取</title>
     <para>
      叢集透過無密碼 SSH 存取在節點間進行通訊。<command>crm cluster init</command> 指令碼會檢查 SSH 金鑰是否存在，如果尚不存在，則會產生這些金鑰。
     </para>
     <para>
      在大多數情況下，<systemitem class="username">root</systemitem> 或 <command>sudo</command> 使用者的 SSH 金鑰必須存在於節點上 (或在其上產生)。
     </para>
     <para>
      或者，<command>sudo</command> 使用者的 SSH 金鑰可以存在於本地機器上，並透過 SSH 代理程式轉遞傳遞至節點。這需要進行額外的設定，不屬於此極簡設定的範疇。如需詳細資訊，請參閱<xref linkend="sec-ha-manual-config-crm-user-privileges"/>。
     </para>
    </important>
   </step>
   <step>
    <para>
     啟動開機指令碼：
    </para>
    <screen><prompt role="root"># </prompt><command>crm cluster init --name <replaceable>CLUSTERNAME</replaceable></command></screen>
    <para>以一個有意義的名稱 (例如叢集的地理位置 <replaceable>CLUSTERNAME</replaceable>) 取代 <literal>amsterdam</literal> 預留位置。若要在稍後建立 Geo 叢集，這樣做特別有用，因為它使站點的識別變得簡單。
    </para>
    <para>
     如果您需要使用多點傳送而不是單點傳播 (預設設定) 來進行叢集通訊，請使用選項 <option>--multicast</option> (或 <option>-U</option>)。
    </para>
    <para>
     該指令碼會檢查是否存在 NTP 組態和硬體監視程式服務。如果需要，它會產生用於 SSH 存取及 Csync2 同步的公用和私密 SSH 金鑰，並啟動相應的服務。
    </para>
   </step>
   <step>
    <para>
     設定叢集通訊層 (Corosync)：
    </para>
    <substeps>
     <step>
      <para>
       輸入要繫結到的網路位址。依預設，指令碼會建議使用網路位址 <systemitem>eth0</systemitem>。您也可以輸入不同的網路位址，如 <literal>bond0</literal> 位址。
      </para>
     </step>
     <step>
      <para>
       接受建議的連接埠 (<literal>5405</literal>) 或輸入其他連接埠。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
    將 SBD 設定為節點圍籬區隔機制：</para>
    <substeps>
     <step>
      <para>輸入 <literal>y</literal> 確認您要使用 SBD。</para>
     </step>
     <step>
      <para>輸入要為 SBD 使用的區塊裝置分割區的永久路徑。該路徑必須在叢集的所有節點間保持一致。</para>
       <para>指令碼會在裝置上建立用於 SBD 的小分割區。</para>
     </step>
    </substeps>
   </step>
   <step xml:id="st-crm-cluster-init-ip">
    <para>設定使用 Hawk2 進行叢集管理所需的虛擬 IP 位址：</para>
    <substeps>
     <step>
      <para>輸入 <literal>y</literal> 確認您要設定虛擬 IP 位址。</para></step>
     <step>
      <para>為 Hawk2 的管理 IP 輸入想要的且未使用的 IP 位址：<literal>192.168.1.10</literal>
      </para>
      <para>您可以連接到此虛擬 IP 位址，而無需使用 Hawk2 登入個別叢集節點。</para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     選擇是否設定 QDevice 和 QNetd。對於本文所述的精簡環境，暫時按 <literal>n</literal> 拒絕。您可以稍後再依照<xref linkend="cha-ha-qdevice"/>所述設定 QDevice 和 QNetd。
    </para>
   </step>
  </procedure>
  <para>
   最後，該指令碼會啟動叢集服務以使叢集上線，並啟用 Hawk2。Hawk2 要使用的 URL 會顯示在螢幕上。
  </para>

  <para>
   您現在便擁有了一個正常運作的單節點叢集。若要檢視其狀態，請執行以下步驟：
  </para>
  <procedure xml:id="pro-ha-inst-quick-hawk2-login">
   <title>登入 Hawk2 Web 介面</title>
   <step>
    <para> 在任一機器上，啟動網頁瀏覽器並確定已啟用 JavaScript 和 Cookie。 </para>
   </step>
   <step>
    <para>對於 URL，請輸入使用開機指令碼設定的虛擬 IP 位址：</para>
    <screen>https://192.168.1.10:7630/</screen>
    <note>
     <title>證書警告</title>
     <para> 當您首次嘗試存取該 URL 時，如果系統顯示證書警告，則表示使用了自行簽署的證書。依預設，自行簽署的證書不被視為可信證書。 </para>
     <para> 請咨詢您的叢集操作人員取得證書詳細資料，以驗證該證書。 </para>
     <para> 若仍要繼續，您可以在瀏覽器中新增一個例外以略過此警告。 </para>
    </note>
   </step>
   <step>
    <para> 在 Hawk2 登入畫面上，輸入開機指令碼所建立使用者的<guimenu>使用者名稱</guimenu>和<guimenu>密碼</guimenu> (使用者 <systemitem class="username">hacluster</systemitem>，密碼 <literal>linux</literal>)。</para>
    <important>
     <title>安全密碼</title>
     <para>請立即以安全的密碼取代預設密碼：
     </para>
     <screen><prompt role="root"># </prompt><command>passwd hacluster</command></screen>
    </important>
   </step>
   <step>
    <para>
     按一下<guimenu>登入</guimenu>。Hawk2 Web 介面預設會顯示「狀態」螢幕：
    </para>
    <figure xml:id="fig-ha-inst-quick-one-node-status">
     <title>Hawk2 中單節點叢集的狀態</title>
     <mediaobject>
      <imageobject>
       <imagedata width="80%" fileref="installquick-one-nodecluster.png"/>
      </imageobject>
     </mediaobject>
    </figure>
   </step>
  </procedure>
 </sect1>

 <sect1 xml:id="sec-ha-inst-quick-setup-2nd-node">
  <title>新增第二個節點</title>
  <para>
    使用 <command>crm cluster join</command> 開機指令碼將第二個節點新增至叢集。指令碼只需存取一個現有叢集節點，即可在目前的機器上自動完成基本設定。
  </para>
  <para>
   如需詳細資訊，請參閱 <command>crm cluster join --help</command> 指令。
  </para>
  <procedure xml:id="pro-ha-inst-quick-setup-crm-cluster-join">
   <title>使用 <command>crm cluster join</command> 新增第二個節點 (<systemitem class="server">bob</systemitem>)</title>
   <step>
    <para>
     以 <systemitem class="username">root</systemitem> 身分或擁有 <command>sudo</command> 權限的使用者身分登入第二個節點。
    </para>
   </step>
   <step>
    <para>
     啟動開機指令碼：
    </para>
    <para>
     如果您以 <systemitem class="username">root</systemitem> 身分設定第一個節點，則可以不指定其他任何參數來執行以下指令：
    </para>
<screen><prompt role="root"># </prompt><command>crm cluster join</command></screen>
    <para>
     如果您以 <command>sudo</command> 使用者身分設定第一個節點，則必須使用 <option>-c</option> 選項指定該使用者：
    </para>
<screen><prompt>&gt; </prompt><command>sudo crm cluster join -c <replaceable>USER</replaceable>@alice</command></screen>
    <para>
     如果 NTP 未設定為在開機時啟動，則會出現一則訊息。指令碼還會檢查是否存在硬體監視程式裝置。如果不存在此類裝置，將會向您發出警告。
    </para>
   </step>
   <step>
    <para>
     如果您尚未使用 <option>-c</option> 指定 <systemitem class="server">alice</systemitem>，系統會提示您輸入第一個節點的 IP 位址。
    </para>
   </step>
   <step>
    <para>
     如果您尚未在這兩部機器之間設定無密碼 SSH 存取，系統會提示您輸入第一個節點的密碼。
    </para>
    <para>
     登入指定節點後，指令碼會複製 Corosync 組態，設定 SSH 和 Csync2，使目前機器做為新叢集節點上線，並啟動 Hawk2 所需的服務。
    </para>
   </step>
  </procedure>
  <para>
   在 Hawk2 中檢查叢集狀態。在<menuchoice>
    <guimenu>狀態</guimenu>
    <guimenu>節點</guimenu>
   </menuchoice>下，您應該會看到狀態為綠色的兩個節點：
  </para>

  <figure xml:id="fig-ha-inst-quick-two-node-cluster">
   <title>雙節點叢集的狀態</title>
   <mediaobject>
    <imageobject>
     <imagedata width="80%" fileref="installquick-two-nodecluster-status.png"/>
    </imageobject>
   </mediaobject>
  </figure>
 </sect1>

  <sect1 xml:id="sec-ha-inst-quick-test">
   <title>測試叢集</title>
   <para>
    雖然以下測試有助於您識別叢集設定存在的問題，但實際的測試涉及特別的使用場景和情境。請先根據您的使用案例對叢集進行全面測試，然後再將其用於線上環境。
   </para>
   <itemizedlist>
    <listitem>
     <para>
      <command>sbd -d <replaceable>DEVICE_NAME</replaceable> list</command> 指令會列出對 SBD 可見的所有節點。對於依本文所述設定的叢集，輸出應顯示 <systemitem class="server">alice</systemitem> 和 <systemitem class="server">bob</systemitem>。
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="sec-ha-inst-quick-test-resource-failover"/>是一項簡單的測試，會在叢集中目前執行資源的節點設定為 <literal>standby</literal> 時，檢查叢集是否將虛擬 IP 位址移到另一個節點。
     </para>
    </listitem>
    <listitem>
     <para>
      <xref linkend="sec-ha-inst-quick-test-with-cluster-script"/> 會模擬叢集故障並報告結果。
     </para>
    </listitem>
   </itemizedlist>
   <sect2 xml:id="sec-ha-inst-quick-test-resource-failover">
    <title>測試資源容錯移轉</title>
    <para>
     請使用以下快速測試程序檢查資源容錯移轉：
    </para>
   <procedure xml:id="pro-ha-inst-quick-test">
    <title>測試資源容錯移轉</title>
    <step>
     <para>
      開啟終端機並 ping <systemitem>192.168.1.10</systemitem> (即您的虛擬 IP 位址)：
     </para>
     <screen><prompt role="root"># </prompt><command>ping 192.168.1.10</command></screen>
    </step>
    <step>
     <para>
      登入 Hawk2：
     </para>
    </step>
    <step>
     <para>
      在<menuchoice><guimenu>狀態</guimenu><guimenu>資源</guimenu></menuchoice>下，檢視執行該虛擬 IP 位址 (資源 <systemitem>admin_addr</systemitem>) 的節點。此程序假定該資源在 <systemitem class="server">alice</systemitem> 上執行。
      </para>
    </step>
    <step>
     <para>
      將 <systemitem class="server">alice</systemitem> 置於<guimenu>待命</guimenu>模式：
     </para>
     <figure xml:id="fig-ha-inst-quick-standby">
      <title>處於待命模式的節點 <systemitem class="server">alice</systemitem></title>
      <mediaobject>
       <imageobject>
        <imagedata width="60%" fileref="installquick-standby-node.png"/>
       </imageobject>
      </mediaobject>
     </figure>
     
    </step>
    <step>
     <para>
      按一下<menuchoice>
       <guimenu> 狀態</guimenu>
       <guimenu> 資源</guimenu>
      </menuchoice>。資源 <systemitem>admin_addr</systemitem> 已移轉至 <systemitem class="server">bob</systemitem>。
     </para>
    </step>
   </procedure>
   <para>
    移轉時，您應該會看見不斷向虛擬 IP 位址進行 ping 的流程。這表示叢集設定與浮動 IP 正常運作。按 <keycombo>
       <keycap function="control"/><keycap>C</keycap>
      </keycombo> 鍵可取消 <command>ping</command> 指令。
   </para>
   </sect2>

   <sect2 xml:id="sec-ha-inst-quick-test-with-cluster-script">
    <title>使用 <command>crm cluster crash_test</command> 指令進行測試</title>
    <para>
     <command>crm cluster crash_test</command> 指令會觸發叢集故障，以便找出問題。在生產環境中使用叢集之前，建議先使用此指令來確定一切符合預期。
    </para>
    <para>
     該指令支援以下檢查：
    </para>
    <variablelist>
     <varlistentry>
      <term><option>--split-brain-iptables</option></term>
      <listitem>
       <para>
        透過封鎖 Corosync 連接埠來模擬電腦分裂情況。檢查是否可如預期般圍籬區隔一個節點。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><option>--kill-sbd</option>/<option>--kill-corosync</option>/<option>--kill-pacemakerd</option></term>
      <listitem>
       <para>
        停止 SBD、Corosync 和 Pacemaker 的精靈。執行其中一項測試後，便可以在 <filename>/var/lib/crmsh/crash_test/</filename> 目錄下找到一份報告。該報告中包含測試案例描述、動作記錄以及對可能的結果的說明。
       </para>
      </listitem>
     </varlistentry>
     <varlistentry>
      <term><option>--fence-node <replaceable>NODE</replaceable></option></term>
      <listitem>
       <para>
        圍籬區隔從指令列傳遞的特定節點。
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
    <para>
     如需詳細資訊，請參閱<command>crm cluster crash_test --help</command>。
    </para>
    <example xml:id="ex-test-with-cluster-script">
     <title>測試叢集：節點圍籬區隔</title>
<screen><prompt role="root"># </prompt><command>crm_mon -1</command>
Stack: corosync
Current DC: alice (version ...) - partition with quorum
Last updated: Fri Mar 03 14:40:21 2020
Last change: Fri Mar 03 14:35:07 2020 by root via cibadmin on alice

2 nodes configured
1 resource configured

Online: [ alice bob ]
Active resources:

 stonith-sbd    (stonith:external/sbd): Started alice

<prompt role="root"># </prompt><command>crm cluster crash_test</command><command> --fence-node bob</command>

==============================================
Testcase:          Fence node bob
Fence action:      reboot
Fence timeout:     60

!!! WARNING WARNING WARNING !!!
THIS CASE MAY LEAD TO NODE BE FENCED.
TYPE Yes TO CONTINUE, OTHER INPUTS WILL CANCEL THIS CASE [Yes/No](No): <command>Yes</command>
INFO: Trying to fence node "bob"
INFO: Waiting 60s for node "bob" reboot...
INFO: Node "bob" will be fenced by "alice"!
INFO: Node "bob" was successfully fenced by "alice"</screen>
    </example>
    <para>
      若要在測試過程中監看 <systemitem class="server">bob</systemitem> 變更狀態，請登入 Hawk2，然後導覽至<menuchoice><guimenu>狀態</guimenu>
      <guimenu>節點</guimenu></menuchoice>。
     </para>
   </sect2>
  </sect1>

  <sect1 xml:id="sec-ha-inst-quick-next">
   <title>後續步驟</title>
   <para>
    使用開機指令碼可以快速地設定可用於測試用途的基本高可用性叢集。不過，若要將此叢集擴充為正常運作且可用於生產環境的高可用性叢集，建議您執行更多步驟。
   </para>
   <variablelist xml:id="vl-ha-inst-quick-next-rec">
    <title>為完成高可用性叢集設定建議執行的步驟</title>
    <varlistentry>
     <term>新增更多節點</term>
     <listitem>
      <para>
       使用以下其中一種方法新增更多節點至叢集：
      </para>
      <itemizedlist>
       <listitem>
        <para>
         若要一次新增一個節點，請依照<xref linkend="sec-ha-inst-quick-setup-2nd-node"/>所述使用 <command>crm cluster join</command> 指令碼。
        </para>
       </listitem>
       <listitem>
        <para>
         若要大量安裝多個節點，請依照<xref linkend="sec-ha-installation-autoyast"/>所述使用 AutoYaST。
        </para>
       </listitem>
      </itemizedlist>
      <para>
       一個一般叢集最多只能包含 32 個節點。憑藉 <systemitem class="daemon">pacemaker_remote</systemitem> 服務，可以將高可用性叢集進行延伸，使其包含超出此限制的額外節點。請參閱 <xref linkend="article-pacemaker-remote"/>，以取得詳細資料。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>設定 QDevice</term>
     <listitem>
      <para>
       如果叢集的節點數是偶數，請設定 QDevice 和 QNetd 以參與仲裁決定。QDevice 會提供一個可設定的投票數，以使叢集可以承受大於標準仲裁規則所允許的節點故障數量。如需詳細資料，請參閱<xref linkend="cha-ha-qdevice"/>。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term>啟用硬體監視程式</term>
     <listitem>
      <para>
       請先以最適合硬體的硬體模組取代 <literal>softdog</literal> 模組，再在生產環境中使用叢集。如需詳細資料，請參閱<xref linkend="sec-ha-storage-protect-watchdog"/>。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </sect1>

  <sect1 xml:id="sec-ha-inst-quick-moreinfo">
   <title>相關資訊</title>
    <para>
     <link xlink:href="https://documentation.suse.com/sle-ha/"/> 上提供了更多有關此產品的文件。如需其他組態和管理任務的資訊，請參閱內容全面的 <link xlink:href="https://documentation.suse.com/sle-ha/html/SLE-HA-all/book-sleha-guide.html">
      Administration Guide</link>。
    </para>
   </sect1>
 <xi:include href="ha_iscsi_for_sbd.xml"/>
 <xi:include href="common_legal.xml"/>
</article>
