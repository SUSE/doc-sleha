<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="urn:x-suse:xslt:profiling:docbook51-profile.xsl"
 type="text/xml"
 title="Profiling step"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_log_in.xml" xml:id="cha-ha-log-in" xml:lang="ja" version="5.1">
  <title>クラスタノードへのログイン</title>
  <info>
    <abstract>
      <para>
        crmシェル(crmsh)は、ノード間の通信にパスワード不要のSSHアクセスを使用します。<command>crm cluster init</command>を使用してクラスタを設定した場合、スクリプトは、SSH鍵があるかどうかを確認し、ない場合には生成します。YaSTクラスタモジュールを使用してクラスタを設定した場合、SSHキーを自分自身で設定する必要があります。
      </para>
      <para>
        デフォルトでは、crmshは特定の操作を<systemitem class="username">root</systemitem>ユーザとして実行します。ただし、パスワード不要のルートSSHアクセスを許可できない場合は、代わりに<command>sudo</command>権限を持つユーザとしてクラスタを設定できます。
      </para>
    </abstract>
    <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
      <dm:bugtracker/>
      <dm:translation>yes</dm:translation>
    </dm:docmanager>
  </info>

  <para>
    最初のノードにクラスタを設定し、クラスタにノードを追加できるユーザは次のとおりです。
  </para>
  <variablelist>
    <varlistentry>
      <term><systemitem class="username">root</systemitem>ユーザ</term>
      <listitem>
        <para>
          crmshは<systemitem class="username">root</systemitem>として実行するのがデフォルトであり、追加の設定は必要ありません。<systemitem class="username">root</systemitem>ユーザのSSH鍵は、リモートシステム上ではなく、ノード上にローカルに存在する(または生成される)必要があります。
        </para>
        <para>
          ノードに<systemitem class="username">root</systemitem>ユーザとしてログインするには、次のコマンドを実行します。
        </para>
<screen><prompt>user@local&gt; </prompt><command>ssh root@<replaceable>NODE</replaceable></command></screen>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term><command>sudo</command>権限を持つユーザ(SSHエージェント転送なし)</term>
      <listitem>
        <para>
          <command>crm cluster join -c <replaceable>USER@NODE</replaceable></command>を使用してクラスタにノードを追加する場合は、このユーザを指定する必要があります。ユーザのSSH鍵は、リモートシステム上ではなく、ノード上にローカルに存在する(または生成される)必要があります。
        </para>
        <para>
          ノードに<command>sudo</command>ユーザとしてログインするには、次のコマンドを実行します。
        </para>
<screen><prompt>user@local&gt; </prompt><command>ssh <replaceable>USER@NODE</replaceable></command></screen>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term><command>sudo</command>権限を持つユーザ(SSHエージェント転送あり)</term>
      <listitem>
        <para>
          SSHエージェント転送を使用して、ローカルSSH鍵をクラスタノードに渡すことができます。これは、ノードにSSH鍵を保存しないようにする必要がある場合に便利ですが、ローカルマシンとクラスタノードで追加の設定が必要です。
        </para>
        <para>
          SSHエージェント転送を有効にしてノードにログインするには、次の手順を実行します。
        </para>
        <orderedlist>
        <listitem>
          <para>
            ローカルマシンでSSHエージェントを起動し、そこにキーを追加します。詳細については、SUSE Linux Enterprise Serverの『<citetitle>Security and Hardening Guide</citetitle>』で<link xlink:href="https://documentation.suse.com/sles/html/SLES-all/cha-ssh.html#sec-ssh-authentic-agent"><citetitle>Automated public key logins with ssh-agent</citetitle></link>を参照してください。
          </para>
        </listitem>
        <listitem>
          <para>
            <option>-A</option>オプションを指定してノードにログインし、SSHエージェント転送を有効にします。
          </para>
<screen><prompt>user@local&gt; </prompt><command>ssh -A <replaceable>USER@NODE</replaceable></command></screen>
        </listitem>
      </orderedlist>
      </listitem>
    </varlistentry>
  </variablelist>
  <para>
    クラスタにノードを追加する場合は、最初のノードを設定したユーザと同じユーザとして各ノードにログインする必要があります。
  </para>
  <important role="compact">
    <para>
      簡潔にするため、このガイドのコマンドでは、<systemitem class="username">root</systemitem>ユーザとしてログインしていることを前提としています。<command>sudo</command>ユーザでログインした場合は、それに応じてコマンドを調整してください。
    </para>
  </important>
</chapter>
