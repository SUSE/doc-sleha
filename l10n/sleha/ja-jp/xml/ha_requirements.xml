<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:dm="urn:x-suse:ns:docmanager" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_requirements.xml" version="5.0" xml:id="cha-ha-requirements">
  <?dbfo-need height="10em"?>

  <title>システム要件と推奨事項</title>
 <info>
      <abstract>
        <para>
    次のセクションでは、SUSE® Linux Enterprise High Availabilityのシステム要件と前提条件について説明します。また、クラスタセットアップの推奨事項についても説明します。
   </para>
      </abstract>
  <dm:docmanager>
   <dm:maintainer/>
   <dm:status>editing</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>yes</dm:translation>
   <dm:languages/>
   <dm:release/>
   <dm:repository/>
  </dm:docmanager>
    </info>
    <sect1 xml:id="sec-ha-requirements-hw">
  <title>ハードウェア要件</title>

  <para>
   次のリストは、SUSE® Linux Enterprise High Availabilityに基づくクラスタのハードウェア要件を指定しています。これらの要件は、最低のハードウェア設定を表しています。クラスタの使用方法によっては、ハードウェアを追加しなければならないこともあります。
  </para>

  <variablelist>
   <varlistentry>
    <term>サーバ</term>
    <listitem>
     <para> <xref linkend="sec-ha-requirements-sw"/>に指定されたソフトウェアを搭載した1～32台のLinuxサーバ。</para>
     <para>
      サーバはベアメタルでも仮想マシンでも構いません。各サーバが同一のハードウェア設定(メモリ、ディスクスペースなど)になっている必要はありませんが、アーキテクチャは同じである必要があります。クロスプラットフォームのクラスタはサポートされていません。
     </para>
     <para> <literal>pacemaker_remote</literal>を使用すると、32ノード制限を超えて追加のLinuxサーバを含めるようにクラスタを拡張できます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>通信チャネル</term>
    <listitem>
       <para>
       クラスタノードあたり、少なくとも2つのTCP/IP通信メディア。ネットワーク機器は、クラスタ通信に使用する通信手段(マルチキャストまたはユニキャスト)をサポートする必要があります。通信メディアは100Mbit/s以上のデータレートをサポートする必要があります。サポートされるクラスタセットアップでは、2つ以上の冗長通信パスが必要です。これは次のように実行できます。</para>
       <itemizedlist>
        <listitem>
         <para>
          ネットワークデバイスボンディング(推奨)
         </para>
        </listitem>
        <listitem>
         <para>
          Corosync内の2つ目の通信チャンネル
         </para>
        </listitem>
       </itemizedlist>
     <para>詳細については、<xref linkend="cha-ha-netbonding"/>と<xref linkend="pro-ha-installation-setup-channel2"/>をそれぞれ参照してください。
      
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>ノードフェンシング/STONITH</term>
    <listitem>
      <para>
      <quote>スプリットブレイン</quote>シナリオを回避するため、クラスタにはノードフェンシングメカニズムが必要です。スプリットブレインシナリオでは、クラスタノードは、お互いを認識していない2つ以上のグループに分割されます(ハードウェアまたはソフトウェアの障害か、ネットワーク接続の切断による)。フェンシングメカニズムにより、問題のあるノードを分離します(通常はノードをリセットするか、ノードの電源をオフにすることによって分離します)。これをSTONITH (<quote>Shoot the other node in the head</quote>)と呼びます。ノードフェンシングメカニズムは、物理デバイス(電源スイッチ)でも、SBD (ディスクによるSTONITH)のようなメカニズムとウォッチドッグを組み合わせたものでも構いません。SBDは、共有ストレージまたはディスクレスモードのいずれかで使用できます。
     </para>
     <para>SBDが使用される場合を除き、High Availabilityクラスタの各ノードには少なくとも1つのSTONITHデバイスが必要です。ノードごとに複数のSTONITHデバイスを使用することを強くお勧めします。</para>
      <important>
      <title>STONITHがない場合はサポートなし</title>
      <itemizedlist>
       <listitem>
        <para>クラスタにはノードフェンシングメカニズムが必要です。</para>
       </listitem>
       <listitem>
        <para>グローバルクラスタオプション<systemitem>stonith-enabled</systemitem>および<systemitem>startup-fencing</systemitem>は<literal>true</literal>に設定する必要があります。これらを変更するとサポートされなくなります。</para>
       </listitem>
      </itemizedlist>
      </important>
    </listitem>
  </varlistentry>
  </variablelist>
 </sect1>
<?dbfo-need height="10em"?>

 <sect1 xml:id="sec-ha-requirements-sw">
  <title>ソフトウェアの必要条件</title>

  <para>
   すべてのノードは、少なくとも次のモジュールおよび拡張機能が必要です。
  </para>

<itemizedlist>
   <listitem>
    <para>Basesystem Module 15 SP7</para>
   </listitem>
   <listitem>
    <para>Server Applications Module 15 SP7</para>
   </listitem>
   <listitem>
    <para>SUSE Linux Enterprise High Availability 15 SP7</para>
   </listitem>
  </itemizedlist>

  <para>
   インストール中に選択したシステムの役割に応じて、デフォルトで次のソフトウェアパターンがインストールされます。
  </para>
  <variablelist>
   <varlistentry>
    <term>HAノードシステムの役割</term>
    <listitem>
     <para>
      高可用性 (<literal>ha_sles</literal>)
     </para>
     <para>
      強化された基本システム (<literal>enhanced_base</literal>)
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>HA GEOノードシステムの役割</term>
    <listitem>
     <para>
      Geo Clustering for High Availability (<literal>ha_geo</literal>)
     </para>
     <para>
      強化された基本システム (<literal>enhanced_base</literal>)
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <note>
   <title>最小インストール</title>
   <para>
    これらのシステムの役割を介してインストールすると、最小限のインストールにのみ抑えられます。必要に応じて、パッケージを手動で追加しなければならない場合があります。</para>
   <para>
    最初に別のシステムの役割が割り当てられていたマシンの場合、<systemitem>ha_sles</systemitem>パターンまたは<systemitem>ha_geo</systemitem>パターンとその他の必要なパッケージを手動でインストールする必要があります。
   </para>
  </note>
 </sect1>
 <sect1 xml:id="sec-ha-requirements-disk">
  <title>ストレージ要件</title>

  <para>
   一部のサービスでは、共有ストレージが必要です。外部NFS共有を使用する場合は、冗長通信パスを介してすべてのクラスタノードから確実にアクセスできる必要があります。</para>
  <para>クラスタでデータの可用性を高めたい場合は、共有ディスクシステム(SAN: Storage Area Network)の利用をお勧めします。共有ディスクシステムを使用する場合は、次の要件を満たしていることを確認してください。
  </para>

  <itemizedlist>
   <listitem>
    <para>
     メーカーの指示のに従い、共有ディスクシステムが適切に設定され、正しく動作していることを確認します。
    </para>
   </listitem>
   <listitem>
    <para>
     共有ディスクシステム中のディスクを、ミラーリングまたはRAIDを使用して耐障害性が高められるように設定してください。
    </para>
   </listitem>
   <listitem>
    <para>
     共有ディスクシステムのアクセスにiSCSIを使用している場合、iSCSIイニシエータとターゲットを正しく設定していることを確認します。
    </para>
   </listitem>
   <listitem>
    <para>
     2台のマシンにデータを配分するミラーリングRAIDシステムを実装するためにDRBD*を使用する際、DRBDに提供されるデバイスにのみアクセスし、決してバッキングデバイスにはアクセスしないようにします。冗長性を確保するために、クラスタの残りの部分と同一のNICを利用できます。
    </para>
   </listitem>
  </itemizedlist>
  <para>
   ディスクベースのSBDをSTONITHメカニズムとして使用する場合は、共有ストレージに対して追加の要件が適用されます。詳細については、<xref linkend="sec-ha-storage-protect-req"/>を参照してください。
   </para>
 </sect1>
 <sect1 xml:id="sec-ha-requirements-other">
  <title>その他の要件と推奨事項</title>

  <para>
   サポートされていて、役に立つHigh Availabilityセットアップについては、次の推奨事項を検討してください。
  </para>

  <variablelist>
   <varlistentry xml:id="vle-ha-req-nodes">
    <term>クラスタノード数</term>
    <listitem>
     <para>3つ以上のノードを持つクラスタに対して、奇数のクラスタノードを使用してクォーラムを持つようにすることを強くお勧めします。クォーラムの詳細については、<xref linkend="sec-ha-config-basics-global"/>を参照してください。通常のクラスタには最大32ノードを含めることができます。<systemitem class="daemon">pacemaker_remote</systemitem>サービスを使用すると、高可用性クラスタを拡張して、この制限を超えて追加のノードを含めることができます。詳細については、『Pacemaker Remote Quick Start』を参照してください。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>時刻同期</term>
     <listitem>
   <para>
     クラスタノードはクラスタ外のNTPサーバに同期する必要があります。SUSE Linux Enterprise High Availability 15以降、Chronyは、NTPでデフォルトで実装されるようになりました。詳細については、<link xlink:href="https://documentation.suse.com/sles-15/html/SLES-all/cha-ntp.html">SUSE Linux Enterprise Server 15 SP7の『管理ガイド』</link>を参照してください。
    </para>
    <para>
     ノードが同期されていない場合、または同期されていても異なるタイムゾーンが設定されている場合、クラスタが正しく動作しない場合があります。また、同期が行われていないと、ログファイルとクラスタレポートの分析が非常に困難になります。ブートストラップスクリプトを使用するときにNTPがまだ設定されていない場合、警告が表示されます。
    </para>
  </listitem>
   </varlistentry>
   <varlistentry>
    <term>ネットワークインタフェースカード(NIC)名</term>
    <listitem>
     <para>
      すべてのノード上で同一である必要があります。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>ホスト名およびIPアドレス</term>
    <listitem>
     <itemizedlist>
      <listitem>
       <para>
        静的IPアドレスを使用します。
       </para>
      </listitem>
      <listitem>
       <para>
        プライマリIPアドレスのみがサポートされます。
       </para>
      </listitem>
      <listitem>
        <para>
     ファイル<filename>/etc/hosts</filename>にあるすべてのクラスタノードを、完全修飾ホスト名およびショートホスト名で一覧表示します。クラスタのメンバーが名前で互いを見つけられることが重要です。名前を使用できない場合、内部クラスタ通信は失敗します。
   </para>
       <para>
        Pacemakerがノード名を取得する方法の詳細については、<link xlink:href="https://clusterlabs.org/doc/en-US/Pacemaker/1.1/html/Pacemaker_Explained/s-node-name.html"></link>も参照してください。
       </para>
      </listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-ha-req-ssh">
    <term>SSH</term>
    <listitem>
      <para>
    すべてのクラスタノードはSSHによって互いにアクセスできる必要があります。<command>crm report</command> (トラブルシューティング用)などのツールおよびHawk2の<guimenu>履歴エクスプローラ</guimenu>は、ノード間でパスワード不要のSSHアクセスを必要とします。それがない場合、現在のノードからしかデータを収集できません。
  </para>
     <para>
      ブートストラップスクリプトを使用してクラスタを設定した場合、SSHキーは自動的に作成され、コピーされます。YaSTクラスタモジュールを使用してクラスタを設定した場合、SSHキーを自分自身で設定する必要があります。
     </para>
     <note>
      <title>規定要件</title>
      <para>
       デフォルトでは、クラスタは<systemitem class="username">root</systemitem>ユーザとして操作を実行します。パスワード不要の<systemitem class="username">root</systemitem> SSHアクセスが規定要件に準拠していない場合、代わりに<command>sudo</command>特権を持つユーザとしてクラスタを設定できます。このユーザは、<command>crm report</command>などのクラスタ操作を実行できます。
      </para>
      <para>
       また、SSHキーをノードに直接保存できない場合、<xref linkend="sec-ha-manual-config-crm-user-privileges"/>で説明されているように、代わりにSSHエージェントを転送してローカルSSHキーを使用できます。
      </para>
      <para>
       さらに厳密なセキュリティポリシーが必要な場合、<xref linkend="sec-crmreport-nonroot-sudo"/>で説明されているように、<command>crm report</command>に特化した限定的な<command>sudo</command>特権のみを持つ非rootユーザを設定できます。
      </para>
      <para>
       <guimenu>履歴エクスプローラ</guimenu>については、現在のところ、パスワード不要のログインに代わる方法はありません。
      </para>
     </note>
    </listitem>
   </varlistentry>
  </variablelist>
 </sect1>
</chapter>
