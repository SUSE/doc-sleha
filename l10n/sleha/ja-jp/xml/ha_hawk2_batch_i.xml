<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_hawk2_batch_i.xml" version="5.0" xml:id="sec-conf-hawk2-batch">
 <title>バッチモードの使用</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer/>
   <dm:status>editing</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>yes</dm:translation>
   <dm:languages/>
   <dm:release/>
   <dm:repository/>
  </dm:docmanager>
 </info>

 <para>
  Hawk2は、「クラスタシミュレータ」を含む<guimenu>バッチモード</guimenu>を提供します<emphasis></emphasis>。これは次の操作に使用できます。
 </para>

 <itemizedlist>
  <listitem>
   <para>
    各変更を直ちに反映させるのではなく、クラスタに変更をステージングして、それらの変更を単一トランザクションとして適用する。
   </para>
  </listitem>
  <listitem>
   <para>
    たとえば、潜在的な障害シナリオを調べるため、変更やクラスタイベントをシミュレートする。
   </para>
  </listitem>
 </itemizedlist>

 <para>
  たとえば、互いに依存するリソースのグループを作成する場合にバッチモードを使用できます。バッチモードを使用すると、クラスタに中間的なまたは不完全な設定を適用することを回避できます。
 </para>

 <para>
  バッチモードが有効な間は、リソースや制約を追加したり編集したり、クラスタ設定を変更できます。ノードのオンラインまたはオフライン化、リソース操作およびチケットの許可または取り消しなど、クラスタのイベントをシミュレートすることもできます。詳細については<xref linkend="pro-hawk2-batch-inject"/>を参照してください。
 </para>

 <para>
  「クラスタシミュレータ」<emphasis></emphasis>は、すべての変更後に自動的に実行され、ユーザインタフェースに予想される結果を表示します。たとえば、次のような場合もあります。バッチモードの最中にリソースを止めると、実際リソースはまだ実行中であるにも関わらず、ユーザインタフェースにはリソースが停止したと表示されます。
 </para>

 <important>
  <title>ウィザード、およびライブシステムへの変更</title>
  <para>
   一部のウィザードには単なるクラスタ設定を超えるアクションが含まれます。これらのウィザードをバッチモードで使用する場合、クラスタ設定を超えるすべての変更がライブシステムに直ちに適用されます。
  </para>
  <para>
   したがって、<systemitem class="username">root</systemitem>許可が必要なウィザードはバッチモードでは実行できません。
  </para>
 </important>

 <procedure xml:id="pro-conf-hawk2-manage-monitor-batch">
  <title>バッチモードの使用</title>
  <step>
   <para>
    Hawk2にログインします。
   </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
  </step>
  <step>
   <para>
    バッチモードを有効にするには、最上位の行から<guimenu>バッチ</guimenu>を選択します。
   </para>
   <para>
    最上位の行の下に追加のバーが表示されます。これは、バッチモードがアクティブであることを示し、バッチモードで実行可能なアクションへのリンクが含まれます。
   </para>
   <figure xml:id="fig-hawk2-batch">
    <title>Hawk2バッチモードが有効</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="hawk2-batchmode-active.png" width="100%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="hawk2-batchmode-active.png" width="100%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </step>
  <step>
   <para>
    バッチモードがアクティブなときに、リソースや制約の追加または編集、あるいはクラスタ設定の編集など、クラスタに対する変更を実行します。
   </para>
   <para>
    変更はシミュレートされ、すべての画面に表示されます。
   </para>
  </step>
  <step>
   <para>
    行った変更の詳細を表示するには、バッチモードバーから<guimenu>表示</guimenu>を選択します。<guimenu>バッチモード</guimenu>ウィンドウが開きます。
   </para>
   <para>
    設定の変更について、ライブ状態とシミュレートされた変更間の相違がcrmsh構文で表示されます。<literal>-</literal>文字で開始される行は、現在の状態を表し、<literal>+</literal>で開始される行は、提案される状態を示します。
   </para>
  </step>
  <step>
   <para>
    イベントを注入したり、さらに詳細を表示する場合は、<xref linkend="pro-hawk2-batch-inject" xrefstyle="select:label"/>を参照してください。または、<guimenu>Close (閉じる)</guimenu>をクリックしてウィンドウを閉じます。
   </para>
  </step>
  <step>
   <para>
    シミュレートした変更を<guimenu>破棄</guimenu>または<guimenu>適用</guimenu>するかのいずれかを選択し、選択内容を確認します。これによりバッチモードが無効になり、通常のモードに戻ります。
   </para>
  </step>
 </procedure>

 <para>
  バッチモードで実行中に、Hawk2では<guimenu>Node Events (ノードイベント)</guimenu>と<guimenu>Resource Events (リソースイベント)</guimenu>を注入することもできます。
 </para>

 <variablelist>
  <varlistentry>
   <term><guimenu>ノードイベント</guimenu>
   </term>
   <listitem>
    <para>
     ノードの状態を変更できます。使用可能な状態は、<guimenu>online (オンライン)</guimenu>、<guimenu>offline (オフライン)</guimenu>、および<guimenu>unclean (アンクリーン)</guimenu>です。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><guimenu>リソースイベント</guimenu>
   </term>
   <listitem>
    <para>
     リソースの一部のプロパティを変更できます。たとえば、操作(<literal>start</literal>、<literal>stop</literal>、<literal>monitor</literal>など)、その操作を適用するノード、およびシミュレートされる予想される結果を設定できます。
    </para>
   </listitem>
  </varlistentry>
  <varlistentry>
   <term><guimenu>チケットイベント</guimenu>
   </term>
   <listitem>
    <para>
     (Geoクラスタにおける)チケットの許可と取り消しの影響をテストできます。
    </para>
   </listitem>
  </varlistentry>
 </variablelist>

 <procedure xml:id="pro-hawk2-batch-inject">
  <title>ノード、リソース、またはチケットイベントの挿入</title>
  <step>
   <para>
    Hawk2にログインします。
   </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
  </step>
  <step>
   <para>
    バッチモードがまだアクティブでない場合、最上位の行で<guimenu>バッチ</guimenu>をクリックして、バッチモードに切り替えます。
   </para>
  </step>
  <step>
   <para>
    バッチモードバーで、<guimenu>表示</guimenu>をクリックして、<guimenu>バッチモード</guimenu>ウィンドウを開きます。
   </para>
  </step>
  <step>
   <para>
    ノードのステータスの変更をシミュレートするには
   </para>
   <substeps>
    <step>
     <para>
      <menuchoice> <guimenu>注入</guimenu> <guimenu>ノードイベント</guimenu> </menuchoice>を順にクリックします。
     </para>
    </step>
    <step>
     <para>
      操作する<guimenu>ノード</guimenu>を選択し、そのターゲット<guimenu>状態</guimenu>を選択します。
     </para>
    </step>
    <step>
     <para>
      変更内容を確認します。イベントは<guimenu>バッチモード</guimenu>ダイアログに一覧表示されるイベントのキューに追加されます。
     </para>
    </step>
   </substeps>
  </step>
  <step>
   <para>
    リソースの操作をシミュレートするには
   </para>
   <substeps>
    <step>
     <para>
      <menuchoice> <guimenu>注入</guimenu> <guimenu>リソースイベント</guimenu> </menuchoice>を順にクリックします。
     </para>
    </step>
    <step>
     <para>
      操作する<guimenu>リソース</guimenu>を選択し、シミュレートする<guimenu>操作</guimenu>を選択します。
     </para>
    </step>
    <step>
     <para>
      必要に応じて、<guimenu>間隔</guimenu>を定義します。
     </para>
    </step>
    <step>
     <para>
      操作を実行する<guimenu>ノード</guimenu>を選択し、ターゲットとする<guimenu>結果</guimenu>を選択します。イベントは<guimenu>バッチモード</guimenu>ダイアログに一覧表示されるイベントのキューに追加されます。
     </para>
    </step>
    <step>
     <para>
      変更内容を確認します。
     </para>
    </step>
   </substeps>
  </step>
  <step>
   <para>
    チケットアクションをシミュレートするには
   </para>
   <substeps>
    <step>
     <para>
      <menuchoice> <guimenu>挿入</guimenu> <guimenu>チケットイベント</guimenu> </menuchoice>を順にクリックします。
     </para>
    </step>
    <step>
     <para>
      操作する<guimenu>チケット</guimenu>を選択し、シミュレートする<guimenu>アクション</guimenu>を選択します。
     </para>
    </step>
    <step>
     <para>
      変更内容を確認します。イベントは<guimenu>バッチモード</guimenu>ダイアログに一覧表示されるイベントのキューに追加されます。
     </para>
    </step>
   </substeps>
  </step>
  <step>
   <para>
    <guimenu>バッチモード</guimenu>ダイアログ(<xref linkend="fig-hawk2-batch-show" xrefstyle="select:label"/>)で、注入されたイベントごとに新しい行が表示されます。ここに一覧表示されるイベントは、直ちにシミュレートされ、<guimenu>状態</guimenu>画面に反映されます。
   </para>
   <para>
    設定の変更も行った場合は、ライブ状態とシミュレートされた変更の間の相違が注入されたイベントの下に表示されます。
   </para>
   <figure xml:id="fig-hawk2-batch-show">
    <title>Hawk2のバッチモード - 注入されたイベントと設定の変更</title>
    <mediaobject>
     <imageobject role="fo">
      <imagedata fileref="hawk2-batchmode-show.png" width="100%" format="PNG"/>
     </imageobject>
     <imageobject role="html">
      <imagedata fileref="hawk2-batchmode-show.png" width="100%" format="PNG"/>
     </imageobject>
    </mediaobject>
   </figure>
  </step>
  <step>
   <para>
    注入されたイベントを削除するには、その隣の<guimenu>削除</guimenu>アイコンをクリックします。Hawk2では、それに従って<guimenu>状態</guimenu>画面が更新されます。
   </para>
  </step>
  <step>
   <para>
    実行されたシミュレーションに関する詳細を表示するには、<guimenu>シミュレータ</guimenu>をクリックして、次のいずれかを選択します。
   </para>
   <variablelist>
    <varlistentry>
     <term><guimenu>まとめ</guimenu>
     </term>
     <listitem>
      <para>
       詳細な概要を表示します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>CIB (in)</guimenu>/<guimenu>CIB (out)</guimenu>
     </term>
     <listitem>
      <para>
       <guimenu>CIB (in)</guimenu>では、初期のCIB状態を示します。<guimenu>CIB (out)</guimenu>では、遷移後のCIBの状態を示します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>遷移グラフ</guimenu>
     </term>
     <listitem>
      <para>
       遷移のグラフィカルな表現を示します。
      </para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><guimenu>遷移</guimenu>
     </term>
     <listitem>
      <para>
       遷移のXML表示を示します。
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </step>
  <step>
   <para>
    シミュレートされた変更を確認したら、<guimenu>バッチモード</guimenu>ウィンドウを閉じます。
   </para>
  </step>
  <step>
   <para>
    バッチモードを終了するには、シミュレートされた変更を<guimenu>適用</guimenu>するか、<guimenu>破棄</guimenu>するかのいずれかを選択します。
   </para>
  </step>
 </procedure>
</sect1>
