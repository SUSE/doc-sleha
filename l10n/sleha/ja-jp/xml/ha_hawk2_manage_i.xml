<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_hawk2_manage_i.xml" version="5.0" xml:id="sec-conf-hawk2-manage">
 <title>クラスタリソースの管理</title>

 <info>
  <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
   <dm:maintainer/>
   <dm:status>editing</dm:status>
   <dm:deadline/>
   <dm:priority/>
   <dm:translation>yes</dm:translation>
   <dm:languages/>
   <dm:release/>
   <dm:repository/>
  </dm:docmanager>
 </info>

 <para>
  Hawk2では、クラスタリソースを設定することに加えて、<guimenu>状態</guimenu>画面で既存のリソースを管理することができます。この画面の概要については、<xref linkend="sec-conf-hawk2-manage-monitor-status"/>を参照してください。
 </para>

 <sect2 xml:id="sec-conf-hawk2-manage-edit">
  <title>リソースとグループの編集</title>
  <para>
   既存のリソースを編集する必要がある場合は、<guimenu>状態</guimenu>画面に移動します。<guimenu>操作</guimenu>列で、変更したいリソースまたはグループの横にある下矢印アイコンをクリックして<guimenu>編集</guimenu>を選択します。
  </para>
  <para>
   編集画面が表示されます。プリミティブリソースを編集する場合は、次の操作が使用できます。
  </para>
  <itemizedlist>
   <title>プリミティブの操作</title>
   <listitem>
    <para>
     リソースのコピー。
    </para>
   </listitem>
   <listitem>
    <para>
     リソースの名前変更 (そのIDの変更)。
    </para>
   </listitem>
   <listitem>
    <para>
     リソースの削除。
    </para>
   </listitem>
  </itemizedlist>
  <para>
   グループを編集する場合は、次の操作が使用できます。
  </para>
  <itemizedlist>
   <title>グループの操作</title>
   <listitem>
    <para>
     このグループに追加される新しいプリミティブの作成。
    </para>
   </listitem>
   <listitem>
    <para>
     グループの名前変更 (そのIDの変更)。
    </para>
   </listitem>
   <listitem>
    <para>
     グループメンバーを再ソートするには、右側の<quote>ハンドル</quote>アイコンを使用して、メンバーを目的の順序にドラッグアンドドロップします。
    </para>
   </listitem>
  </itemizedlist>
 </sect2>

 <sect2 xml:id="sec-conf-hawk2-manage-start">
  <title>リソースの開始</title>
  <para>
   クラスタリソースは、起動する前に、正しく設定されているようにします。たとえば、Apacheサーバをクラスタリソースとして使用する場合は、まず、Apacheサーバを設定します。クラスタでそれぞれのリソースを開始する前に、Apache設定を完了します。
  </para>
  <note>
   <title>クラスタによって管理されるサービスには介入しないでくださいクラスタによって管理されるサービスは操作しないでください</title>
   <para>
    High Availability Extensionでリソースを管理しているときに、リソースを他の方法(クラスタ外で、たとえば、手動、ブート、再起動など)で開始したり、停止したりしてはなりません。High Availability Extensionソフトウェアが、すべてのサービスの開始または停止アクションを実行します。
   </para>
   <para>
    ただし、サービスが適切に構成されているか確認したい場合は手動で開始しますが、High Availabilityが起動する前に停止してください。
   </para>
   <para>
    現在クラスタで管理されているリソースへの介入については、まず、リソースを<literal>maintenance mode</literal>に設定します。詳細については、<xref linkend="pro-ha-maint-mode-rsc-hawk2"/>を参照してください。
   </para>
  </note>
  <para>
   Hawk2でリソースを作成するときには、<literal>target-role</literal>メタ属性でその初期状態を設定することができます。その値を<literal>stopped</literal>に設定した場合、リソースは、作成後、自動的に開始することはありません。
  </para>
  <procedure xml:id="pro-hawk2-rsc-start">
   <title>新しいリソースの起動</title>
   <step>
    <para>
     Hawk2にログインします。
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     左のナビゲーションバーから、<menuchoice><guimenu>監視機能</guimenu>
     <guimenu>状態</guimenu></menuchoice>の順に選択します。<guimenu>Resources (リソース)</guimenu>のリストには<guimenu>状態</guimenu>も表示されます。
    </para>
   </step>
   <step>
    <para>
     起動するリソースを選択します。その<guimenu>操作</guimenu>列で、<guimenu>開始</guimenu>アイコンをクリックします。継続するには、表示されるメッセージに対して確認します。
    </para>
    <para>
     リソースが開始すると、Hawk2はすぐにリソースの<guimenu>状態</guimenu>を緑に変え、それがどのノードで実行されているかを表示します。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec-conf-hawk2-manage-cleanup">
  <title>リソースのクリーンアップ</title>
  <para>
   リソースは、失敗した場合は自動的に再起動しますが、失敗のたびにリソースの失敗回数が増加します。
  </para>
  <para>
   リソースに対して<literal>migration-threshold</literal>が設定されていた場合、失敗回数が移行しきい値に達すると、そのリソースはそのノードでは実行されなくなります。
  </para>
  <para>
   リソースの失敗回数は、(リソースに<literal>failure-timeout</literal>オプションを設定することにより)自動的にリセットするか、または次に示すように手動でリセットできます。
  </para>
  <procedure xml:id="pro-hawk2-clean">
   <title>リソースのクリーンアップ</title>
   <step>
    <para>
     Hawk2にログインします。
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     左のナビゲーションバーから、<guimenu>状態</guimenu>を選択します。<guimenu>Resources (リソース)</guimenu>のリストには<guimenu>状態</guimenu>も表示されます。
    </para>
   </step>
   <step>
    <para>
     クリーンアップするリソースに移動します。<guimenu>操作</guimenu>列で、下矢印ボタンをクリックして<guimenu>Cleanup (クリーンアップ)</guimenu>を選択します。継続するには、表示されるメッセージに対して確認します。
    </para>
    <para>
     これにより、コマンド<command>crm resource cleanup</command>が実行され、すべてのノードでリソースがクリーンアップされます。
    </para>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec-conf-hawk2-manage-remove">
  <title>クラスタリソースの削除</title>
  <para>
   リソースをクラスタから削除する必要がある場合は、次の手順に従って、設定エラーが発生しないようにします。
  </para>
  <procedure xml:id="pro-hawk2-rsc-rm">
   <title>クラスタリソースの削除</title>
   <step>
    <para>
     Hawk2にログインします。
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     <xref linkend="pro-hawk2-clean"/>の説明に従って、すべてのノードでリソースをクリーンアップします。
    </para>
   </step>
   <step>
    <para>
     リソースを停止します。
    </para>
    <substeps>
     <step>
      <para>
       左のナビゲーションバーから、<menuchoice><guimenu>監視機能</guimenu>
       <guimenu>状態</guimenu></menuchoice>の順に選択します。<guimenu>Resources (リソース)</guimenu>のリストには<guimenu>状態</guimenu>も表示されます。
      </para>
     </step>
     <step>
      <para>
       <guimenu>操作</guimenu>列で、リソースの横にある<guimenu>Stop (停止)</guimenu>ボタンをクリックします。
      </para>
     </step>
     <step>
      <para>
       継続するには、表示されるメッセージに対して確認します。
      </para>
      <para>
       リソースが停止すると、<guimenu>状態</guimenu>列に変更が反映されます。
      </para>
     </step>
    </substeps>
   </step>
   <step>
    <para>
     リソースを削除します。
    </para>
    <substeps>
     <step>
      <para>
       左のナビゲーションバーから、<menuchoice><guimenu>環境設定</guimenu> <guimenu>設定の編集</guimenu></menuchoice>の順に選択します。
      </para>
     </step>
     <step>
      <para>
       <guimenu>Resources (リソース)</guimenu>のリストで、それぞれのリソースに移動します。<guimenu>操作</guimenu>列で、リソースの横にある<guimenu>Delete (削除)</guimenu>アイコンをクリックします。
      </para>
     </step>
     <step>
      <para>
       継続するには、表示されるメッセージに対して確認します。
      </para>
     </step>
    </substeps>
   </step>
  </procedure>
 </sect2>

 <sect2 xml:id="sec-conf-hawk2-manage-migrate">
  <title>クラスタリソースの移行</title>
  <para>
   <xref linkend="sec-conf-hawk2-failover"/>で説明したように、ソフトウェアまたはハードウェアの障害時には、クラスタは定義可能な特定のパラメータ(たとえばマイグレーションしきい値やリソースの固着性など)に従って、リソースを自動的にフェールオーバー(マイグレート)させます。クラスタ内の別のノードにリソースを手動で移行させることもできます。または、リソースを現在のノードから出すかはユーザが判断し、どこに移動するかはクラスタに判断させます。
  </para>
  <procedure xml:id="pro-hawk2-rsc-migrate">
   <title>リソースを手動で移行する</title>
   <step>
    <para>
     Hawk2にログインします。
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     左のナビゲーションバーから、<menuchoice><guimenu>監視機能</guimenu>
     <guimenu>状態</guimenu></menuchoice>の順に選択します。<guimenu>Resources (リソース)</guimenu>のリストには<guimenu>状態</guimenu>も表示されます。
    </para>
   </step>
   <step>
    <para>
     <guimenu>Resources (リソース)</guimenu>のリストで、それぞれのリソースを選択します。
    </para>
   </step>
   <step>
    <para>
     <guimenu>操作</guimenu>列で、下矢印ボタンをクリックして<guimenu>Migrate (移行)</guimenu>を選択します。
    </para>
   </step>
   <step>
    <para>
     開くウィンドウには、次の選択肢があります。
    </para>
    <itemizedlist>
     <listitem>
      <para>
       <guimenu>Away from current node (現在のノードから離れる)</guimenu>: これによって現在のノードに対して<literal>-INFINITY</literal>スコアによる場所の制約が作成されます。
      </para>
     </listitem>
     <listitem>
      <para>
       または、別のノードにリソースを移動できます。これによって移動先ノードに対して<literal>INFINITY</literal>スコアの場所の制約が作成されます。
      </para>
     </listitem>
    </itemizedlist>
   </step>
   <step>
    <para>
     選択内容を確認します。
    </para>
   </step>
  </procedure>
  <para>
   リソースを再び元に戻すには、次の手順に従います。
  </para>
  <procedure xml:id="pro-hawk2-rsc-migrate-back">
   <title>リソースの移行解除</title>
   <step>
    <para>
     Hawk2にログインします。
    </para>
<screen>https://<replaceable>HAWKSERVER</replaceable>:7630/</screen>
   </step>
   <step>
    <para>
     左のナビゲーションバーから、<menuchoice><guimenu>監視機能</guimenu>
     <guimenu>状態</guimenu></menuchoice>の順に選択します。<guimenu>Resources (リソース)</guimenu>のリストには<guimenu>状態</guimenu>も表示されます。
    </para>
   </step>
   <step>
    <para>
     <guimenu>Resources (リソース)</guimenu>のリストで、それぞれのリソースに移動します。
    </para>
   </step>
   <step>
    <para>
     <guimenu>操作</guimenu>列で、下矢印ボタンをクリックして<guimenu>消去</guimenu>を選択します。継続するには、表示されるメッセージに対して確認します。
    </para>
    <para>
     これによって、<command>crm_resource </command> <option>--clear</option>コマンドが使用されます。リソースは元の場所に戻ることができます。あるいは現在の場所に残ることもあります(リソースの固着性によって)。
    </para>
   </step>
  </procedure>
  <para>
   詳細については、<link xlink:href="http://www.clusterlabs.org/pacemaker/doc/"/>から入手できる『<citetitle>Pacemaker Explained</citetitle>』を参照してください。特に、「<citetitle>Resource Migration</citetitle>」のセクションを参照してください。
  </para>
 </sect2>
</sect1>
