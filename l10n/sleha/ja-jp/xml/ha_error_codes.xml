<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_error_codes.xml" version="5.0" xml:id="sec-ha-errorcodes">
 <title>OCF戻りコードと障害回復</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>editing</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>yes</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  OCF仕様によると、アクションが返す必要がある出口コードの厳密な定義があります。クラスタは常に、予期される結果に対する戻りコードを確認します。結果が予期された値と一致しない場合、アクションは失敗したとみなされ、回復処理が開始されます。障害回復には3種類あります。
 </para>

 <table>
  <title>障害回復の種類</title>
  <tgroup cols="3">
   <thead>
    <row>
     <entry>
      <para>
       回復の種類
      </para>
     </entry>
     <entry>
      <para>
       説明
      </para>
     </entry>
     <entry>
      <para>
       クラスタが行うアクション
      </para>
     </entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry>
      <para>
       soft
      </para>
     </entry>
     <entry>
      <para>
       一時的なエラーが発生しました。
      </para>
     </entry>
     <entry>
      <para>
       リソースを再起動するか、新しい場所に移動させます。
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       hard
      </para>
     </entry>
     <entry>
      <para>
       一時的ではないエラーが発生しました。エラーは、現在のノードに固有の場合があります。
      </para>
     </entry>
     <entry>
      <para>
       リソースを他の場所に移動して、現在のノードで再試行されないようにします。
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       fatal
      </para>
     </entry>
     <entry>
      <para>
       すべてのクラスタノードに共通の、一時的ではないエラーが発生しました。これは、不正な設定が指定されたことを示しています。
      </para>
     </entry>
     <entry>
      <para>
       リソースを停止して、どのクラスタノードでも開始されないようにします。
      </para>
     </entry>
    </row>
   </tbody>
  </tgroup>
 </table>

 <para>
  アクションが失敗したと想定して、次の表では、異なるOCF戻りコードを概説します。また、エラーコードを受け取った場合にクラスタが開始する回復の種類も示しています。
 </para>

 <remark>taroth 2010-03-07: DEVs, please check if the information in the table is still valid</remark>



 <table>
  <title>OCF戻りコード</title>
  <tgroup cols="4">
   <colspec colnum="1" colname="1" colwidth="12*"/>
   <colspec colnum="2" colname="2" colwidth="23*"/>
   <colspec colnum="3" colname="3" colwidth="50*"/>
   <colspec colnum="4" colname="4" colwidth="15*"/>
   <thead>
    <row>
     <entry>
      <para>
       OCF戻りコード
      </para>
     </entry>
     <entry>
      <para>
       OCFエイリアス
      </para>
     </entry>
     <entry>
      <para>
       説明
      </para>
     </entry>
     <entry>
      <para>
       回復の種類
      </para>
     </entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry>
      <para>
       0
      </para>
     </entry>
     <entry>
      <para>
       OCF_SUCCESS
      </para>
     </entry>
     <entry>
      <para>
       成功。コマンドは正常に完了しました。これは、すべてのstart、stop、promote、demoteコマンドの予期された結果です。
      </para>
     </entry>
     <entry>
      <para>
       soft
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       1
      </para>
     </entry>
     <entry>
      <para>
       OCF_ERR_­GENERIC
      </para>
     </entry>
     <entry>
      <para>
       汎用の<quote>問題が発生した</quote>ことを示すエラーコード。
      </para>
     </entry>
     <entry>
      <para>
       soft
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       2
      </para>
     </entry>
     <entry>
      <para>
       OCF_ERR_ARGS
      </para>
     </entry>
     <entry>
      <para>
       リソースの設定がこのマシンで有効ではありません(たとえば、ノード上に見つからない場所/ツールを参照している場合)。
      </para>
     </entry>
     <entry>
      <para>
       hard
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       3
      </para>
     </entry>
     <entry>
      <para>
       OCF_­ERR_­UN­IMPLEMENTED
      </para>
     </entry>
     <entry>
      <para>
       要求されたアクションは実行されていません。
      </para>
     </entry>
     <entry>
      <para>
       hard
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       4
      </para>
     </entry>
     <entry>
      <para>
       OCF_ERR_PERM
      </para>
     </entry>
     <entry>
      <para>
       リソースエージェントに、作業を完了できるだけの権限がありません。
      </para>
     </entry>
     <entry>
      <para>
       hard
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       5
      </para>
     </entry>
     <entry>
      <para>
       OCF_ERR_­INSTALLED
      </para>
     </entry>
     <entry>
      <para>
       リソースが必要とするツールがこのコンピュータにインストールされていません。
      </para>
     </entry>
     <entry>
      <para>
       hard
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       6
      </para>
     </entry>
     <entry>
      <para>
       OCF_ERR_­CONFIGURED
      </para>
     </entry>
     <entry>
      <para>
       リソースの設定が無効です(たとえば、必要なパラメータがないなど)。
      </para>
     </entry>
     <entry>
      <para>
       fatal
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       7
      </para>
     </entry>
     <entry>
      <para>
       OCF_NOT_­RUNNING
      </para>
     </entry>
     <entry>
      <para>
       リソースが実行されていません。クラスタは、どのアクションについてもこれを返すリソースを停止しようとしません。
      </para>
      <para>
       このOCF戻りコードはリソース回復を必要することも必要としないこともあります。予期されたリソースの状態に依存します。予期されない場合は、<literal>soft</literal>回復を行います。
      </para>
     </entry>
     <entry>
      <para>
       N/A
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       8
      </para>
     </entry>
     <entry>
      <para>
       OCF_RUNNING_­PROMOTED
      </para>
     </entry>
     <entry>
      <para>
       リソースはPromotedモードで実行しています。
      </para>
     </entry>
     <entry>
      <para>
       soft
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       9
      </para>
     </entry>
     <entry>
      <para>
       OCF_FAILED_­PROMOTED
      </para>
     </entry>
     <entry>
      <para>
       リソースはPromotedモードですが、失敗しました。リソースは降格、停止され、再度開始されます(昇格されます)。
      </para>
     </entry>
     <entry>
      <para>
       soft
      </para>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       その他
      </para>
     </entry>
     <entry>
      <para>
       該当なし
      </para>
     </entry>
     <entry>
      <para>
       カスタムエラーコード。
      </para>
     </entry>
     <entry>
      <para>
       soft
      </para>
     </entry>
    </row>
   </tbody>
  </tgroup>
 </table>
</sect1>
