<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:dm="urn:x-suse:ns:docmanager" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="ha_requirements.xml" version="5.0" xml:id="cha-ha-requirements">
  <?dbfo-need height="10em"?>


  <title>システム要件と推奨事項</title>
 <info>
      <dm:docmanager>
        <dm:bugtracker>
          <dm:assignee>taroth@suse.com</dm:assignee>
        </dm:bugtracker>
        <dm:translation>yes</dm:translation>
      </dm:docmanager>
      <abstract>
        <para>
    次のセクションでは、<phrase role="roductnamereg"><phrase os="sles">SUSE® Linux Enterprise High Availability Extension</phrase></phrase>のシステム要件と前提条件について説明します。また、クラスタセットアップの推奨事項についても説明します。
   </para>
      </abstract>
    </info>
    <sect1 xml:id="sec-ha-requirements-hw">
  <title>ハードウェア要件</title>

  <para>
   次のリストは、<phrase role="roductnamereg"><phrase os="sles">SUSE® Linux Enterprise High Availability Extension</phrase></phrase>に基づくクラスタのハードウェア要件を指定しています。これらの要件は、最低のハードウェア設定を表しています。クラスタの使用方法によっては、ハードウェアを追加しなければならないこともあります。
  </para>

  <variablelist>
   <varlistentry>
    <term>サーバ</term>
    <listitem>
     <para> <xref linkend="sec-ha-requirements-sw"/>に指定されたソフトウェアを搭載した1～32台のLinuxサーバ。 </para>
     <para>
      サーバはベアメタルでも仮想マシンでも構いません。各サーバが同一のハードウェア設定(メモリ、ディスクスペースなど)になっている必要はありませんが、アーキテクチャは同じである必要があります。クロスプラットフォームのクラスタはサポートされていません。
     </para>
     <para> <literal>pacemaker_remote</literal>を使用すると、32ノード制限を超えて追加のLinuxサーバを含めるようにクラスタを拡張できます。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>通信チャネル</term>
    <listitem>
       <para>
       クラスタノードあたり、少なくとも2つのTCP/IP通信メディア。ネットワーク機器は、クラスタ通信に使用する通信手段(マルチキャストまたはユニキャスト)をサポートする必要があります。通信メディアは100Mbit/s以上のデータレートをサポートする必要があります。サポートされるクラスタセットアップでは、2つ以上の冗長通信パスが必要です。これは次のように実行できます。</para>
       <itemizedlist>
        <listitem>
         <para>
          ネットワークデバイスボンディング(推奨)。
         </para>
        </listitem>
        <listitem>
         <para>
          Corosync内の2つ目の通信チャネル。
         </para>
        </listitem>
       </itemizedlist>
     <para>詳細については、<xref linkend="cha-ha-netbonding"/>と<xref linkend="pro-ha-installation-setup-channel2"/>をそれぞれ参照してください。
      
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>ノードフェンシング/STONITH</term>
    <listitem>
      <para>
      <quote>スプリットブレイン</quote>シナリオを回避するため、クラスタにはノードフェンシングメカニズムが必要です。スプリットブレインシナリオでは、クラスタノードは、お互いを認識していない2つ以上のグループに分割されます(ハードウェアまたはソフトウェアの障害か、ネットワーク接続の切断による)。フェンシングメカニズムにより、問題のあるノードを分離します(通常はノードをリセットするか、ノードの電源をオフにすることによって分離します)。これをSTONITH (<quote>Shoot the other node in the head</quote>)と呼びます。ノードフェンシングメカニズムは、物理デバイス(電源スイッチ)でも、SBD (ディスクによるSTONITH)のようなメカニズムとウォッチドッグを組み合わせたものでも構いません。SBDを使用するには共有ストレージが必要です。
     </para>
     <para>SBDが使用される場合を除き、High Availabilityクラスタの各ノードには少なくとも1つのSTONITHデバイスが必要です。ノードごとに複数のSTONITHデバイスを使用することを強くお勧めします。</para>
      <important>
      <title>STONITHがない場合はサポートなし</title>
      <itemizedlist>
       <listitem>
        <para>クラスタにはノードフェンシングメカニズムが必要です。</para>
       </listitem>
       <listitem>
        <para>グローバルクラスタオプション<systemitem>stonith-enabled</systemitem>および<systemitem>startup-fencing</systemitem>を<literal>true</literal>に設定する必要があります。これらを変更するとサポートされなくなります。</para>
       </listitem>
      </itemizedlist>
      </important>
    </listitem>
  </varlistentry>
  </variablelist>
 </sect1>
<?dbfo-need height="10em"?>


 <sect1 xml:id="sec-ha-requirements-sw">
  <title>ソフトウェアの必要条件</title>

  <para>
   クラスタの一部になるすべてのノードには、少なくとも次のモジュールと拡張機能が含まれている必要があります。
  </para>

<itemizedlist>
   <listitem>
    <para>Base System Module <phrase role="productnumber"><phrase os="sles">15 SP2</phrase></phrase></para>
   </listitem>
   <listitem>
    <para>Server Applications Module <phrase role="productnumber"><phrase os="sles">15 SP2</phrase></phrase></para>
   </listitem>
   <listitem>
    <para><phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> <phrase role="productnumber"><phrase os="sles">15 SP2</phrase></phrase></para>
   </listitem>
  </itemizedlist>

   <para>
   インストール中に選択した<systemitem>システムの役割</systemitem>に応じて、デフォルトで次のソフトウェアパターンがインストールされます。
 </para>
 <table>
  <title>システムの役割とインストールされるパターン</title>
  <tgroup cols="2">
   <colspec colnum="1" colname="1" colwidth="50*"/>
   <colspec colnum="2" colname="2" colwidth="50*"/>
   <thead>
    <row>
     <entry>
      <para>
       システムの役割
      </para>
     </entry>
     <entry>
      <para>
       ソフトウェアパターン(YaST/Zypper)
      </para>
     </entry>
    </row>
   </thead>
   <tbody>
    <row>
     <entry>
      <para>
       HAノード
      </para>
     </entry>
     <entry>
       <itemizedlist>
        <listitem>
         <para>
          High Availability (sles_ha)
         </para>
        </listitem>
        <listitem>
         <para>
         強化された基本システム (enhanced_base)
         </para>
        </listitem>
       </itemizedlist>
     </entry>
    </row>
    <row>
     <entry>
      <para>
       HA GEOノード
      </para>
     </entry>
      <entry>
       <itemizedlist>
        <listitem>
         <para>
          Geo Clustering for High Availability (ha_geo)
         </para>
        </listitem>
        <listitem>
         <para>
          強化された基本システム (enhanced_base)
         </para>
        </listitem>
       </itemizedlist>
      </entry>
    </row>
   </tbody>
  </tgroup>
 </table>
  <note>
   <title>最小インストール</title>
   <para>
    これらのシステムの役割を介してインストールすると、最小限のインストールにのみ抑えられます。必要に応じて、パッケージを手動で追加しなければならない場合があります。</para>
   <para>
    最初別のシステムの役割が割り当てられていたマシンの場合、<systemitem>sles_ha</systemitem>または<systemitem>ha_geo</systemitem>パターンとその他の必要なパッケージを手動でインストールする必要があります。
   </para>
  </note>
 </sect1>
 <sect1 xml:id="sec-ha-requirements-disk">
  <title>ストレージ要件</title>

  <para>
   一部のサービスでは、共有ストレージが必要です。外部NFS共有を使用する場合は、冗長通信パスを介してすべてのクラスタノードから確実にアクセスできる必要があります。</para>
  <para>クラスタでデータの可用性を高めたい場合は、共有ディスクシステム(SAN: Storage Area Network)の利用をお勧めします。共有ディスクシステムを使用する場合は、次の要件を満たしていることを確認してください。
  </para>

  <itemizedlist>
   <listitem>
    <para>
     メーカーの指示のに従い、共有ディスクシステムが適切に設定され、正しく動作していることを確認します。
    </para>
   </listitem>
   <listitem>
    <para>
     共有ディスクシステム中のディスクを、ミラーリングまたはRAIDを使用して耐障害性が高められるように設定してください。
    </para>
   </listitem>
   <listitem>
    <para>
     共有ディスクシステムのアクセスにiSCSIを使用している場合、iSCSIイニシエータとターゲットを正しく設定していることを確認します。
    </para>
   </listitem>
   <listitem>
    <para>
     2台のマシンにデータを配分するミラーリングRAIDシステムを実装するためにDRBD*を使用する際、DRBDに提供されるデバイスにのみアクセスし、決してバッキングデバイスにはアクセスしないようにします。冗長性を確保するために、クラスタの残りの部分と同一のNICを利用できます。
    </para>
   </listitem>
  </itemizedlist>
  <para>
   SBDをSTONITHメカニズムとして使用する場合は、共有ストレージに対して追加の要件が適用されます。詳細については、<xref linkend="sec-ha-storage-protect-req"/>を参照してください。
   </para>
 </sect1>
 <sect1 xml:id="sec-ha-requirements-other">
  <title>その他の要件と推奨事項</title>

  <para>
   サポートされていて、役に立つHigh Availabilityセットアップについては、次の推奨事項を検討してください。
  </para>

  <variablelist>
   <varlistentry xml:id="vle-ha-req-nodes">
    <term>クラスタノード数</term>
    <listitem>
     <para>3つ以上のノードを持つクラスタに対して、奇数のクラスタノードを使用してクォーラムを持つようにすることを強くお勧めします。クォーラムの詳細については、<xref linkend="sec-ha-config-basics-global"/>を参照してください。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>時刻同期</term>
     <listitem>
   <para>
     クラスタノードはクラスタ外のNTPサーバに同期する必要があります。<phrase role="productname"><phrase os="sles">SUSE Linux Enterprise High Availability Extension</phrase></phrase> 15以降、Chronyは、NTPでデフォルトで実装されるようになりました。詳細については、『<link xlink:href="https://documentation.suse.com/sles/15-SP2/html/SLES-all/cha-ntp.html">SUSE Linux Enterprise Server <phrase role="productnumber"><phrase os="sles">15 SP2</phrase></phrase>の
     <citetitle>管理ガイド</citetitle></link>』を参照してください。
    </para>
    <para>
     ノードが同期されていない場合、クラスタが正常に動作しないことがあります。また、同期が行われていないと、ログファイルとクラスタレポートの分析が非常に困難になります。ブートストラップスクリプトを使用するときにNTPがまだ設定されていない場合、警告が表示されます。
    </para>
  </listitem>
   </varlistentry>
   <varlistentry>
    <term>ネットワークインタフェースカード(NIC)名</term>
    <listitem>
     <para>
      すべてのノード上で同一である必要があります。
     </para>
    </listitem>
   </varlistentry>
   <varlistentry>
    <term>ホスト名およびIPアドレス</term>
    <listitem>
     <itemizedlist>
      <listitem>
       <para>
        静的IPアドレスを使用します。
       </para>
      </listitem>
      <listitem>
        <para>
     <filename>/etc/hosts</filename>ファイルにあるすべてのクラスタノードを、完全修飾ホスト名およびショートホスト名で一覧表示します。クラスタのメンバーが名前で互いを見つけられることが重要です。名前を使用できない場合、内部クラスタ通信は失敗します。
   </para>
       <para>
        Pacemakerがノード名を取得する方法の詳細については、<link xlink:href="http://clusterlabs.org/doc/en-US/Pacemaker/1.1/html/Pacemaker_Explained/s-node-name.html"/>も参照してください。
       </para>
      </listitem>
     </itemizedlist>
    </listitem>
   </varlistentry>
   <varlistentry xml:id="vle-ha-req-ssh">
    <term>SSH</term>
    <listitem>
      <para>
    すべてのクラスタノードはSSHによって互いにアクセスできる必要があります。<command>crm report</command> (トラブルシューティング用)などのツールおよびHawk2の<guimenu>履歴エクスプローラ</guimenu>は、ノード間でパスワード不要のSSHアクセスを必要とします。それがない場合、現在のノードからしかデータを収集できません。
  </para>
     <note>
      <title>規定要件</title>
      <para>
       パスワード不要のSSHアクセスが規定要件に適合しない場合は、<xref linkend="app-crmreport-nonroot"/>で説明されている次善策を使用して<command>crm report</command>を実行できます。
      </para>
      <para>
       <guimenu>履歴エクスプローラ</guimenu>については、現在のところ、パスワード不要のログインに代わる方法はありません。
      </para>
     </note>
    </listitem>
   </varlistentry>

  </variablelist>
 </sect1>
</chapter>
