<?xml version="1.0" encoding="UTF-8"?>
<sect1 xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xml:base="geo_ip_i.xml" version="5.0" xml:id="sec.ha.geo.ip.relocation">


 <title>Configuration de la relocalisation d'adresse IP via la mise à jour DNS</title>

 <info>
      <dm:docmanager xmlns:dm="urn:x-suse:ns:docmanager">
        <dm:maintainer/>
        <dm:status>modification</dm:status>
        <dm:deadline/>
        <dm:priority/>
        <dm:translation>oui</dm:translation>
        <dm:languages/>
        <dm:release/>
        <dm:repository/>
      </dm:docmanager>
    </info>
    <para>
  Si un site de votre grappe géographique est arrêté alors qu'il se produit un basculement de ticket, vous devez généralement adapter le routage réseau en conséquence (à moins que vous ayez configuré un basculement de réseau pour chaque ticket). Selon le type de service lié à un ticket, il existe une alternative à la reconfiguration du routage : vous pouvez utiliser une mise à jour DNS dynamique et changer l'adresse IP d'un service.
 </para>

 <para>
  Dans ce cas, les conditions préalables suivantes doivent être remplies :
 </para>

 <itemizedlist>
  <listitem>
   <para>
    Le service concerné par le basculement est lié à un nom d'hôte.
   </para>
  </listitem>
  <listitem>
   <para>
    Votre serveur DNS doit être configuré pour les mises à jour DNS dynamiques. Pour plus d'informations sur la procédure à suivre pour effectuer cette configuration avec BIND/named, reportez-vous à la documentation <literal>named</literal> ou à l'adresse <link xlink:href="http://www.semicomplete.com/articles/dynamic-dns-with-dhcp/"/>. <remark>taroth 2014-11-21: lmb, would you consider the aforementioned link appropriate (WRT to
     our customers and the kind of setup that is needed here)?</remark> Vous trouverez également plus d'informations sur la configuration DNS, y compris la mise à jour dynamique des données de zone, dans le chapitre <citetitle>The Domain Name System</citetitle> (Le système de nom de domaine) du manuel SUSE Linux Enterprise Server 12 SP2 Administration Guide (Guide d'administration de SUSE Linux Enterprise Server 12 SP2) disponible à l'adresse <link xlink:href="http://www.suse.com/documentation/"/>.
   </para>
  </listitem>
  <listitem>
   <para>
    L'exemple suivant suppose que les mises à jour DNS sont protégées par une clé partagée (clé TSIG) pour la zone à mettre à jour. La clé peut être créée à l'aide de <command>dnssec-keygen</command> :
   </para>
<screen><prompt role="root">root # </prompt><command>dnssec-keygen</command> -a hmac-md5 -b 128 -n USER geo-update</screen>
   <para>
    Pour plus d'infos d'informations, reportez-vous à la page du manuel <command>dnssec-keygen</command> ou au manuel SUSE Linux Enterprise Administration Guide (Guide d'administration de SUSE Linux Enterprise), disponible à l'adresse <link xlink:href="http://www.suse.com/documentation/"/>. Reportez-vous au chapitre <citetitle>The Domain Name System</citetitle> (Le système de nom de domaine), section <citetitle>Secure Transactions</citetitle> (Transactions sécurisées).
   </para>
  </listitem>
 </itemizedlist>

 <para>
  L'<xref linkend="ex.ha.geo.dyn.dns.rsc.config"/> montre comment utiliser l'agent de ressource <systemitem>ocf:heartbeat:dnsupdate</systemitem> pour gérer la commande <command>nsupdate</command>. <remark>taroth 2014-11-21: lmb, is the following correct? it
   is mentioned in the description of fate#316112, however, your example in c#9 mentions focuses on
   IPv4 only...</remark> Ce dernier prend en charge les protocoles IPv4 et IPv6.
 </para>

 <example xml:id="ex.ha.geo.dyn.dns.rsc.config">
  <title>Configuration des ressources pour la mise à jour DNS dynamique</title>
<screen><prompt role="custom">crm(live)configure# </prompt><command>primitive</command> dns-update-ip ocf:heartbeat:dnsupdate params \
  hostname="www.domain.com"<co xml:id="co.dyn.dns.hostname"/> ip="192.168.3.4"<co xml:id="co.dyn.dns.ip"/>\
  keyfile="<replaceable>/etc/whereever/Kgeo-update*</replaceable>.key"<co xml:id="co.dyn.dns.key"/>\
  server="192.168.1.1"<co xml:id="co.dyn.dns.srv"/> serverport="53"<co xml:id="co.dyn.dns.srv.port"/></screen>
  <calloutlist>
   <callout arearefs="co.dyn.dns.hostname">
    <para>
     Nom d'hôte lié au service qui doit basculer avec le ticket. L'adresse IP de ce nom d'hôte doit être mise à jour via le DNS dynamique.
    </para>
   </callout>
   <callout arearefs="co.dyn.dns.ip">
    <para>
     Adresse IP du serveur qui héberge le service à migrer. <remark>taroth 2014-11-21:
     lmb, this description taken from fate c#9 is IMHO a bit misleading as it seems to imply that
     this param is about the *current* IP address. However, from the description in
     /usr/lib/ocf/resource.d/heartbeat/dnsupdate, I think this needs to be the IP address that
     will be used for the hostname *after* failover - is that correct?</remark> L'adresse IP spécifiée ici peut également être sous contrôle de grappe. Cela ne gère pas le basculement local, mais garantit que les parties externes seront dirigées vers le site approprié après un basculement de ticket.
    </para>
   </callout>
   <callout arearefs="co.dyn.dns.key">
    <para>
     Chemin d'accès au fichier de clé publique généré avec <command>dnssec-keygen</command>.
    </para>
   </callout>
   <callout arearefs="co.dyn.dns.srv">
    <para>
     Adresse IP du serveur DNS auquel les mises à jour doivent être envoyées. Si aucun serveur n'est spécifié, le système stipule par défaut le serveur maître de la zone appropriée.
    </para>
   </callout>
   <callout arearefs="co.dyn.dns.srv.port">
    <para>
     Port à utiliser pour la communication avec le serveur DNS. Cette option est appliquée uniquement si un serveur DNS est spécifié.
    </para>
   </callout>
  </calloutlist>
  <para>
   Avec la configuration de ressources ci-dessus, l'agent de ressource s'occupe de supprimer le site de grappe géographique qui a échoué de l'enregistrement DNS et de modifier l'adresse IP d'un service via la mise à jour DNS dynamique.
  </para>
 </example>
</sect1>
